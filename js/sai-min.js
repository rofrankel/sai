Sai={};Sai.util={};Sai.imagePath=typeof Sai.imagePath!=="undefined"&&Sai.imagePath!==null?Sai.imagePath:"/static/images/sai/";Sai.util.roundToMag=function(m,p){var g;p=typeof p!=="undefined"&&p!==null?p:0;g=Math.pow(10,p);return parseFloat((Math.round(m/g)*g).toFixed(Math.max(0,p)))};Sai.util.round=function(m,p){return parseFloat((Math.round(m/p)*p).toFixed(Math.max(0,Math.ceil(-1*Math.log(p)/Math.LN10))))};
Sai.util.sumArray=function(m){var p,g,a;a=0;p=m.length;for(g=0;0<=p?g<p:g>p;0<=p?g+=1:g-=1)a+=typeof m[g]==="number"?m[g]:0;return a};Sai.util.prettystr=function(m,p){var g;p=typeof p!=="undefined"&&p!==null?p:2;if(typeof m==="number"){if(Math.abs(m)>=1E12){g="t";m/=1E12}else if(Math.abs(m)>=1E9){g="b";m/=1E9}else if(Math.abs(m)>=1E6){g="m";m/=1E6}else if(Math.abs(m)>=1E3){g="k";m/=1E3}else return String(parseFloat(m.toFixed(p)));return parseFloat(m.toFixed(1))+g}return m};
Sai.util.prettynum=function(m){var p;if(!(isNaN(parseFloat(m))||!String(m).match(/^\d+(\.\d+)?$/))){m=String(m).split(".");for(p=/(\d+)(\d{3})/;p.test(m[0]);)m[0]=m[0].replace(p,"$1,$2");return m[0]+(m.length>1?parseFloat("0."+m[1]).toFixed(2).slice(1):"")}};Sai.util.infoSetters=function(m,p){return[function(){return m(p)},function(){return m()}]};
Sai.util.transformCoords=function(m,p){var g;if(p.getScreenCTM){g=p.createSVGPoint();g.x=m.clientX;g.y=m.clientY;g=g.matrixTransform(p.getScreenCTM().inverse());if(navigator.userAgent.toLowerCase().indexOf("chrome")!==-1||navigator.userAgent.toLowerCase().indexOf("safari")!==-1)g.x+=document.body.scrollLeft;return{x:g.x,y:g.y}}else return{x:event.x,y:event.y}};
Sai.util.multiplyColor=function(m,p,g,a){a=typeof a!=="undefined"&&a!==null?a:0;p=a+(1-a)*p;a=Raphael.getRGB(m);if(g){m=a.r+(255-a.r)*(1-p);g=a.g+(255-a.g)*(1-p);p=a.b+(255-a.b)*(1-p)}else{m=a.r*p;g=a.g*p;p=a.b*p}return{r:m,g:g,b:p,str:"rgb("+m+", "+g+", "+p+")"}};
Sai.util.reflectColor=function(m,p){var g,a,b,c,d,f,e,i,j;f=Raphael.getRGB(m);i=Raphael.getRGB(p);j={};a=["r","g","b"];g=0;for(b=a.length;g<b;g++){d=a[g];c=f[d];e=i[d];j[d]=c===e?c:c>e?e*((255-c)/(255-e)):(255*(e-c)+e*c)/e}return"rgb("+j.r+", "+j.g+", "+j.b+")"};Sai.data=typeof Sai.data!=="undefined"&&Sai.data!==null?Sai.data:{};Sai.data.map=typeof Sai.data.map!=="undefined"&&Sai.data.map!==null?Sai.data.map:{};
Raphael.fn.sai=typeof Raphael.fn.sai!=="undefined"&&Raphael.fn.sai!==null?Raphael.fn.sai:{};Raphael.fn.sai.chart=function(m,p,g,a,b,c){b=typeof{line:Sai.LineChart}[b]!=="undefined"&&{line:Sai.LineChart}[b]!==null?{line:Sai.LineChart}[b]:b;b=typeof b!=="undefined"&&b!==null?b:Sai.Chart;return(new b(this,m,p,g,a,c)).render()};(function(){var m,p=Object.prototype.hasOwnProperty;Raphael.fn.sai.prim=typeof Raphael.fn.sai.prim!=="undefined"&&Raphael.fn.sai.prim!==null?Raphael.fn.sai.prim:{};m=function(g,a,b,c){return[function(){g.attr(a);return c?c[0](g):null},function(){g.attr(b);return c?c[1](g):null}]};Raphael.fn.sai.prim.candlestick=function(g,a,b,c,d,f,e,i,j,h,k){e=typeof e!=="undefined"&&e!==null?e:"#000000";f%2||f++;f=this.rect(g-f/2,a,f,b-a||1).attr("stroke",e);c=this.path("M"+g+" "+c+"L"+g+" "+a+"M"+g+" "+b+"L"+g+
" "+d).attr("stroke",e);f.attr("fill",i?e:"#ffffff");e=this.set().push(f,c);if(j){g=m(e,{scale:"1.5,1.5,"+g+","+(a+(b-a)/2),"fill-opacity":0.5},{scale:"1.0,1.0,"+g+","+(a+(b-a)/2),"fill-opacity":1},k);e.hover(g[0],g[1])}return e};Raphael.fn.sai.prim.line=function(g,a,b){var c,d,f,e;a=typeof a!=="undefined"&&a!==null?a:"#000000";b=typeof b!=="undefined"&&b!==null?b:1;c=0;for(d=g.length;c<d;c++){f=g[c];if(typeof f!=="undefined"&&f!==null)if(typeof e!=="undefined"&&e!==null)e+="L"+f[0]+" "+f[1];else e=
"M"+f[0]+" "+f[1]}return this.path(e).attr({stroke:a,"stroke-width":b})};Raphael.fn.sai.prim.area=function(g,a,b,c){var d,f,e,i,j;if(g.length<2)return this.set();a=typeof a!=="undefined"&&a!==null?a:"#000000";b=typeof b!=="undefined"&&b!==null?b:1;d=0;for(f=g.length;d<f;d++){i=g[d];if(typeof i!=="undefined"&&i!==null)if(typeof j!=="undefined"&&j!==null){j+="L"+i[0]+" "+i[1];e+="L"+i[0]+" "+i[1]}else{j="M"+i[0]+" "+i[1];e="M"+i[0]+" "+i[1]}}for(g=c.length-1;c.length-1<=0?g<=0:g>=0;g+=-1)e+="L"+c[g][0]+
","+c[g][1];c=this.path(e).attr({fill:a,"stroke-width":0,"stroke-opacity":0,"fill-opacity":0.35});a=this.path(j).attr({stroke:a,"stroke-width":b});return this.set().push(c,a)};Raphael.fn.sai.prim.stackedBar=function(g,a,b,c,d,f,e){var i,j,h,k,l,n,o,q;if(d&&typeof(i=g[g.length-1])!=="undefined"&&i!==null)q=c-g[g.length-1][1];b*=0.67;o=this.set();k=c;j=g.length;for(i=0;0<=j?i<j:i>j;0<=j?i+=1:i-=1){n=i;if(typeof(h=g[n])!=="undefined"&&h!==null&&g[n][1]!==c){l=k-g[n][1];k=n===0?1:0;o.push(k=this.rect(g[n][0]-
b/2,g[n][1],b,l-k).attr("fill",(a==undefined?undefined:a[n])||"#000000").attr("stroke",(a==undefined?undefined:a[n])||"#000000"));if(d){l=m(k,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},[function(r){return function(){e[0]&&e[0]();return f({"(selected)":Sai.util.prettystr(r)+"%"},false)}}(100*l/q),e[1]]);k.hover(l[0],l[1])}k=g[n][1]}}return o};Raphael.fn.sai.prim.groupedBar=function(g,a,b,c,d,f,e){var i,j,h,k;f=this.set();j=b/(g.length+1);k=(b-j)/2;b=g.length;for(h=0;0<=b?h<b:h>b;0<=b?h+=1:h-=1)if(typeof(i=
g[h]==undefined?undefined:g[h][0])!=="undefined"&&i!==null)f.push(this.rect(g[h][0]-k+h*j,g[h][1],j-1,c-g[h][1]-0.5).attr("fill",(a==undefined?undefined:a[h])||"#000000").attr("stroke",(a==undefined?undefined:a[h])||"#000000"));if(d){g=m(f,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},e);f.hover(g[0],g[1])}return f};Raphael.fn.sai.prim.haxis=function(g,a,b,c,d,f,e){var i,j,h,k,l,n,o,q,r,u,v,s;e=typeof e!=="undefined"&&e!==null?e:[10,5];d=typeof d!=="undefined"&&d!==null?d:1;f=typeof f!=="undefined"&&
f!==null?f:"#000000";h=this.path("M"+a+" "+b+"l"+c+" 0").attr("stroke",f);u=this.set();j=this.set();q=c/12;q=q<g.length?Math.ceil(g.length/q):1;n=c/(g.length-1)*q;s=a;v=0;r=false;c=0;i=g.length;for(o=0;0<=i?o<i:o>i;o+=q){k=g[o];if(typeof k!=="undefined"&&k!==null){l=e[String(k)?0:1];u.push(this.path("M"+s+" "+b+"l0 "+l).attr("stroke",f));if(k!==""){l=this.text(s,b+l+2,Sai.util.prettystr(k));k=l.getBBox();l.attr("y",l.attr("y")+k.height/2);j.push(l);l=k.width;c=Math.max(l,c);if(k.x-l/2<=v)r=true;v=
Math.max(k.x+l/2,v)}}s+=n}g=this.set().push(h,u,j);if(r){f=j.items;j=0;for(h=f.length;j<h;j++){l=f[j];l.rotate(-90);l.translate(0,l.getBBox().width/2-2)}g.push(this.rect(a,b,1,d+c+e[0]).attr("opacity","0"))}return g};Raphael.fn.sai.prim.vaxis=function(g,a,b,c,d,f,e,i){var j,h,k,l,n,o;i=typeof i!=="undefined"&&i!==null?i:[10,5];e=typeof e!=="undefined"&&e!==null?e:"#000000";f=typeof f!=="undefined"&&f!==null?f:false;k=this.path("M"+a+" "+b+"l0 "+-c).attr("stroke",e);l=this.set();d=this.set();c=c/(g.length-
1);o=b;b=0;for(j=g.length;b<j;b++){n=g[b];if(n!==null){h=i[String(n)?0:1];l.push(this.path("M"+a+" "+o+"l"+(f?h:-h)+" 0").attr("stroke",e));h=this.text(a+(f?1:-1)*(h+2),o,Sai.util.prettystr(n));h.attr({x:h.attr("x")+(f?1:-1)*h.getBBox().width/2,fill:e});d.push(h)}o-=c}return this.set().push(k,l,d)};Raphael.fn.sai.prim.popup=function(g,a,b){var c,d,f,e,i,j;this.set();j=this.set();d=0;f=a+5+5;if("__HEAD__"in b){c=this.text(g,f,b.__HEAD__).attr({fill:"#cfc","font-size":"12","font-weight":"bold"});d=
Math.max(d,c.getBBox().width);j.push(c);f+=17}for(i in b)if(p.call(b,i))if(i!=="__HEAD__"){e=this.text(g+5,f,i+" = "+b[i]).attr({fill:"white","font-weight":"bold"});e.translate(e.getBBox().width/2,0);d=Math.max(d,e.getBBox().width);f+=10;j.push(e)}b=d+10;this.rect(g,a,b,f-a,5).attr({fill:"black","fill-opacity":".85",stroke:"black"});typeof c==="undefined"||c==undefined||c.translate(b/2);return j.toFront()};Raphael.fn.sai.prim.legend=function(g,a,b,c,d){var f,e,i,j,h,k,l,n,o;a-=14;l=this.set();h=g;
k=a;for(o in c)if(p.call(c,o)){n=this.text(h+14,k,o).attr({fill:typeof(f=d==undefined?undefined:d[o])!=="undefined"&&f!==null?d==undefined?undefined:d[o]:"black"});n.translate(n.getBBox().width/2,n.getBBox().height/2);j=this.rect(h,k,9,9).attr({fill:typeof(e=c[o])!=="undefined"&&e!==null?c[o]:"black",stroke:typeof(i=d==undefined?undefined:d[o])!=="undefined"&&i!==null?d==undefined?undefined:d[o]:"black"});j=this.set().push(n,j);if(h-g+15+j.getBBox().width>b){l.translate(0,-14);j.translate(g-h,a-k);
h=g;k=a}h+=j.getBBox().width+15;l.push(j)}return l};Raphael.fn.sai.prim.info=function(g,a,b,c){var d,f,e,i,j,h;i=this.set();e=g;a=a;for(f in c)if(p.call(c,f))if(c[f]!==null){j=this.text(e,a,f+(f===""?"":": ")+(typeof(d=Sai.util.prettynum(c[f]))!=="undefined"&&d!==null?Sai.util.prettynum(c[f]):Sai.util.prettystr(c[f])));h=j.getBBox();j.translate(h.width/2,h.height/2);if(e-g+15+h.width>b){j.translate(g-e,14);e=g;a+=14}e+=h.width+15;i.push(j)}return i};Raphael.fn.sai.prim.hoverShape=function(g,a,b,c){g=
g(this).attr(a);b=m(g,c&&c[0]||{},c&&c[1]||{},b);g.mouseover(b[0]);g.mouseout(b[1]);return g};Raphael.fn.sai.prim.histogram=function(g,a,b,c,d,f,e,i,j,h,k,l){var n,o,q,r;h=typeof h!=="undefined"&&h!==null?h:"#ffffff";l=typeof l!=="undefined"&&l!==null?l:10;r=this.set();r.push(this.rect(g,a-c,b,c).attr({"stroke-width":0,"stroke-opacity":0,fill:h}));c=a-(c-12);a-=5;f=typeof f!=="undefined"&&f!==null?f:0;e=typeof e!=="undefined"&&e!==null?e:1;r.push(f=this.text(g,a,Sai.util.prettystr(f)));f.translate(f.getBBox().width/
2,0);r.push(e=this.text(g+b,a,Sai.util.prettystr(e)));e.translate(-e.getBBox().width/2,0);a-=7;e={};h=f=0;for(n=d.length;h<n;h++){q=d[h];q=Math.min(l-1,Math.floor(l*q/1));if(q in e)e[q]+=1;else e[q]=1;f=Math.max(f,e[q])}r.push(this.path("M"+g+","+a+" l"+b+", 0").attr("stroke",j));a-=1;h=b/l;for(o in e)if(p.call(e,o)){d=(a-c)*(e[o]/f);r.push(this.rect(g+(parseInt(o)+0.2)*h,a-d,h*0.6,d).attr({fill:Sai.util.multiplyColor(j,(parseInt(o)+0.5)/l,k,0.2).str,"stroke-width":k?0.35:0,"stroke-opacity":k?1:0,
stroke:"#000000"}))}r.push(this.text(g+b/2,c-6,Sai.util.prettystr(i)));return r}})();(function(){var m=Object.prototype.hasOwnProperty,p=function(g,a){var b=function(){};b.prototype=a.prototype;g.prototype=new b;g.prototype.constructor=g;typeof a.extended==="function"&&a.extended(g);g.__superClass__=a.prototype};Sai.Plot=function(g,a,b,c,d,f,e,i){this.opts=i;this.rawdata=e;this.data=f;this.h=d;this.w=c;this.y=b;this.x=a;this.r=g;this.opts=typeof this.opts!=="undefined"&&this.opts!==null?this.opts:{};this.setDenormalizedData();this.set=this.r.set();return this};Sai.Plot.prototype.setDenormalizedData=
function(){var g,a,b,c,d,f,e,i,j,h;if(this.data instanceof Array){g=[];b=this.data;a=0;for(c=b.length;a<c;a++){j=b[a];g.push(this.denormalize(j))}return this.dndata=g}else{this.dndata=typeof this.dndata!=="undefined"&&this.dndata!==null?this.dndata:{};g=[];a=this.data;for(h in a)if(m.call(a,h))g.push(this.dndata[h]=function(){d=[];e=this.data[h];f=0;for(i=e.length;f<i;f++){j=e[f];d.push(this.denormalize(j))}return d}.call(this));return g}};Sai.Plot.prototype.denormalize=function(g){if(g instanceof
Array)return[this.x+this.w*g[0],this.y-this.h*g[1]]};Sai.Plot.prototype.render=function(){this.set.push(this.r.rect(20,20,20,20).attr("fill","red"),this.r.circle(40,40,10).attr("fill","blue"));return this};Sai.LinePlot=function(){return Sai.Plot.apply(this,arguments)};p(Sai.LinePlot,Sai.Plot);Sai.LinePlot.prototype.setDenormalizedData=function(){var g,a,b;Sai.LinePlot.__superClass__.setDenormalizedData.apply(this,arguments);g=[];a=this.dndata;for(b in a)if(m.call(a,b))g.push(this.dndata[b].length===
1&&(this.dndata[b]==undefined?undefined:this.dndata[b][0]==undefined?undefined:this.dndata[b][0][0])===this.x?this.dndata[b].push([this.x+this.w,this.dndata[b][0][1]]):null);return g};Sai.LinePlot.prototype.render=function(g,a){var b,c;this.set.remove();b=this.dndata;for(c in b)if(m.call(b,c))c.match("^__")||this.set.push(this.r.sai.prim.line(this.dndata[c],(g==undefined?undefined:g[c])||"black",a||1));return this};Sai.AreaPlot=function(){return Sai.LinePlot.apply(this,arguments)};p(Sai.AreaPlot,
Sai.LinePlot);Sai.AreaPlot.prototype.render=function(g,a,b){var c,d,f,e,i,j,h;this.set.remove();c=this.dndata;for(h in c)if(m.call(c,h))if(!h.match("^__")){d=typeof d!=="undefined"&&d!==null?d:[this.denormalize([0,0]),this.denormalize([1,0])];this.set.push(this.r.sai.prim.area(this.dndata[h],(g==undefined?undefined:g[h])||"black",a||1,d));if(b){d=[];e=this.dndata[h];f=0;for(i=e.length;f<i;f++){j=e[f];d.push([j[0],j[1]-a/2])}d=d}}return this};Sai.CandlestickPlot=function(){return Sai.Plot.apply(this,
arguments)};p(Sai.CandlestickPlot,Sai.Plot);Sai.CandlestickPlot.prototype.render=function(g,a,b,c){var d,f,e,i,j,h,k,l,n;this.set.remove();j=(g==undefined?undefined:g.up)||"black";i=(g==undefined?undefined:g.down)||"red";a=typeof a!=="undefined"&&a!==null?a:5;g=this.dndata.open.length;for(h=0;0<=g?h<g:h>g;0<=g?h+=1:h-=1)if(typeof(d=this.dndata.close[h])!=="undefined"&&d!==null){n=this.dndata.close[h][1]<this.dndata.open[h][1];k={};f=this.rawdata;for(l in f)if(m.call(f,l))k[l]=this.rawdata[l][h];this.set.push(this.r.sai.prim.candlestick(this.dndata.open[h][0],
n&&this.dndata.close[h][1]||this.dndata.open[h][1],n&&this.dndata.open[h][1]||this.dndata.close[h][1],this.dndata.high[h][1],this.dndata.low[h][1],a||5,h&&typeof(e=this.dndata.close[h-1])!=="undefined"&&e!==null&&this.dndata.close[h-1][1]<this.dndata.close[h][1]?i:j,!n,b,c,Sai.util.infoSetters(c,k)))}return this};Sai.BarPlot=function(){return Sai.Plot.apply(this,arguments)};p(Sai.BarPlot,Sai.Plot);Sai.BarPlot.prototype.render=function(g,a,b,c){var d,f,e,i,j,h,k;this.set.remove();j=0;e=[];g=g?this.r.sai.prim.stackedBar:
this.r.sai.prim.groupedBar;d=this.dndata;for(k in d)if(m.call(d,k)){j=this.dndata[k].length;e.push((a==undefined?undefined:a[k])||"black")}for(d=0;0<=j?d<j:d>j;0<=j?d+=1:d-=1){a=[];f=this.dndata;for(k in f)m.call(f,k)&&a.push(this.dndata[k][d]);i={};f=this.rawdata;for(h in f)if(m.call(f,h))i[h]=this.rawdata[h][d];this.set.push(g(a,e,this.w/j,this.y,b,c,Sai.util.infoSetters(c,i)))}return this};Sai.GeoPlot=function(){return Sai.Plot.apply(this,arguments)};p(Sai.GeoPlot,Sai.Plot);Sai.GeoPlot.prototype.getRegionColor=
function(g,a,b){return Sai.util.multiplyColor(g[b],(this.data[b][a]==undefined?undefined:this.data[b][a][1])||0,this.opts.fromWhite,this.opts.fromWhite?0.2:0).str};Sai.GeoPlot.prototype.getRegionOpacity=function(g,a){var b;return typeof(b=this.data[a][g]==undefined?undefined:this.data[a][g][1])!=="undefined"&&b!==null?1:this.opts.fromWhite?0.15:0.25};Sai.GeoPlot.prototype.render=function(g,a,b,c,d,f,e){var i,j,h,k,l;this.set.remove();k=this.rawdata[b];l={};i=k.length;for(h=0;0<=i?h<i:h>i;0<=i?h+=
1:h-=1)l[k[h]]=h;i=a.paths;for(j in i)m.call(i,j)&&function(){var n,o,q,r,u,v=j;u=l[v];q=a.name[v];q={region:typeof q!=="undefined"&&q!==null?q:v};n=this.rawdata;for(o in n)if(m.call(n,o))if(o!==b)q[o]=this.rawdata[o][u];o=this.getRegionColor(g,u,c);u=this.getRegionOpacity(u,c);r=Sai.util.infoSetters(e,q);return this.set.push(this.r.sai.prim.hoverShape(function(s,w,t,z){return function(y){return y.path(s).translate(t,z).scale(w,w,t,z)}}(a.paths[v],Math.min(this.w/a.width,this.h/a.height),this.x,this.y-
this.h),{fill:o,stroke:this.opts.fromWhite?"black":d,"stroke-width":0.5,opacity:u},f?[function(s){navigator.userAgent.toLowerCase().indexOf("msie")!==-1||navigator.userAgent.toLowerCase().indexOf("opera")!==-1||s.toFront();return r[0]()},r[1]]:null,f?[{"fill-opacity":0.75,"stroke-width":this.opts.fromWhite?2:0.5},{"fill-opacity":1,"stroke-width":0.5}]:null))}.call(this);i=this.set.getBBox();this.set.translate((this.w-i.width)/2,(this.h-i.height)/2);return this};Sai.ChromaticGeoPlot=function(){return Sai.GeoPlot.apply(this,
arguments)};p(Sai.ChromaticGeoPlot,Sai.GeoPlot);Sai.ChromaticGeoPlot.prototype.getRegionColor=function(g,a){var b,c,d,f,e,i;f=d=c=0;b=this.data;for(i in b)if(m.call(b,i)){e=Sai.util.multiplyColor(g[i],(this.data[i][a]==undefined?undefined:this.data[i][a][1])||0,this.opts.fromWhite);f+=e.r;d+=e.g;c+=e.b}return"rgb("+f+", "+d+", "+c+")"};Sai.ChromaticGeoPlot.prototype.getRegionOpacity=function(g){var a,b,c;a=this.data;for(c in a)if(m.call(a,c))if(typeof(b=this.data[c][g]==undefined?undefined:this.data[c][g][1])!==
"undefined"&&b!==null)return 1;return 0.25}})();(function(){var m=Object.prototype.hasOwnProperty,p=function(a,b){return function(){return a.apply(b,arguments)}},g=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;typeof b.extended==="function"&&b.extended(a);a.__superClass__=b.prototype};Sai.Chart=function(a,b,c,d,f,e,i,j){var h;this.opts=j;this.__LABELS__=i;this.h=f;this.w=d;this.y=c;this.x=b;this.r=a;h=this;this.drawInfo=function(){return Sai.Chart.prototype.drawInfo.apply(h,arguments)};this.getStackedMax=
function(){return Sai.Chart.prototype.getStackedMax.apply(h,arguments)};this.setData=function(){return Sai.Chart.prototype.setData.apply(h,arguments)};this.opts=typeof this.opts!=="undefined"&&this.opts!==null?this.opts:{};this.opts.bgcolor=typeof this.opts.bgcolor!=="undefined"&&this.opts.bgcolor!==null?this.opts.bgcolor:"white";this.setData(e);this.padding={left:5,right:5,top:5,bottom:5};return this};Sai.Chart.prototype.groupsToNullPad=function(){return[]};Sai.Chart.prototype.nonNegativeGroups=
function(){return[]};Sai.Chart.prototype.setData=function(a){var b,c,d,f,e,i,j,h,k;this.data={};for(k in a)if(m.call(a,k))this.data[k]=a[k]instanceof Array?a[k].slice(0):a[k];a=this.dataGroups(a);h=this.nonNegativeGroups();for(j in a)if(m.call(a,j))if(a[j].length>0)if(function(){for(var l=0,n=h.length;l<n;l++)if(h[l]===j)return true;return false}.call(this)){c=a[j];b=0;for(d=c.length;b<d;b++){k=c[b];if(typeof(e=this.data[k])!=="undefined"&&e!==null){f=this.data[k].length;for(i=0;0<=f?i<f:i>f;0<=f?
i+=1:i-=1)if(this.data[k][i]<0)this.data[k][i]*=-1}}}b=this.groupsToNullPad();e=0;for(c=b.length;e<c;e++){j=b[e];if(j in a){f=a[j];d=0;for(i=f.length;d<i;d++){k=f[d];this.nullPad(k)}}}return this.normalize(this.data)};Sai.Chart.prototype.nullPad=function(a){return a in this.data?this.data[a]=[null].concat(this.data[a].concat([null])):null};Sai.Chart.prototype.caresAbout=function(a){return!(a.match("^__")||a===this.__LABELS__)};Sai.Chart.prototype.dataGroups=function(a){var b,c,d;b=[];for(d in a)m.call(a,
d)&&this.caresAbout(d)&&b.push(d);c=[];for(d in a)if(m.call(a,d))if(d.match("^__")||d===this.__LABELS__)c.push(d);return{all:b,__META__:c}};Sai.Chart.prototype.getYAxisVals=function(a,b,c){var d,f,e;if(a===b)return[0,b,b*2];c=typeof c!=="undefined"&&c!==null?c:false;for(d=1;(b-a)*d<10;)d*=10;a*=d;b*=d;e=Math.floor(f=Math.log(b-a)/Math.LN10-0.4);e=Math.pow(10,e);if(f%1>0.7&&!c)e*=4;else if(f%1>0.35&&!c)e*=2;f=Sai.util.round(a-(c?e/2.1:e/1.9),e);if(f<=0&&0<=a)f=0;a=Sai.util.round(b+(c?e/2.1:e/1.9),
e);f/=d;a/=d;e/=d;d=[];for(b=f;f<=a?b<=a:b>=a;b+=e)d.push(Sai.util.round(b,e));return d};Sai.Chart.prototype.getMax=function(a,b){var c,d,f,e,i,j,h,k,l,n;return Math.max.apply(Math,function(){c=[];d=0;for(f=b.length;d<f;d++){n=b[d];if(typeof(k=a[n])!=="undefined"&&k!==null)c.push(Math.max.apply(Math,function(){e=[];j=a[n];i=0;for(h=j.length;i<h;i++){l=j[i];typeof l!=="undefined"&&l!==null&&typeof l==="number"&&e.push(l)}return e}()))}return c}())};Sai.Chart.prototype.getMin=function(a,b){var c,d,
f,e,i,j,h,k,l,n;return Math.min.apply(Math,function(){c=[];d=0;for(f=b.length;d<f;d++){n=b[d];if(typeof(k=a[n])!=="undefined"&&k!==null)c.push(Math.min.apply(Math,function(){e=[];j=a[n];i=0;for(h=j.length;i<h;i++){l=j[i];typeof l!=="undefined"&&l!==null&&typeof l==="number"&&e.push(l)}return e}()))}return c}())};Sai.Chart.prototype.getStackedMax=function(a,b){var c,d,f,e,i,j,h;return Math.max.apply(Math,function(){c=[];d=a[this.__LABELS__].length;for(j=0;0<=d?j<d:j>d;0<=d?j+=1:j-=1)c.push(Sai.util.sumArray(function(){f=
[];e=0;for(i=b.length;e<i;e++){h=b[e];h!==this.__LABELS__&&f.push(a[h][j])}return f}.call(this)));return c}.call(this))};Sai.Chart.prototype.getStackedMin=function(){return 0};Sai.Chart.prototype.normalize=function(a){var b,c,d,f,e,i,j,h,k,l,n,o,q,r,u,v,s,w,t,z,y,B,x,A;w=this.dataGroups(a);this.ndata={};if(typeof(b=this.opts.stacked)!=="undefined"&&b!==null)this.stackedNdata={};b=function(D,C,E){if(typeof D==="number")return C===E?1:(D-C)/(E-C);return null};for(s in w)if(m.call(w,s))if(!(s.match("^__")||
Sai.util.sumArray(function(){c=[];f=w[s];d=0;for(e=f.length;d<e;d++){x=f[d];c.push(this.data[x].length)}return c}.call(this))===0)){this.ndata[s]={};if(typeof(i=this.opts.stacked)!=="undefined"&&i!==null){this.stackedNdata[s]={};v={}}y=this.opts.stacked?this.getStackedMin:this.getMin;j=this.opts.stacked?this.getStackedMax:this.getMax;y=y(a,w[s]);z=j(a,w[s]);A=this.getYAxisVals(y,z);y=A[0];z=A[A.length-1];h=w[s];j=0;for(k=h.length;j<k;j++){x=h[j];if(typeof(l=a[x])!=="undefined"&&l!==null){var F=this.ndata[s],
G=x;n=[];o=a[x].length;for(t=0;0<=o?t<o:t>o;0<=o?t+=1:t-=1)n.push(typeof(q=a[x][t])!=="undefined"&&q!==null&&(B=b(a[x][t],y,z))!==null?[t/(a[x].length-1||1),B]:null);F[G]=n;if(typeof(u=this.opts.stacked)!=="undefined"&&u!==null){this.stackedNdata[s][x]=[];n=a[x].length;for(t=0;0<=n?t<n:t>n;0<=n?t+=1:t-=1){o=v[t]||0;o=[t/(a[x].length-1||1),typeof(r=a[x][t])!=="undefined"&&r!==null&&(B=b(a[x][t],y,z))!==null?B+o:o];this.stackedNdata[s][x].push(o);if(o!==null)v[t]=o[1]}}this.ndata[s].__YVALS__=A}}}return[]};
Sai.Chart.prototype.addAxes=function(a,b){var c,d,f,e,i,j,h;this.axisWidth=1.5;this.padding.top+=5;for(h=this.data[this.__LABELS__].length-1;this.data[this.__LABELS__].length-1<=0?h<=0:h>=0;this.data[this.__LABELS__].length-1<=0?h+=1:h-=1)if(typeof(c=this.data[this.__LABELS__][h])!=="undefined"&&c!==null){c=this.r.text(0,0,Sai.util.prettystr(this.data[this.__LABELS__][h]));this.padding.right+=c.getBBox().width/2;c.remove();break}h=this.h-(this.padding.bottom+this.padding.top);c=this.r.sai.prim.vaxis(typeof(d=
this.ndata[a]==undefined?undefined:this.ndata[a].__YVALS__)!=="undefined"&&d!==null?this.ndata[a]==undefined?undefined:this.ndata[a].__YVALS__:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,h,this.axisWidth);d=c.getBBox().width;c.remove();if(typeof b!=="undefined"&&b!==null){c=this.r.sai.prim.vaxis(typeof(f=this.ndata[b]==undefined?undefined:this.ndata[b].__YVALS__)!=="undefined"&&f!==null?this.ndata[b]==undefined?undefined:this.ndata[b].__YVALS__:[0,"?"],this.x+this.padding.left,this.y-
this.padding.bottom,h,this.axisWidth);f=c.getBBox().width;c.remove()}else f=0;this.haxis=this.r.sai.prim.haxis(this.data[this.__LABELS__],this.x+this.padding.left+d,this.y-this.padding.bottom,this.w-this.padding.left-this.padding.right-d-f,this.axisWidth);f=this.haxis.getBBox().height;if(isNaN(f))f=1;this.haxis.translate(0,-f);this.padding.bottom+=f;h=this.h-(this.padding.bottom+this.padding.top);this.vaxis=this.r.sai.prim.vaxis(typeof(e=this.ndata[a]==undefined?undefined:this.ndata[a].__YVALS__)!==
"undefined"&&e!==null?this.ndata[a]==undefined?undefined:this.ndata[a].__YVALS__:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,h,this.axisWidth);this.vaxis.translate(this.vaxis.getBBox().width,0);this.padding.left+=this.vaxis.getBBox().width;if(typeof b!=="undefined"&&b!==null){this.vaxis_right=this.r.sai.prim.vaxis(typeof(i=this.ndata[b]==undefined?undefined:this.ndata[b].__YVALS__)!=="undefined"&&i!==null?this.ndata[b]==undefined?undefined:this.ndata[b].__YVALS__:[0,"?"],this.w-this.padding.right,
this.y-this.padding.bottom,h,this.axisWidth,true,typeof(j=this.colors.__RIGHTAXIS__)!=="undefined"&&j!==null?this.colors.__RIGHTAXIS__:"blue");this.vaxis_right.translate(-this.vaxis_right.getBBox().width,0);this.padding.right+=this.vaxis_right.getBBox().width}this.setPlotCoords();return this.r.set().push(this.haxis).push(this.vaxis)};Sai.Chart.prototype.setPlotCoords=function(){this.px=this.x+this.padding.left;this.py=this.y-this.padding.bottom;this.pw=this.w-this.padding.left-this.padding.right;
return this.ph=this.h-this.padding.bottom-this.padding.top};Sai.Chart.prototype.drawBG=function(){var a,b,c,d;return this.bg=this.r.rect(typeof(a=this.px)!=="undefined"&&a!==null&&this.px||this.x,typeof(b=this.py)!=="undefined"&&b!==null&&this.py-this.ph||this.y-this.h,typeof(c=this.pw)!=="undefined"&&c!==null&&this.pw||this.w,typeof(d=this.ph)!=="undefined"&&d!==null&&this.ph||this.h).attr({fill:this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack()};Sai.Chart.prototype.logoPos=function(){var a,
b,c,d,f;f=typeof(a=this.px)!=="undefined"&&a!==null&&typeof(b=this.pw)!=="undefined"&&b!==null?this.px+this.pw-160-5:this.w+this.x-160-this.padding.right;a=typeof(c=this.py)!=="undefined"&&c!==null&&typeof(d=this.ph)!=="undefined"&&d!==null?this.py-this.ph+5:this.y-this.h+this.padding.top;return[f,a,160,34]};Sai.Chart.prototype.drawLogo=function(){var a;a=this.logoPos();return this.logo=this.r.image(Sai.imagePath+"logo.png",a[0],a[1],a[2],a[3]).attr({opacity:0.25})};Sai.Chart.prototype.render=function(){this.plot=
typeof this.plot!=="undefined"&&this.plot!==null?this.plot:new Sai.Plot(this.r);this.plot.render();return this};Sai.Chart.prototype.showError=function(a){return this.r.text(this.x+this.w/2,this.y-this.h/2,a)};Sai.Chart.prototype.setColors=function(a){var b;this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};for(b in a)if(m.call(a,b))if(b in this.data)this.colors[b]=a[b];return this};Sai.Chart.prototype.setColor=function(a,b){this.colors=typeof this.colors!=="undefined"&&
this.colors!==null?this.colors:{};this.colors[a]=b;return this};Sai.Chart.prototype.drawGuideline=function(a,b){var c;b=typeof b!=="undefined"&&b!==null?b:"all";if(!(typeof(c=this.ndata[b]==undefined?undefined:this.ndata[b].__YVALS__)!=="undefined"&&c!==null))return null;c=this.ndata[b].__YVALS__[0];if(!(a>c))return null;c=(a-c)/(this.ndata[b].__YVALS__[this.ndata[b].__YVALS__.length-1]-c);this.guidelines=typeof this.guidelines!=="undefined"&&this.guidelines!==null?this.guidelines:this.r.set();c=
new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,{guideline:[[0,c],[1,c]]});c.render({guideline:"#ccc"});return this.guidelines.push(c.set)};Sai.Chart.prototype.drawLegend=function(a){var b,c,d,f,e,i,j;if(a=typeof a!=="undefined"&&a!==null?a:this.colors){d={};i={};b=a;for(j in b)if(m.call(b,j))if(j!==this.__LABELS__){d[j]=a[j];i[j]="black";if(typeof(e=this.opts.groups==undefined?undefined:this.opts.groups.right)!=="undefined"&&e!==null)if(function(){for(var h=0,k=(f=this.opts.groups.right).length;h<
k;h++)if(f[h]===j)return true;return false}.call(this))i[j]=typeof(c=this.colors.__RIGHTAXIS__)!=="undefined"&&c!==null?this.colors.__RIGHTAXIS__:"blue"}this.legend=this.r.sai.prim.legend(this.x,this.y-this.padding.bottom,this.w,d,i);if(this.legend.length>0)this.padding.bottom+=this.legend.getBBox().height+15;return this.legend.translate((this.w-this.legend.getBBox().width)/2,0)}};Sai.Chart.prototype.drawTitle=function(){var a;if(typeof(a=this.opts.title)!=="undefined"&&a!==null){this.title=this.r.text(this.x+
this.w/2,this.y-this.h,this.opts.title).attr({"font-size":20});this.title.translate(0,this.title.getBBox().height/2);return this.padding.top+=this.title.getBBox().height+5}};Sai.Chart.prototype.setupInfoSpace=function(){this.info_y=this.y-this.h+this.padding.top;this.info_x=this.x+this.padding.left;this.info_w=this.w-this.padding.left-this.padding.right;return this.padding.top+=30};Sai.Chart.prototype.drawInfo=function(a,b){var c,d,f;b=typeof b!=="undefined"&&b!==null?b:true;a=typeof a!=="undefined"&&
a!==null?a:typeof(c=this.default_info)!=="undefined"&&c!==null?this.default_info():{};if(b)this.info_data={};this.info&&this.info.remove();c=a;for(f in c)if(m.call(c,f))f.match("^__")||(this.info_data[f]=typeof(d=a[f])!=="undefined"&&d!==null?a[f]:"(no data)");return this.info=this.r.sai.prim.info(this.info_x,this.info_y,this.info_w,this.info_data)};Sai.Chart.prototype.getIndex=function(a){a=Sai.util.transformCoords(a,this.r.canvas).x;return Math.round((this.data[this.__LABELS__].length-1)*(a-this.px)/
this.pw)};Sai.LineChart=function(){return Sai.Chart.apply(this,arguments)};g(Sai.LineChart,Sai.Chart);Sai.LineChart.prototype.nonNegativeGroups=function(){return this.opts.stacked?["all","left","right"]:[]};Sai.LineChart.prototype.dataGroups=function(){var a,b,c;c=Sai.LineChart.__superClass__.dataGroups.apply(this,arguments);if(typeof(a=this.opts.groups==undefined?undefined:this.opts.groups.left)!=="undefined"&&a!==null&&typeof(b=this.opts.groups==undefined?undefined:this.opts.groups.right)!=="undefined"&&
b!==null){c.left=this.opts.groups.left;c.right=this.opts.groups.right}return c};Sai.LineChart.prototype.render=function(){var a,b,c,d,f,e,i,j;this.drawTitle();this.setupInfoSpace();this.drawLegend();(i="left"in this.ndata&&"right"in this.ndata)?this.addAxes("left","right"):this.addAxes("all");this.drawBG();this.drawLogo();this.drawGuideline(0);this.lines=[];this.dots=this.r.set();e=typeof(a=this.opts.stacked)!=="undefined"&&a!==null?this.stackedNdata:this.ndata;a=this.opts.area?Sai.AreaPlot:Sai.LinePlot;
this.plotSets=this.r.set();this.plots=[];if(i){this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,e.left)).render(this.colors,typeof(b=this.opts.lineWidth)!=="undefined"&&b!==null?this.opts.lineWidth:2,this.opts.stacked));this.plotSets.push(this.plots[0].set);this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,e.right)).render(this.colors,typeof(c=this.opts.lineWidth)!=="undefined"&&c!==null?this.opts.lineWidth:2,this.opts.stacked));this.plotSets.push(this.plots[1].set)}else{this.plots.push((new a(this.r,
this.px,this.py,this.pw,this.ph,e.all)).render(this.colors,typeof(d=this.opts.lineWidth)!=="undefined"&&d!==null?this.opts.lineWidth:2,this.opts.stacked));this.plotSets.push(this.plots[0].set)}b=e.all;for(j in b)if(m.call(b,j))if(j!=="__YVALS__")this.dots.push(this.r.circle(0,0,4).attr({fill:typeof(f=this.colors==undefined?undefined:this.colors[j])!=="undefined"&&f!==null?this.colors==undefined?undefined:this.colors[j]:"black"}).hide());this.r.set().push(this.bg,this.plotSets,this.dots,this.logo,
this.guidelines).mousemove(p(function(h){var k,l,n,o,q,r,u,v,s,w;u=this.getIndex(h);v={};v[this.__LABELS__]=this.data[this.__LABELS__][u];h=e.all;for(j in h)if(m.call(h,j))if(typeof(k=this.data[j])!=="undefined"&&k!==null)v[j]=this.data[j][u];this.drawInfo(v);r=0;k=[];h=e.all;for(j in h)m.call(h,j)&&j!=="__YVALS__"&&k.push(function(){l=[];o=this.plots;n=0;for(q=o.length;n<q;n++){s=o[n];j in s.dndata&&l.push(function(){w=s.dndata[j][u];typeof w!=="undefined"&&w!==null?this.dots[r].attr({cx:w[0],cy:w[1]}).show().toFront():
this.dots[r].hide();return r++}.call(this))}return l}.call(this));return k},this)).mouseout(p(function(){this.drawInfo({},true);return this.dots.hide()},this));this.logo==undefined||this.logo.toFront();return this};Sai.Sparkline=function(){return Sai.Chart.apply(this,arguments)};g(Sai.Sparkline,Sai.Chart);Sai.Sparkline.prototype.dataGroups=function(){return{data:["data"]}};Sai.Sparkline.prototype.render=function(){this.drawBG();this.plots=this.r.set();this.plots.push((new Sai.LinePlot(this.r,this.x,
this.y,this.w,this.h,this.ndata.data)).render({data:this.colors&&this.colors[series]||"black"},1).set);return this};Sai.BarChart=function(){return Sai.Chart.apply(this,arguments)};g(Sai.BarChart,Sai.Chart);Sai.BarChart.prototype.getMin=function(){return 0};Sai.BarChart.prototype.groupsToNullPad=function(){var a,b,c;a=[];b=this.dataGroups();for(c in b)m.call(b,c)&&a.push(c);return a};Sai.BarChart.prototype.nonNegativeGroups=function(){var a,b,c;a=[];b=this.dataGroups();for(c in b)m.call(b,c)&&a.push(c);
return a};Sai.BarChart.prototype.render=function(){var a,b,c,d,f,e,i;this.drawTitle();this.setupInfoSpace();this.drawLegend();this.addAxes("all");this.drawLogo();this.drawBG();if("all"in this.ndata){this.guidelines=this.r.set();b=this.ndata.all.__YVALS__;a=0;for(c=b.length;a<c;a++){i=b[a];this.drawGuideline(i)}}this.plots=this.r.set();a={};c={};c[this.__LABELS__]=this.data[this.__LABELS__];b=typeof(d=this.opts.stacked)!=="undefined"&&d!==null?this.stackedNdata:this.ndata;d=b.all;for(e in d)if(m.call(d,
e))if(!(e.match("^__")||e===this.__LABELS__)){a[e]=b.all[e];c[e]=this.data[e]}this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph,a,c)).render(typeof(f=this.opts.stacked)!=="undefined"&&f!==null,this.colors,this.opts.interactive,this.drawInfo).set);this.logo==undefined||this.logo.toFront();return this};Sai.StockChart=function(){return Sai.Chart.apply(this,arguments)};g(Sai.StockChart,Sai.Chart);Sai.StockChart.prototype.groupsToNullPad=function(){return["prices","volume","__META__"]};
Sai.StockChart.prototype.dataGroups=function(a){var b,c;b={__META__:[this.__LABELS__]};if("volume"in this.data)b.volume=["volume"];for(c in a)if(m.call(a,c))if(this.caresAbout(c)&&!(this.__LABELS__===c||"volume"===c)){b.prices=typeof b.prices!=="undefined"&&b.prices!==null?b.prices:[];b.prices.push(c)}return b};Sai.StockChart.prototype.nonNegativeGroups=function(){return["volume"]};Sai.StockChart.prototype.render=function(){var a,b,c,d,f,e,i;if(!(typeof(a=this.ndata.prices)!=="undefined"&&a!==null&&
"open"in this.ndata.prices&&"close"in this.ndata.prices&&"high"in this.ndata.prices&&"low"in this.ndata.prices)){this.showError("This chart requires data series named 'open', 'close', 'high', and 'low'.\n \nOnce you add series with these names, the chart will display.");return null}this.drawTitle();this.setupInfoSpace();d={};b=false;a=this.ndata.prices;for(i in a)if(m.call(a,i))if(!("open"===i||"close"===i||"high"===i||"low"===i)&&!(i.match("^__")||i===this.__LABELS__)){d[i]=(this.colors==undefined?
undefined:this.colors[i])||"black";b=true}b&&this.drawLegend(d);this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};this.colors.up=typeof this.colors.up!=="undefined"&&this.colors.up!==null?this.colors.up:"black";this.colors.down=typeof this.colors.down!=="undefined"&&this.colors.down!==null?this.colors.down:"red";this.colors.vol_up=typeof this.colors.vol_up!=="undefined"&&this.colors.vol_up!==null?this.colors.vol_up:"#666666";this.colors.vol_down=typeof this.colors.vol_down!==
"undefined"&&this.colors.vol_down!==null?this.colors.vol_down:"#cc6666";this.addAxes("prices");this.drawLogo();this.drawBG();this.drawGuideline(0,"prices");this.plots=this.r.set();d={up:[],down:[]};a={};b=this.ndata.prices;for(f in b)if(m.call(b,f))f.match("^__")||f===this.__LABELS__||(a[f]=this.data[f]);if(typeof(c=this.data.volume)!=="undefined"&&c!==null)a.vol=this.data.volume;if("volume"in this.ndata){c=this.ndata.volume.volume.length;for(f=0;0<=c?f<c:f>c;0<=c?f+=1:f-=1)if(this.ndata.volume.volume[f]!==
null)if(f&&this.ndata.prices.close[f-1]&&this.ndata.prices.close[f][1]<this.ndata.prices.close[f-1][1]){d.down.push(this.ndata.volume.volume[f]);d.up.push([this.ndata.volume.volume[f][0],0])}else{d.up.push(this.ndata.volume.volume[f]);d.down.push([this.ndata.volume.volume[f][0],0])}else{d.up.push([0,0]);d.down.push([0,0])}this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph*0.2,d,a)).render(true,{up:this.colors.vol_up,down:this.colors.vol_down}).set)}this.plots.push((new Sai.CandlestickPlot(this.r,
this.px,this.py,this.pw,this.ph,{open:this.ndata.prices.open,close:this.ndata.prices.close,high:this.ndata.prices.high,low:this.ndata.prices.low},a)).render(this.colors,Math.min(5,this.pw/this.ndata.prices.open.length-2)).set);f={};c=this.ndata.prices;for(i in c)if(m.call(c,i))"open"===i||"close"===i||"high"===i||"low"===i||i.match("^__")||i===this.__LABELS__||(f[i]=this.ndata.prices[i]);this.plots.push((new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,f)).render(this.colors).set);e=this.pw/
(this.data[this.__LABELS__].length-1);this.glow=this.r.rect(this.px-e/2,this.py-this.ph,e,this.ph).attr({fill:"0-"+this.opts.bgcolor+"-#DDAA99-"+this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack().hide();this.bg.toBack();this.r.set().push(this.bg,this.plots,this.logo,this.glow,this.guidelines).mousemove(p(function(j){var h,k,l,n,o;l=this.getIndex(j);n={};n[this.__LABELS__]=this.data[this.__LABELS__][l];o=false;j=this.ndata.prices;for(i in j)if(m.call(j,i))if(!(i.match("^__")||i===this.__LABELS__))if(typeof(h=
this.data[i]==undefined?undefined:this.data[i][l])!=="undefined"&&h!==null){n[i]=this.data[i][l];o=true}if(typeof(k=this.data.volume==undefined?undefined:this.data.volume[l])!=="undefined"&&k!==null){n.volume=this.data.volume[l];o=true}this.drawInfo(n);return o?this.glow.attr({x:this.px+e*(l-0.5)}).show():null},this)).mouseout(p(function(){this.drawInfo({},true);return this.glow.hide()},this));this.logo==undefined||this.logo.toFront();return this};Sai.GeoChart=function(){var a;a=this;this.renderPlot=
function(){return Sai.GeoChart.prototype.renderPlot.apply(a,arguments)};return Sai.Chart.apply(this,arguments)};g(Sai.GeoChart,Sai.Chart);Sai.GeoChart.prototype.plotType=Sai.GeoPlot;Sai.GeoChart.prototype.interactiveHistogram=true;Sai.GeoChart.prototype.getMax=function(a){return Math.max.apply(Math,a)};Sai.GeoChart.prototype.getMin=function(a){return Math.min.apply(Math,a)};Sai.GeoChart.prototype.normalize=function(a){var b,c,d,f,e,i,j,h,k,l,n,o,q;this.ndata={};this.bounds={};k={};l={};for(q in a)if(m.call(a,
q))if(!(q.match("^__")||q===this.__LABELS__))if(typeof(b=a[q])!=="undefined"&&b!==null){c=[];f=a[q];d=0;for(e=f.length;d<e;d++){h=f[d];typeof h!=="undefined"&&h!==null&&c.push(h)}c=c;k[q]=this.getMax(c,q);if(!(typeof n!=="undefined"&&n!==null)||k[q]>n)n=k[q];l[q]=this.getMin(c,q);if(!(typeof o!=="undefined"&&o!==null)||l[q]<o)o=l[q]}for(q in a)if(m.call(a,q))if(!(q.match("^__")||q===this.__LABELS__))if(typeof(i=a[q])!=="undefined"&&i!==null){if(this.opts.groupedNormalization){f=n;e=o}else{f=k[q];
e=l[q]}this.bounds[q]=[e,f];h=this.ndata;var r=q;b=[];c=a[q].length;for(d=0;0<=c?d<c:d>c;0<=c?d+=1:d-=1)b.push(typeof(j=a[q][d])!=="undefined"&&j!==null?[d/(a[q].length-1),(a[q][d]-e)/(f-e)]:null);h[r]=b}return[]};Sai.GeoChart.prototype.dataGroups=function(a){var b,c;b=[];for(c in a)if(m.call(a,c))if(c.match("^__")||c===this.__LABELS__)b.push(c);b={__META__:b};for(c in a)if(m.call(a,c))c.match("^__")||c===this.__LABELS__||(b[c]=[c]);return b};Sai.GeoChart.prototype.drawHistogramLegend=function(a){var b,
c,d,f,e,i,j,h,k,l,n,o,q,r;this.histogramLegend=this.r.set();k=Math.max(0.1*(this.h-this.padding.bottom-this.padding.top),50);q=Math.min(150,(this.w-this.padding.left-this.padding.right-20)/a.length);b=a.length;for(n=0;0<=b?n<b:n>b;0<=b?n+=1:n-=1){o=a[n];l=this.x+n*q;c=[];d=this.ndata[o].length;for(e=0;0<=d?e<d:e>d;0<=d?e+=1:e-=1)if(typeof(f=this.ndata[o][e])!=="undefined"&&f!==null)c.push(this.ndata[o][e][1]);c=c;if(typeof(i=this.bounds==undefined?undefined:this.bounds[o])!=="undefined"&&i!==null){e=
this.bounds[o];d=e[0];e=e[1]}else{d=[];j=this.data[o];e=0;for(h=j.length;e<h;e++){r=j[e];typeof r!=="undefined"&&r!==null&&d.push(r)}d=d;e=[Math.min.apply(Math,d),Math.max.apply(Math,d)];d=e[0];e=e[1]}e=this.getYAxisVals(d,e,true);d=e[0];e=e[e.length-1];this.histogramLegend.push(l=this.r.sai.prim.histogram(l,this.y-this.padding.bottom,q*0.8,k,c,d,e,o,this.colors[o],"white",this.opts.fromWhite));this.opts.interactive&&this.setupHistogramInteraction(l,o)}this.histogramLegend.translate((this.w-this.padding.left-
this.padding.right-this.histogramLegend.getBBox().width)/2,0);return this.padding.bottom+=k+5};Sai.GeoChart.prototype.setupHistogramInteraction=function(a,b){return a.click(p(function(){return this.renderPlot(b)},this)).hover(p(function(c){return p(function(){c.attr({"fill-opacity":0.75});return this.drawInfo({"Click to display on map":b})},this)},this)(a),p(function(c){return p(function(){c.attr({"fill-opacity":1});return this.drawInfo()},this)},this)(a))};Sai.GeoChart.prototype.renderPlot=function(a){this.geoPlot==
undefined||this.geoPlot.set.remove();this.geoPlot=(new this.plotType(this.r,this.px,this.py,this.pw,this.ph,this.ndata,this.data,{fromWhite:this.opts.fromWhite})).render(this.colors||{},this.data.__MAP__,this.__LABELS__,a,this.opts.bgcolor,this.opts.interactive,this.drawInfo);return this.logo==undefined?undefined:this.logo.toFront()};Sai.GeoChart.prototype.default_info=function(){return{"":this.opts.interactive?"Click histogram below to change map display":""}};Sai.GeoChart.prototype.render=function(){var a,
b,c;this.drawTitle();this.setupInfoSpace();this.drawHistogramLegend(function(){a=[];b=this.data;for(c in b)if(m.call(b,c))c.match("^__")||c===this.__LABELS__||a.push(c);return a}.call(this));this.setPlotCoords();this.drawLogo();this.drawBG();this.drawInfo();this.renderPlot(this.data.__DEFAULT__);return this};Sai.ChromaticGeoChart=function(){return Sai.GeoChart.apply(this,arguments)};g(Sai.ChromaticGeoChart,Sai.GeoChart);Sai.ChromaticGeoChart.prototype.plotType=Sai.ChromaticGeoPlot;Sai.ChromaticGeoChart.prototype.interactiveHistogram=
false;Sai.ChromaticGeoChart.prototype.default_info=function(){return{}};Sai.ChromaticGeoChart.prototype.setupHistogramInteraction=function(){return false}})();
