Sai={};Sai.util={};Sai.imagePath=typeof Sai.imagePath!=="undefined"&&Sai.imagePath!==null?Sai.imagePath:"/static/images/sai/";Sai.util.roundToMag=function(o,q){var i;q=typeof q!=="undefined"&&q!==null?q:0;i=Math.pow(10,q);return parseFloat((Math.round(o/i)*i).toFixed(Math.max(0,q)))};Sai.util.round=function(o,q){return parseFloat((Math.round(o/q)*q).toFixed(Math.max(0,Math.ceil(-1*Math.log(q)/Math.LN10))))};
Sai.util.sumArray=function(o){var q,i,a;a=0;q=o.length;for(i=0;0<=q?i<q:i>q;0<=q?i+=1:i-=1)a+=typeof o[i]==="number"?o[i]:0;return a};Sai.util.prettystr=function(o,q){var i;q=typeof q!=="undefined"&&q!==null?q:2;if(typeof o==="number"){if(Math.abs(o)>=1E12){i="t";o/=1E12}else if(Math.abs(o)>=1E9){i="b";o/=1E9}else if(Math.abs(o)>=1E6){i="m";o/=1E6}else if(Math.abs(o)>=1E3){i="k";o/=1E3}else return String(parseFloat(o.toFixed(q)));return parseFloat(o.toFixed(1))+i}return o};
Sai.util.prettynum=function(o){var q;if(!(isNaN(parseFloat(o))||!String(o).match(/^[-+]?\d+(\.\d+)?$/))){o=String(o).split(".");for(q=/(\d+)(\d{3})/;q.test(o[0]);)o[0]=o[0].replace(q,"$1,$2");return o[0]+(o.length>1?parseFloat("0."+o[1]).toFixed(2).slice(1):"")}};Sai.util.infoSetters=function(o,q){return[function(){return o(q)},function(){return o()}]};
Sai.util.transformCoords=function(o,q){var i;if(q.getScreenCTM){i=q.createSVGPoint();i.x=o.clientX;i.y=o.clientY;i=i.matrixTransform(q.getScreenCTM().inverse());if(navigator.userAgent.toLowerCase().indexOf("chrome")!==-1||navigator.userAgent.toLowerCase().indexOf("safari")!==-1)i.x+=document.body.scrollLeft;return{x:i.x,y:i.y}}else return{x:o.x,y:o.y}};
Sai.util.multiplyColor=function(o,q,i,a){a=typeof a!=="undefined"&&a!==null?a:0;q=a+(1-a)*q;a=Raphael.getRGB(o);if(i){o=a.r+(255-a.r)*(1-q);i=a.g+(255-a.g)*(1-q);q=a.b+(255-a.b)*(1-q)}else{o=a.r*q;i=a.g*q;q=a.b*q}return{r:o,g:i,b:q,str:"rgb("+o+", "+i+", "+q+")"}};Sai.util.colerp=function(o,q,i){o=Raphael.getRGB(o);q=Raphael.getRGB(q);return"rgb("+(q.r*i+o.r*(1-i))+", "+(q.g*i+o.g*(1-i))+", "+(q.b*i+o.b*(1-i))+")"};
Sai.util.reflectColor=function(o,q){var i,a,b,c,e,f,d,g,h;f=Raphael.getRGB(o);g=Raphael.getRGB(q);h={};a=["r","g","b"];i=0;for(b=a.length;i<b;i++){e=a[i];c=f[e];d=g[e];h[e]=c===d?c:c>d?d*((255-c)/(255-d)):(255*(d-c)+d*c)/d}return"rgb("+h.r+", "+h.g+", "+h.b+")"};Sai.data=typeof Sai.data!=="undefined"&&Sai.data!==null?Sai.data:{};Sai.data.map=typeof Sai.data.map!=="undefined"&&Sai.data.map!==null?Sai.data.map:{};
Raphael.fn.sai=typeof Raphael.fn.sai!=="undefined"&&Raphael.fn.sai!==null?Raphael.fn.sai:{};Raphael.fn.sai.chart=function(o,q,i,a,b,c){b=typeof{line:Sai.LineChart}[b]!=="undefined"&&{line:Sai.LineChart}[b]!==null?{line:Sai.LineChart}[b]:b;b=typeof b!=="undefined"&&b!==null?b:Sai.Chart;return(new b(this,o,q,i,a,c)).render()};(function(){var o,q=Object.prototype.hasOwnProperty;Raphael.fn.sai.prim=typeof Raphael.fn.sai.prim!=="undefined"&&Raphael.fn.sai.prim!==null?Raphael.fn.sai.prim:{};o=function(i,a,b,c){return[function(){i.attr(a);return c?c[0](i):null},function(){i.attr(b);return c?c[1](i):null}]};Raphael.fn.sai.prim.candlestick=function(i,a,b,c,e,f,d,g,h,k,j){d=typeof d!=="undefined"&&d!==null?d:"#000000";f%2||f++;f=this.rect(i-f/2,a,f,b-a||1).attr("stroke",d);c=this.path("M"+i+" "+c+"L"+i+" "+a+"M"+i+" "+b+"L"+i+
" "+e).attr("stroke",d);f.attr("fill",g?d:"#ffffff");d=this.set().push(f,c);if(h){i=o(d,{scale:"1.5,1.5,"+i+","+(a+(b-a)/2),"fill-opacity":0.5},{scale:"1.0,1.0,"+i+","+(a+(b-a)/2),"fill-opacity":1},j);d.hover(i[0],i[1])}return d};Raphael.fn.sai.prim.line=function(i,a,b){var c,e,f,d;a=typeof a!=="undefined"&&a!==null?a:"#000000";b=typeof b!=="undefined"&&b!==null?b:1;c=0;for(e=i.length;c<e;c++){f=i[c];if(typeof f!=="undefined"&&f!==null)if(typeof d!=="undefined"&&d!==null)d+="L"+f[0]+" "+f[1];else d=
"M"+f[0]+" "+f[1]}return this.path(d).attr({stroke:a,"stroke-width":b})};Raphael.fn.sai.prim.area=function(i,a,b,c){var e,f,d,g,h;if(i.length<2)return this.set();a=typeof a!=="undefined"&&a!==null?a:"#000000";b=typeof b!=="undefined"&&b!==null?b:1;e=0;for(f=i.length;e<f;e++){g=i[e];if(typeof g!=="undefined"&&g!==null)if(typeof h!=="undefined"&&h!==null){h+="L"+g[0]+" "+g[1];d+="L"+g[0]+" "+g[1]}else{h="M"+g[0]+" "+g[1];d="M"+g[0]+" "+g[1]}}for(i=c.length-1;c.length-1<=0?i<=0:i>=0;i+=-1)d+="L"+c[i][0]+
","+c[i][1];c=this.path(d).attr({fill:a,"stroke-width":0,"stroke-opacity":0,"fill-opacity":0.35});a=this.path(h).attr({stroke:a,"stroke-width":b});return this.set().push(c,a)};Raphael.fn.sai.prim.stackedBar=function(i,a,b,c,e,f,d){var g,h,k,j,l,m,n,p;if(e&&typeof(g=i[i.length-1])!=="undefined"&&g!==null)p=c-i[i.length-1][1];b*=0.67;n=this.set();j=c;h=i.length;for(g=0;0<=h?g<h:g>h;0<=h?g+=1:g-=1){m=g;if(typeof(k=i[m])!=="undefined"&&k!==null&&i[m][1]!==c){l=j-i[m][1];j=m===0?1:0;n.push(j=this.rect(i[m][0]-
b/2,i[m][1],b,l-j).attr("fill",(typeof a==="undefined"||a===null?undefined:a[m])||"#000000").attr("stroke",(typeof a==="undefined"||a===null?undefined:a[m])||"#000000"));if(e){l=o(j,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},[function(r){return function(){d[0]&&d[0]();return f({"(selected)":Sai.util.prettystr(r)+"%"},false)}}(100*l/p),d[1]]);j.hover(l[0],l[1])}j=i[m][1]}}return n};Raphael.fn.sai.prim.groupedBar=function(i,a,b,c,e,f,d){var g,h,k,j,l,m;f=this.set();h=b/(i.length+1);m=(b-h)/2;b=
i.length;for(l=0;0<=b?l<b:l>b;0<=b?l+=1:l-=1)if(typeof(g=i[l]==null?undefined:i[l][0])!=="undefined"&&g!==null){k=Math.min(i[l][1],c);j=Math.max(i[l][1],c)-k-0.5;f.push(this.rect(i[l][0]-m+l*h,k,h-1,j).attr("fill",(typeof a==="undefined"||a===null?undefined:a[l])||"#000000").attr("stroke",(typeof a==="undefined"||a===null?undefined:a[l])||"#000000"))}if(e){i=o(f,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},d);f.hover(i[0],i[1])}return f};Raphael.fn.sai.prim.haxis=function(i,a,b,c,e){var f,d,g,h,
k,j,l,m,n,p,r,y,w,x,t,s,A,u,z,B;t=typeof(f=e.ticklens)!=="undefined"&&f!==null?f:[5,2];f=typeof(d=e.width)!=="undefined"&&d!==null?d:1;d=typeof(g=e.color)!=="undefined"&&g!==null?g:"black";y=this.path("M"+a+" "+b+"l"+c+" 0").attr("stroke",d);s=this.set();r=this.set();g=c/20;p=g<i.length?Math.ceil(i.length/g):1;m=c/(i.length-1)*p;z=a;u=-1;x=false;g=0;B=null;h=i.length;for(n=0;0<=h?n<h:n>h;n+=p){j=i[n];if(typeof j!=="undefined"&&j!==null){l=t[String(j)?0:1];s.push(this.path("M"+z+" "+b+"l0 "+l).attr("stroke",
d));if(j!==""){l=this.text(z,b+l+2,Sai.util.prettystr(j));j=l.getBBox();w=l.attr("y")+j.height/2;l.attr("y",w);if(!(typeof B!=="undefined"&&B!==null)||w<B)B=w;r.push(l);l=j.width;g=Math.max(l,g);if(j.x<=u)x=true;if(j.x+l>u)u=j.x+l}}z+=m}if(typeof(k=e.title)!=="undefined"&&k!==null)A=this.text(a+c/2,B+14,e.title).attr({"font-size":"12px","font-weight":"bold"});i=this.set().push(y,s,r,A);if(x){e=r.items;c=0;for(k=e.length;c<k;c++){l=e[c];l.rotate(-90);l.translate(0,l.getBBox().width/2-2)}i.push(this.rect(a,
b,1,f+g+t[0]).attr("opacity","0"))}return i};Raphael.fn.sai.prim.vaxis=function(i,a,b,c,e){var f,d,g,h,k,j,l,m,n,p,r,y,w,x,t,s;y=typeof(f=e.ticklens)!=="undefined"&&f!==null?f:[5,2];f=typeof(d=e.color)!=="undefined"&&d!==null?d:"black";r=typeof(g=e.right)!=="undefined"&&g!==null?g:false;d=this.path("M"+a+" "+b+"l0 "+-c).attr("stroke",f);w=this.set();g=this.set();m=c/(i.length-1);s=b;t=null;h=0;for(k=i.length;h<k;h++){n=i[h];if(n!==null){p=y[String(n)?0:1];w.push(this.path("M"+a+" "+s+"l"+(r?p:-p)+
" 0").attr("stroke",f));p=a+(r?1:-1)*(p+3);n=this.text(p,s,Sai.util.prettystr(n));n.attr({"text-anchor":r?"start":"end",fill:f});p+=(r?1:-1)*(n.getBBox().width+8);if(!(typeof t!=="undefined"&&t!==null)||p<t)t=p;g.push(n)}s-=m}if(typeof(j=e.title)!=="undefined"&&j!==null){x=this.text(t,b-c/2,e.title).attr({"font-size":"12px","font-weight":"bold"});i=x.getBBox();x.rotate(-90);l=this.rect(i.x+(i.width-i.height)/2,b,i.height,1).attr({opacity:0})}l=typeof l!=="undefined"&&l!==null?l:null;return this.set().push(this.set().push(d,
w,g,l),x)};Raphael.fn.sai.prim.popup=function(i,a,b){var c,e,f,d,g,h;this.set();h=this.set();e=0;f=a+5+5;if("__HEAD__"in b){c=this.text(i,f,b.__HEAD__).attr({fill:"#cfc","font-size":"12","font-weight":"bold"});e=Math.max(e,c.getBBox().width);h.push(c);f+=17}for(g in b)if(q.call(b,g))if(g!=="__HEAD__"){d=this.text(i+5,f,g+" = "+b[g]).attr({fill:"white","font-weight":"bold"});d.translate(d.getBBox().width/2,0);e=Math.max(e,d.getBBox().width);f+=10;h.push(d)}b=e+10;this.rect(i,a,b,f-a,5).attr({fill:"black",
"fill-opacity":".85",stroke:"black"});typeof c==="undefined"||c===null||c.translate(b/2);return h.toFront()};Raphael.fn.sai.prim.legend=function(i,a,b,c,e){var f,d,g,h,k,j,l,m,n;a-=14;l=this.set();k=i;j=a;for(n in c)if(q.call(c,n)){m=this.text(k+14,j,n).attr({fill:typeof(f=typeof e==="undefined"||e===null?undefined:e[n])!=="undefined"&&f!==null?f:"black"});m.translate(m.getBBox().width/2,m.getBBox().height/2);h=this.rect(k,j,9,9).attr({fill:typeof(d=c[n])!=="undefined"&&d!==null?d:"black",stroke:typeof(g=
typeof e==="undefined"||e===null?undefined:e[n])!=="undefined"&&g!==null?g:"black"});h=this.set().push(m,h);if(k-i+15+h.getBBox().width>b){l.translate(0,-14);h.translate(i-k,a-j);k=i;j=a}k+=h.getBBox().width+15;l.push(h)}return l};Raphael.fn.sai.prim.info=function(i,a,b,c){var e,f,d,g,h,k;g=this.set();d=i;a=a;for(f in c)if(q.call(c,f))if(c[f]!==null){h=f+(f===""?"":": ");h+=typeof c[f]==="string"?c[f]:typeof(e=Sai.util.prettynum(c[f]))!=="undefined"&&e!==null?e:Sai.util.prettystr(c[f]);h=this.text(d,
a,h);k=h.getBBox();h.translate(k.width/2,k.height/2);if(d-i+15+k.width>b){h.translate(i-d,14);d=i;a+=14}d+=k.width+15;g.push(h)}return g};Raphael.fn.sai.prim.hoverShape=function(i,a,b,c){i=i(this).attr(a);b=o(i,c&&c[0]||{},c&&c[1]||{},b);i.mouseover(b[0]);i.mouseout(b[1]);return i};Raphael.fn.sai.prim.histogram=function(i,a,b,c,e,f,d,g,h,k,j,l){var m,n,p,r;k=typeof k!=="undefined"&&k!==null?k:"white";h=typeof h!=="undefined"&&h!==null?h:"black";l=typeof l!=="undefined"&&l!==null?l:10;r=this.set();
r.push(this.rect(i,a-c,b,c).attr({"stroke-width":0,"stroke-opacity":0,fill:k}));c=a-(c-12);a-=5;f=typeof f!=="undefined"&&f!==null?f:0;d=typeof d!=="undefined"&&d!==null?d:1;r.push(f=this.text(i,a,Sai.util.prettystr(f)));f.translate(f.getBBox().width/2,0);r.push(d=this.text(i+b,a,Sai.util.prettystr(d)));d.translate(-d.getBBox().width/2,0);a-=7;d={};k=f=0;for(m=e.length;k<m;k++){p=e[k];p=Math.min(l-1,Math.floor(l*p/1));if(p in d)d[p]+=1;else d[p]=1;f=Math.max(f,d[p])}r.push(this.path("M"+i+","+a+" l"+
b+", 0").attr("stroke",h));a-=1;k=b/l;for(n in d)if(q.call(d,n)){e=(a-c)*(d[n]/f);r.push(this.rect(i+(parseInt(n)+0.2)*k,a-e,k*0.6,e).attr({fill:Sai.util.multiplyColor(h,(parseInt(n)+0.5)/l,j,0.2).str,"stroke-width":j?0.35:0,"stroke-opacity":j?1:0,stroke:"#000000"}))}r.push(this.text(i+b/2,c-6,Sai.util.prettystr(g)));return r}})();(function(){var o=Object.prototype.hasOwnProperty,q=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;typeof b.extended==="function"&&b.extended(a);a.__super__=b.prototype},i=function(a,b){return function(){return a.apply(b,arguments)}};Sai.Plot=function(a,b,c,e,f,d,g,h){this.opts=h;this.rawdata=g;this.data=d;this.h=f;this.w=e;this.y=c;this.x=b;this.r=a;this.opts=typeof this.opts!=="undefined"&&this.opts!==null?this.opts:{};this.setDenormalizedData();
this.set=this.r.set();return this};Sai.Plot.prototype.setDenormalizedData=function(){var a,b,c,e,f,d,g,h,k,j;if(this.data instanceof Array){a=[];c=this.data;b=0;for(e=c.length;b<e;b++){k=c[b];a.push(this.denormalize(k))}return this.dndata=a}else{this.dndata=typeof this.dndata!=="undefined"&&this.dndata!==null?this.dndata:{};a=[];b=this.data;for(j in b)if(o.call(b,j))a.push(this.dndata[j]=function(){f=[];g=this.data[j];d=0;for(h=g.length;d<h;d++){k=g[d];f.push(this.denormalize(k))}return f}.call(this));
return a}};Sai.Plot.prototype.denormalize=function(a){if(a instanceof Array)return[this.x+this.w*a[0],this.y-this.h*a[1]]};Sai.Plot.prototype.render=function(){this.set.push(this.r.rect(20,20,20,20).attr("fill","red"),this.r.circle(40,40,10).attr("fill","blue"));return this};Sai.LinePlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.LinePlot,Sai.Plot);Sai.LinePlot.prototype.setDenormalizedData=function(){var a,b,c;Sai.LinePlot.__super__.setDenormalizedData.apply(this,arguments);a=[];b=this.dndata;
for(c in b)if(o.call(b,c))a.push(this.dndata[c].length===1&&(this.dndata[c]==null?undefined:this.dndata[c][0]==null?undefined:this.dndata[c][0][0])===this.x?this.dndata[c].push([this.x+this.w,this.dndata[c][0][1]]):null);return a};Sai.LinePlot.prototype.render=function(a,b){var c,e;this.set.remove();c=this.dndata;for(e in c)if(o.call(c,e))e.match("^__")||this.set.push(this.r.sai.prim.line(this.dndata[e],(typeof a==="undefined"||a===null?undefined:a[e])||"black",b||1));return this};Sai.AreaPlot=function(){return Sai.LinePlot.apply(this,
arguments)};q(Sai.AreaPlot,Sai.LinePlot);Sai.AreaPlot.prototype.render=function(a,b,c,e){var f,d,g,h,k,j,l,m,n;this.set.remove();j=[this.denormalize([0,e]),this.denormalize([1,e])];e=this.dndata;for(n in e)if(o.call(e,n))if(!n.match("^__")){f=this.dndata[n].length;for(g=0;0<=f?g<f:g>f;0<=f?g+=1:g-=1){l=this.dndata[n][g];if(typeof l!=="undefined"&&l!==null)break}for(g=this.dndata[n].length-1;this.dndata[n].length-1<=0?g<=0:g>=0;this.dndata[n].length-1<=0?g+=1:g-=1){m=this.dndata[n][g];if(typeof m!==
"undefined"&&m!==null)break}typeof d!=="undefined"&&d!==null&&c||(d=[[l[0],j[0][1]],[m[0],j[1][1]]]);this.set.push(this.r.sai.prim.area(this.dndata[n],(typeof a==="undefined"||a===null?undefined:a[n])||"black",b||1,d));if(c){d=[];g=this.dndata[n];f=0;for(h=g.length;f<h;f++){k=g[f];d.push([k[0],k[1]-b/2])}d=d}}return this};Sai.CandlestickPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.CandlestickPlot,Sai.Plot);Sai.CandlestickPlot.prototype.render=function(a,b,c,e){var f,d,g,h,k,j,l,m,
n;this.set.remove();k=(typeof a==="undefined"||a===null?undefined:a.up)||"black";h=(typeof a==="undefined"||a===null?undefined:a.down)||"red";b=typeof b!=="undefined"&&b!==null?b:5;a=this.dndata.open.length;for(j=0;0<=a?j<a:j>a;0<=a?j+=1:j-=1)if(typeof(f=this.dndata.close[j])!=="undefined"&&f!==null){n=this.dndata.close[j][1]<this.dndata.open[j][1];l={};d=this.rawdata;for(m in d)if(o.call(d,m))l[m]=this.rawdata[m][j];this.set.push(this.r.sai.prim.candlestick(this.dndata.open[j][0],n&&this.dndata.close[j][1]||
this.dndata.open[j][1],n&&this.dndata.open[j][1]||this.dndata.close[j][1],this.dndata.high[j][1],this.dndata.low[j][1],b||5,j&&typeof(g=this.dndata.close[j-1])!=="undefined"&&g!==null&&this.dndata.close[j-1][1]<this.dndata.close[j][1]?h:k,!n,c,e,Sai.util.infoSetters(e,l)))}return this};Sai.BarPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.BarPlot,Sai.Plot);Sai.BarPlot.prototype.render=function(a,b,c,e,f){var d,g,h,k,j,l,m;this.set.remove();b=this.denormalize([0,b])[1];j=0;h=[];a=a?this.r.sai.prim.stackedBar:
this.r.sai.prim.groupedBar;d=this.dndata;for(m in d)if(o.call(d,m)){j=this.dndata[m].length;h.push((typeof c==="undefined"||c===null?undefined:c[m])||"black")}for(d=0;0<=j?d<j:d>j;0<=j?d+=1:d-=1){c=[];g=this.dndata;for(m in g)o.call(g,m)&&c.push(this.dndata[m][d]);k={};g=this.rawdata;for(l in g)if(o.call(g,l))k[l]=this.rawdata[l][d];this.set.push(a(c,h,this.w/j,b,e,f,Sai.util.infoSetters(f,k)))}return this};Sai.GeoPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.GeoPlot,Sai.Plot);Sai.GeoPlot.prototype.getRegionColor=
function(a,b,c){return Sai.util.multiplyColor(a[c],(this.data[c][b]==null?undefined:this.data[c][b][1])||0,this.opts.fromWhite,this.opts.fromWhite?0.2:0).str};Sai.GeoPlot.prototype.getRegionOpacity=function(a,b){var c;return typeof(c=this.data[b][a]==null?undefined:this.data[b][a][1])!=="undefined"&&c!==null?1:this.opts.fromWhite?0.15:0.25};Sai.GeoPlot.prototype.render=function(a,b,c,e,f,d,g){var h,k,j,l,m,n,p;this.set.remove();h=[];j=this.rawdata[c];k=0;for(l=j.length;k<l;k++){n=j[k];h.push(n.toUpperCase())}p=
{};k=h.length;for(j=0;0<=k?j<k:j>k;0<=k?j+=1:j-=1)p[h[j]]=j;h=b.paths;for(m in h)o.call(h,m)&&function(){var r,y,w,x,t,s=m;t=p[s];w=b.name[s];w={region:typeof w!=="undefined"&&w!==null?w:s};r=this.rawdata;for(y in r)if(o.call(r,y))if(y!==c)w[y]=this.rawdata[y][t];y=this.getRegionColor(a,t,e);t=this.getRegionOpacity(t,e);x=Sai.util.infoSetters(g,w);return this.set.push(this.r.sai.prim.hoverShape(function(A,u,z,B){return function(E){return E.path(A).translate(z,B).scale(u,u,z,B)}}(b.paths[s],Math.min(this.w/
b.width,this.h/b.height),this.x,this.y-this.h),{fill:y,stroke:this.opts.fromWhite?"black":f,"stroke-width":0.5,opacity:t},d?[function(A){navigator.userAgent.toLowerCase().indexOf("msie")!==-1||navigator.userAgent.toLowerCase().indexOf("opera")!==-1||A.toFront();return x[0]()},x[1]]:null,d?[{"fill-opacity":0.75,"stroke-width":this.opts.fromWhite?2:0.5},{"fill-opacity":1,"stroke-width":0.5}]:null))}.call(this);h=this.set.getBBox();this.set.translate((this.w-h.width)/2,(this.h-h.height)/2);return this};
Sai.ChromaticGeoPlot=function(){return Sai.GeoPlot.apply(this,arguments)};q(Sai.ChromaticGeoPlot,Sai.GeoPlot);Sai.ChromaticGeoPlot.prototype.getRegionColor=function(a,b){var c,e,f,d,g,h;d=f=e=0;c=this.data;for(h in c)if(o.call(c,h)){g=Sai.util.multiplyColor(a[h],(this.data[h][b]==null?undefined:this.data[h][b][1])||0,this.opts.fromWhite);d+=g.r;f+=g.g;e+=g.b}return"rgb("+d+", "+f+", "+e+")"};Sai.ChromaticGeoPlot.prototype.getRegionOpacity=function(a){var b,c,e;b=this.data;for(e in b)if(o.call(b,e))if(typeof(c=
this.data[e][a]==null?undefined:this.data[e][a][1])!=="undefined"&&c!==null)return 1;return 0.25};Sai.ScatterPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.ScatterPlot,Sai.Plot);Sai.ScatterPlot.prototype.render=function(a,b,c,e,f){var d,g,h,k,j,l;this.set.remove();d=this.dndata;for(j in d)if(o.call(d,j)){k=this.dndata[j].length;break}h=function(m,n,p){return n*p+m*(1-p)};l=i(function(m){return this.x+this.w*((m-this.y)/-this.h)},this);for(g=0;0<=k?g<k:g>k;0<=k?g+=1:g-=1)(function(){var m,
n,p,r,y,w,x,t,s,A,u,z,B,E,v=g;B=l(this.dndata[a.x]==null?undefined:this.dndata[a.x][v][1]);E=this.dndata[a.y]==null?undefined:this.dndata[a.y][v][1];A=b instanceof Array&&typeof(n=a.color)!=="undefined"&&n!==null?Sai.util.colerp(b[0],b[1],typeof(m=this.data[a.color]==null?undefined:this.data[a.color][v]==null?undefined:this.data[a.color][v][1])!=="undefined"&&m!==null?m:0):b instanceof Object&&typeof(p=a.color)!=="undefined"&&p!==null?b[this.rawdata[a.color][v]]:"black";m=c instanceof Array&&typeof(y=
a.radius)!=="undefined"&&y!==null?h(c[0],c[1],typeof(r=this.data[a.radius]==null?undefined:this.data[a.radius][v]==null?undefined:this.data[a.radius][v][1])!=="undefined"&&r!==null?r:0):c instanceof Object&&typeof(w=a.radius)!=="undefined"&&w!==null?c[this.rawdata[a.radius][v]]:5;r=e instanceof Array&&typeof(t=a.stroke_opacity)!=="undefined"&&t!==null?h(e[0],e[1],typeof(x=this.data[a.stroke_opacity]==null?undefined:this.data[a.stroke_opacity][v]==null?undefined:this.data[a.stroke_opacity][v][1])!==
"undefined"&&x!==null?x:0):e instanceof Object&&typeof(s=a.stroke_opacity)!=="undefined"&&s!==null?e[this.rawdata[a.stroke_opacity][v]]:1;t={};x=this.rawdata;for(z in x)if(o.call(x,z))z.match("^__")||(t[z]=this.rawdata[z][v]);u=Sai.util.infoSetters(f,t);return this.set.push(this.r.circle(B,E,m).attr({fill:A,"stroke-opacity":r}).attr({"fill-opacity":0.8,"stroke-width":2}).hover(function(){u[0]();return this.attr("fill-opacity",0.5)},function(){u[1]();return this.attr("fill-opacity",0.8)}))}).call(this);
return this}})();(function(){var o=Object.prototype.hasOwnProperty,q=function(a,b){return function(){return a.apply(b,arguments)}},i=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;typeof b.extended==="function"&&b.extended(a);a.__super__=b.prototype};Sai.Chart=function(a,b,c,e,f,d,g,h){var k;this.opts=h;this.__LABELS__=g;this.h=f;this.w=e;this.y=c;this.x=b;this.r=a;k=this;this.drawInfo=function(){return Sai.Chart.prototype.drawInfo.apply(k,arguments)};this.getStackedMax=
function(){return Sai.Chart.prototype.getStackedMax.apply(k,arguments)};this.opts=typeof this.opts!=="undefined"&&this.opts!==null?this.opts:{};this.opts.bgcolor=typeof this.opts.bgcolor!=="undefined"&&this.opts.bgcolor!==null?this.opts.bgcolor:"white";this.setData(d);this.padding={left:5,right:5,top:5,bottom:5};return this};Sai.Chart.prototype.groupsToNullPad=function(){return[]};Sai.Chart.prototype.nonNegativeGroups=function(){return[]};Sai.Chart.prototype.nextSeriesSuffix=function(){var a;this.suffixCtr=
(typeof(a=this.suffixCtr)!=="undefined"&&a!==null?a:0)+1;return"["+this.suffixCtr+"]"};Sai.Chart.prototype.fixSeriesName=function(a){return a+(a.match(/^\s+$/)?this.nextSeriesSuffix():"")};Sai.Chart.prototype.setData=function(a){var b,c,e,f,d,g,h,k,j,l,m;this.data={};this.renames={};for(m in a)if(o.call(a,m)){for(;;){h=this.fixSeriesName(m);if(h===m||!(h in a))break}this.renames[m]=h;if(a[m]instanceof Array)if(this.__LABELS__===m){this.__LABELS__=h;var n=this.data,p=h;b=[];e=a[m];c=0;for(f=e.length;c<
f;c++){d=e[c];b.push(String(d))}n[p]=b}else{n=this.data;p=h;b=[];e=a[m];c=0;for(f=e.length;c<f;c++){d=e[c];b.push(typeof d==="string"&&d.match(/^[+-]?[\d,]+(\.\d+)?$/)&&!isNaN(g=parseFloat(d.replace(",","")))?g:d)}n[p]=b}else this.data[h]=a[m]}a=this.dataGroups(this.data);l=this.nonNegativeGroups();for(j in a)if(o.call(a,j))if(a[j].length>0)if(function(){for(var r=0,y=l.length;r<y;r++)if(l[r]===j)return true;return false}.call(this)){g=a[j];d=0;for(h=g.length;d<h;d++){m=g[d];if(typeof(k=this.data[m])!==
"undefined"&&k!==null){b=this.data[m].length;for(c=0;0<=b?c<b:c>b;0<=b?c+=1:c-=1)if(this.data[m][c]<0)this.data[m][c]*=-1}}}d=this.groupsToNullPad();k=0;for(g=d.length;k<g;k++){j=d[k];if(j in a){b=a[j];h=0;for(c=b.length;h<c;h++){m=b[h];this.nullPad(m)}}}return this.normalize(this.data)};Sai.Chart.prototype.nullPad=function(a){return a in this.data?this.data[a]=[null].concat(this.data[a].concat([null])):null};Sai.Chart.prototype.caresAbout=function(a){return!(a.match("^__")||a===this.__LABELS__)};
Sai.Chart.prototype.dataGroups=function(a){var b,c,e;b=[];for(e in a)o.call(a,e)&&this.caresAbout(e)&&b.push(e);c=[];for(e in a)if(o.call(a,e))if(e.match("^__")||e===this.__LABELS__)c.push(e);return{all:b,__META__:c}};Sai.Chart.prototype.getYAxisVals=function(a,b,c){var e,f,d;if(a===b)return[0,b,b*2];c=typeof c!=="undefined"&&c!==null?c:false;for(e=1;(b-a)*e<10;)e*=10;a*=e;b*=e;d=Math.floor(f=Math.log(b-a)/Math.LN10-0.4);d=Math.pow(10,d);if(f%1>0.7&&!c)d*=4;else if(f%1>0.35&&!c)d*=2;f=Sai.util.round(a-
(c?d/2.1:d/1.75),d);if(f<0&&0<=a)f=0;a=Sai.util.round(b+(c?d/2.1:d/1.75),d);f/=e;a/=e;d/=e;e=[];for(b=f;f<=a?b<=a:b>=a;b+=d)e.push(Sai.util.round(b,d));return e};Sai.Chart.prototype.getMax=function(a,b){var c,e,f,d,g,h,k,j,l,m;return Math.max.apply(Math,function(){c=[];e=0;for(f=b.length;e<f;e++){m=b[e];if(typeof(j=a[m])!=="undefined"&&j!==null)c.push(Math.max.apply(Math,function(){d=[];h=a[m];g=0;for(k=h.length;g<k;g++){l=h[g];typeof l!=="undefined"&&l!==null&&typeof l==="number"&&d.push(l)}return d}()))}return c}())};
Sai.Chart.prototype.getMin=function(a,b){var c,e,f,d,g,h,k,j,l,m;return Math.min.apply(Math,function(){c=[];e=0;for(f=b.length;e<f;e++){m=b[e];if(typeof(j=a[m])!=="undefined"&&j!==null)c.push(Math.min.apply(Math,function(){d=[];h=a[m];g=0;for(k=h.length;g<k;g++){l=h[g];typeof l!=="undefined"&&l!==null&&typeof l==="number"&&d.push(l)}return d}()))}return c}())};Sai.Chart.prototype.getStackedMax=function(a,b){var c,e,f,d,g,h,k;return Math.max.apply(Math,function(){c=[];e=a[this.__LABELS__].length;for(h=
0;0<=e?h<e:h>e;0<=e?h+=1:h-=1)c.push(Sai.util.sumArray(function(){f=[];d=0;for(g=b.length;d<g;d++){k=b[d];k!==this.__LABELS__&&f.push(a[k][h])}return f}.call(this)));return c}.call(this))};Sai.Chart.prototype.getStackedMin=function(){return 0};Sai.Chart.prototype.normalize=function(a){var b,c,e,f,d,g,h,k,j,l,m,n,p,r,y,w,x,t,s,A,u,z,B,E,v,G;A=this.dataGroups(a);this.ndata={};if(typeof(b=this.opts.stacked)!=="undefined"&&b!==null)this.stackedNdata={};B=function(F,C,D){if(typeof F==="number")return C===
D?1:(F-C)/(D-C);return null};b=function(F,C){var D,H,I;D=0;for(H=C.length;D<H;D++){I=C[D];if(!F(I))return false}return true};t=function(F){var C,D,H;C=0;for(D=F.length;C<D;C++){H=F[C];if(typeof H==="number")return false}return true};for(s in A)if(o.call(A,s)){if(!(g=s.match("^__"))){if(!(g=Sai.util.sumArray(function(){c=[];f=A[s];e=0;for(d=f.length;e<d;e++){v=f[e];c.push(this.data[v].length)}return c}.call(this))===0)){u=b;z=t;g=[];k=A[s];h=0;for(j=k.length;h<j;h++){v=k[h];g.push(this.data[v])}g=
u(z,g)}g=g}if(!g){this.ndata[s]={};if(typeof(l=this.opts.stacked)!=="undefined"&&l!==null){this.stackedNdata[s]={};x={}}g=this.opts.stacked?this.getStackedMin:this.getMin;h=this.opts.stacked?this.getStackedMax:this.getMax;g=g(a,A[s]);z=h(a,A[s]);G=this.getYAxisVals(g,z);g=G[0];z=G[G.length-1];k=A[s];h=0;for(j=k.length;h<j;h++){v=k[h];if(typeof(m=a[v])!=="undefined"&&m!==null){var J=this.ndata[s],K=v;n=[];p=a[v].length;for(u=0;0<=p?u<p:u>p;0<=p?u+=1:u-=1)n.push(typeof(r=a[v][u])!=="undefined"&&r!==
null&&(E=B(a[v][u],g,z))!==null?[u/(a[v].length-1||1),E]:null);J[K]=n;if(typeof(w=this.opts.stacked)!=="undefined"&&w!==null){this.stackedNdata[s][v]=[];n=a[v].length;for(u=0;0<=n?u<n:u>n;0<=n?u+=1:u-=1){p=x[u]||0;p=[u/(a[v].length-1||1),typeof(y=a[v][u])!=="undefined"&&y!==null&&(E=B(a[v][u],g,z))!==null?E+p:p];this.stackedNdata[s][v].push(p);if(p!==null)x[u]=p[1]}}this.ndata[s].__YVALS__=G}}}}return[]};Sai.Chart.prototype.addAxes=function(a,b){var c,e,f,d,g,h,k,j,l,m,n;this.axisWidth=1.5;this.padding.top+=
5;for(n=this.data[this.__LABELS__].length-1;this.data[this.__LABELS__].length-1<=0?n<=0:n>=0;this.data[this.__LABELS__].length-1<=0?n+=1:n-=1)if(typeof(c=this.data[this.__LABELS__][n])!=="undefined"&&c!==null){c=this.r.text(0,0,Sai.util.prettystr(this.data[this.__LABELS__][n]));this.padding.right+=c.getBBox().width/2;c.remove();break}n=this.h-(this.padding.bottom+this.padding.top);c=typeof(e=this.ndata[a[0]])!=="undefined"&&e!==null||!(typeof(f=this.ndata[a[1]])!=="undefined"&&f!==null);e=typeof(d=
this.ndata[a[1]])!=="undefined"&&d!==null;if(c){d=this.r.sai.prim.vaxis(typeof(g=this.ndata[a[0]]==null?undefined:this.ndata[a[0]].__YVALS__)!=="undefined"&&g!==null?g:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,n,{width:this.axisWidth,title:typeof b==="undefined"||b===null?undefined:b.left});g=d.items[0].getBBox().width;d.remove()}else g=0;if(e){d=this.r.sai.prim.vaxis(typeof(h=this.ndata[a[1]]==null?undefined:this.ndata[a[1]].__YVALS__)!=="undefined"&&h!==null?h:[0,"?"],this.x+this.padding.left,
this.y-this.padding.bottom,n,{width:this.axisWidth,title:typeof b==="undefined"||b===null?undefined:b.right});h=d.getBBox().width;d.remove()}else h=0;this.haxis=this.r.sai.prim.haxis(this.data[this.__LABELS__],this.x+this.padding.left+g,this.y-this.padding.bottom,this.w-this.padding.left-this.padding.right-g-h,{width:this.axisWidth,title:typeof b==="undefined"||b===null?undefined:b.bottom});h=this.haxis.getBBox().height;if(isNaN(h))h=1;this.haxis.translate(0,-h);this.padding.bottom+=h;n=this.h-(this.padding.bottom+
this.padding.top);if(c){this.vaxis=this.r.sai.prim.vaxis(typeof(k=this.ndata[a[0]]==null?undefined:this.ndata[a[0]].__YVALS__)!=="undefined"&&k!==null?k:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,n,{width:this.axisWidth,title:typeof b==="undefined"||b===null?undefined:b.left});k=this.vaxis.items[0].getBBox().width;this.vaxis.translate(k,0);this.padding.left+=k}if(e){this.vaxis_right=this.r.sai.prim.vaxis(typeof(j=this.ndata[a[1]]==null?undefined:this.ndata[a[1]].__YVALS__)!=="undefined"&&
j!==null?j:[0,"?"],this.w-this.padding.right,this.y-this.padding.bottom,n,{width:this.axisWidth,right:true,title:typeof b==="undefined"||b===null?undefined:b.right,color:typeof(l=this.ndata[a[0]])!=="undefined"&&l!==null?typeof(m=this.colors.__RIGHTAXIS__)!=="undefined"&&m!==null?m:"blue":"black"});j=this.vaxis_right.items[0].getBBox().width;this.vaxis_right.translate(-j,0);this.padding.right+=j}this.setPlotCoords();return this.r.set().push(this.haxis).push(this.vaxis)};Sai.Chart.prototype.setPlotCoords=
function(){this.px=this.x+this.padding.left;this.py=this.y-this.padding.bottom;this.pw=this.w-this.padding.left-this.padding.right;return this.ph=this.h-this.padding.bottom-this.padding.top};Sai.Chart.prototype.drawBG=function(){var a,b,c,e;return this.bg=this.r.rect(typeof(a=this.px)!=="undefined"&&a!==null&&this.px||this.x,typeof(b=this.py)!=="undefined"&&b!==null&&this.py-this.ph||this.y-this.h,typeof(c=this.pw)!=="undefined"&&c!==null&&this.pw||this.w,typeof(e=this.ph)!=="undefined"&&e!==null&&
this.ph||this.h).attr({fill:this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack()};Sai.Chart.prototype.logoPos=function(){var a,b,c,e,f;f=typeof(a=this.px)!=="undefined"&&a!==null&&typeof(b=this.pw)!=="undefined"&&b!==null?this.px+this.pw-160-5:this.w+this.x-160-this.padding.right;a=typeof(c=this.py)!=="undefined"&&c!==null&&typeof(e=this.ph)!=="undefined"&&e!==null?this.py-this.ph+5:this.y-this.h+this.padding.top;return[f,a,160,34]};Sai.Chart.prototype.drawLogo=function(){var a;a=this.logoPos();
return this.logo=this.r.image(Sai.imagePath+"logo.png",a[0],a[1],a[2],a[3]).attr({opacity:0.25})};Sai.Chart.prototype.drawFootnote=function(a){var b,c,e,f,d,g;a=typeof a!=="undefined"&&a!==null?a:typeof(b=this.opts.footnote)!=="undefined"&&b!==null?b:"";if(a.match(/^\s*$/))return null;b=(this.w-this.padding.left-this.padding.right)/5.5;g=a.split(" ");f=[];e="";a=0;for(c=g.length;a<c;a++){d=g[a];if(e.length+d.length>b){f.push(e);e=""}e+=d+" "}e!==""&&f.push(e);a=f.join("\n");this.footnote=this.r.text(this.x+
this.padding.left,this.y-this.padding.bottom,a);b=this.footnote.getBBox().height;this.padding.bottom+=b+10;return this.footnote.translate(0,-b/2).attr({"text-anchor":"start"})};Sai.Chart.prototype.render=function(){this.plot=typeof this.plot!=="undefined"&&this.plot!==null?this.plot:new Sai.Plot(this.r);this.plot.render();return this};Sai.Chart.prototype.showError=function(a){return this.r.text(this.x+this.padding.left+this.pw/2,this.y-this.padding.bottom-this.ph/2,a)};Sai.Chart.prototype.setColors=
function(a){var b,c;this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};for(b in a)if(o.call(a,b)){c=this.renames[b];if(c in this.data)this.colors[c]=a[b]}return this};Sai.Chart.prototype.setColor=function(a,b){this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};this.colors[this.renames[a]]=b;return this};Sai.Chart.prototype.normalizedHeight=function(a,b){var c;if(!(typeof(c=this.ndata[b]==null?undefined:this.ndata[b].__YVALS__)!=="undefined"&&
c!==null))return null;c=this.ndata[b].__YVALS__[0];if(!(a>c))return null;return(a-c)/(this.ndata[b].__YVALS__[this.ndata[b].__YVALS__.length-1]-c)};Sai.Chart.prototype.drawGuideline=function(a,b){var c;b=typeof b!=="undefined"&&b!==null?b:"all";if(!(typeof(c=this.ndata[b]==null?undefined:this.ndata[b].__YVALS__)!=="undefined"&&c!==null))return null;c=this.normalizedHeight(a,b);this.guidelines=typeof this.guidelines!=="undefined"&&this.guidelines!==null?this.guidelines:this.r.set();c=new Sai.LinePlot(this.r,
this.px,this.py,this.pw,this.ph,{guideline:[[0,c],[1,c]]});c.render({guideline:"#ccc"});return this.guidelines.push(c.set)};Sai.Chart.prototype.drawLegend=function(a){var b,c,e,f,d,g,h,k;if(a=typeof a!=="undefined"&&a!==null?a:this.colors){e={};h={};b=a;for(k in b)if(o.call(b,k))if(k!==this.__LABELS__){e[k]=a[k];h[k]="black";if(typeof(g=this.opts.groups==null?undefined:this.opts.groups.right)!=="undefined"&&g!==null)if(function(){for(var j=0,l=(d=this.opts.groups.right).length;j<l;j++)if(d[j]===k)return true;
return false}.call(this))h[k]=typeof(c=this.ndata.left)!=="undefined"&&c!==null?typeof(f=this.colors.__RIGHTAXIS__)!=="undefined"&&f!==null?f:"blue":"black"}this.legend=this.r.sai.prim.legend(this.x,this.y-this.padding.bottom,this.w,e,h);a=this.legend.getBBox();if(this.legend.length>0)this.padding.bottom+=a.height+15;return this.legend.translate((this.w-a.width)/2,0)}};Sai.Chart.prototype.drawTitle=function(){var a;if(typeof(a=this.opts.title)!=="undefined"&&a!==null){this.title=this.r.text(this.x+
this.w/2,this.y-this.h,this.opts.title).attr({"font-size":20});this.title.translate(0,this.title.getBBox().height/2);return this.padding.top+=this.title.getBBox().height+5}};Sai.Chart.prototype.setupInfoSpace=function(){this.info_y=this.y-this.h+this.padding.top;this.info_x=this.x+this.padding.left;this.info_w=this.w-this.padding.left-this.padding.right;return this.padding.top+=30};Sai.Chart.prototype.drawInfo=function(a,b){var c,e,f;b=typeof b!=="undefined"&&b!==null?b:true;a=typeof a!=="undefined"&&
a!==null?a:typeof(c=this.default_info)!=="undefined"&&c!==null?this.default_info():{};if(b)this.info_data={};this.info&&this.info.remove();c=a;for(f in c)if(o.call(c,f))f.match("^__")||(this.info_data[f]=typeof(e=a[f])!=="undefined"&&e!==null?e:"(no data)");return this.info=this.r.sai.prim.info(this.info_x,this.info_y,this.info_w,this.info_data)};Sai.Chart.prototype.getIndex=function(a){a=Sai.util.transformCoords(a,this.r.canvas).x;return Math.round((this.data[this.__LABELS__].length-1)*(a-this.px)/
this.pw)};Sai.LineChart=function(){return Sai.Chart.apply(this,arguments)};i(Sai.LineChart,Sai.Chart);Sai.LineChart.prototype.nonNegativeGroups=function(){return this.opts.stacked?["all","left","right"]:[]};Sai.LineChart.prototype.dataGroups=function(){var a,b,c,e,f,d;d=Sai.LineChart.__super__.dataGroups.apply(this,arguments);if(typeof(f=this.opts.groups==null?undefined:this.opts.groups.left)!=="undefined"&&f!==null&&typeof(a=this.opts.groups==null?undefined:this.opts.groups.right)!=="undefined"&&
a!==null){a=[];c=this.opts.groups.left;b=0;for(e=c.length;b<e;b++){f=c[b];this.caresAbout(f)&&f in this.data&&a.push(f)}d.left=a;a=[];c=this.opts.groups.right;b=0;for(e=c.length;b<e;b++){f=c[b];this.caresAbout(f)&&f in this.data&&a.push(f)}d.right=a}return d};Sai.LineChart.prototype.render=function(){var a,b,c,e,f,d,g,h;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawLegend();(g="right"in this.ndata)?this.addAxes(["left","right"]):this.addAxes(["all"]);this.drawBG();this.drawLogo();
if(g){this.ndata.left.__YVALS__[0]<0&&this.drawGuideline(0,"left");this.ndata.right.__YVALS__[0]<0&&this.drawGuideline(0,"right")}else this.ndata.all.__YVALS__[0]<0&&this.drawGuideline(0,"all");this.lines=[];this.dots=this.r.set();d=typeof(a=this.opts.stacked)!=="undefined"&&a!==null?this.stackedNdata:this.ndata;a=this.opts.area?Sai.AreaPlot:Sai.LinePlot;this.plotSets=this.r.set();this.plots=[];if(g){this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,d.left)).render(this.colors,typeof(b=
this.opts.lineWidth)!=="undefined"&&b!==null?b:2,this.opts.stacked,this.normalizedHeight(0,"left")));this.plotSets.push(this.plots[0].set);this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,d.right)).render(this.colors,typeof(c=this.opts.lineWidth)!=="undefined"&&c!==null?c:2,this.opts.stacked,this.normalizedHeight(0,"right")));this.plotSets.push(this.plots[1].set)}else{this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,d.all)).render(this.colors,typeof(e=this.opts.lineWidth)!==
"undefined"&&e!==null?e:2,this.opts.stacked,this.normalizedHeight(0,"all")));this.plotSets.push(this.plots[0].set)}b=d.all;for(h in b)if(o.call(b,h))if(h!=="__YVALS__")this.dots.push(this.r.circle(0,0,4).attr({fill:typeof(f=this.colors==null?undefined:this.colors[h])!=="undefined"&&f!==null?f:"black"}).hide());this.r.set().push(this.bg,this.plotSets,this.dots,this.logo,this.guidelines).mousemove(q(function(k){var j,l,m,n,p,r,y,w,x,t,s;y=this.getIndex(k);w={};w[this.__LABELS__]=this.data[this.__LABELS__][y];
k=d.all;for(s in k)if(o.call(k,s))if(typeof(j=this.data[s])!=="undefined"&&j!==null)w[s]=this.data[s][y];this.drawInfo(w);r=0;j=[];k=d.all;for(s in k)o.call(k,s)&&s!=="__YVALS__"&&j.push(function(){l=[];n=this.plots;m=0;for(p=n.length;m<p;m++){x=n[m];s in x.dndata&&l.push(function(){t=x.dndata[s][y];typeof t!=="undefined"&&t!==null?this.dots[r].attr({cx:t[0],cy:t[1]}).show().toFront():this.dots[r].hide();return r++}.call(this))}return l}.call(this));return j},this)).mouseout(q(function(){this.drawInfo({},
true);return this.dots.hide()},this));return this};Sai.Sparkline=function(){return Sai.Chart.apply(this,arguments)};i(Sai.Sparkline,Sai.Chart);Sai.Sparkline.prototype.dataGroups=function(){return{data:["data"]}};Sai.Sparkline.prototype.render=function(){this.drawBG();this.plots=this.r.set();this.plots.push((new Sai.LinePlot(this.r,this.x,this.y,this.w,this.h,this.ndata.data)).render({data:this.colors&&this.colors[series]||"black"},1).set);return this};Sai.BarChart=function(){var a;a=this;this.getMin=
function(){return Sai.BarChart.prototype.getMin.apply(a,arguments)};return Sai.Chart.apply(this,arguments)};i(Sai.BarChart,Sai.Chart);Sai.BarChart.prototype.getMin=function(){return Math.min(Sai.BarChart.__super__.getMin.apply(this,arguments),0)};Sai.BarChart.prototype.groupsToNullPad=function(){var a,b,c;a=[];b=this.dataGroups();for(c in b)o.call(b,c)&&a.push(c);return a};Sai.BarChart.prototype.nonNegativeGroups=function(){var a,b,c;if(this.opts.stacked){a=[];b=this.dataGroups();for(c in b)o.call(b,
c)&&a.push(c);return a}return[]};Sai.BarChart.prototype.tooMuchData=function(){var a,b,c,e;c=this.w/3;b=0;a=this.data;for(e in a)if(o.call(a,e))if(e!==this.__LABELS__){b+=this.data[e].length;if(this.opts.stacked)break}return b>c};Sai.BarChart.prototype.render=function(){var a,b,c,e,f,d,g;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawLegend();this.addAxes(["all"]);this.drawLogo();this.drawBG();if(this.tooMuchData()){this.showError("Sorry, the chart isn't wide enough to plot this much data.\n \nPossible solutions include downsampling your data\n (e.g. monthly instead of daily) or using a line chart");
return this}if("all"in this.ndata){this.guidelines=this.r.set();b=this.ndata.all.__YVALS__.slice(1,this.ndata.all.__YVALS__.length-1);a=0;for(c=b.length;a<c;a++){g=b[a];this.drawGuideline(g)}}this.plots=this.r.set();a={};c={};c[this.__LABELS__]=this.data[this.__LABELS__];b=typeof(e=this.opts.stacked)!=="undefined"&&e!==null?this.stackedNdata:this.ndata;e=b.all;for(d in e)if(o.call(e,d))if(!(d.match("^__")||d===this.__LABELS__)){a[d]=b.all[d];c[d]=this.data[d]}this.plots.push((new Sai.BarPlot(this.r,
this.px,this.py,this.pw,this.ph,a,c)).render(typeof(f=this.opts.stacked)!=="undefined"&&f!==null,this.normalizedHeight(0,"all"),this.colors,this.opts.interactive,this.drawInfo).set);return this};Sai.StockChart=function(){return Sai.Chart.apply(this,arguments)};i(Sai.StockChart,Sai.Chart);Sai.StockChart.prototype.groupsToNullPad=function(){return["prices","volume","__META__"]};Sai.StockChart.prototype.dataGroups=function(a){var b,c;b={__META__:[this.__LABELS__]};if("volume"in this.data)b.volume=["volume"];
for(c in a)if(o.call(a,c))if(this.caresAbout(c)&&!(this.__LABELS__===c||"volume"===c)){b.prices=typeof b.prices!=="undefined"&&b.prices!==null?b.prices:[];b.prices.push(c)}return b};Sai.StockChart.prototype.nonNegativeGroups=function(){return["volume"]};Sai.StockChart.prototype.render=function(){var a,b,c,e,f,d,g,h;this.drawTitle();this.setupInfoSpace();this.drawFootnote();c={};h=false;a=this.ndata.prices;for(g in a)if(o.call(a,g))if(!("open"===g||"close"===g||"high"===g||"low"===g)&&!(g.match("^__")||
g===this.__LABELS__)){c[g]=(this.colors==null?undefined:this.colors[g])||"black";h=true}h&&this.drawLegend(c);this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};this.colors.up=typeof this.colors.up!=="undefined"&&this.colors.up!==null?this.colors.up:"black";this.colors.down=typeof this.colors.down!=="undefined"&&this.colors.down!==null?this.colors.down:"red";this.colors.vol_up=typeof this.colors.vol_up!=="undefined"&&this.colors.vol_up!==null?this.colors.vol_up:"#666666";
this.colors.vol_down=typeof this.colors.vol_down!=="undefined"&&this.colors.vol_down!==null?this.colors.vol_down:"#cc6666";this.addAxes(["prices"]);this.drawLogo();this.drawBG();if(!(typeof(b=this.ndata.prices)!=="undefined"&&b!==null&&"open"in this.ndata.prices&&"close"in this.ndata.prices&&"high"in this.ndata.prices&&"low"in this.ndata.prices)){this.showError("This chart requires data series named\nopen, close, high, and low.\n \nOnce you add series with these names, the chart will display.");return null}this.ndata.prices.__YVALS__[0]<
0&&this.drawGuideline(0,"prices");this.plots=this.r.set();b={up:[],down:[]};a={};c=this.ndata.prices;for(f in c)if(o.call(c,f))f.match("^__")||f===this.__LABELS__||(a[f]=this.data[f]);if(typeof(e=this.data.volume)!=="undefined"&&e!==null)a.vol=this.data.volume;if("volume"in this.ndata){e=this.ndata.volume.volume.length;for(f=0;0<=e?f<e:f>e;0<=e?f+=1:f-=1)if(this.ndata.volume.volume[f]!==null)if(f&&this.ndata.prices.close[f-1]&&this.ndata.prices.close[f][1]<this.ndata.prices.close[f-1][1]){b.down.push(this.ndata.volume.volume[f]);
b.up.push([this.ndata.volume.volume[f][0],0])}else{b.up.push(this.ndata.volume.volume[f]);b.down.push([this.ndata.volume.volume[f][0],0])}else{b.up.push([0,0]);b.down.push([0,0])}this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph*0.2,b,a)).render(true,this.normalizedHeight(0,"volume"),{up:this.colors.vol_up,down:this.colors.vol_down}).set)}this.plots.push((new Sai.CandlestickPlot(this.r,this.px,this.py,this.pw,this.ph,{open:this.ndata.prices.open,close:this.ndata.prices.close,
high:this.ndata.prices.high,low:this.ndata.prices.low},a)).render(this.colors,Math.min(5,this.pw/this.ndata.prices.open.length-2)).set);f={};e=this.ndata.prices;for(g in e)if(o.call(e,g))"open"===g||"close"===g||"high"===g||"low"===g||g.match("^__")||g===this.__LABELS__||(f[g]=this.ndata.prices[g]);this.plots.push((new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,f)).render(this.colors).set);d=this.pw/(this.data[this.__LABELS__].length-1);this.glow=this.r.rect(this.px-d/2,this.py-this.ph,d,
this.ph).attr({fill:"0-"+this.opts.bgcolor+"-#DDAA99-"+this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack().hide();this.bg.toBack();this.r.set().push(this.bg,this.plots,this.logo,this.glow,this.guidelines).mousemove(q(function(k){var j,l,m,n,p,r;m=this.getIndex(k);n={};n[this.__LABELS__]=this.data[this.__LABELS__][m];p=false;k=this.ndata.prices;for(r in k)if(o.call(k,r))if(!(r.match("^__")||r===this.__LABELS__))if(typeof(j=this.data[r]==null?undefined:this.data[r][m])!=="undefined"&&j!==
null){n[r]=this.data[r][m];p=true}if(typeof(l=this.data.volume==null?undefined:this.data.volume[m])!=="undefined"&&l!==null){n.volume=this.data.volume[m];p=true}this.drawInfo(n);return p?this.glow.attr({x:this.px+d*(m-0.5)}).show():null},this)).mouseout(q(function(){this.drawInfo({},true);return this.glow.hide()},this));return this};Sai.GeoChart=function(){var a;a=this;this.renderPlot=function(){return Sai.GeoChart.prototype.renderPlot.apply(a,arguments)};return Sai.Chart.apply(this,arguments)};i(Sai.GeoChart,
Sai.Chart);Sai.GeoChart.prototype.plotType=Sai.GeoPlot;Sai.GeoChart.prototype.interactiveHistogram=true;Sai.GeoChart.prototype.getMax=function(a){return Math.max.apply(Math,a)};Sai.GeoChart.prototype.getMin=function(a){return Math.min.apply(Math,a)};Sai.GeoChart.prototype.normalize=function(a){var b,c,e,f,d,g,h,k,j,l,m,n,p;this.ndata={};this.bounds={};j={};l={};for(p in a)if(o.call(a,p))if(!(p.match("^__")||p===this.__LABELS__))if(typeof(b=a[p])!=="undefined"&&b!==null){c=[];f=a[p];e=0;for(d=f.length;e<
d;e++){k=f[e];typeof k!=="undefined"&&k!==null&&c.push(k)}c=c;j[p]=this.getMax(c,p);if(!(typeof m!=="undefined"&&m!==null)||j[p]>m)m=j[p];l[p]=this.getMin(c,p);if(!(typeof n!=="undefined"&&n!==null)||l[p]<n)n=l[p]}for(p in a)if(o.call(a,p))if(!(p.match("^__")||p===this.__LABELS__))if(typeof(g=a[p])!=="undefined"&&g!==null){if(this.opts.groupedNormalization){f=m;d=n}else{f=j[p];d=l[p]}this.bounds[p]=[d,f];k=this.ndata;var r=p;b=[];c=a[p].length;for(e=0;0<=c?e<c:e>c;0<=c?e+=1:e-=1)b.push(typeof(h=a[p][e])!==
"undefined"&&h!==null?[e/(a[p].length-1),(a[p][e]-d)/(f-d)]:null);k[r]=b}return[]};Sai.GeoChart.prototype.dataGroups=function(a){var b,c;b=[];for(c in a)if(o.call(a,c))if(c.match("^__")||c===this.__LABELS__)b.push(c);b={__META__:b};for(c in a)if(o.call(a,c))c.match("^__")||c===this.__LABELS__||(b[c]=[c]);return b};Sai.GeoChart.prototype.drawHistogramLegend=function(a){var b,c,e,f,d,g,h,k,j,l,m,n,p,r;this.histogramLegend=this.r.set();j=Math.max(0.1*(this.h-this.padding.bottom-this.padding.top),50);
p=Math.min(150,(this.w-this.padding.left-this.padding.right-20)/a.length);b=a.length;for(m=0;0<=b?m<b:m>b;0<=b?m+=1:m-=1){n=a[m];l=this.x+m*p;c=[];e=this.ndata[n].length;for(d=0;0<=e?d<e:d>e;0<=e?d+=1:d-=1)if(typeof(f=this.ndata[n][d])!=="undefined"&&f!==null)c.push(this.ndata[n][d][1]);c=c;if(typeof(g=this.bounds==null?undefined:this.bounds[n])!=="undefined"&&g!==null){d=this.bounds[n];e=d[0];d=d[1]}else{e=[];h=this.data[n];d=0;for(k=h.length;d<k;d++){r=h[d];typeof r!=="undefined"&&r!==null&&e.push(r)}e=
e;d=[Math.min.apply(Math,e),Math.max.apply(Math,e)];e=d[0];d=d[1]}d=this.getYAxisVals(e,d,true);e=d[0];d=d[d.length-1];this.histogramLegend.push(l=this.r.sai.prim.histogram(l,this.y-this.padding.bottom,p*0.8,j,c,e,d,n,this.colors[n],"white",this.opts.fromWhite));this.opts.interactive&&this.setupHistogramInteraction(l,n)}this.histogramLegend.translate((this.w-this.padding.left-this.padding.right-this.histogramLegend.getBBox().width)/2,0);return this.padding.bottom+=j+5};Sai.GeoChart.prototype.setupHistogramInteraction=
function(a,b){return a.click(q(function(){return this.renderPlot(b)},this)).hover(q(function(c){return q(function(){c.attr({"fill-opacity":0.75});return this.drawInfo({"Click to display on map":b})},this)},this)(a),q(function(c){return q(function(){c.attr({"fill-opacity":1});return this.drawInfo()},this)},this)(a))};Sai.GeoChart.prototype.renderPlot=function(a){this.geoPlot==null||this.geoPlot.set.remove();return this.geoPlot=(new this.plotType(this.r,this.px,this.py,this.pw,this.ph,this.ndata,this.data,
{fromWhite:this.opts.fromWhite})).render(this.colors||{},this.data.__MAP__,this.__LABELS__,a,this.opts.bgcolor,this.opts.interactive,this.drawInfo)};Sai.GeoChart.prototype.default_info=function(){return{"":this.opts.interactive?"Click histogram below to change map display":""}};Sai.GeoChart.prototype.render=function(){var a,b,c;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawHistogramLegend(function(){a=[];b=this.data;for(c in b)if(o.call(b,c))c.match("^__")||c===this.__LABELS__||
a.push(c);return a}.call(this));this.setPlotCoords();this.drawLogo();this.drawBG();this.drawInfo();this.renderPlot(this.data.__DEFAULT__);return this};Sai.ChromaticGeoChart=function(){return Sai.GeoChart.apply(this,arguments)};i(Sai.ChromaticGeoChart,Sai.GeoChart);Sai.ChromaticGeoChart.prototype.plotType=Sai.ChromaticGeoPlot;Sai.ChromaticGeoChart.prototype.interactiveHistogram=false;Sai.ChromaticGeoChart.prototype.default_info=function(){return{}};Sai.ChromaticGeoChart.prototype.setupHistogramInteraction=
function(){return false};Sai.ScatterChart=function(){return Sai.Chart.apply(this,arguments)};i(Sai.ScatterChart,Sai.Chart);Sai.ScatterChart.prototype.dataGroups=function(a){var b,c;b=[];for(c in a)if(o.call(a,c))if(c.match("^__")||c===this.__LABELS__)b.push(c);b={__META__:b};for(c in a)if(o.call(a,c))c.match("^__")||c===this.__LABELS__||(b[c]=[c]);return b};Sai.ScatterChart.prototype.render=function(){var a,b,c,e,f,d;this.drawTitle();this.setupInfoSpace();this.drawFootnote();f=typeof(a=this.opts.colors)!==
"undefined"&&a!==null?a:typeof(b=this.colors)!=="undefined"&&b!==null?b:["black","white"];f instanceof Array||this.drawLegend(f);this.__LABELS__="__XVALS__";this.data.__XVALS__=this.ndata[this.opts.mappings.x].__YVALS__;this.addAxes([this.opts.mappings.y],{left:this.opts.mappings.y,bottom:this.opts.mappings.x});this.drawLogo();this.drawBG();b={};a=this.ndata;for(d in a)if(o.call(a,d))b[d]=this.ndata[d][d];this.plots=this.r.set();this.plots.push((new Sai.ScatterPlot(this.r,this.px,this.py,this.pw,
this.ph,b,this.data)).render(this.opts.mappings,f,typeof(c=this.opts.radius)!=="undefined"&&c!==null?c:[4,12],typeof(e=this.opts.stroke_opacity)!=="undefined"&&e!==null?e:[0,1],this.drawInfo).set);return this}})();
