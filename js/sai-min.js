(function(){Sai={};var w,B;Sai.util={};Sai.imagePath!=null||(Sai.imagePath="/static/images/sai/");Sai.util.roundToMag=function(q,h){var d;h!=null||(h=0);d=Math.pow(10,h);return parseFloat((Math.round(q/d)*d).toFixed(Math.max(0,h)))};Sai.util.round=function(q,h){return parseFloat((Math.round(q/h)*h).toFixed(Math.max(0,Math.ceil(-1*Math.log(h)/Math.LN10))))};Sai.util.sumArray=function(q){var h,d,a;h=d=0;for(a=q.length;0<=a?h<a:h>a;0<=a?h+=1:h-=1)d+=typeof q[h]==="number"?q[h]:0;return d};Sai.util.prettystr=
function(q,h){var d,a;d=h!=null?h:1;h!=null||(h=2);if(typeof q==="number"){if(Math.abs(q)>=1E12){a="t";q/=1E12}else if(Math.abs(q)>=1E9){if(d>=8)return q;a="b";q/=1E9}else if(Math.abs(q)>=1E6){if(d>=5)return q;a="m";q/=1E6}else if(Math.abs(q)>=1E3){if(d>=2)return q;a="k";q/=1E3}else return String(parseFloat(q.toFixed(h)));return parseFloat(q.toFixed(d))+a}return q};Sai.util.prettynum=function(q){var h;if(!(isNaN(parseFloat(q))||!String(q).match(/^[-+]?\d+(\.\d+)?$/))){q=String(q).split(".");for(h=
/(\d+)(\d{3})/;h.test(q[0]);)q[0]=q[0].replace(h,"$1,$2");return q[0]+(q.length>1?parseFloat("0."+q[1]).toFixed(2).slice(1):"")}};Sai.util.infoSetters=function(q,h){return[function(){return q(h)},function(){return q()}]};Sai.util.transformCoords=function(q,h){var d;if(h.getScreenCTM){d=h.createSVGPoint();d.x=q.clientX;d.y=q.clientY;d=d.matrixTransform(h.getScreenCTM().inverse());if(navigator.userAgent.toLowerCase().indexOf("chrome")!==-1||navigator.userAgent.toLowerCase().indexOf("safari")!==-1){d.x+=
document.body.scrollLeft;d.y+=document.body.scrollTop}return{x:d.x,y:d.y}}else return{x:q.x,y:q.y}};Sai.util.multiplyColor=function(q,h,d,a){a!=null||(a=0);h=a+(1-a)*h;a=Raphael.getRGB(q);if(d){q=a.r+(255-a.r)*(1-h);d=a.g+(255-a.g)*(1-h);h=a.b+(255-a.b)*(1-h)}else{q=a.r*h;d=a.g*h;h=a.b*h}return{r:q,g:d,b:h,str:"rgb("+q+", "+d+", "+h+")"}};Sai.util.colerp=function(q,h,d){q=Raphael.getRGB(q);h=Raphael.getRGB(h);return"rgb("+(h.r*d+q.r*(1-d))+", "+(h.g*d+q.g*(1-d))+", "+(h.b*d+q.b*(1-d))+")"};Sai.util.reflectColor=
function(q,h){var d,a,b,c,f,e,i,g,j;b=Raphael.getRGB(q);f=Raphael.getRGB(h);e={};j=["r","g","b"];i=0;for(g=j.length;i<g;i++){a=j[i];d=b[a];c=f[a];e[a]=d===c?d:d>c?c*((255-d)/(255-c)):(255*(c-d)+c*d)/c}return"rgb("+e.r+", "+e.g+", "+e.b+")"};Sai.data!=null||(Sai.data={});(w=Sai.data).map!=null||(w.map={});(B=Raphael.fn).sai!=null||(B.sai={});Raphael.fn.sai.chart=function(q,h,d,a,b,c){var f;b=(f={line:Sai.LineChart}[b])!=null?f:b;b!=null||(b=Sai.Chart);return(new b(this,q,h,d,a,c)).render()}}).call(this);(function(){var w,B,q=Array.prototype.indexOf||function(h){for(var d=0,a=this.length;d<a;d++)if(this[d]===h)return d;return-1};(B=Raphael.fn.sai).prim!=null||(B.prim={});w=function(h,d,a,b){return[function(){h.attr(d);return b!=null?typeof b[0]==="function"?b[0](h):void 0:void 0},function(){h.attr(a);return b!=null?typeof b[1]==="function"?b[1](h):void 0:void 0}]};Raphael.fn.sai.prim.candlestick=function(h,d,a,b,c,f,e,i,g,j,k){e!=null||(e="#000000");f%2||f++;f=this.rect(h-f/2,d,f,a-d||1).attr("stroke",
e);b=this.path("M"+h+" "+b+"L"+h+" "+d+"M"+h+" "+a+"L"+h+" "+c).attr("stroke",e);f.attr("fill",i?e:"#ffffff");e=this.set().push(f,b);if(g){h=w(e,{scale:"1.5,1.5,"+h+","+(d+(a-d)/2),"fill-opacity":0.5},{scale:"1.0,1.0,"+h+","+(d+(a-d)/2),"fill-opacity":1},k);e.hover(h[0],h[1])}return e};Raphael.fn.sai.prim.line=function(h,d,a){var b,c,f,e;d!=null||(d="#000000");a!=null||(a=1);f=0;for(e=h.length;f<e;f++){b=h[f];if(b!=null)if(typeof c!="undefined"&&c!==null)c+="L"+b[0]+" "+b[1];else c="M"+b[0]+" "+b[1]}return this.path(c).attr({stroke:d,
"stroke-width":a})};Raphael.fn.sai.prim.area=function(h,d,a,b){var c,f,e,i,g;if(h.length<2)return this.set();d!=null||(d="#000000");a!=null||(a=1);i=0;for(g=h.length;i<g;i++){f=h[i];if(f!=null)if(typeof e!="undefined"&&e!==null){e+="L"+f[0]+" "+f[1];c+="L"+f[0]+" "+f[1]}else{e="M"+f[0]+" "+f[1];c="M"+f[0]+" "+f[1]}}for(h=g=b.length-1;g<=0?h<=0:h>=0;h+=-1){f=b[h][0];i=b[h][1];c+="L"+f+","+i}b=this.path(c).attr({fill:d,"stroke-width":0,"stroke-opacity":0,"fill-opacity":0.35});d=this.path(e).attr({stroke:d,
"stroke-width":a});return this.set().push(b,d)};Raphael.fn.sai.prim.stackedBar=function(h,d,a,b,c,f,e){var i,g,j,k,l,m,o,n,p,r;if(c){k=l=b;m=0;for(n=h.length;m<n;m++){g=h[m];if(k<g[1])k=g[1];if(l>g[1])l=g[1]}p=k-l||1}a*=0.67;n=this.set();m=[b,b];l=function(t){return t<b?1:0};g=0;for(r=h.length;0<=r?g<r:g>r;0<=r?g+=1:g-=1)if(h[g]!=null&&h[g][1]!==b){k=l(h[g][1]);j=Math.abs(m[k]-h[g][1]);i=m[k]===b?1:0;o=h[g][1]-(k?0:j-i);n.push(i=this.rect(h[g][0]-a/2,o,a,j-i).attr("fill",(d!=null?d[g]:void 0)||"#000000").attr("stroke",
(d!=null?d[g]:void 0)||"#000000"));if(c){j=w(i,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},[function(t){return function(){e[0]&&e[0]();return f({"(selected)":Sai.util.prettystr(t)+"%"},false)}}(100*(j/p)),e[1]]);i.hover(j[0],j[1])}m[k]=h[g][1]}return n};Raphael.fn.sai.prim.groupedBar=function(h,d,a,b,c,f,e){var i,g,j,k,l,m;f=this.set();i=a/(h.length+1);k=(a-i)/2;j=0;for(l=h.length;0<=l?j<l:j>l;0<=l?j+=1:j-=1)if(((m=h[j])!=null?m[0]:void 0)!=null){a=Math.min(h[j][1],b);g=Math.max(h[j][1],b)-a-0.5;
f.push(this.rect(h[j][0]-k+j*i,a,i-1,g).attr("fill",(d!=null?d[j]:void 0)||"#000000").attr("stroke",(d!=null?d[j]:void 0)||"#000000"))}if(c){h=w(f,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},e);f.hover(h[0],h[1])}return f};Raphael.fn.sai.prim.haxis=function(h,d,a,b,c){var f,e,i,g,j,k,l,m,o,n,p,r,t,s,u,v,x,C,D;r=(u=c.ticklens)!=null?u:[5,2];u=(i=c.width)!=null?i:1;i=(n=c.color)!=null?n:"black";m=this.path("M"+d+" "+a+"l"+b+" 0").attr("stroke",i);t=this.set();l=this.set();n=b/25;k=n<h.length?Math.ceil(h.length/
n):1;g=b/(h.length-1)*k;x=d;v=-1;p=false;n=0;C=null;j=0;for(D=h.length;0<=D?j<D:j>D;j+=k){f=h[j];if(f!=null){e=r[String(f)?0:1];t.push(this.path("M"+x+" "+a+"l0 "+e).attr("stroke",i));if(f!==""){e=this.text(x,a+e+2,Sai.util.prettystr(f).substring(0,12));f=e.getBBox();o=e.attr("y")+5;e.attr("y",o);if(C==null||o<C)C=o;l.push(e);e=f.width;n=Math.max(e,n);if(f.x<=v+3)p=true;if(f.x+e>v)v=f.x+e}}x+=g}if(c.title!=null)s=this.text(d+b/2,C+14,c.title).attr({"font-size":"12px","font-weight":"bold"});h=this.set().push(m,
t,l,s);if(p){s=l.items;b=0;for(c=s.length;b<c;b++){e=s[b];e.rotate(-90);e.translate(0,e.getBBox().width/2-2)}h.push(this.rect(d,a,1,u+n+r[0]).attr("opacity","0"))}return h};Raphael.fn.sai.prim.vaxis=function(h,d,a,b,c){var f,e,i,g,j,k,l,m,o,n,p,r,t,s,u,v,x;p=(f=c.ticklens)!=null?f:[5,2];f=(m=c.color)!=null?m:"black";n=(k=c.right)!=null?k:false;m=this.path("M"+d+" "+a+"l0 "+-b).attr("stroke",f);r=this.set();k=this.set();i=b/(h.length-1);u=a;s=null;j=[];l=true;v=0;for(x=h.length;v<x;v++){g=h[v];if(g!==
null){g=Sai.util.prettystr(g);if(q.call(j,g)>=0){l=false;break}j.push(g)}}if(!l){v=[];j=0;for(l=h.length;j<l;j++){g=h[j];v.push(Sai.util.prettystr(g,2))}j=v}v=l=0;for(x=h.length;v<x;v++){g=h[v];if(g!==null){g=p[String(g)?0:1];r.push(this.path("M"+d+" "+u+"l"+(n?g:-g)+" 0").attr("stroke",f));o=d+(n?1:-1)*(g+3);g=this.text(o,u,j[l++]);g.attr({"text-anchor":n?"start":"end",fill:f});o+=(n?1:-1)*(g.getBBox().width+8);if(s==null||o<s)s=o;k.push(g)}u-=i}if(c.title!=null){t=this.text(s,a-b/2,c.title).attr({"font-size":"12px",
"font-weight":"bold"});h=t.getBBox();t.rotate(-90);e=this.rect(h.x+(h.width-h.height)/2,a,h.height,1).attr({opacity:0})}e!=null||(e=null);return this.set().push(this.set().push(m,r,k,e),t)};Raphael.fn.sai.prim.popup=function(h,d,a){var b,c,f,e,i,g;this.set();g=this.set();c=0;f=d+5+5;if("__HEAD__"in a){b=this.text(h,f,a.__HEAD__).attr({fill:"#cfc","font-size":"12","font-weight":"bold"});c=Math.max(c,b.getBBox().width);g.push(b);f+=17}for(i in a)if(i!=="__HEAD__"){e=this.text(h+5,f,i+" = "+a[i]).attr({fill:"white",
"font-weight":"bold","text-anchor":"start"});c=Math.max(c,e.getBBox().width);f+=10;g.push(e)}a=c+10;this.rect(h,d,a,f-d,5).attr({fill:"black","fill-opacity":".85",stroke:"black"});b!=null&&b.translate(a/2);return g.toFront()};Raphael.fn.sai.prim.legend=function(h,d,a,b,c){var f,e,i,g,j,k,l,m,o;d-=14;j=this.set();i=h;g=d;for(k in b){e=this.text(i+14,g+5,k).attr({fill:(l=c!=null?c[k]:void 0)!=null?l:"black","text-anchor":"start"});f=this.rect(i,g,9,9).attr({fill:(m=b[k])!=null?m:"black",stroke:(o=c!=
null?c[k]:void 0)!=null?o:"black"});f=this.set().push(e,f);e=f.getBBox().width;if(i-h+15+e>a){j.translate(0,-14);f.translate(h-i,d-g);i=h;g=d}i+=e+15;j.push(f)}return j};Raphael.fn.sai.prim.wrappedText=function(h,d,a,b,c){var f,e,i,g;c!=null||(c=" ");typeof spacing!="undefined"&&spacing!==null||(spacing=1);b!=null||(b="");if(!b.match(/^\s*$/)){a=a/6;i=[];for(e=0;e<b.length-1;){f=e+a;g=b.substring(e,f+1);f=f>=b.length?f:g.lastIndexOf(c);i.push(g.substring(0,f));e+=f+1}b=i.join("\n");return this.text(h,
d+5*i.length,b).attr({"font-family":"Lucida Console","text-anchor":"start"})}};Raphael.fn.sai.prim.info=function(h,d,a,b){var c,f,e,i,g,j;e=this.set();f=h;d=d;for(c in b)if(b[c]!==null){i=c+(c===""?"":": ");i+=typeof b[c]==="string"?b[c]:(j=Sai.util.prettynum(b[c]))!=null?j:Sai.util.prettystr(b[c]);g=6*i.length;if(f-h+g>a){f=h;d+=14}i=this.text(f,d,i).attr({"font-family":"Lucida Console","text-anchor":"start"});f+=g+15;e.push(i)}return e};Raphael.fn.sai.prim.hoverShape=function(h,d,a,b){h=h(this).attr(d);
a=w(h,b&&b[0]||{},b&&b[1]||{},a);h.mouseover(a[0]);h.mouseout(a[1]);return h};Raphael.fn.sai.prim.histogram=function(h,d,a,b,c,f,e,i,g,j,k,l){var m,o,n,p,r,t;j!=null||(j="white");g!=null||(g=["black","white"]);l!=null||(l=10);r=this.set();r.push(this.rect(h,d-b,a,b).attr({"stroke-width":0,"stroke-opacity":0,fill:j}));b=d-(b-12);d-=5;f!=null||(f=0);e!=null||(e=1);r.push(this.text(h,d,Sai.util.prettystr(f)).attr({"text-anchor":"start"}));r.push(this.text(h+a,d,Sai.util.prettystr(e)).attr({"text-anchor":"end"}));
d-=7;f={};j=e=0;for(t=c.length;j<t;j++){n=c[j];n=Math.min(l-1,Math.floor(l*n/1));if(n in f)f[n]+=1;else f[n]=1;e=Math.max(e,f[n])}r.push(this.rect(h,d,a,1).attr({fill:"0-"+g[0]+"-"+((o=g[1])!=null?o:g[0]),"stroke-width":0,"stroke-opacity":0}));d-=1;o=a/l;for(m in f){c=(d-b)*(f[m]/e);r.push(g.length===1?p=Sai.util.multiplyColor(g[0],(parseInt(m)+0.5)/l,k,0.2).str:p=Sai.util.colerp(g[0],g[1],(parseInt(m)+0.5)/l),this.rect(h+(parseInt(m)+0.2)*o,d-c,o*0.6,c).attr({fill:p,"stroke-width":k?0.35:0,"stroke-opacity":k?
1:0,stroke:"#000000"}))}r.push(this.text(h+a/2,b-6,Sai.util.prettystr(i)));return r}}).call(this);(function(){var w=Object.prototype.hasOwnProperty,B=function(h,d){function a(){this.constructor=h}for(var b in d)if(w.call(d,b))h[b]=d[b];a.prototype=d.prototype;h.prototype=new a;h.__super__=d.prototype;return h},q=function(h,d){return function(){return h.apply(d,arguments)}};Sai.Plot=function(){function h(d,a,b,c,f,e,i,g){this.r=d;this.x=a;this.y=b;this.w=c;this.h=f;this.data=e;this.rawdata=i;this.opts=g;this.opts!=null||(this.opts={});this.setDenormalizedData();this.set=this.r.set()}h.prototype.setDenormalizedData=
function(){var d,a,b,c,f,e,i,g,j,k;if(this.data instanceof Array){i=this.data;j=[];b=0;for(f=i.length;b<f;b++){d=i[b];j.push(this.denormalize(d))}return this.dndata=j}else{this.dndata!=null||(this.dndata={});b=[];for(a in this.data)b.push(this.dndata[a]=function(){g=this.data[a];k=[];c=0;for(e=g.length;c<e;c++){d=g[c];k.push(this.denormalize(d))}return k}.call(this));return b}};h.prototype.denormalize=function(d){if(d instanceof Array)return[this.x+this.w*d[0],this.y-this.h*d[1]]};h.prototype.render=
function(){this.set.push(this.r.rect(20,20,20,20).attr("fill","red"),this.r.circle(40,40,10).attr("fill","blue"));return this};return h}();Sai.LinePlot=function(){function h(){h.__super__.constructor.apply(this,arguments)}B(h,Sai.Plot);h.prototype.setDenormalizedData=function(){var d,a,b,c;h.__super__.setDenormalizedData.apply(this,arguments);c=[];for(d in this.dndata)c.push(this.dndata[d].length===1&&((a=this.dndata[d])!=null?(b=a[0])!=null?b[0]:void 0:void 0)===this.x?this.dndata[d].push([this.x+
this.w,this.dndata[d][0][1]]):void 0);return c};h.prototype.render=function(d,a){var b;this.set.remove();for(b in this.dndata)b.match("^__")||this.set.push(this.r.sai.prim.line(this.dndata[b],(d!=null?d[b]:void 0)||"black",a||1));return this};return h}();Sai.AreaPlot=function(){function h(){h.__super__.constructor.apply(this,arguments)}B(h,Sai.LinePlot);h.prototype.render=function(d,a,b,c){var f,e,i,g,j,k,l;this.set.remove();l=[];j=0;for(k=c.length;j<k;j++){e=c[j];l.push(this.denormalize(e))}c=l;
for(g in this.dndata)if(!g.match("^__")){e=0;for(j=this.dndata[g].length;0<=j?e<j:e>j;0<=j?e+=1:e-=1){f=this.dndata[g][e];if(f!=null)break}for(e=j=this.dndata[g].length-1;j<=0?e<=0:e>=0;j<=0?e+=1:e-=1){i=this.dndata[g][e];if(i!=null)break}l=[];j=0;for(k=c.length;j<k;j++){e=c[j];l.push([Math.max(Math.min(i[0],e[0]),f[0]),e[1]])}e=l;this.set.push(this.r.sai.prim.area(this.dndata[g],(d!=null?d[g]:void 0)||"black",a||1,e));if(b)c=this.dndata[g]}return this};return h}();Sai.CandlestickPlot=function(){function h(){h.__super__.constructor.apply(this,
arguments)}B(h,Sai.Plot);h.prototype.render=function(d,a,b,c){var f,e,i,g,j,k;this.set.remove();f=(d!=null?d.up:void 0)||"black";d=(d!=null?d.down:void 0)||"red";a!=null||(a=5);e=0;for(k=this.dndata.open.length;0<=k?e<k:e>k;0<=k?e+=1:e-=1)if(this.dndata.close[e]!=null){j=this.dndata.close[e][1]<this.dndata.open[e][1];i={};for(g in this.rawdata)i[g]=this.rawdata[g][e];this.set.push(this.r.sai.prim.candlestick(this.dndata.open[e][0],j&&this.dndata.close[e][1]||this.dndata.open[e][1],j&&this.dndata.open[e][1]||
this.dndata.close[e][1],this.dndata.high[e][1],this.dndata.low[e][1],a||5,e&&this.dndata.close[e-1]!=null&&this.dndata.close[e-1][1]<this.dndata.close[e][1]?d:f,!j,b,c,Sai.util.infoSetters(c,i)))}return this};return h}();Sai.BarPlot=function(){function h(){h.__super__.constructor.apply(this,arguments)}B(h,Sai.Plot);h.prototype.render=function(d,a,b,c,f,e){var i,g,j,k,l,m,o,n,p;this.set.remove();a=this.denormalize([0,a])[1];l=0;g=[];i=d?this.r.sai.prim.stackedBar:this.r.sai.prim.groupedBar;for(p in this.dndata){l=
Math.max(l,this.dndata[p].length);g.push((b!=null?b[p]:void 0)||"black")}for(j=0;0<=l?j<l:j>l;0<=l?j+=1:j-=1){b=[];for(p in this.dndata)b.push(this.dndata[p][j]);k={};for(n in this.rawdata)k[n]=this.rawdata[n][j];if(d){o=m=0;for(p in this.rawdata)if(p!==e)if(!isNaN(this.rawdata[p][j])){m+=Math.abs(this.rawdata[p][j]);o+=this.rawdata[p][j]}k["(magnitude)"]=m}this.set.push(i(b,g,this.w/l,a,c,f,Sai.util.infoSetters(f,k)))}return this};return h}();Sai.GeoPlot=function(){function h(){h.__super__.constructor.apply(this,
arguments)}B(h,Sai.Plot);h.prototype.getRegionColor=function(d,a,b){var c;return Sai.util.multiplyColor(d[b],((c=this.data[b][a])!=null?c[1]:void 0)||0,this.opts.fromWhite,this.opts.fromWhite?0.2:0).str};h.prototype.getRegionOpacity=function(d,a){var b;return((b=this.data[a][d])!=null?b[1]:void 0)!=null?1:this.opts.fromWhite?0.15:0.25};h.prototype.render=function(d,a,b,c,f,e,i){var g,j,k,l,m,o,n,p,r,t,s,u,v;this.set.remove();v=this.rawdata[b];s=[];k=0;for(u=v.length;k<u;k++){g=v[k];s.push(g.toUpperCase())}p=
{};k=0;for(u=s.length;0<=u?k<u:k>u;0<=u?k+=1:k-=1)p[s[k]]=k;s=function(x){r=p[x];o=a.name[x];l={region:o!=null?o:x};for(t in this.rawdata)if(t!==b)l[t]=this.rawdata[t][r];j=this.getRegionColor(d,r,c);n=this.getRegionOpacity(r,c);m=Sai.util.infoSetters(i,l);return this.set.push(this.r.sai.prim.hoverShape(function(C,D,F,G){return function(H){return H.path(C).translate(F,G).scale(D,D,F,G)}}(a.paths[x],Math.min(this.w/a.width,this.h/a.height),this.x,this.y-this.h),{fill:j,stroke:this.opts.fromWhite?"black":
f,"stroke-width":0.5,opacity:n},e?[function(C){return function(D){navigator.userAgent.toLowerCase().indexOf("msie")!==-1||navigator.userAgent.toLowerCase().indexOf("opera")!==-1||D.toFront();return C()}}(m[0]),m[1]]:null,e?[{"fill-opacity":0.75,"stroke-width":this.opts.fromWhite?1.5:0.5},{"fill-opacity":1,"stroke-width":0.5}]:null))};for(g in a.paths)s.call(this,g);g=this.set.getBBox();this.set.translate((this.w-g.width)/2,(this.h-g.height)/2);return this};return h}();Sai.ChromaticGeoPlot=function(){function h(){h.__super__.constructor.apply(this,
arguments)}B(h,Sai.GeoPlot);h.prototype.getRegionColor=function(d,a){var b,c,f,e,i,g;f=c=b=0;for(i in this.data){e=Sai.util.multiplyColor(d[i],((g=this.data[i][a])!=null?g[1]:void 0)||0,this.opts.fromWhite);f+=e.r;c+=e.g;b+=e.b}return"rgb("+f+", "+c+", "+b+")"};h.prototype.getRegionOpacity=function(d){var a,b;for(a in this.data)if(((b=this.data[a][d])!=null?b[1]:void 0)!=null)return 1;return 0.25};return h}();Sai.ScatterPlot=function(){function h(){h.__super__.constructor.apply(this,arguments)}B(h,
Sai.Plot);h.prototype.render=function(d,a,b,c,f,e,i){var g,j,k,l,m,o,n,p,r,t,s,u,v,x,C,D,F,G,H,I,J,R,L,M,N,O,P,Q,S;this.set.remove();for(r in this.dndata){n=this.dndata[r].length;break}o=function(A,y,z){return y*z+A*(1-z)};x=q(function(A){return this.x+this.w*((A-this.y)/-this.h)},this);C=function(A){u=x((D=this.dndata[d.x])!=null?D[A][1]:void 0);v=(R=this.dndata[d.y])!=null?R[A][1]:void 0;j=a instanceof Array&&d.color!=null?Sai.util.colerp(a[0],a[1],(L=(M=this.data[d.color])!=null?(N=M[A])!=null?
N[1]:void 0:void 0)!=null?L:0):a instanceof Object&&d.color!=null?a[this.rawdata[d.color][A]]:"black";t=f instanceof Array&&d.stroke_color!=null?Sai.util.colerp(f[0],f[1],(O=(P=this.data[d.stroke_color])!=null?(Q=P[A])!=null?Q[1]:void 0:void 0)!=null?O:0):a instanceof Object&&d.color!=null?f[this.rawdata[d.stroke_color][A]]:"black";p=b instanceof Array&&d.radius!=null?o(b[0],b[1],(S=(F=this.data[d.radius])!=null?(G=F[A])!=null?G[1]:void 0:void 0)!=null?S:0):b instanceof Object&&d.radius!=null?b[this.rawdata[d.radius][A]]:
5;s=c instanceof Array&&d.stroke_opacity!=null?o(c[0],c[1],(H=(I=this.data[d.stroke_opacity])!=null?(J=I[A])!=null?J[1]:void 0:void 0)!=null?H:0):c instanceof Object&&d.stroke_opacity!=null?c[this.rawdata[d.stroke_opacity][A]]:1;if(e){l={};for(r in this.rawdata)r.match("^__")||(l[r]=this.rawdata[r][A]);m=Sai.util.infoSetters(i,l)}return this.set.push(g=this.r.circle(u,v,p).attr({fill:j,"stroke-opacity":s,stroke:t,"fill-opacity":0.8,"stroke-width":2}),e?g.hover(function(y){return function(){y();return this.attr("fill-opacity",
0.5)}}(m[0]),function(y){return function(){y();return this.attr("fill-opacity",0.8)}}(m[1])):void 0)};for(k=0;0<=n?k<n:k>n;0<=n?k+=1:k-=1)C.call(this,k);return this};return h}()}).call(this);(function(){var w=function(d,a){return function(){return d.apply(a,arguments)}},B=Array.prototype.indexOf||function(d){for(var a=0,b=this.length;a<b;a++)if(this[a]===d)return a;return-1},q=Object.prototype.hasOwnProperty,h=function(d,a){function b(){this.constructor=d}for(var c in a)if(q.call(a,c))d[c]=a[c];b.prototype=a.prototype;d.prototype=new b;d.__super__=a.prototype;return d};Sai.Chart=function(){function d(a,b,c,f,e,i,g,j){var k;this.r=a;this.x=b;this.y=c;this.w=f;this.h=e;this.__LABELS__=
g;this.opts=j;this.drawInfo=w(this.drawInfo,this);this.opts!=null||(this.opts={});(k=this.opts).bgcolor!=null||(k.bgcolor="white");this.setData(i);a=this.opts.simple?0:5;this.padding={left:a,right:a,top:a,bottom:a}}d.prototype.groupsToNullPad=function(){return[]};d.prototype.nonNegativeGroups=function(){return[]};d.prototype.nextSeriesSuffix=function(){var a;this.suffixCtr=((a=this.suffixCtr)!=null?a:0)+1;return"["+this.suffixCtr+"]"};d.prototype.fixSeriesName=function(a){return a+(a.match(/^\s+$/)?
this.nextSeriesSuffix():"")};d.prototype.setSemanticRename=function(a){var b,c;if(this.semanticRenamePatterns!=null){this.semanticRenames!=null||(this.semanticRenames={});c=[];for(b in this.semanticRenamePatterns)c.push(a.match(this.semanticRenamePatterns[b])?this.semanticRenames[b]=a:void 0);return c}};d.prototype.getBaseline=function(a){a=this.normalizedHeight(0,a!=null?a:"all");return[[0,a],[1,a]]};d.prototype.setData=function(a){var b,c,f,e,i,g,j,k,l;this.data={};this.renames={};if(function(n){var p;
for(p in n)if(n.hasOwnProperty(p))return false;return true}(a))this.render=function(){return this.showError("(no data -> empty chart)")};else{for(e in a){for(;;){i=this.fixSeriesName(e);this.setSemanticRename(i);if(i===e||!(i in a))break}this.renames[e]=i;if(a[e]instanceof Array)if(this.__LABELS__===e){this.__LABELS__=i;var m=this.data,o=i;k=a[e];l=[];g=0;for(j=k.length;g<j;g++){b=k[g];l.push(String(b))}m[o]=l}else{m=this.data;o=i;k=a[e];l=[];g=0;for(j=k.length;g<j;g++){b=k[g];l.push(typeof b==="string"&&
b.match(/^( +)?[+-]?[\d,]+(\.\d+)?( +)?$/)&&!isNaN(f=parseFloat(b.replace(/,/g,"")))?f:b)}m[o]=l}else this.data[i]=a[e]}a=this.dataGroups(this.data);f=this.nonNegativeGroups();for(c in a)if(a[c].length>0)if(B.call(f,c)>=0){j=a[c];i=0;for(g=j.length;i<g;i++){e=j[i];if(this.data[e]!=null){b=0;for(k=this.data[e].length;0<=k?b<k:b>k;0<=k?b+=1:b-=1)if(this.data[e][b]<0)this.data[e][b]*=-1}}}i=this.groupsToNullPad();b=0;for(f=i.length;b<f;b++){c=i[b];if(c in a){j=a[c];g=0;for(c=j.length;g<c;g++){e=j[g];
this.nullPad(e)}}}return this.normalize(this.data)}};d.prototype.nullPad=function(a){if(a in this.data)return this.data[a]=[null].concat(this.data[a].concat([null]))};d.prototype.caresAbout=function(a){return!(a.match("^__")||a===this.__LABELS__)};d.prototype.dataGroups=function(a){var b,c,f;c=[];for(b in a)this.caresAbout(b)&&c.push(b);f=[];for(b in a)if(b.match("^__")||b===this.__LABELS__)f.push(b);return{all:c,__META__:f}};d.prototype.getYAxisVals=function(a,b,c){var f,e,i;if(!(typeof a==="number"&&
typeof b==="number"))return[a,b];if(a===b)return[0,b,b*2];c!=null||(c=false);for(e=1;(b-a)*e<10;)e*=10;a*=e;b*=e;i=Math.floor(f=Math.log(b-a)/Math.LN10-0.4);i=Math.pow(10,i);if(f%1>0.7&&!c)i*=4;else if(f%1>0.35&&!c)i*=2;f=Sai.util.round(a-(c?i/2.1:i/1.75),i);if(f<0&&0<=a)f=0;a=Sai.util.round(b+(c?i/2.1:i/1.75),i);f/=e;a/=e;i/=e;e=f;for(b=[e];e<a;){e=Sai.util.round(e+i,i);b.push(e)}return b};d.prototype.getMax=function(a,b){var c,f,e,i,g,j,k,l,m;return Math.max.apply(Math,function(){l=[];e=0;for(g=
b.length;e<g;e++){f=b[e];a[f]!=null&&l.push(Math.max.apply(Math,function(){k=a[f];m=[];i=0;for(j=k.length;i<j;i++){c=k[i];c!=null&&typeof c==="number"&&m.push(c)}return m}()))}return l}())};d.prototype.getMin=function(a,b){var c,f,e,i,g,j,k,l,m;return Math.min.apply(Math,function(){l=[];e=0;for(g=b.length;e<g;e++){f=b[e];a[f]!=null&&l.push(Math.min.apply(Math,function(){k=a[f];m=[];i=0;for(j=k.length;i<j;i++){c=k[i];c!=null&&typeof c==="number"&&m.push(c)}return m}()))}return l}())};d.prototype.getStackedMax=
function(a,b){var c,f,e,i,g,j,k,l;this.stackedMax!=null||(this.stackedMax={});this.stackedMax[b]=(g=this.stackedMax[b])!=null?g:Math.max.apply(Math,function(){k=[];c=0;for(j=a[this.__LABELS__].length;0<=j?c<j:c>j;0<=j?c+=1:c-=1)k.push(Sai.util.sumArray(function(){l=[];e=0;for(i=b.length;e<i;e++){f=b[e];f!==this.__LABELS__&&a[f][c]>=0&&l.push(a[f][c])}return l}.call(this)));return k}.call(this));return this.stackedMax[b]};d.prototype.getStackedMin=function(a,b){var c,f,e,i,g,j,k,l;this.stackedMin!=
null||(this.stackedMin={});this.stackedMin[b]=(g=this.stackedMin[b])!=null?g:Math.min.apply(Math,function(){k=[];c=0;for(j=a[this.__LABELS__].length;0<=j?c<j:c>j;0<=j?c+=1:c-=1)k.push(Sai.util.sumArray(function(){l=[];e=0;for(i=b.length;e<i;e++){f=b[e];f!==this.__LABELS__&&a[f][c]<0&&l.push(a[f][c])}return l}.call(this)));return k}.call(this));return this.stackedMin[b]};d.prototype.normalize=function(a){var b,c,f,e,i,g,j,k,l,m,o,n,p,r,t,s,u,v,x,C,D,F,G,H,I,J,R,L,M,N,O,P,Q;j=this.dataGroups(a);this.ndata=
{};if(this.opts.stacked!=null)this.stackedNdata={};p=function(y,z,E){if(typeof y==="number")return z===E?1:(y-z)/(E-z);return null};b=function(y,z){var E,K,T;K=0;for(T=z.length;K<T;K++){E=z[K];if(!y(E))return false}return true};i=function(y){var z,E,K;E=0;for(K=y.length;E<K;E++){z=y[E];if(typeof z==="number")return false}return true};L=[];for(g in j){if(!(m=g.match("^__"))){if(!(m=Sai.util.sumArray(function(){F=j[g];M=[];v=0;for(C=F.length;v<C;v++){s=F[v];M.push(this.data[s].length)}return M}.call(this))===
0)){var S=b,A=i;G=j[g];N=[];m=0;for(n=G.length;m<n;m++){s=G[m];N.push(this.data[s])}m=S(A,N)}m=m}if(!m){this.ndata[g]={};if(this.opts.stacked!=null){this.stackedNdata[g]={};f={}}n=this.opts.stacked?w(function(y,z){return this.getStackedMin(y,z)},this):this.getMin;m=this.opts.stacked?w(function(y,z){return this.getStackedMax(y,z)},this):this.getMax;o=n(a,j[g]);l=m(a,j[g]);m=this.getYAxisVals(o,l);o=m[0];l=m[m.length-1];this.ndata[g].__YVALS__=m;L.push(function(){H=j[g];O=[];x=0;for(D=H.length;x<D;x++){s=
H[x];if(a[s]!=null){var y=this.ndata[g],z=s;P=[];k=0;for(I=a[s].length;0<=I?k<I:k>I;0<=I?k+=1:k-=1)P.push(a[s][k]!=null&&(t=p(a[s][k],o,l))!==null?[k/(a[s].length-1||1),t]:null);y[z]=P;O.push(function(){if(this.opts.stacked!=null){r=p(0,o,l);this.stackedNdata[g][s]=[];Q=[];k=0;for(J=a[s].length;0<=J?k<J:k>J;0<=J?k+=1:k-=1){e=a[s][k]!=null&&a[s][k]<0?0:1;f[k]!=null||(f[k]=[r,r]);c=f[k][e];u=[k/(a[s].length-1||1),((R=p(a[s][k],o,l))!=null?R:r)-r+c];this.stackedNdata[g][s].push(u);Q.push(u!==null?f[k][e]=
u[1]:void 0)}return Q}}.call(this))}}return O}.call(this))}}return L};d.prototype.addAxes=function(a,b){var c,f,e,i,g,j,k,l,m,o,n,p,r;this.axisWidth=1.5;this.padding.top+=5;for(f=c=this.data[this.__LABELS__].length-1;c<=0?f<=0:f>=0;c<=0?f+=1:f-=1)if(this.data[this.__LABELS__][f]!=null){f=this.r.text(0,0,Sai.util.prettystr(this.data[this.__LABELS__][f]));this.padding.right+=f.getBBox().width/2;f.remove();break}j=this.h-(this.padding.bottom+this.padding.top);c=this.ndata[a[0]]!=null||this.ndata[a[1]]==
null;f=this.ndata[a[1]]!=null;if(c){r=this.r.sai.prim.vaxis((i=(l=this.ndata[a[0]])!=null?l.__YVALS__:void 0)!=null?i:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,j,{width:this.axisWidth,title:b!=null?b.left:void 0});i=r.items[0].getBBox().width;r.remove()}else i=0;if(f){r=this.r.sai.prim.vaxis((e=(m=this.ndata[a[1]])!=null?m.__YVALS__:void 0)!=null?e:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,j,{width:this.axisWidth,title:b!=null?b.right:void 0});e=r.getBBox().width;
r.remove()}else e=0;this.haxis=this.r.sai.prim.haxis(this.data[this.__LABELS__],this.x+this.padding.left+i,this.y-this.padding.bottom,this.w-this.padding.left-this.padding.right-i-e,{width:this.axisWidth,title:b!=null?b.bottom:void 0});e=this.haxis.getBBox().height;if(isNaN(e))e=1;this.haxis.translate(0,-e);this.padding.bottom+=e;j=this.h-(this.padding.bottom+this.padding.top);if(c){this.vaxis=this.r.sai.prim.vaxis((g=(o=this.ndata[a[0]])!=null?o.__YVALS__:void 0)!=null?g:[0,"?"],this.x+this.padding.left,
this.y-this.padding.bottom,j,{width:this.axisWidth,title:b!=null?b.left:void 0});g=this.vaxis.items[0].getBBox().width;this.vaxis.translate(g,0);this.padding.left+=g}if(f){this.vaxis_right=this.r.sai.prim.vaxis((n=(p=this.ndata[a[1]])!=null?p.__YVALS__:void 0)!=null?n:[0,"?"],this.w-this.padding.right,this.y-this.padding.bottom,j,{width:this.axisWidth,right:true,title:b!=null?b.right:void 0,color:this.ndata[a[0]]!=null?(k=this.colors.__RIGHTAXIS__)!=null?k:"blue":"black"});k=this.vaxis_right.items[0].getBBox().width;
this.vaxis_right.translate(-k,0);this.padding.right+=k}this.setPlotCoords();return this.r.set().push(this.haxis).push(this.vaxis)};d.prototype.setPlotCoords=function(){var a,b,c,f;this.px=this.x+this.padding.left;this.py=this.y-this.padding.bottom;this.pw=this.w-this.padding.left-this.padding.right;this.ph=this.h-this.padding.bottom-this.padding.top;a=(b=this.legend)!=null?b.getBBox():void 0;if((b=this.legend)!=null)b.translate(this.px+this.pw/2-(a.x+a.width/2),0);a=(c=this.histogramLegend)!=null?
c.getBBox():void 0;return(f=this.histogramLegend)!=null?f.translate(this.px+this.pw/2-(a.x+a.width/2),0):void 0};d.prototype.drawBG=function(){return this.bg=this.r.rect(this.px!=null&&this.px||this.x,this.py!=null&&this.py-this.ph||this.y-this.h,this.pw!=null&&this.pw||this.w,this.ph!=null&&this.ph||this.h).attr({fill:this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack()};d.prototype.logoPos=function(){return[this.px!=null&&this.pw!=null?this.px+this.pw-150-5:this.w+this.x-150-this.padding.right,
this.py!=null&&this.ph!=null?this.py-this.ph+5:this.y-this.h+this.padding.top,150,28]};d.prototype.drawLogo=function(){var a,b,c,f,e,i,g;if(!this.opts.simple){a=this.logoPos();e=a[0];i=a[1];f=a[2];a=a[3];b=[328.3,53.06];c=[f/344,a/65];e+=b[0]*c[0];i+=b[1]*c[1];return this.logo=this.r.path("M"+e+","+i+"h1.9v1.6c0.5-0.5,0.9-0.9,1.3-1.2,0.6-0.4,1.4-0.7,2.2-0.7,0.9,0,1.6,0.3,2.2,0.7,0.3,0.3,0.6,0.7,0.9,1.2,0.4-0.7,0.9-1.1,1.5-1.4,0.6-0.3,1.2-0.5,2-0.5,1.5,0,2.6,0.6,3.1,1.7,0.3,0.6,0.5,1.4,0.5,2.5v7.7h-2v-8.1c0-0.7-0.2-1.3-0.6-1.6-0.4-0.2-0.9-0.4-1.4-0.4-0.8,0-1.4,0.3-2,0.8-0.5,0.5-0.8,1.3-0.8,2.5v6.8h-2v-7.6c0-0.8-0.1-1.3-0.3-1.7-0.3-0.5-0.8-0.8-1.6-0.8-0.8,0-1.4,0.3-2,0.8-0.6,0.6-0.9,1.6-0.9,3.1v6.2h-2v-11.6zm-3.9,1.1c1,1,1.5,2.5,1.5,4.4,0,1.9-0.4,3.4-1.3,4.7-0.9,1.2-2.3,1.8-4.2,1.8-1.6,0-2.9-0.6-3.8-1.6-0.9-1.1-1.4-2.6-1.4-4.4,0-1.9,0.5-3.5,1.5-4.6,1-1.2,2.3-1.7,3.9-1.7,1.5,0,2.8,0.5,3.8,1.4zm-1.2,7.7c0.5-0.9,0.7-2,0.7-3.2,0-1.1-0.2-2-0.5-2.6-0.6-1.1-1.5-1.6-2.8-1.6-1.2,0-2,0.4-2.6,1.3-0.5,0.9-0.8,2-0.8,3.3,0,1.2,0.3,2.2,0.8,3.1,0.6,0.8,1.4,1.2,2.6,1.2,1.2,0,2.1-0.5,2.6-1.5zm-10.6-8.2c0.8,0.6,1.3,1.7,1.5,3.3h-1.9c-0.1-0.7-0.4-1.3-0.8-1.8-0.4-0.5-1.1-0.7-2-0.7-1.2,0-2.1,0.6-2.6,1.8-0.4,0.8-0.6,1.8-0.6,2.9,0,1.2,0.3,2.1,0.8,2.9,0.5,0.8,1.2,1.2,2.3,1.2,0.8,0,1.4-0.2,1.9-0.7,0.5-0.5,0.8-1.2,1-2h1.9c-0.2,1.5-0.8,2.6-1.7,3.3-0.8,0.7-1.9,1.1-3.3,1.1-1.5,0-2.7-0.6-3.6-1.7-0.9-1.1-1.3-2.4-1.3-4.1,0-2,0.5-3.6,1.4-4.7,1-1.2,2.3-1.7,3.8-1.7,1.3,0,2.4,0.3,3.2,0.9zm-13.3,8.6h2.2v2.4h-2.2v-2.4zm-181-15.8-6,12.9h-7.6c-0.9-0.4-4.5-6-5.3-7.2-3.3-4.5-6.8-8.9-10.1-13.5-1.2-1.7-2.8-3.2-4-5.1h-8.9v-2.8h17.7c3.4,0,7.2,0.3,9.6-0.8,2.2-0.9,3.9-2.5,5.2-4.3,1.1-1.7,2.8-4.6,2.1-8-1.2-4.9-4-7.791-8.5-9.251-2.6-0.81-9.8-0.61-9.8-0.61h-21v56.361h4.7v-26h6.5c6.4,8.6,12.9,17.3,19.3,26h12.9l6.5-13.1h34.5l6.4,13.1h5.4l-8.6-17.7h-41zm-41.9-34.10h17.7c4.5,0,7.8-0.1,10,2.1,1.1,1.1,2.8,3.2,2.1,5.9-0.5,2.2-1.9,4-3.9,4.8-2,0.9-5.8,0.7-8.4,0.7h-17.5v-13.50zm61.1-4.751-17.4,36.051h37.5l-17.4-36.051h-2.7zm-9.9,31.251,11-22.9,11.4,22.9h-22.4zm-127.60-26.500h25.800v51.8h4.7v-56.361h-30.500v4.561zm276.70-12.341-35.6,29.741v-29.741h-4.8v39.441l48-39.441h-7.6zm19.4,0h-7.4l-32.3,26.941,32.3,37.2h6.2l-31.6-36.400,32.8-27.741zm-163.3,0-25.1,50.841-5.9-7.8-3.4-4.5v-0.4c9.7,0,16-4.9,18.8-11.6,4.8-11.3-2.7-21.961-10.4-25.211-3.4-1.44-8-1.33-12.9-1.33h-20.3h-73.600v4.74h64.100v2.97l-30.7,0.1v56.331h4.7v-51.8h26v51.8h4.7v-59.401h22.8c4,0,8.8-0.46,12,0.57,3.4,1.12,5.9,3.35,7.7,6.031,1.7,2.6,3.5,7.2,2.1,11.6-0.7,2.3-1.9,4.2-3.2,5.9-1.3,1.7-4.4,3.4-6.6,4.2-1,0.3-3.1,0.5-3.1,0.5h-11.5c5.6,7.7,11.3,15.3,17,23h4.4c0.6-0.4,25-50.151,25.4-51.801h6.1l29.2,59.401h5.1l-31.3-64.141h-12.1zm103.5,43.641v20.5h4.8v-18.2l12.5-10.5,25,28.7h6.3l-30.6-35.1-18,14.6zm-7.7-28.3c-6.1-9.141-17.1-15.251-29.6-15.251-19.2,0-34.8,14.351-34.8,32.151,0,17.7,15.6,32.1,34.8,32.1,10.5,0,22.4-4.1,29.7-10.8v10.6h4.8v-19c-1.7,0.8-3.3,1.8-4.9,2.8v0.1c-10.9,7.1-19.4,11.2-29.9,11.3-16.4,0-29.6-12.2-29.6-27.2,0-15.1,13.2-27.311,29.6-27.311,11.5,0,21.5,6.011,26.4,14.811,0,0,2.2-1.4,3.5-2.2v20.8c-1.3,0.9-4.5,3.3-4.6,3.4-8.2,5.4-17.9,10.3-25.5,10.4-12,0-21.7-9-21.7-19.9,0-11,9.7-19.9,21.7-19.9,8.4,0,15.7,4.4,19.3,10.8l0.1,0.1c0.2,0.2,0.5,0.2,0.7,0.1,0,0,0.1-0.1,0.1-0.1,0.1-0.1,0.9-0.6,1.7-1,0.4-0.3,0.8-0.5,1.1-0.7,0.1,0,0.2-0.1,0.3-0.2h0.1l0.1-0.1c0.2-0.1,0.3-0.5,0.1-0.7-4.5-7.8-13.3-12.971-23.4-12.971-14.8,0-26.7,11.071-26.7,24.771,0,13.7,11.9,24.7,26.7,24.7,9.6,0,25.4-8.1,29.9-12.2,1.6-1.1,3.1-2.4,4.9-3.2v-41.561h-4.9v15.361z").hide().attr({fill:(g=
this.opts.logoColor)!=null?g:"#AA5128","stroke-width":0,"stroke-opacity":0,opacity:0.25,cx:e+f/2,cy:i-a/2}).scale(c[0],c[1],e,i).show()}};d.prototype.drawFootnote=function(a){var b;a!=null||(a=(b=this.opts.footnote)!=null?b:"");if(!a.match(/^\s*$/)){this.footnote=this.r.sai.prim.wrappedText(this.x+this.padding.left,this.y-this.padding.bottom,this.w,a," ");a=this.footnote.getBBox().height;this.padding.bottom+=a+10;return this.footnote.translate(0,-a)}};d.prototype.render=function(){this.opts.simple&&
this.renderPlots!=null?this.renderPlots():this.renderFull();return this};d.prototype.renderFull=function(){this.plot!=null||(this.plot=new Sai.Plot(this.r));this.plot.render();return this};d.prototype.showError=function(a){var b,c;return this.r.text(this.x+this.padding.left+((b=this.pw)!=null?b:this.w)/2,this.y-this.padding.bottom-((c=this.ph)!=null?c:this.h)/2,a)};d.prototype.setColors=function(a){var b,c;this.colors!=null||(this.colors={});for(b in a){c=this.renames[b];if(c in this.data)this.colors[c]=
a[b]}return this};d.prototype.setColor=function(a,b){this.colors!=null||(this.colors={});this.colors[this.renames[a]]=b;return this};d.prototype.normalizedHeight=function(a,b){var c,f;if(((c=this.ndata[b])!=null?c.__YVALS__:void 0)!=null){f=this.ndata[b].__YVALS__[0];c=this.ndata[b].__YVALS__[this.ndata[b].__YVALS__.length-1];if(a<f)a=f;else if(a>c)a=c;return(a-f)/(c-f)}};d.prototype.drawGuideline=function(a,b){var c;b!=null||(b="all");if(((c=this.ndata[b])!=null?c.__YVALS__:void 0)!=null){c=this.normalizedHeight(a,
b);this.guidelines!=null||(this.guidelines=this.r.set());c=new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,{guideline:[[0,c],[1,c]]});c.render({guideline:"#ccc"});return this.guidelines.push(c.set)}};d.prototype.drawLegend=function(a){var b,c,f,e,i;a!=null||(a=this.colors);if(a){c={};f={};for(b in a)if(b!==this.__LABELS__){c[b]=a[b];f[b]="black";if(((e=this.opts.groups)!=null?e.right:void 0)!=null)if(B.call(this.opts.groups.right,b)>=0)f[b]=this.ndata.left!=null?(i=this.colors.__RIGHTAXIS__)!=
null?i:"blue":"black"}this.legend=this.r.sai.prim.legend(this.x,this.y-this.padding.bottom,this.w,c,f);a=this.legend.getBBox();if(this.legend.length>0)this.padding.bottom+=a.height+15;return this.legend.translate((this.w-a.width)/2,0)}};d.prototype.drawTitle=function(){if(this.opts.title!=null){this.title=this.r.text(this.x+this.w/2,this.y-this.h,this.opts.title).attr({"font-size":20});this.title.translate(0,this.title.getBBox().height/2);return this.padding.top+=this.title.getBBox().height+5}};d.prototype.setupInfoSpace=
function(){this.info_y=this.y-this.h+this.padding.top;this.info_x=this.x+this.padding.left;this.info_w=this.w-this.padding.left-this.padding.right;return this.padding.top+=30};d.prototype.drawInfo=function(a,b){var c,f;b!=null||(b=true);a!=null||(a=this.default_info!=null?this.default_info():{});if(b)this.info_data={};this.info&&this.info.remove();for(c in a)c.match("^__")||(this.info_data[c]=(f=a[c])!=null?f:"(no data)");return this.info=this.r.sai.prim.info(this.info_x,this.info_y,this.info_w,this.info_data)};
d.prototype.getIndex=function(a){a=Sai.util.transformCoords(a,this.r.canvas).x;return Math.round((this.data[this.__LABELS__].length-1)*(a-this.px)/this.pw)};d.prototype.drawHistogramLegend=function(a,b){var c,f,e,i,g,j,k,l,m,o,n,p;b!=null||(b=this.colors);this.histogramLegend=this.r.set();i=Math.max(0.1*(this.h-this.padding.bottom-this.padding.top),50);l=Math.min(150,(this.w-this.padding.left-this.padding.right-20)/a.length);g=0;for(m=a.length;0<=m?g<m:g>m;0<=m?g+=1:g-=1){k=a[g];c=[];f=0;for(e=this.ndata[k][k].length;0<=
e?f<e:f>e;0<=e?f+=1:f-=1)this.ndata[k][k][f]!=null&&c.push(this.ndata[k][k][f][1]);f=c;if(((o=this.bounds)!=null?o[k]:void 0)!=null){c=this.bounds[k];e=c[0];c=c[1]}else{n=this.data[k];p=[];c=0;for(j=n.length;c<j;c++){e=n[c];e!=null&&p.push(e)}e=p;c=[Math.min.apply(Math,e),Math.max.apply(Math,e)];e=c[0];c=c[1]}c=this.getYAxisVals(e,c,true);e=c[0];j=c[c.length-1];c=b[k];this.histogramLegend.push(f=this.r.sai.prim.histogram(this.x+g*l,this.y-this.padding.bottom,l*0.8,i,f,e,j,k,typeof c==="object"?[c.__LOW__,
c.__HIGH__]:[c],"white",this.opts.fromWhite));this.opts.interactive&&this.setupHistogramInteraction(f,k)}this.histogramLegend.translate((this.w-this.padding.left-this.padding.right-this.histogramLegend.getBBox().width)/2,0);return this.padding.bottom+=i+5};d.prototype.setupHistogramInteraction=function(){return null};return d}();Sai.LineChart=function(){function d(){d.__super__.constructor.apply(this,arguments)}h(d,Sai.Chart);d.prototype.nonNegativeGroups=function(){return this.opts.stacked?["all",
"left","right"]:[]};d.prototype.dataGroups=function(){var a,b,c,f,e,i;a=d.__super__.dataGroups.apply(this,arguments);if(((b=this.opts.groups)!=null?b.left:void 0)!=null&&((c=this.opts.groups)!=null?c.right:void 0)!=null){e=this.opts.groups.left;i=[];c=0;for(f=e.length;c<f;c++){b=e[c];this.caresAbout(b)&&b in this.data&&i.push(b)}a.left=i;e=this.opts.groups.right;i=[];c=0;for(f=e.length;c<f;c++){b=e[c];this.caresAbout(b)&&b in this.data&&i.push(b)}a.right=i}return a};d.prototype.renderPlots=function(){var a,
b,c,f,e,i,g,j;this.px==null&&this.setPlotCoords();this.drawBG();this.drawLogo();c="right"in this.ndata;a=this.opts.stacked!=null?this.stackedNdata:this.ndata;b=this.opts.area?Sai.AreaPlot:Sai.LinePlot;if(c){if(((f=this.ndata.left)!=null?f.__YVALS__[0]:void 0)<0)this.drawGuideline(0,"left");if(((e=this.ndata.right)!=null?e.__YVALS__[0]:void 0)<0)this.drawGuideline(0,"right")}else this.ndata.all.__YVALS__[0]<0&&this.drawGuideline(0,"all");this.plots=[];if(c){if(a.left!=null)this.plots.push((new b(this.r,
this.px,this.py,this.pw,this.ph,a.left)).render(this.colors,(i=this.opts.lineWidth)!=null?i:2,this.opts.stacked,this.getBaseline("left")));if(a.right!=null)return this.plots.push((new b(this.r,this.px,this.py,this.pw,this.ph,a.right)).render(this.colors,(g=this.opts.lineWidth)!=null?g:2,this.opts.stacked,this.getBaseline("right")))}else return this.plots.push((new b(this.r,this.px,this.py,this.pw,this.ph,a.all)).render(this.colors,(j=this.opts.lineWidth)!=null?j:2,this.opts.stacked,this.getBaseline("all")))};
d.prototype.renderFull=function(){var a,b,c,f,e,i,g;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawLegend();"right"in this.ndata?this.addAxes(["left","right"]):this.addAxes(["all"]);this.renderPlots();this.plotSets=this.r.set();e=this.plots;c=0;for(f=e.length;c<f;c++){a=e[c];this.plotSets.push(a.set)}this.dots=this.r.set();for(b in this.ndata.all)if(b!=="__YVALS__")this.dots.push(this.r.circle(0,0,4).attr({fill:(i=(g=this.colors)!=null?g[b]:void 0)!=null?i:"black"}).hide());a=
this.r.set().push(this.bg,this.plotSets,this.dots,this.logo,this.guidelines).mousemove(w(function(j){var k,l,m,o,n,p,r,t,s,u;l=this.getIndex(j);j={};if(((t=this.data[this.__LABELS__])!=null?t.length:void 0)>l&&l>=0){j[this.__LABELS__]=this.data[this.__LABELS__][l];for(n in this.ndata.all)if(this.data[n]!=null)j[n]=this.data[n][l]}this.drawInfo(j);k=0;t=[];for(n in this.ndata.all)n!=="__YVALS__"&&t.push(function(){s=this.plots;u=[];p=0;for(r=s.length;p<r;p++){m=s[p];if(n in m.dndata){o=m.dndata[n][l];
o!=null?this.dots[k].attr({cx:o[0],cy:o[1]}).show().toFront():this.dots[k].hide();u.push(k++)}}return u}.call(this));return t},this)).mouseout(w(function(){this.drawInfo({},true);return this.dots.hide()},this));this.opts.href&&a.attr({href:this.opts.href,target:"_blank"});return this};return d}();Sai.StreamChart=function(){function d(a,b,c,f,e,i,g,j){this.r=a;this.x=b;this.y=c;this.w=f;this.h=e;this.__LABELS__=g;this.opts=j;this.opts.stacked=true;d.__super__.constructor.apply(this,arguments)}h(d,
Sai.LineChart);d.prototype.getStackedMax=function(){return d.__super__.getStackedMax.apply(this,arguments)/2};d.prototype.getStackedMin=function(a,b){var c,f;c=d.__super__.getStackedMin.apply(this,arguments);f=this.getStackedMax(a,b);return c-f};d.prototype.normalize=function(a){var b,c,f,e,i,g,j,k,l,m,o,n,p,r,t,s;d.__super__.normalize.apply(this,arguments);c=this.dataGroups(this.data);this.baselines!=null||(this.baselines={});r=[];for(b in this.stackedNdata){e=this.normalizedHeight(0,b!=null?b:"all");
this.normalizedHeight(this.getStackedMin(a,c[b]),b);this.baselines[b]=[];var u=this.ndata[b];n=this.ndata[b].__YVALS__;t=[];m=0;for(o=n.length;m<o;m++){l=n[m];t.push(Math.abs(l))}u.__YVALS__=t;for(j in this.stackedNdata[b])k=j;r.push(function(){s=[];f=0;for(p=this.stackedNdata[b][j].length;0<=p?f<p:f>p;0<=p?f+=1:f-=1){i=(this.stackedNdata[b][k][f][1]-e)/2;for(j in this.stackedNdata[b]){g=this.stackedNdata[b][j][f];if(g!=null)g[1]-=i}s.push(this.baselines[b].push([g[0],e-i]))}return s}.call(this))}return r};
d.prototype.addAxes=function(a,b){b!=null||(b={});"left"in b||(b.left="magnitude");return d.__super__.addAxes.call(this,a,b)};d.prototype.getBaseline=function(a){return this.baselines[a]};return d}();Sai.Sparkline=function(){function d(){d.__super__.constructor.apply(this,arguments)}h(d,Sai.Chart);d.prototype.dataGroups=function(){return{data:["data"]}};d.prototype.renderFull=function(){this.drawBG();this.plots=this.r.set();this.plots.push((new Sai.LinePlot(this.r,this.x,this.y,this.w,this.h,this.ndata.data)).render({data:this.colors&&
this.colors[series]||"black"},1).set);return this};return d}();Sai.BarChart=function(){function d(){d.__super__.constructor.apply(this,arguments)}h(d,Sai.Chart);d.prototype.getMin=function(){return Math.min(d.__super__.getMin.apply(this,arguments),0)};d.prototype.groupsToNullPad=function(){var a,b;b=[];for(a in this.dataGroups())b.push(a);return b};d.prototype.tooMuchData=function(){var a,b,c;b=this.w/3;a=0;for(c in this.data)if(c!==this.__LABELS__){a+=this.data[c].length;if(this.opts.stacked)break}return a>
b};d.prototype.renderPlots=function(){var a,b,c,f,e;this.px==null&&this.setPlotCoords();this.drawLogo();this.drawBG();if(this.tooMuchData()){this.showError("Sorry, the chart isn't wide enough to plot this much data.\n \nPossible solutions include downsampling your data\n (e.g. weekly instead of daily) or using a line chart");return this}if("all"in this.ndata){this.guidelines=this.r.set();e=this.ndata.all.__YVALS__.slice(1,this.ndata.all.__YVALS__.length-1);b=0;for(c=e.length;b<c;b++){a=e[b];this.drawGuideline(a)}}this.plots=
this.r.set();a={};c={};c[this.__LABELS__]=this.data[this.__LABELS__];b=this.opts.stacked!=null?this.stackedNdata:this.ndata;for(f in b.all)if(!(f.match("^__")||f===this.__LABELS__)){a[f]=b.all[f];c[f]=this.data[f]}return this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph,a,c)).render(this.opts.stacked!=null,this.normalizedHeight(0,"all"),this.colors,this.opts.interactive&&!this.opts.simple,this.drawInfo,this.__LABELS__).set)};d.prototype.renderFull=function(){var a;this.drawTitle();
this.setupInfoSpace();this.drawFootnote();this.drawLegend();this.addAxes(["all"]);this.renderPlots();a=this.r.set().push(this.plots,this.bg,this.logo,this.guidelines);this.opts.href&&a.attr({href:this.opts.href,target:"_blank"});return this};return d}();Sai.StockChart=function(){function d(){d.__super__.constructor.apply(this,arguments)}h(d,Sai.Chart);d.prototype.semanticRenamePatterns={open:/^open$/i,close:/^close$/i,high:/^high$/i,low:/^low$/i,volume:/^vol(ume)?$/i};d.prototype.groupsToNullPad=
function(){return["prices","volume","__META__"]};d.prototype.dataGroups=function(a){var b,c,f,e;b={__META__:[this.__LABELS__]};f=(e=this.semanticRenames.volume)!=null?e:"volume";if(f in this.data)b.volume=[f];for(c in a)if(this.caresAbout(c)&&c!==this.__LABELS__&&c!==f){b.prices!=null||(b.prices=[]);b.prices.push(c)}return b};d.prototype.nonNegativeGroups=function(){return["volume"]};d.prototype.renderPlots=function(){var a,b,c,f,e,i,g,j,k,l,m,o;this.px==null&&this.setPlotCoords();e=(b=this.semanticRenames.open)!=
null?b:"open";b=(c=this.semanticRenames.close)!=null?c:"close";c=(f=this.semanticRenames.high)!=null?f:"high";f=(k=this.semanticRenames.low)!=null?k:"low";k=(o=this.semanticRenames.volume)!=null?o:"volume";this.colors!=null||(this.colors={});(i=this.colors).up!=null||(i.up="black");(j=this.colors).down!=null||(j.down="red");(l=this.colors).vol_up!=null||(l.vol_up="#666666");(m=this.colors).vol_down!=null||(m.vol_down="#cc6666");this.drawLogo();this.drawBG();if(this.ndata.prices!=null&&e in this.ndata.prices&&
b in this.ndata.prices&&c in this.ndata.prices&&f in this.ndata.prices){this.ndata.prices.__YVALS__[0]<0&&this.drawGuideline(0,"prices");this.plots=this.r.set();j={up:[],down:[]};i={};for(a in this.ndata.prices)a.match("^__")||a===this.__LABELS__||(i[a]=this.data[a]);if(this.data[k]!=null)i.vol=this.data[k];if("volume"in this.ndata){a=0;for(l=this.ndata.volume[k].length;0<=l?a<l:a>l;0<=l?a+=1:a-=1)if(this.ndata.volume[k][a]!==null)if(a&&this.ndata.prices[b][a-1]&&this.ndata.prices[b][a][1]<this.ndata.prices[b][a-
1][1]){j.down.push(this.ndata.volume[k][a]);j.up.push([this.ndata.volume[k][a][0],0])}else{j.up.push(this.ndata.volume[k][a]);j.down.push([this.ndata.volume[k][a][0],0])}else{j.up.push([0,0]);j.down.push([0,0])}this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph*0.2,j,i)).render(true,this.normalizedHeight(0,"volume"),{up:this.colors.vol_up,down:this.colors.vol_down}).set)}this.plots.push((new Sai.CandlestickPlot(this.r,this.px,this.py,this.pw,this.ph,{open:this.ndata.prices[e],
close:this.ndata.prices[b],high:this.ndata.prices[c],low:this.ndata.prices[f]},i)).render(this.colors,Math.min(5,this.pw/this.ndata.prices[e].length-2)).set);a={};for(g in this.ndata.prices)g===e||g===b||g===c||g===f||g.match("^__")||g===this.__LABELS__||(a[g]=this.ndata.prices[g]);return this.plots.push((new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,a)).render(this.colors).set)}else this.showError("This chart requires data series named\nopen, close, high, and low.\n \nOnce you add series with these names, the chart will display.")};
d.prototype.renderFull=function(){var a,b,c,f,e,i,g,j,k,l;this.drawTitle();this.setupInfoSpace();this.drawFootnote();i=(b=this.semanticRenames.open)!=null?b:"open";b=(f=this.semanticRenames.close)!=null?f:"close";f=(e=this.semanticRenames.high)!=null?e:"high";e=(a=this.semanticRenames.low)!=null?a:"low";k=(j=this.semanticRenames.volume)!=null?j:"volume";a={};j=false;for(g in this.ndata.prices)if(g!==i&&g!==b&&g!==f&&g!==e&&!(g.match("^__")||g===this.__LABELS__)){a[g]=((l=this.colors)!=null?l[g]:void 0)||
"black";j=true}j&&this.drawLegend(a);this.addAxes(["prices"]);this.renderPlots();c=this.pw/(this.data[this.__LABELS__].length-1);this.glow=this.r.rect(this.px-c/2,this.py-this.ph,c,this.ph).attr({fill:"0-"+this.opts.bgcolor+"-#DDAA99-"+this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack().hide();this.bg.toBack();this.r.set().push(this.bg,this.plots,this.logo,this.glow,this.guidelines).mousemove(w(function(m){var o,n,p,r,t;m=this.getIndex(m);o={};if(this.data[this.__LABELS__][m]!=null)o[this.__LABELS__]=
this.data[this.__LABELS__][m];n=false;for(p in this.ndata.prices)if(!(p.match("^__")||p===this.__LABELS__))if(((r=this.data[p])!=null?r[m]:void 0)!=null){o[p]=this.data[p][m];n=true}if(((t=this.data[k])!=null?t[m]:void 0)!=null){o[k]=this.data[k][m];n=true}this.drawInfo(o);if(n)return this.glow.attr({x:this.px+c*(m-0.5)}).show()},this)).mouseout(w(function(){this.drawInfo({},true);return this.glow.hide()},this));return this};return d}();Sai.GeoChart=function(){function d(){this.renderPlots=w(this.renderPlots,
this);d.__super__.constructor.apply(this,arguments)}h(d,Sai.Chart);d.prototype.plotType=Sai.GeoPlot;d.prototype.interactiveHistogram=true;d.prototype.getMax=function(a){return Math.max.apply(Math,a)};d.prototype.getMin=function(a){return Math.min.apply(Math,a)};d.prototype.normalize=function(a){var b,c,f,e,i,g,j,k,l,m,o,n,p,r,t;this.ndata={};this.bounds={};e={};g={};for(l in a)if(!(l.match("^__")||l===this.__LABELS__))if(a[l]!=null){n=a[l];r=[];m=0;for(o=n.length;m<o;m++){b=n[m];b!=null&&r.push(b)}b=
r;e[l]=this.getMax(b,l);if(!(typeof j!="undefined"&&j!==null)||e[l]>j)j=e[l];g[l]=this.getMin(b,l);if(!(typeof k!="undefined"&&k!==null)||g[l]<k)k=g[l]}b=[];for(l in a)if(!(l.match("^__")||l===this.__LABELS__))if(a[l]!=null){if(this.opts.groupedNormalization){f=j;i=k}else{f=e[l];i=g[l]}this.bounds[l]=[i,f];this.ndata[l]={};b.push(this.ndata[l][l]=function(){t=[];c=0;for(p=a[l].length;0<=p?c<p:c>p;0<=p?c+=1:c-=1)t.push(a[l][c]!=null?[c/(a[l].length-1),(a[l][c]-i)/(f-i)]:null);return t}())}return b};
d.prototype.dataGroups=function(a){var b,c;b=[];for(c in a)if(c.match("^__")||c===this.__LABELS__)b.push(c);b={__META__:b};for(c in a)c.match("^__")||c===this.__LABELS__||(b[c]=[c]);return b};d.prototype.setupHistogramInteraction=function(a,b){return a.click(w(function(){return this.renderPlots(b)},this)).hover(w(function(c){return w(function(){c.attr({"fill-opacity":0.75});return this.drawInfo({"Click to display on map":b})},this)},this)(a),w(function(c){return w(function(){c.attr({"fill-opacity":1});
return this.drawInfo()},this)},this)(a))};d.prototype.renderPlots=function(a){var b,c;this.px==null&&this.setPlotCoords();if((b=this.bg)!=null)b.remove();if((b=this.logo)!=null)b.remove();if((b=this.geoPlot)!=null)b.set.remove();this.drawBG();this.drawLogo();b={};for(c in this.ndata)b[c]=this.ndata[c][c];this.geoPlot=(new this.plotType(this.r,this.px,this.py,this.pw,this.ph,b,this.data,{fromWhite:this.opts.fromWhite})).render(this.colors||{},this.data.__MAP__,this.__LABELS__,a!=null?a:this.data.__DEFAULT__,
this.opts.bgcolor,this.opts.interactive&&!this.opts.simple,this.drawInfo);return this};d.prototype.default_info=function(){return{"":this.opts.interactive?"Click histogram below to change map display":""}};d.prototype.renderFull=function(){var a,b,c;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawHistogramLegend(function(){c=[];for(b in this.data)b.match("^__")||b===this.__LABELS__||c.push(b);return c}.call(this));this.setPlotCoords();this.drawInfo();this.renderPlots();a=this.r.set().push(this.geoPlot.set,
this.bg,this.logo,this.info,this.footnote);this.opts.href&&a.attr({href:this.opts.href,target:"_blank"});return this};return d}();Sai.ChromaticGeoChart=function(){function d(){d.__super__.constructor.apply(this,arguments)}h(d,Sai.GeoChart);d.prototype.plotType=Sai.ChromaticGeoPlot;d.prototype.interactiveHistogram=false;d.prototype.default_info=function(){return{}};d.prototype.setupHistogramInteraction=function(){return false};return d}();Sai.ScatterChart=function(){function d(){d.__super__.constructor.apply(this,
arguments)}h(d,Sai.Chart);d.prototype.dataGroups=function(a){var b,c;b=[];for(c in a)if(c.match("^__")||c===this.__LABELS__)b.push(c);b={__META__:b};for(c in a)c.match("^__")||c===this.__LABELS__||(b[c]=[c]);return b};d.prototype.renderPlots=function(){var a,b,c,f,e,i,g;this.px==null&&this.setPlotCoords();a=(i=(g=this.opts.colors)!=null?g:this.colors)!=null?i:["black","white"];i=(e=this.opts.stroke_opacity)!=null?e:[0,1];e=(c=this.opts.stroke_colors)!=null?c:["black","black"];c=(b=this.opts.radius)!=
null?b:[4,12];this.drawLogo();this.drawBG();b={};for(f in this.ndata)b[f]=this.ndata[f][f];this.plots=this.r.set();this.plots.push((new Sai.ScatterPlot(this.r,this.px,this.py,this.pw,this.ph,b,this.data)).render(this.opts.mappings,a,c,i,e,this.opts.interactive&&!this.opts.simple,this.drawInfo).set);return this};d.prototype.renderFull=function(){var a,b,c,f,e,i;this.drawTitle();this.setupInfoSpace();this.drawFootnote();b=(i=(e=this.opts.colors)!=null?e:this.colors)!=null?i:["black","white"];i=(f=this.opts.stroke_colors)!=
null?f:["black","black"];e=[];f={};if(b instanceof Array){e.push(this.opts.mappings.color);f[this.opts.mappings.color]={__LOW__:b[0],__HIGH__:b[1]}}else{typeof legend_colors!="undefined"&&legend_colors!==null||(legend_colors={});c=true;for(a in b)legend_colors[a]=b[a]}if(!(i instanceof Array)){typeof legend_colors!="undefined"&&legend_colors!==null||(legend_colors={});c=true;for(a in b)legend_colors[a]=i[a]}e.length&&this.drawHistogramLegend(e,f);c&&this.drawLegend(b);this.__LABELS__="__XVALS__";
this.data.__XVALS__=this.ndata[this.opts.mappings.x].__YVALS__;this.addAxes([this.opts.mappings.y],{left:this.opts.mappings.y,bottom:this.opts.mappings.x});this.renderPlots();a=this.r.set().push(this.plots,this.bg,this.logo,this.info,this.footnote,this.histogramLegend,this.legend);this.opts.href&&a.attr({href:this.opts.href,target:"_blank"});return this};return d}()}).call(this);
