Sai={};Sai.util={};Sai.imagePath=typeof Sai.imagePath!=="undefined"&&Sai.imagePath!==null?Sai.imagePath:"/static/images/sai/";Sai.util.roundToMag=function(n,q){var i;q=typeof q!=="undefined"&&q!==null?q:0;i=Math.pow(10,q);return parseFloat((Math.round(n/i)*i).toFixed(Math.max(0,q)))};Sai.util.round=function(n,q){return parseFloat((Math.round(n/q)*q).toFixed(Math.max(0,Math.ceil(-1*Math.log(q)/Math.LN10))))};
Sai.util.sumArray=function(n){var q,i,a;a=0;q=n.length;for(i=0;0<=q?i<q:i>q;0<=q?i+=1:i-=1)a+=typeof n[i]==="number"?n[i]:0;return a};Sai.util.prettystr=function(n,q){var i;q=typeof q!=="undefined"&&q!==null?q:2;if(typeof n==="number"){if(Math.abs(n)>=1E12){i="t";n/=1E12}else if(Math.abs(n)>=1E9){i="b";n/=1E9}else if(Math.abs(n)>=1E6){i="m";n/=1E6}else if(Math.abs(n)>=1E3){i="k";n/=1E3}else return String(parseFloat(n.toFixed(q)));return parseFloat(n.toFixed(1))+i}return n};
Sai.util.prettynum=function(n){var q;if(!(isNaN(parseFloat(n))||!String(n).match(/^[-+]?\d+(\.\d+)?$/))){n=String(n).split(".");for(q=/(\d+)(\d{3})/;q.test(n[0]);)n[0]=n[0].replace(q,"$1,$2");return n[0]+(n.length>1?parseFloat("0."+n[1]).toFixed(2).slice(1):"")}};Sai.util.infoSetters=function(n,q){return[function(){return n(q)},function(){return n()}]};
Sai.util.transformCoords=function(n,q){var i;if(q.getScreenCTM){i=q.createSVGPoint();i.x=n.clientX;i.y=n.clientY;i=i.matrixTransform(q.getScreenCTM().inverse());if(navigator.userAgent.toLowerCase().indexOf("chrome")!==-1||navigator.userAgent.toLowerCase().indexOf("safari")!==-1)i.x+=document.body.scrollLeft;return{x:i.x,y:i.y}}else return{x:n.x,y:n.y}};
Sai.util.multiplyColor=function(n,q,i,a){a=typeof a!=="undefined"&&a!==null?a:0;q=a+(1-a)*q;a=Raphael.getRGB(n);if(i){n=a.r+(255-a.r)*(1-q);i=a.g+(255-a.g)*(1-q);q=a.b+(255-a.b)*(1-q)}else{n=a.r*q;i=a.g*q;q=a.b*q}return{r:n,g:i,b:q,str:"rgb("+n+", "+i+", "+q+")"}};Sai.util.colerp=function(n,q,i){n=Raphael.getRGB(n);q=Raphael.getRGB(q);return"rgb("+(q.r*i+n.r*(1-i))+", "+(q.g*i+n.g*(1-i))+", "+(q.b*i+n.b*(1-i))+")"};
Sai.util.reflectColor=function(n,q){var i,a,c,b,d,f,e,g,h;f=Raphael.getRGB(n);g=Raphael.getRGB(q);h={};a=["r","g","b"];i=0;for(c=a.length;i<c;i++){d=a[i];b=f[d];e=g[d];h[d]=b===e?b:b>e?e*((255-b)/(255-e)):(255*(e-b)+e*b)/e}return"rgb("+h.r+", "+h.g+", "+h.b+")"};Sai.data=typeof Sai.data!=="undefined"&&Sai.data!==null?Sai.data:{};Sai.data.map=typeof Sai.data.map!=="undefined"&&Sai.data.map!==null?Sai.data.map:{};
Raphael.fn.sai=typeof Raphael.fn.sai!=="undefined"&&Raphael.fn.sai!==null?Raphael.fn.sai:{};Raphael.fn.sai.chart=function(n,q,i,a,c,b){c=typeof{line:Sai.LineChart}[c]!=="undefined"&&{line:Sai.LineChart}[c]!==null?{line:Sai.LineChart}[c]:c;c=typeof c!=="undefined"&&c!==null?c:Sai.Chart;return(new c(this,n,q,i,a,b)).render()};(function(){var n,q=Object.prototype.hasOwnProperty;Raphael.fn.sai.prim=typeof Raphael.fn.sai.prim!=="undefined"&&Raphael.fn.sai.prim!==null?Raphael.fn.sai.prim:{};n=function(i,a,c,b){return[function(){i.attr(a);return b?b[0](i):null},function(){i.attr(c);return b?b[1](i):null}]};Raphael.fn.sai.prim.candlestick=function(i,a,c,b,d,f,e,g,h,k,j){e=typeof e!=="undefined"&&e!==null?e:"#000000";f%2||f++;f=this.rect(i-f/2,a,f,c-a||1).attr("stroke",e);b=this.path("M"+i+" "+b+"L"+i+" "+a+"M"+i+" "+c+"L"+i+
" "+d).attr("stroke",e);f.attr("fill",g?e:"#ffffff");e=this.set().push(f,b);if(h){i=n(e,{scale:"1.5,1.5,"+i+","+(a+(c-a)/2),"fill-opacity":0.5},{scale:"1.0,1.0,"+i+","+(a+(c-a)/2),"fill-opacity":1},j);e.hover(i[0],i[1])}return e};Raphael.fn.sai.prim.line=function(i,a,c){var b,d,f,e;a=typeof a!=="undefined"&&a!==null?a:"#000000";c=typeof c!=="undefined"&&c!==null?c:1;b=0;for(d=i.length;b<d;b++){f=i[b];if(typeof f!=="undefined"&&f!==null)if(typeof e!=="undefined"&&e!==null)e+="L"+f[0]+" "+f[1];else e=
"M"+f[0]+" "+f[1]}return this.path(e).attr({stroke:a,"stroke-width":c})};Raphael.fn.sai.prim.area=function(i,a,c,b){var d,f,e,g,h;if(i.length<2)return this.set();a=typeof a!=="undefined"&&a!==null?a:"#000000";c=typeof c!=="undefined"&&c!==null?c:1;d=0;for(f=i.length;d<f;d++){g=i[d];if(typeof g!=="undefined"&&g!==null)if(typeof h!=="undefined"&&h!==null){h+="L"+g[0]+" "+g[1];e+="L"+g[0]+" "+g[1]}else{h="M"+g[0]+" "+g[1];e="M"+g[0]+" "+g[1]}}for(i=b.length-1;b.length-1<=0?i<=0:i>=0;i+=-1)e+="L"+b[i][0]+
","+b[i][1];b=this.path(e).attr({fill:a,"stroke-width":0,"stroke-opacity":0,"fill-opacity":0.35});a=this.path(h).attr({stroke:a,"stroke-width":c});return this.set().push(b,a)};Raphael.fn.sai.prim.stackedBar=function(i,a,c,b,d,f,e){var g,h,k,j,l,o,m,p;if(d&&typeof(g=i[i.length-1])!=="undefined"&&g!==null)p=b-i[i.length-1][1];c*=0.67;m=this.set();j=b;h=i.length;for(g=0;0<=h?g<h:g>h;0<=h?g+=1:g-=1){o=g;if(typeof(k=i[o])!=="undefined"&&k!==null&&i[o][1]!==b){l=j-i[o][1];j=o===0?1:0;m.push(j=this.rect(i[o][0]-
c/2,i[o][1],c,l-j).attr("fill",(typeof a==="undefined"||a===null?undefined:a[o])||"#000000").attr("stroke",(typeof a==="undefined"||a===null?undefined:a[o])||"#000000"));if(d){l=n(j,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},[function(r){return function(){e[0]&&e[0]();return f({"(selected)":Sai.util.prettystr(r)+"%"},false)}}(100*l/p),e[1]]);j.hover(l[0],l[1])}j=i[o][1]}}return m};Raphael.fn.sai.prim.groupedBar=function(i,a,c,b,d,f,e){var g,h,k,j,l,o;f=this.set();h=c/(i.length+1);o=(c-h)/2;c=
i.length;for(l=0;0<=c?l<c:l>c;0<=c?l+=1:l-=1)if(typeof(g=i[l]==null?undefined:i[l][0])!=="undefined"&&g!==null){k=Math.min(i[l][1],b);j=Math.max(i[l][1],b)-k-0.5;f.push(this.rect(i[l][0]-o+l*h,k,h-1,j).attr("fill",(typeof a==="undefined"||a===null?undefined:a[l])||"#000000").attr("stroke",(typeof a==="undefined"||a===null?undefined:a[l])||"#000000"))}if(d){i=n(f,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},e);f.hover(i[0],i[1])}return f};Raphael.fn.sai.prim.haxis=function(i,a,c,b,d){var f,e,g,h,
k,j,l,o,m,p,r,t,u,x,v,s,B,w,z,C;v=typeof(f=d.ticklens)!=="undefined"&&f!==null?f:[5,2];f=typeof(e=d.width)!=="undefined"&&e!==null?e:1;e=typeof(g=d.color)!=="undefined"&&g!==null?g:"black";t=this.path("M"+a+" "+c+"l"+b+" 0").attr("stroke",e);s=this.set();r=this.set();g=b/25;p=g<i.length?Math.ceil(i.length/g):1;o=b/(i.length-1)*p;z=a;w=-1;x=false;g=0;C=null;h=i.length;for(m=0;0<=h?m<h:m>h;m+=p){j=i[m];if(typeof j!=="undefined"&&j!==null){l=v[String(j)?0:1];s.push(this.path("M"+z+" "+c+"l0 "+l).attr("stroke",
e));if(j!==""){l=this.text(z,c+l+2,Sai.util.prettystr(j).substring(0,12));j=l.getBBox();u=l.attr("y")+5;l.attr("y",u);if(!(typeof C!=="undefined"&&C!==null)||u<C)C=u;r.push(l);l=j.width;g=Math.max(l,g);if(j.x<=w+3)x=true;if(j.x+l>w)w=j.x+l}}z+=o}if(typeof(k=d.title)!=="undefined"&&k!==null)B=this.text(a+b/2,C+14,d.title).attr({"font-size":"12px","font-weight":"bold"});i=this.set().push(t,s,r,B);if(x){d=r.items;b=0;for(k=d.length;b<k;b++){l=d[b];l.rotate(-90);l.translate(0,l.getBBox().width/2-2)}i.push(this.rect(a,
c,1,f+g+v[0]).attr("opacity","0"))}return i};Raphael.fn.sai.prim.vaxis=function(i,a,c,b,d){var f,e,g,h,k,j,l,o,m,p,r,t,u,x,v,s;t=typeof(f=d.ticklens)!=="undefined"&&f!==null?f:[5,2];f=typeof(e=d.color)!=="undefined"&&e!==null?e:"black";r=typeof(g=d.right)!=="undefined"&&g!==null?g:false;e=this.path("M"+a+" "+c+"l0 "+-b).attr("stroke",f);u=this.set();g=this.set();o=b/(i.length-1);s=c;v=null;h=0;for(k=i.length;h<k;h++){m=i[h];if(m!==null){p=t[String(m)?0:1];u.push(this.path("M"+a+" "+s+"l"+(r?p:-p)+
" 0").attr("stroke",f));p=a+(r?1:-1)*(p+3);m=this.text(p,s,Sai.util.prettystr(m));m.attr({"text-anchor":r?"start":"end",fill:f});p+=(r?1:-1)*(m.getBBox().width+8);if(!(typeof v!=="undefined"&&v!==null)||p<v)v=p;g.push(m)}s-=o}if(typeof(j=d.title)!=="undefined"&&j!==null){x=this.text(v,c-b/2,d.title).attr({"font-size":"12px","font-weight":"bold"});i=x.getBBox();x.rotate(-90);l=this.rect(i.x+(i.width-i.height)/2,c,i.height,1).attr({opacity:0})}l=typeof l!=="undefined"&&l!==null?l:null;return this.set().push(this.set().push(e,
u,g,l),x)};Raphael.fn.sai.prim.popup=function(i,a,c){var b,d,f,e,g,h;this.set();h=this.set();d=0;f=a+5+5;if("__HEAD__"in c){b=this.text(i,f,c.__HEAD__).attr({fill:"#cfc","font-size":"12","font-weight":"bold"});d=Math.max(d,b.getBBox().width);h.push(b);f+=17}for(g in c)if(q.call(c,g))if(g!=="__HEAD__"){e=this.text(i+5,f,g+" = "+c[g]).attr({fill:"white","font-weight":"bold","text-anchor":"start"});d=Math.max(d,e.getBBox().width);f+=10;h.push(e)}c=d+10;this.rect(i,a,c,f-a,5).attr({fill:"black","fill-opacity":".85",
stroke:"black"});typeof b==="undefined"||b===null||b.translate(c/2);return h.toFront()};Raphael.fn.sai.prim.legend=function(i,a,c,b,d){var f,e,g,h,k,j,l,o,m;a-=14;o=this.set();j=i;l=a;for(m in b)if(q.call(b,m)){k=this.text(j+14,l+5,m).attr({fill:typeof(f=typeof d==="undefined"||d===null?undefined:d[m])!=="undefined"&&f!==null?f:"black","text-anchor":"start"});h=this.rect(j,l,9,9).attr({fill:typeof(e=b[m])!=="undefined"&&e!==null?e:"black",stroke:typeof(g=typeof d==="undefined"||d===null?undefined:
d[m])!=="undefined"&&g!==null?g:"black"});h=this.set().push(k,h);k=h.getBBox().width;if(j-i+15+k>c){o.translate(0,-14);h.translate(i-j,a-l);j=i;l=a}j+=k+15;o.push(h)}return o};Raphael.fn.sai.prim.wrappedText=function(i,a,c,b,d){var f,e,g,h;d=typeof d!=="undefined"&&d!==null?d:" ";b=typeof b!=="undefined"&&b!==null?b:"";if(b.match(/^\s*$/))return null;c=c/6;g=[];for(e=0;e<b.length-1;){f=e+c;h=b.substring(e,f+1);f=f>=b.length?f:h.lastIndexOf(d);g.push(h.substring(0,f));e+=f+1}b=g.join("\n");return this.text(i,
a+5*g.length,b).attr({"font-family":"Lucida Console","text-anchor":"start"})};Raphael.fn.sai.prim.info=function(i,a,c,b){var d,f,e,g,h,k;g=this.set();e=i;a=a;for(f in b)if(q.call(b,f))if(b[f]!==null){h=f+(f===""?"":": ");h+=typeof b[f]==="string"?b[f]:typeof(d=Sai.util.prettynum(b[f]))!=="undefined"&&d!==null?d:Sai.util.prettystr(b[f]);k=6*h.length;if(e-i+k>c){e=i;a+=14}h=this.text(e,a,h).attr({"font-family":"Lucida Console","text-anchor":"start"});e+=k+15;g.push(h)}return g};Raphael.fn.sai.prim.hoverShape=
function(i,a,c,b){i=i(this).attr(a);c=n(i,b&&b[0]||{},b&&b[1]||{},c);i.mouseover(c[0]);i.mouseout(c[1]);return i};Raphael.fn.sai.prim.histogram=function(i,a,c,b,d,f,e,g,h,k,j,l){var o,m,p,r,t,u;k=typeof k!=="undefined"&&k!==null?k:"white";h=typeof h!=="undefined"&&h!==null?h:["black","white"];l=typeof l!=="undefined"&&l!==null?l:10;u=this.set();u.push(this.rect(i,a-b,c,b).attr({"stroke-width":0,"stroke-opacity":0,fill:k}));b=a-(b-12);a-=5;f=typeof f!=="undefined"&&f!==null?f:0;e=typeof e!=="undefined"&&
e!==null?e:1;u.push(this.text(i,a,Sai.util.prettystr(f)).attr({"text-anchor":"start"}));u.push(this.text(i+c,a,Sai.util.prettystr(e)).attr({"text-anchor":"end"}));a-=7;f={};k=e=0;for(o=d.length;k<o;k++){r=d[k];r=Math.min(l-1,Math.floor(l*r/1));if(r in f)f[r]+=1;else f[r]=1;e=Math.max(e,f[r])}u.push(this.rect(i,a,c,1).attr({fill:"0-"+h[0]+"-"+(typeof(m=h[1])!=="undefined"&&m!==null?m:h[0]),"stroke-width":0,"stroke-opacity":0}));a-=1;m=c/l;for(p in f)if(q.call(f,p)){d=(a-b)*(f[p]/e);u.push(h.length===
1?t=Sai.util.multiplyColor(h[0],(parseInt(p)+0.5)/l,j,0.2).str:t=Sai.util.colerp(h[0],h[1],(parseInt(p)+0.5)/l),this.rect(i+(parseInt(p)+0.2)*m,a-d,m*0.6,d).attr({fill:t,"stroke-width":j?0.35:0,"stroke-opacity":j?1:0,stroke:"#000000"}))}u.push(this.text(i+c/2,b-6,Sai.util.prettystr(g)));return u}})();(function(){var n=Object.prototype.hasOwnProperty,q=function(a,c){var b=function(){};b.prototype=c.prototype;a.prototype=new b;a.prototype.constructor=a;typeof c.extended==="function"&&c.extended(a);a.__super__=c.prototype},i=function(a,c){return function(){return a.apply(c,arguments)}};Sai.Plot=function(a,c,b,d,f,e,g,h){this.opts=h;this.rawdata=g;this.data=e;this.h=f;this.w=d;this.y=b;this.x=c;this.r=a;this.opts=typeof this.opts!=="undefined"&&this.opts!==null?this.opts:{};this.setDenormalizedData();
this.set=this.r.set();return this};Sai.Plot.prototype.setDenormalizedData=function(){var a,c,b,d,f,e,g,h,k,j;if(this.data instanceof Array){a=[];b=this.data;c=0;for(d=b.length;c<d;c++){k=b[c];a.push(this.denormalize(k))}return this.dndata=a}else{this.dndata=typeof this.dndata!=="undefined"&&this.dndata!==null?this.dndata:{};a=[];c=this.data;for(j in c)if(n.call(c,j))a.push(this.dndata[j]=function(){f=[];g=this.data[j];e=0;for(h=g.length;e<h;e++){k=g[e];f.push(this.denormalize(k))}return f}.call(this));
return a}};Sai.Plot.prototype.denormalize=function(a){if(a instanceof Array)return[this.x+this.w*a[0],this.y-this.h*a[1]]};Sai.Plot.prototype.render=function(){this.set.push(this.r.rect(20,20,20,20).attr("fill","red"),this.r.circle(40,40,10).attr("fill","blue"));return this};Sai.LinePlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.LinePlot,Sai.Plot);Sai.LinePlot.prototype.setDenormalizedData=function(){var a,c,b;Sai.LinePlot.__super__.setDenormalizedData.apply(this,arguments);a=[];c=this.dndata;
for(b in c)if(n.call(c,b))a.push(this.dndata[b].length===1&&(this.dndata[b]==null?undefined:this.dndata[b][0]==null?undefined:this.dndata[b][0][0])===this.x?this.dndata[b].push([this.x+this.w,this.dndata[b][0][1]]):null);return a};Sai.LinePlot.prototype.render=function(a,c){var b,d;this.set.remove();b=this.dndata;for(d in b)if(n.call(b,d))d.match("^__")||this.set.push(this.r.sai.prim.line(this.dndata[d],(typeof a==="undefined"||a===null?undefined:a[d])||"black",c||1));return this};Sai.AreaPlot=function(){return Sai.LinePlot.apply(this,
arguments)};q(Sai.AreaPlot,Sai.LinePlot);Sai.AreaPlot.prototype.render=function(a,c,b,d){var f,e,g,h,k,j,l,o,m;this.set.remove();j=[this.denormalize([0,d]),this.denormalize([1,d])];d=this.dndata;for(m in d)if(n.call(d,m))if(!m.match("^__")){f=this.dndata[m].length;for(g=0;0<=f?g<f:g>f;0<=f?g+=1:g-=1){l=this.dndata[m][g];if(typeof l!=="undefined"&&l!==null)break}for(g=this.dndata[m].length-1;this.dndata[m].length-1<=0?g<=0:g>=0;this.dndata[m].length-1<=0?g+=1:g-=1){o=this.dndata[m][g];if(typeof o!==
"undefined"&&o!==null)break}typeof e!=="undefined"&&e!==null&&b||(e=[[l[0],j[0][1]],[o[0],j[1][1]]]);this.set.push(this.r.sai.prim.area(this.dndata[m],(typeof a==="undefined"||a===null?undefined:a[m])||"black",c||1,e));if(b){e=[];g=this.dndata[m];f=0;for(h=g.length;f<h;f++){k=g[f];e.push([k[0],k[1]-c/2])}e=e}}return this};Sai.CandlestickPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.CandlestickPlot,Sai.Plot);Sai.CandlestickPlot.prototype.render=function(a,c,b,d){var f,e,g,h,k,j,l,o,
m;this.set.remove();k=(typeof a==="undefined"||a===null?undefined:a.up)||"black";h=(typeof a==="undefined"||a===null?undefined:a.down)||"red";c=typeof c!=="undefined"&&c!==null?c:5;a=this.dndata.open.length;for(j=0;0<=a?j<a:j>a;0<=a?j+=1:j-=1)if(typeof(f=this.dndata.close[j])!=="undefined"&&f!==null){m=this.dndata.close[j][1]<this.dndata.open[j][1];l={};e=this.rawdata;for(o in e)if(n.call(e,o))l[o]=this.rawdata[o][j];this.set.push(this.r.sai.prim.candlestick(this.dndata.open[j][0],m&&this.dndata.close[j][1]||
this.dndata.open[j][1],m&&this.dndata.open[j][1]||this.dndata.close[j][1],this.dndata.high[j][1],this.dndata.low[j][1],c||5,j&&typeof(g=this.dndata.close[j-1])!=="undefined"&&g!==null&&this.dndata.close[j-1][1]<this.dndata.close[j][1]?h:k,!m,b,d,Sai.util.infoSetters(d,l)))}return this};Sai.BarPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.BarPlot,Sai.Plot);Sai.BarPlot.prototype.render=function(a,c,b,d,f){var e,g,h,k,j,l,o;this.set.remove();c=this.denormalize([0,c])[1];j=0;h=[];a=a?this.r.sai.prim.stackedBar:
this.r.sai.prim.groupedBar;e=this.dndata;for(o in e)if(n.call(e,o)){j=this.dndata[o].length;h.push((typeof b==="undefined"||b===null?undefined:b[o])||"black")}for(e=0;0<=j?e<j:e>j;0<=j?e+=1:e-=1){b=[];g=this.dndata;for(o in g)n.call(g,o)&&b.push(this.dndata[o][e]);k={};g=this.rawdata;for(l in g)if(n.call(g,l))k[l]=this.rawdata[l][e];this.set.push(a(b,h,this.w/j,c,d,f,Sai.util.infoSetters(f,k)))}return this};Sai.GeoPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.GeoPlot,Sai.Plot);Sai.GeoPlot.prototype.getRegionColor=
function(a,c,b){return Sai.util.multiplyColor(a[b],(this.data[b][c]==null?undefined:this.data[b][c][1])||0,this.opts.fromWhite,this.opts.fromWhite?0.2:0).str};Sai.GeoPlot.prototype.getRegionOpacity=function(a,c){var b;return typeof(b=this.data[c][a]==null?undefined:this.data[c][a][1])!=="undefined"&&b!==null?1:this.opts.fromWhite?0.15:0.25};Sai.GeoPlot.prototype.render=function(a,c,b,d,f,e,g){var h,k,j,l,o,m,p;this.set.remove();h=[];j=this.rawdata[b];k=0;for(l=j.length;k<l;k++){m=j[k];h.push(m.toUpperCase())}p=
{};k=h.length;for(j=0;0<=k?j<k:j>k;0<=k?j+=1:j-=1)p[h[j]]=j;h=c.paths;for(o in h)n.call(h,o)&&function(){var r,t,u,x,v,s=o;v=p[s];u=c.name[s];u={region:typeof u!=="undefined"&&u!==null?u:s};r=this.rawdata;for(t in r)if(n.call(r,t))if(t!==b)u[t]=this.rawdata[t][v];t=this.getRegionColor(a,v,d);v=this.getRegionOpacity(v,d);x=Sai.util.infoSetters(g,u);return this.set.push(this.r.sai.prim.hoverShape(function(B,w,z,C){return function(G){return G.path(B).translate(z,C).scale(w,w,z,C)}}(c.paths[s],Math.min(this.w/
c.width,this.h/c.height),this.x,this.y-this.h),{fill:t,stroke:this.opts.fromWhite?"black":f,"stroke-width":0.5,opacity:v},e?[function(B){navigator.userAgent.toLowerCase().indexOf("msie")!==-1||navigator.userAgent.toLowerCase().indexOf("opera")!==-1||B.toFront();return x[0]()},x[1]]:null,e?[{"fill-opacity":0.75,"stroke-width":this.opts.fromWhite?1.5:0.5},{"fill-opacity":1,"stroke-width":0.5}]:null))}.call(this);h=this.set.getBBox();this.set.translate((this.w-h.width)/2,(this.h-h.height)/2);return this};
Sai.ChromaticGeoPlot=function(){return Sai.GeoPlot.apply(this,arguments)};q(Sai.ChromaticGeoPlot,Sai.GeoPlot);Sai.ChromaticGeoPlot.prototype.getRegionColor=function(a,c){var b,d,f,e,g,h;e=f=d=0;b=this.data;for(h in b)if(n.call(b,h)){g=Sai.util.multiplyColor(a[h],(this.data[h][c]==null?undefined:this.data[h][c][1])||0,this.opts.fromWhite);e+=g.r;f+=g.g;d+=g.b}return"rgb("+e+", "+f+", "+d+")"};Sai.ChromaticGeoPlot.prototype.getRegionOpacity=function(a){var c,b,d;c=this.data;for(d in c)if(n.call(c,d))if(typeof(b=
this.data[d][a]==null?undefined:this.data[d][a][1])!=="undefined"&&b!==null)return 1;return 0.25};Sai.ScatterPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.ScatterPlot,Sai.Plot);Sai.ScatterPlot.prototype.render=function(a,c,b,d,f,e){var g,h,k,j,l,o;this.set.remove();g=this.dndata;for(l in g)if(n.call(g,l)){j=this.dndata[l].length;break}k=function(m,p,r){return p*r+m*(1-r)};o=i(function(m){return this.x+this.w*((m-this.y)/-this.h)},this);for(h=0;0<=j?h<j:h>j;0<=j?h+=1:h-=1)(function(){var m,
p,r,t,u,x,v,s,B,w,z,C,G,A,D,I,J,y=h;I=o(this.dndata[a.x]==null?undefined:this.dndata[a.x][y][1]);J=this.dndata[a.y]==null?undefined:this.dndata[a.y][y][1];G=c instanceof Array&&typeof(p=a.color)!=="undefined"&&p!==null?Sai.util.colerp(c[0],c[1],typeof(m=this.data[a.color]==null?undefined:this.data[a.color][y]==null?undefined:this.data[a.color][y][1])!=="undefined"&&m!==null?m:0):c instanceof Object&&typeof(r=a.color)!=="undefined"&&r!==null?c[this.rawdata[a.color][y]]:"black";m=f instanceof Array&&
typeof(u=a.stroke_color)!=="undefined"&&u!==null?Sai.util.colerp(f[0],f[1],typeof(t=this.data[a.stroke_color]==null?undefined:this.data[a.stroke_color][y]==null?undefined:this.data[a.stroke_color][y][1])!=="undefined"&&t!==null?t:0):c instanceof Object&&typeof(x=a.color)!=="undefined"&&x!==null?f[this.rawdata[a.stroke_color][y]]:"black";t=b instanceof Array&&typeof(s=a.radius)!=="undefined"&&s!==null?k(b[0],b[1],typeof(v=this.data[a.radius]==null?undefined:this.data[a.radius][y]==null?undefined:this.data[a.radius][y][1])!==
"undefined"&&v!==null?v:0):b instanceof Object&&typeof(B=a.radius)!=="undefined"&&B!==null?b[this.rawdata[a.radius][y]]:5;v=d instanceof Array&&typeof(z=a.stroke_opacity)!=="undefined"&&z!==null?k(d[0],d[1],typeof(w=this.data[a.stroke_opacity]==null?undefined:this.data[a.stroke_opacity][y]==null?undefined:this.data[a.stroke_opacity][y][1])!=="undefined"&&w!==null?w:0):d instanceof Object&&typeof(C=a.stroke_opacity)!=="undefined"&&C!==null?d[this.rawdata[a.stroke_opacity][y]]:1;z={};w=this.rawdata;
for(D in w)if(n.call(w,D))D.match("^__")||(z[D]=this.rawdata[D][y]);A=Sai.util.infoSetters(e,z);return this.set.push(this.r.circle(I,J,t).attr({fill:G,"stroke-opacity":v,stroke:m,"fill-opacity":0.8,"stroke-width":2}).hover(function(){A[0]();return this.attr("fill-opacity",0.5)},function(){A[1]();return this.attr("fill-opacity",0.8)}))}).call(this);return this}})();(function(){var n=Object.prototype.hasOwnProperty,q=function(a,c){return function(){return a.apply(c,arguments)}},i=function(a,c){var b=function(){};b.prototype=c.prototype;a.prototype=new b;a.prototype.constructor=a;typeof c.extended==="function"&&c.extended(a);a.__super__=c.prototype};Sai.Chart=function(a,c,b,d,f,e,g,h){var k;this.opts=h;this.__LABELS__=g;this.h=f;this.w=d;this.y=b;this.x=c;this.r=a;k=this;this.drawInfo=function(){return Sai.Chart.prototype.drawInfo.apply(k,arguments)};this.getStackedMax=
function(){return Sai.Chart.prototype.getStackedMax.apply(k,arguments)};this.opts=typeof this.opts!=="undefined"&&this.opts!==null?this.opts:{};this.opts.bgcolor=typeof this.opts.bgcolor!=="undefined"&&this.opts.bgcolor!==null?this.opts.bgcolor:"white";this.setData(e);this.padding={left:5,right:5,top:5,bottom:5};return this};Sai.Chart.prototype.groupsToNullPad=function(){return[]};Sai.Chart.prototype.nonNegativeGroups=function(){return[]};Sai.Chart.prototype.nextSeriesSuffix=function(){var a;this.suffixCtr=
(typeof(a=this.suffixCtr)!=="undefined"&&a!==null?a:0)+1;return"["+this.suffixCtr+"]"};Sai.Chart.prototype.fixSeriesName=function(a){return a+(a.match(/^\s+$/)?this.nextSeriesSuffix():"")};Sai.Chart.prototype.setSemanticRename=function(a){var c,b,d;if(!(typeof(c=this.semanticRenamePatterns)!=="undefined"&&c!==null))return null;this.semanticRenames=typeof this.semanticRenames!=="undefined"&&this.semanticRenames!==null?this.semanticRenames:{};c=[];b=this.semanticRenamePatterns;for(d in b)if(n.call(b,
d))c.push(a.match(this.semanticRenamePatterns[d])?this.semanticRenames[d]=a:null);return c};Sai.Chart.prototype.setData=function(a){var c,b,d,f,e,g,h,k,j,l,o;this.data={};this.renames={};if(function(r){var t;for(t in r)if(n.call(r,t))if(r.hasOwnProperty(t))return false;return true}(a)){this.render=function(){return this.showError("(no data -> empty chart)")};return null}for(o in a)if(n.call(a,o)){for(;;){h=this.fixSeriesName(o);this.setSemanticRename(h);if(h===o||!(h in a))break}this.renames[o]=h;
if(a[o]instanceof Array)if(this.__LABELS__===o){this.__LABELS__=h;var m=this.data,p=h;c=[];d=a[o];b=0;for(f=d.length;b<f;b++){e=d[b];c.push(String(e))}m[p]=c}else{m=this.data;p=h;c=[];d=a[o];b=0;for(f=d.length;b<f;b++){e=d[b];c.push(typeof e==="string"&&e.match(/^[+-]?[\d,]+(\.\d+)?$/)&&!isNaN(g=parseFloat(e.replace(/,/g,"")))?g:e)}m[p]=c}else this.data[h]=a[o]}a=this.dataGroups(this.data);l=this.nonNegativeGroups();for(j in a)if(n.call(a,j))if(a[j].length>0)if(function(){for(var r=0,t=l.length;r<
t;r++)if(l[r]===j)return true;return false}.call(this)){g=a[j];e=0;for(h=g.length;e<h;e++){o=g[e];if(typeof(k=this.data[o])!=="undefined"&&k!==null){c=this.data[o].length;for(b=0;0<=c?b<c:b>c;0<=c?b+=1:b-=1)if(this.data[o][b]<0)this.data[o][b]*=-1}}}e=this.groupsToNullPad();k=0;for(g=e.length;k<g;k++){j=e[k];if(j in a){c=a[j];h=0;for(b=c.length;h<b;h++){o=c[h];this.nullPad(o)}}}return this.normalize(this.data)};Sai.Chart.prototype.nullPad=function(a){return a in this.data?this.data[a]=[null].concat(this.data[a].concat([null])):
null};Sai.Chart.prototype.caresAbout=function(a){return!(a.match("^__")||a===this.__LABELS__)};Sai.Chart.prototype.dataGroups=function(a){var c,b,d;c=[];for(d in a)n.call(a,d)&&this.caresAbout(d)&&c.push(d);b=[];for(d in a)if(n.call(a,d))if(d.match("^__")||d===this.__LABELS__)b.push(d);return{all:c,__META__:b}};Sai.Chart.prototype.getYAxisVals=function(a,c,b){var d,f,e;if(!(typeof a==="number"&&typeof c==="number"))return[a,c];if(a===c)return[0,c,c*2];b=typeof b!=="undefined"&&b!==null?b:false;for(d=
1;(c-a)*d<10;)d*=10;a*=d;c*=d;e=Math.floor(f=Math.log(c-a)/Math.LN10-0.4);e=Math.pow(10,e);if(f%1>0.7&&!b)e*=4;else if(f%1>0.35&&!b)e*=2;f=Sai.util.round(a-(b?e/2.1:e/1.75),e);if(f<0&&0<=a)f=0;a=Sai.util.round(c+(b?e/2.1:e/1.75),e);f/=d;a/=d;e/=d;d=[];for(c=f;f<=a?c<=a:c>=a;c+=e)d.push(Sai.util.round(c,e));return d};Sai.Chart.prototype.getMax=function(a,c){var b,d,f,e,g,h,k,j,l,o;return Math.max.apply(Math,function(){b=[];d=0;for(f=c.length;d<f;d++){o=c[d];if(typeof(j=a[o])!=="undefined"&&j!==null)b.push(Math.max.apply(Math,
function(){e=[];h=a[o];g=0;for(k=h.length;g<k;g++){l=h[g];typeof l!=="undefined"&&l!==null&&typeof l==="number"&&e.push(l)}return e}()))}return b}())};Sai.Chart.prototype.getMin=function(a,c){var b,d,f,e,g,h,k,j,l,o;return Math.min.apply(Math,function(){b=[];d=0;for(f=c.length;d<f;d++){o=c[d];if(typeof(j=a[o])!=="undefined"&&j!==null)b.push(Math.min.apply(Math,function(){e=[];h=a[o];g=0;for(k=h.length;g<k;g++){l=h[g];typeof l!=="undefined"&&l!==null&&typeof l==="number"&&e.push(l)}return e}()))}return b}())};
Sai.Chart.prototype.getStackedMax=function(a,c){var b,d,f,e,g,h,k;return Math.max.apply(Math,function(){b=[];d=a[this.__LABELS__].length;for(h=0;0<=d?h<d:h>d;0<=d?h+=1:h-=1)b.push(Sai.util.sumArray(function(){f=[];e=0;for(g=c.length;e<g;e++){k=c[e];k!==this.__LABELS__&&f.push(a[k][h])}return f}.call(this)));return b}.call(this))};Sai.Chart.prototype.getStackedMin=function(){return 0};Sai.Chart.prototype.normalize=function(a){var c,b,d,f,e,g,h,k,j,l,o,m,p,r,t,u,x,v,s,B,w,z,C,G,A,D;B=this.dataGroups(a);
this.ndata={};if(typeof(c=this.opts.stacked)!=="undefined"&&c!==null)this.stackedNdata={};C=function(y,E,F){if(typeof y==="number")return E===F?1:(y-E)/(F-E);return null};c=function(y,E){var F,H,K;F=0;for(H=E.length;F<H;F++){K=E[F];if(!y(K))return false}return true};v=function(y){var E,F,H;E=0;for(F=y.length;E<F;E++){H=y[E];if(typeof H==="number")return false}return true};for(s in B)if(n.call(B,s)){if(!(g=s.match("^__"))){if(!(g=Sai.util.sumArray(function(){b=[];f=B[s];d=0;for(e=f.length;d<e;d++){A=
f[d];b.push(this.data[A].length)}return b}.call(this))===0)){w=c;z=v;g=[];k=B[s];h=0;for(j=k.length;h<j;h++){A=k[h];g.push(this.data[A])}g=w(z,g)}g=g}if(!g){this.ndata[s]={};if(typeof(l=this.opts.stacked)!=="undefined"&&l!==null){this.stackedNdata[s]={};x={}}g=this.opts.stacked?this.getStackedMin:this.getMin;h=this.opts.stacked?this.getStackedMax:this.getMax;g=g(a,B[s]);z=h(a,B[s]);D=this.getYAxisVals(g,z);g=D[0];z=D[D.length-1];k=B[s];h=0;for(j=k.length;h<j;h++){A=k[h];if(typeof(o=a[A])!=="undefined"&&
o!==null){var I=this.ndata[s],J=A;m=[];p=a[A].length;for(w=0;0<=p?w<p:w>p;0<=p?w+=1:w-=1)m.push(typeof(r=a[A][w])!=="undefined"&&r!==null&&(G=C(a[A][w],g,z))!==null?[w/(a[A].length-1||1),G]:null);I[J]=m;if(typeof(u=this.opts.stacked)!=="undefined"&&u!==null){this.stackedNdata[s][A]=[];m=a[A].length;for(w=0;0<=m?w<m:w>m;0<=m?w+=1:w-=1){p=x[w]||0;p=[w/(a[A].length-1||1),typeof(t=a[A][w])!=="undefined"&&t!==null&&(G=C(a[A][w],g,z))!==null?G+p:p];this.stackedNdata[s][A].push(p);if(p!==null)x[w]=p[1]}}this.ndata[s].__YVALS__=
D}}}}return[]};Sai.Chart.prototype.addAxes=function(a,c){var b,d,f,e,g,h,k,j,l,o,m;this.axisWidth=1.5;this.padding.top+=5;for(m=this.data[this.__LABELS__].length-1;this.data[this.__LABELS__].length-1<=0?m<=0:m>=0;this.data[this.__LABELS__].length-1<=0?m+=1:m-=1)if(typeof(b=this.data[this.__LABELS__][m])!=="undefined"&&b!==null){b=this.r.text(0,0,Sai.util.prettystr(this.data[this.__LABELS__][m]));this.padding.right+=b.getBBox().width/2;b.remove();break}m=this.h-(this.padding.bottom+this.padding.top);
b=typeof(d=this.ndata[a[0]])!=="undefined"&&d!==null||!(typeof(f=this.ndata[a[1]])!=="undefined"&&f!==null);d=typeof(e=this.ndata[a[1]])!=="undefined"&&e!==null;if(b){e=this.r.sai.prim.vaxis(typeof(g=this.ndata[a[0]]==null?undefined:this.ndata[a[0]].__YVALS__)!=="undefined"&&g!==null?g:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,m,{width:this.axisWidth,title:typeof c==="undefined"||c===null?undefined:c.left});g=e.items[0].getBBox().width;e.remove()}else g=0;if(d){e=this.r.sai.prim.vaxis(typeof(h=
this.ndata[a[1]]==null?undefined:this.ndata[a[1]].__YVALS__)!=="undefined"&&h!==null?h:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,m,{width:this.axisWidth,title:typeof c==="undefined"||c===null?undefined:c.right});h=e.getBBox().width;e.remove()}else h=0;this.haxis=this.r.sai.prim.haxis(this.data[this.__LABELS__],this.x+this.padding.left+g,this.y-this.padding.bottom,this.w-this.padding.left-this.padding.right-g-h,{width:this.axisWidth,title:typeof c==="undefined"||c===null?undefined:
c.bottom});h=this.haxis.getBBox().height;if(isNaN(h))h=1;this.haxis.translate(0,-h);this.padding.bottom+=h;m=this.h-(this.padding.bottom+this.padding.top);if(b){this.vaxis=this.r.sai.prim.vaxis(typeof(k=this.ndata[a[0]]==null?undefined:this.ndata[a[0]].__YVALS__)!=="undefined"&&k!==null?k:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,m,{width:this.axisWidth,title:typeof c==="undefined"||c===null?undefined:c.left});k=this.vaxis.items[0].getBBox().width;this.vaxis.translate(k,0);this.padding.left+=
k}if(d){this.vaxis_right=this.r.sai.prim.vaxis(typeof(j=this.ndata[a[1]]==null?undefined:this.ndata[a[1]].__YVALS__)!=="undefined"&&j!==null?j:[0,"?"],this.w-this.padding.right,this.y-this.padding.bottom,m,{width:this.axisWidth,right:true,title:typeof c==="undefined"||c===null?undefined:c.right,color:typeof(l=this.ndata[a[0]])!=="undefined"&&l!==null?typeof(o=this.colors.__RIGHTAXIS__)!=="undefined"&&o!==null?o:"blue":"black"});j=this.vaxis_right.items[0].getBBox().width;this.vaxis_right.translate(-j,
0);this.padding.right+=j}this.setPlotCoords();return this.r.set().push(this.haxis).push(this.vaxis)};Sai.Chart.prototype.setPlotCoords=function(){var a;this.px=this.x+this.padding.left;this.py=this.y-this.padding.bottom;this.pw=this.w-this.padding.left-this.padding.right;this.ph=this.h-this.padding.bottom-this.padding.top;a=this.legend==null?undefined:this.legend.getBBox();this.legend==null||this.legend.translate(this.px+this.pw/2-(a.x+a.width/2),0);a=this.histogramLegend==null?undefined:this.histogramLegend.getBBox();
return this.histogramLegend==null?undefined:this.histogramLegend.translate(this.px+this.pw/2-(a.x+a.width/2),0)};Sai.Chart.prototype.drawBG=function(){var a,c,b,d;return this.bg=this.r.rect(typeof(a=this.px)!=="undefined"&&a!==null&&this.px||this.x,typeof(c=this.py)!=="undefined"&&c!==null&&this.py-this.ph||this.y-this.h,typeof(b=this.pw)!=="undefined"&&b!==null&&this.pw||this.w,typeof(d=this.ph)!=="undefined"&&d!==null&&this.ph||this.h).attr({fill:this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack()};
Sai.Chart.prototype.logoPos=function(){var a,c,b,d,f;f=typeof(a=this.px)!=="undefined"&&a!==null&&typeof(c=this.pw)!=="undefined"&&c!==null?this.px+this.pw-160-5:this.w+this.x-160-this.padding.right;a=typeof(b=this.py)!=="undefined"&&b!==null&&typeof(d=this.ph)!=="undefined"&&d!==null?this.py-this.ph+5:this.y-this.h+this.padding.top;return[f,a,160,34]};Sai.Chart.prototype.drawLogo=function(){var a;a=this.logoPos();return this.logo=this.r.image(Sai.imagePath+"logo.png",a[0],a[1],a[2],a[3]).attr({opacity:0.25,
href:"http://track.com",target:"_blank"})};Sai.Chart.prototype.drawFootnote=function(a){var c;a=typeof a!=="undefined"&&a!==null?a:typeof(c=this.opts.footnote)!=="undefined"&&c!==null?c:"";if(a.match(/^\s*$/))return null;this.footnote=this.r.sai.prim.wrappedText(this.x+this.padding.left,this.y-this.padding.bottom,this.w,a," ");a=this.footnote.getBBox().height;this.padding.bottom+=a+10;return this.footnote.translate(0,-a)};Sai.Chart.prototype.render=function(){this.plot=typeof this.plot!=="undefined"&&
this.plot!==null?this.plot:new Sai.Plot(this.r);this.plot.render();return this};Sai.Chart.prototype.showError=function(a){var c,b;return this.r.text(this.x+this.padding.left+(typeof(c=this.pw)!=="undefined"&&c!==null?c:this.w)/2,this.y-this.padding.bottom-(typeof(b=this.ph)!=="undefined"&&b!==null?b:this.h)/2,a)};Sai.Chart.prototype.setColors=function(a){var c,b;this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};for(c in a)if(n.call(a,c)){b=this.renames[c];if(b in this.data)this.colors[b]=
a[c]}return this};Sai.Chart.prototype.setColor=function(a,c){this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};this.colors[this.renames[a]]=c;return this};Sai.Chart.prototype.normalizedHeight=function(a,c){var b;if(!(typeof(b=this.ndata[c]==null?undefined:this.ndata[c].__YVALS__)!=="undefined"&&b!==null))return null;b=this.ndata[c].__YVALS__[0];if(!(a>b))return null;return(a-b)/(this.ndata[c].__YVALS__[this.ndata[c].__YVALS__.length-1]-b)};Sai.Chart.prototype.drawGuideline=
function(a,c){var b;c=typeof c!=="undefined"&&c!==null?c:"all";if(!(typeof(b=this.ndata[c]==null?undefined:this.ndata[c].__YVALS__)!=="undefined"&&b!==null))return null;b=this.normalizedHeight(a,c);this.guidelines=typeof this.guidelines!=="undefined"&&this.guidelines!==null?this.guidelines:this.r.set();b=new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,{guideline:[[0,b],[1,b]]});b.render({guideline:"#ccc"});return this.guidelines.push(b.set)};Sai.Chart.prototype.drawLegend=function(a){var c,
b,d,f,e,g,h,k;if(a=typeof a!=="undefined"&&a!==null?a:this.colors){d={};h={};c=a;for(k in c)if(n.call(c,k))if(k!==this.__LABELS__){d[k]=a[k];h[k]="black";if(typeof(g=this.opts.groups==null?undefined:this.opts.groups.right)!=="undefined"&&g!==null)if(function(){for(var j=0,l=(e=this.opts.groups.right).length;j<l;j++)if(e[j]===k)return true;return false}.call(this))h[k]=typeof(b=this.ndata.left)!=="undefined"&&b!==null?typeof(f=this.colors.__RIGHTAXIS__)!=="undefined"&&f!==null?f:"blue":"black"}this.legend=
this.r.sai.prim.legend(this.x,this.y-this.padding.bottom,this.w,d,h);a=this.legend.getBBox();if(this.legend.length>0)this.padding.bottom+=a.height+15;return this.legend.translate((this.w-a.width)/2,0)}};Sai.Chart.prototype.drawTitle=function(){var a;if(typeof(a=this.opts.title)!=="undefined"&&a!==null){this.title=this.r.text(this.x+this.w/2,this.y-this.h,this.opts.title).attr({"font-size":20});this.title.translate(0,this.title.getBBox().height/2);return this.padding.top+=this.title.getBBox().height+
5}};Sai.Chart.prototype.setupInfoSpace=function(){this.info_y=this.y-this.h+this.padding.top;this.info_x=this.x+this.padding.left;this.info_w=this.w-this.padding.left-this.padding.right;return this.padding.top+=30};Sai.Chart.prototype.drawInfo=function(a,c){var b,d,f;c=typeof c!=="undefined"&&c!==null?c:true;a=typeof a!=="undefined"&&a!==null?a:typeof(b=this.default_info)!=="undefined"&&b!==null?this.default_info():{};if(c)this.info_data={};this.info&&this.info.remove();b=a;for(f in b)if(n.call(b,
f))f.match("^__")||(this.info_data[f]=typeof(d=a[f])!=="undefined"&&d!==null?d:"(no data)");return this.info=this.r.sai.prim.info(this.info_x,this.info_y,this.info_w,this.info_data)};Sai.Chart.prototype.getIndex=function(a){a=Sai.util.transformCoords(a,this.r.canvas).x;return Math.round((this.data[this.__LABELS__].length-1)*(a-this.px)/this.pw)};Sai.Chart.prototype.drawHistogramLegend=function(a,c){var b,d,f,e,g,h,k,j,l,o,m,p,r;c=typeof c!=="undefined"&&c!==null?c:this.colors;this.histogramLegend=
this.r.set();l=Math.max(0.1*(this.h-this.padding.bottom-this.padding.top),50);p=Math.min(150,(this.w-this.padding.left-this.padding.right-20)/a.length);b=a.length;for(o=0;0<=b?o<b:o>b;0<=b?o+=1:o-=1){m=a[o];d=[];f=this.ndata[m][m].length;for(g=0;0<=f?g<f:g>f;0<=f?g+=1:g-=1)if(typeof(e=this.ndata[m][m][g])!=="undefined"&&e!==null)d.push(this.ndata[m][m][g][1]);d=d;if(typeof(h=this.bounds==null?undefined:this.bounds[m])!=="undefined"&&h!==null){g=this.bounds[m];f=g[0];g=g[1]}else{f=[];k=this.data[m];
g=0;for(j=k.length;g<j;g++){r=k[g];typeof r!=="undefined"&&r!==null&&f.push(r)}f=f;g=[Math.min.apply(Math,f),Math.max.apply(Math,f)];f=g[0];g=g[1]}g=this.getYAxisVals(f,g,true);f=g[0];k=g[g.length-1];g=c[m];this.histogramLegend.push(d=this.r.sai.prim.histogram(this.x+o*p,this.y-this.padding.bottom,p*0.8,l,d,f,k,m,typeof g==="object"?[g.__LOW__,g.__HIGH__]:[g],"white",this.opts.fromWhite));this.opts.interactive&&this.setupHistogramInteraction(d,m)}this.histogramLegend.translate((this.w-this.padding.left-
this.padding.right-this.histogramLegend.getBBox().width)/2,0);return this.padding.bottom+=l+5};Sai.Chart.prototype.setupHistogramInteraction=function(){return null};Sai.LineChart=function(){return Sai.Chart.apply(this,arguments)};i(Sai.LineChart,Sai.Chart);Sai.LineChart.prototype.nonNegativeGroups=function(){return this.opts.stacked?["all","left","right"]:[]};Sai.LineChart.prototype.dataGroups=function(){var a,c,b,d,f,e;e=Sai.LineChart.__super__.dataGroups.apply(this,arguments);if(typeof(f=this.opts.groups==
null?undefined:this.opts.groups.left)!=="undefined"&&f!==null&&typeof(a=this.opts.groups==null?undefined:this.opts.groups.right)!=="undefined"&&a!==null){a=[];b=this.opts.groups.left;c=0;for(d=b.length;c<d;c++){f=b[c];this.caresAbout(f)&&f in this.data&&a.push(f)}e.left=a;a=[];b=this.opts.groups.right;c=0;for(d=b.length;c<d;c++){f=b[c];this.caresAbout(f)&&f in this.data&&a.push(f)}e.right=a}return e};Sai.LineChart.prototype.render=function(){var a,c,b,d,f,e,g,h;this.drawTitle();this.setupInfoSpace();
this.drawFootnote();this.drawLegend();(g="right"in this.ndata)?this.addAxes(["left","right"]):this.addAxes(["all"]);this.drawBG();this.drawLogo();if(g){this.ndata.left.__YVALS__[0]<0&&this.drawGuideline(0,"left");this.ndata.right.__YVALS__[0]<0&&this.drawGuideline(0,"right")}else this.ndata.all.__YVALS__[0]<0&&this.drawGuideline(0,"all");this.lines=[];this.dots=this.r.set();e=typeof(a=this.opts.stacked)!=="undefined"&&a!==null?this.stackedNdata:this.ndata;a=this.opts.area?Sai.AreaPlot:Sai.LinePlot;
this.plotSets=this.r.set();this.plots=[];if(g){this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,e.left)).render(this.colors,typeof(c=this.opts.lineWidth)!=="undefined"&&c!==null?c:2,this.opts.stacked,this.normalizedHeight(0,"left")));this.plotSets.push(this.plots[0].set);this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,e.right)).render(this.colors,typeof(b=this.opts.lineWidth)!=="undefined"&&b!==null?b:2,this.opts.stacked,this.normalizedHeight(0,"right")));this.plotSets.push(this.plots[1].set)}else{this.plots.push((new a(this.r,
this.px,this.py,this.pw,this.ph,e.all)).render(this.colors,typeof(d=this.opts.lineWidth)!=="undefined"&&d!==null?d:2,this.opts.stacked,this.normalizedHeight(0,"all")));this.plotSets.push(this.plots[0].set)}c=e.all;for(h in c)if(n.call(c,h))if(h!=="__YVALS__")this.dots.push(this.r.circle(0,0,4).attr({fill:typeof(f=this.colors==null?undefined:this.colors[h])!=="undefined"&&f!==null?f:"black"}).hide());this.r.set().push(this.bg,this.plotSets,this.dots,this.logo,this.guidelines).mousemove(q(function(k){var j,
l,o,m,p,r,t,u,x,v,s;t=this.getIndex(k);u={};u[this.__LABELS__]=this.data[this.__LABELS__][t];k=e.all;for(s in k)if(n.call(k,s))if(typeof(j=this.data[s])!=="undefined"&&j!==null)u[s]=this.data[s][t];this.drawInfo(u);r=0;j=[];k=e.all;for(s in k)n.call(k,s)&&s!=="__YVALS__"&&j.push(function(){l=[];m=this.plots;o=0;for(p=m.length;o<p;o++){x=m[o];s in x.dndata&&l.push(function(){v=x.dndata[s][t];typeof v!=="undefined"&&v!==null?this.dots[r].attr({cx:v[0],cy:v[1]}).show().toFront():this.dots[r].hide();
return r++}.call(this))}return l}.call(this));return j},this)).mouseout(q(function(){this.drawInfo({},true);return this.dots.hide()},this));return this};Sai.Sparkline=function(){return Sai.Chart.apply(this,arguments)};i(Sai.Sparkline,Sai.Chart);Sai.Sparkline.prototype.dataGroups=function(){return{data:["data"]}};Sai.Sparkline.prototype.render=function(){this.drawBG();this.plots=this.r.set();this.plots.push((new Sai.LinePlot(this.r,this.x,this.y,this.w,this.h,this.ndata.data)).render({data:this.colors&&
this.colors[series]||"black"},1).set);return this};Sai.BarChart=function(){var a;a=this;this.getMin=function(){return Sai.BarChart.prototype.getMin.apply(a,arguments)};return Sai.Chart.apply(this,arguments)};i(Sai.BarChart,Sai.Chart);Sai.BarChart.prototype.getMin=function(){return Math.min(Sai.BarChart.__super__.getMin.apply(this,arguments),0)};Sai.BarChart.prototype.groupsToNullPad=function(){var a,c,b;a=[];c=this.dataGroups();for(b in c)n.call(c,b)&&a.push(b);return a};Sai.BarChart.prototype.nonNegativeGroups=
function(){var a,c,b;if(this.opts.stacked){a=[];c=this.dataGroups();for(b in c)n.call(c,b)&&a.push(b);return a}return[]};Sai.BarChart.prototype.tooMuchData=function(){var a,c,b,d;b=this.w/3;c=0;a=this.data;for(d in a)if(n.call(a,d))if(d!==this.__LABELS__){c+=this.data[d].length;if(this.opts.stacked)break}return c>b};Sai.BarChart.prototype.render=function(){var a,c,b,d,f,e,g;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawLegend();this.addAxes(["all"]);this.drawLogo();this.drawBG();
if(this.tooMuchData()){this.showError("Sorry, the chart isn't wide enough to plot this much data.\n \nPossible solutions include downsampling your data\n (e.g. monthly instead of daily) or using a line chart");return this}if("all"in this.ndata){this.guidelines=this.r.set();c=this.ndata.all.__YVALS__.slice(1,this.ndata.all.__YVALS__.length-1);a=0;for(b=c.length;a<b;a++){g=c[a];this.drawGuideline(g)}}this.plots=this.r.set();a={};b={};b[this.__LABELS__]=this.data[this.__LABELS__];c=typeof(d=this.opts.stacked)!==
"undefined"&&d!==null?this.stackedNdata:this.ndata;d=c.all;for(e in d)if(n.call(d,e))if(!(e.match("^__")||e===this.__LABELS__)){a[e]=c.all[e];b[e]=this.data[e]}this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph,a,b)).render(typeof(f=this.opts.stacked)!=="undefined"&&f!==null,this.normalizedHeight(0,"all"),this.colors,this.opts.interactive,this.drawInfo).set);return this};Sai.StockChart=function(){return Sai.Chart.apply(this,arguments)};i(Sai.StockChart,Sai.Chart);Sai.StockChart.prototype.semanticRenamePatterns=
{open:/^open$/i,close:/^close$/i,high:/^high$/i,low:/^low$/i,volume:/^vol(ume)?$/i};Sai.StockChart.prototype.groupsToNullPad=function(){return["prices","volume","__META__"]};Sai.StockChart.prototype.dataGroups=function(a){var c,b,d,f;b={__META__:[this.__LABELS__]};f=typeof(c=this.semanticRenames.volume)!=="undefined"&&c!==null?c:"volume";if(f in this.data)b.volume=[f];for(d in a)if(n.call(a,d))if(this.caresAbout(d)&&!(this.__LABELS__===d||f===d)){b.prices=typeof b.prices!=="undefined"&&b.prices!==
null?b.prices:[];b.prices.push(d)}return b};Sai.StockChart.prototype.nonNegativeGroups=function(){return["volume"]};Sai.StockChart.prototype.render=function(){var a,c,b,d,f,e,g,h,k,j,l,o,m;this.drawTitle();this.setupInfoSpace();this.drawFootnote();j=typeof(a=this.semanticRenames.open)!=="undefined"&&a!==null?a:"open";a=typeof(c=this.semanticRenames.close)!=="undefined"&&c!==null?c:"close";c=typeof(b=this.semanticRenames.high)!=="undefined"&&b!==null?b:"high";b=typeof(d=this.semanticRenames.low)!==
"undefined"&&d!==null?d:"low";m=typeof(f=this.semanticRenames.volume)!=="undefined"&&f!==null?f:"volume";f={};o=false;d=this.ndata.prices;for(l in d)if(n.call(d,l))if(!(j===l||a===l||c===l||b===l)&&!(l.match("^__")||l===this.__LABELS__)){f[l]=(this.colors==null?undefined:this.colors[l])||"black";o=true}o&&this.drawLegend(f);this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};this.colors.up=typeof this.colors.up!=="undefined"&&this.colors.up!==null?this.colors.up:"black";
this.colors.down=typeof this.colors.down!=="undefined"&&this.colors.down!==null?this.colors.down:"red";this.colors.vol_up=typeof this.colors.vol_up!=="undefined"&&this.colors.vol_up!==null?this.colors.vol_up:"#666666";this.colors.vol_down=typeof this.colors.vol_down!=="undefined"&&this.colors.vol_down!==null?this.colors.vol_down:"#cc6666";this.addAxes(["prices"]);this.drawLogo();this.drawBG();if(!(typeof(e=this.ndata.prices)!=="undefined"&&e!==null&&j in this.ndata.prices&&a in this.ndata.prices&&
c in this.ndata.prices&&b in this.ndata.prices)){this.showError("This chart requires data series named\nopen, close, high, and low.\n \nOnce you add series with these names, the chart will display.");return null}this.ndata.prices.__YVALS__[0]<0&&this.drawGuideline(0,"prices");this.plots=this.r.set();d={up:[],down:[]};e={};f=this.ndata.prices;for(h in f)if(n.call(f,h))h.match("^__")||h===this.__LABELS__||(e[h]=this.data[h]);if(typeof(g=this.data[m])!=="undefined"&&g!==null)e.vol=this.data[m];if("volume"in
this.ndata){g=this.ndata.volume[m].length;for(h=0;0<=g?h<g:h>g;0<=g?h+=1:h-=1)if(this.ndata.volume[m][h]!==null)if(h&&this.ndata.prices[a][h-1]&&this.ndata.prices[a][h][1]<this.ndata.prices[a][h-1][1]){d.down.push(this.ndata.volume[m][h]);d.up.push([this.ndata.volume[m][h][0],0])}else{d.up.push(this.ndata.volume[m][h]);d.down.push([this.ndata.volume[m][h][0],0])}else{d.up.push([0,0]);d.down.push([0,0])}this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph*0.2,d,e)).render(true,this.normalizedHeight(0,
m),{up:this.colors.vol_up,down:this.colors.vol_down}).set)}this.plots.push((new Sai.CandlestickPlot(this.r,this.px,this.py,this.pw,this.ph,{open:this.ndata.prices[j],close:this.ndata.prices[a],high:this.ndata.prices[c],low:this.ndata.prices[b]},e)).render(this.colors,Math.min(5,this.pw/this.ndata.prices[j].length-2)).set);h={};g=this.ndata.prices;for(l in g)if(n.call(g,l))j===l||a===l||c===l||b===l||l.match("^__")||l===this.__LABELS__||(h[l]=this.ndata.prices[l]);this.plots.push((new Sai.LinePlot(this.r,
this.px,this.py,this.pw,this.ph,h)).render(this.colors).set);k=this.pw/(this.data[this.__LABELS__].length-1);this.glow=this.r.rect(this.px-k/2,this.py-this.ph,k,this.ph).attr({fill:"0-"+this.opts.bgcolor+"-#DDAA99-"+this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack().hide();this.bg.toBack();this.r.set().push(this.bg,this.plots,this.logo,this.glow,this.guidelines).mousemove(q(function(p){var r,t,u,x,v,s;p=this.getIndex(p);x={};if(typeof(r=this.data[this.__LABELS__][p])!=="undefined"&&
r!==null)x[this.__LABELS__]=this.data[this.__LABELS__][p];v=false;r=this.ndata.prices;for(s in r)if(n.call(r,s))if(!(s.match("^__")||s===this.__LABELS__))if(typeof(t=this.data[s]==null?undefined:this.data[s][p])!=="undefined"&&t!==null){x[s]=this.data[s][p];v=true}if(typeof(u=this.data[m]==null?undefined:this.data[m][p])!=="undefined"&&u!==null){x[m]=this.data[m][p];v=true}this.drawInfo(x);return v?this.glow.attr({x:this.px+k*(p-0.5)}).show():null},this)).mouseout(q(function(){this.drawInfo({},true);
return this.glow.hide()},this));return this};Sai.GeoChart=function(){var a;a=this;this.renderPlot=function(){return Sai.GeoChart.prototype.renderPlot.apply(a,arguments)};return Sai.Chart.apply(this,arguments)};i(Sai.GeoChart,Sai.Chart);Sai.GeoChart.prototype.plotType=Sai.GeoPlot;Sai.GeoChart.prototype.interactiveHistogram=true;Sai.GeoChart.prototype.getMax=function(a){return Math.max.apply(Math,a)};Sai.GeoChart.prototype.getMin=function(a){return Math.min.apply(Math,a)};Sai.GeoChart.prototype.normalize=
function(a){var c,b,d,f,e,g,h,k,j,l,o,m,p;this.ndata={};this.bounds={};j={};l={};for(p in a)if(n.call(a,p))if(!(p.match("^__")||p===this.__LABELS__))if(typeof(c=a[p])!=="undefined"&&c!==null){b=[];f=a[p];d=0;for(e=f.length;d<e;d++){k=f[d];typeof k!=="undefined"&&k!==null&&b.push(k)}b=b;j[p]=this.getMax(b,p);if(!(typeof o!=="undefined"&&o!==null)||j[p]>o)o=j[p];l[p]=this.getMin(b,p);if(!(typeof m!=="undefined"&&m!==null)||l[p]<m)m=l[p]}for(p in a)if(n.call(a,p))if(!(p.match("^__")||p===this.__LABELS__))if(typeof(g=
a[p])!=="undefined"&&g!==null){if(this.opts.groupedNormalization){f=o;e=m}else{f=j[p];e=l[p]}this.bounds[p]=[e,f];this.ndata[p]={};k=this.ndata[p];var r=p;c=[];b=a[p].length;for(d=0;0<=b?d<b:d>b;0<=b?d+=1:d-=1)c.push(typeof(h=a[p][d])!=="undefined"&&h!==null?[d/(a[p].length-1),(a[p][d]-e)/(f-e)]:null);k[r]=c}return[]};Sai.GeoChart.prototype.dataGroups=function(a){var c,b;c=[];for(b in a)if(n.call(a,b))if(b.match("^__")||b===this.__LABELS__)c.push(b);c={__META__:c};for(b in a)if(n.call(a,b))b.match("^__")||
b===this.__LABELS__||(c[b]=[b]);return c};Sai.GeoChart.prototype.setupHistogramInteraction=function(a,c){return a.click(q(function(){return this.renderPlot(c)},this)).hover(q(function(b){return q(function(){b.attr({"fill-opacity":0.75});return this.drawInfo({"Click to display on map":c})},this)},this)(a),q(function(b){return q(function(){b.attr({"fill-opacity":1});return this.drawInfo()},this)},this)(a))};Sai.GeoChart.prototype.renderPlot=function(a){var c,b,d;this.geoPlot==null||this.geoPlot.set.remove();
b={};c=this.ndata;for(d in c)if(n.call(c,d))b[d]=this.ndata[d][d];return this.geoPlot=(new this.plotType(this.r,this.px,this.py,this.pw,this.ph,b,this.data,{fromWhite:this.opts.fromWhite})).render(this.colors||{},this.data.__MAP__,this.__LABELS__,a,this.opts.bgcolor,this.opts.interactive,this.drawInfo)};Sai.GeoChart.prototype.default_info=function(){return{"":this.opts.interactive?"Click histogram below to change map display":""}};Sai.GeoChart.prototype.render=function(){var a,c,b;this.drawTitle();
this.setupInfoSpace();this.drawFootnote();this.drawHistogramLegend(function(){a=[];c=this.data;for(b in c)if(n.call(c,b))b.match("^__")||b===this.__LABELS__||a.push(b);return a}.call(this));this.setPlotCoords();this.drawLogo();this.drawBG();this.drawInfo();this.renderPlot(this.data.__DEFAULT__);return this};Sai.ChromaticGeoChart=function(){return Sai.GeoChart.apply(this,arguments)};i(Sai.ChromaticGeoChart,Sai.GeoChart);Sai.ChromaticGeoChart.prototype.plotType=Sai.ChromaticGeoPlot;Sai.ChromaticGeoChart.prototype.interactiveHistogram=
false;Sai.ChromaticGeoChart.prototype.default_info=function(){return{}};Sai.ChromaticGeoChart.prototype.setupHistogramInteraction=function(){return false};Sai.ScatterChart=function(){return Sai.Chart.apply(this,arguments)};i(Sai.ScatterChart,Sai.Chart);Sai.ScatterChart.prototype.dataGroups=function(a){var c,b;c=[];for(b in a)if(n.call(a,b))if(b.match("^__")||b===this.__LABELS__)c.push(b);c={__META__:c};for(b in a)if(n.call(a,b))b.match("^__")||b===this.__LABELS__||(c[b]=[b]);return c};Sai.ScatterChart.prototype.render=
function(){var a,c,b,d,f,e,g,h,k,j;this.drawTitle();this.setupInfoSpace();this.drawFootnote();g=typeof(a=this.opts.colors)!=="undefined"&&a!==null?a:typeof(c=this.colors)!=="undefined"&&c!==null?c:["black","white"];a=typeof(b=this.opts.stroke_opacity)!=="undefined"&&b!==null?b:[0,1];b=typeof(d=this.opts.stroke_colors)!=="undefined"&&d!==null?d:["black","black"];d=typeof(f=this.opts.radius)!=="undefined"&&f!==null?f:[4,12];c=[];f={};if(g instanceof Array){c.push(this.opts.mappings.color);f[this.opts.mappings.color]=
{__LOW__:g[0],__HIGH__:g[1]}}else{k=typeof k!=="undefined"&&k!==null?k:{};h=true;for(e in g)if(n.call(g,e))k[e]=g[e]}if(b instanceof Array){c.push(this.opts.mappings.stroke_color);f[this.opts.mappings.stroke_color]={__LOW__:b[0],__HIGH__:b[1]}}else{k=typeof k!=="undefined"&&k!==null?k:{};h=true;for(e in g)if(n.call(g,e))k[e]=b[e]}c.length&&this.drawHistogramLegend(c,f);h&&this.drawLegend(g);this.__LABELS__="__XVALS__";this.data.__XVALS__=this.ndata[this.opts.mappings.x].__YVALS__;this.addAxes([this.opts.mappings.y],
{left:this.opts.mappings.y,bottom:this.opts.mappings.x});this.drawLogo();this.drawBG();h={};e=this.ndata;for(j in e)if(n.call(e,j))h[j]=this.ndata[j][j];this.plots=this.r.set();this.plots.push((new Sai.ScatterPlot(this.r,this.px,this.py,this.pw,this.ph,h,this.data)).render(this.opts.mappings,g,d,a,b,this.drawInfo).set);return this}})();
