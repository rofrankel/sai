Sai={};Sai.util={};Sai.imagePath=typeof Sai.imagePath!=="undefined"&&Sai.imagePath!==null?Sai.imagePath:"/static/images/sai/";Sai.util.roundToMag=function(n,q){var j;q=typeof q!=="undefined"&&q!==null?q:0;j=Math.pow(10,q);return parseFloat((Math.round(n/j)*j).toFixed(Math.max(0,q)))};Sai.util.round=function(n,q){return parseFloat((Math.round(n/q)*q).toFixed(Math.max(0,Math.ceil(-1*Math.log(q)/Math.LN10))))};
Sai.util.sumArray=function(n){var q,j,a;a=0;q=n.length;for(j=0;0<=q?j<q:j>q;0<=q?j+=1:j-=1)a+=typeof n[j]==="number"?n[j]:0;return a};Sai.util.prettystr=function(n,q){var j;q=typeof q!=="undefined"&&q!==null?q:2;if(typeof n==="number"){if(Math.abs(n)>=1E12){j="t";n/=1E12}else if(Math.abs(n)>=1E9){j="b";n/=1E9}else if(Math.abs(n)>=1E6){j="m";n/=1E6}else if(Math.abs(n)>=1E3){j="k";n/=1E3}else return String(parseFloat(n.toFixed(q)));return parseFloat(n.toFixed(1))+j}return n};
Sai.util.prettynum=function(n){var q;if(!(isNaN(parseFloat(n))||!String(n).match(/^[-+]?\d+(\.\d+)?$/))){n=String(n).split(".");for(q=/(\d+)(\d{3})/;q.test(n[0]);)n[0]=n[0].replace(q,"$1,$2");return n[0]+(n.length>1?parseFloat("0."+n[1]).toFixed(2).slice(1):"")}};Sai.util.infoSetters=function(n,q){return[function(){return n(q)},function(){return n()}]};
Sai.util.transformCoords=function(n,q){var j;if(q.getScreenCTM){j=q.createSVGPoint();j.x=n.clientX;j.y=n.clientY;j=j.matrixTransform(q.getScreenCTM().inverse());if(navigator.userAgent.toLowerCase().indexOf("chrome")!==-1||navigator.userAgent.toLowerCase().indexOf("safari")!==-1){j.x+=document.body.scrollLeft;j.y+=document.body.scrollTop}return{x:j.x,y:j.y}}else return{x:n.x,y:n.y}};
Sai.util.multiplyColor=function(n,q,j,a){a=typeof a!=="undefined"&&a!==null?a:0;q=a+(1-a)*q;a=Raphael.getRGB(n);if(j){n=a.r+(255-a.r)*(1-q);j=a.g+(255-a.g)*(1-q);q=a.b+(255-a.b)*(1-q)}else{n=a.r*q;j=a.g*q;q=a.b*q}return{r:n,g:j,b:q,str:"rgb("+n+", "+j+", "+q+")"}};Sai.util.colerp=function(n,q,j){n=Raphael.getRGB(n);q=Raphael.getRGB(q);return"rgb("+(q.r*j+n.r*(1-j))+", "+(q.g*j+n.g*(1-j))+", "+(q.b*j+n.b*(1-j))+")"};
Sai.util.reflectColor=function(n,q){var j,a,b,c,d,e,f,g,h;e=Raphael.getRGB(n);g=Raphael.getRGB(q);h={};a=["r","g","b"];j=0;for(b=a.length;j<b;j++){d=a[j];c=e[d];f=g[d];h[d]=c===f?c:c>f?f*((255-c)/(255-f)):(255*(f-c)+f*c)/f}return"rgb("+h.r+", "+h.g+", "+h.b+")"};Sai.data=typeof Sai.data!=="undefined"&&Sai.data!==null?Sai.data:{};Sai.data.map=typeof Sai.data.map!=="undefined"&&Sai.data.map!==null?Sai.data.map:{};
Raphael.fn.sai=typeof Raphael.fn.sai!=="undefined"&&Raphael.fn.sai!==null?Raphael.fn.sai:{};Raphael.fn.sai.chart=function(n,q,j,a,b,c){b=typeof{line:Sai.LineChart}[b]!=="undefined"&&{line:Sai.LineChart}[b]!==null?{line:Sai.LineChart}[b]:b;b=typeof b!=="undefined"&&b!==null?b:Sai.Chart;return(new b(this,n,q,j,a,c)).render()};(function(){var n,q=Object.prototype.hasOwnProperty;Raphael.fn.sai.prim=typeof Raphael.fn.sai.prim!=="undefined"&&Raphael.fn.sai.prim!==null?Raphael.fn.sai.prim:{};n=function(j,a,b,c){return[function(){j.attr(a);return c?c[0](j):null},function(){j.attr(b);return c?c[1](j):null}]};Raphael.fn.sai.prim.candlestick=function(j,a,b,c,d,e,f,g,h,k,i){f=typeof f!=="undefined"&&f!==null?f:"#000000";e%2||e++;e=this.rect(j-e/2,a,e,b-a||1).attr("stroke",f);c=this.path("M"+j+" "+c+"L"+j+" "+a+"M"+j+" "+b+"L"+j+
" "+d).attr("stroke",f);e.attr("fill",g?f:"#ffffff");f=this.set().push(e,c);if(h){j=n(f,{scale:"1.5,1.5,"+j+","+(a+(b-a)/2),"fill-opacity":0.5},{scale:"1.0,1.0,"+j+","+(a+(b-a)/2),"fill-opacity":1},i);f.hover(j[0],j[1])}return f};Raphael.fn.sai.prim.line=function(j,a,b){var c,d,e,f;a=typeof a!=="undefined"&&a!==null?a:"#000000";b=typeof b!=="undefined"&&b!==null?b:1;c=0;for(d=j.length;c<d;c++){e=j[c];if(typeof e!=="undefined"&&e!==null)if(typeof f!=="undefined"&&f!==null)f+="L"+e[0]+" "+e[1];else f=
"M"+e[0]+" "+e[1]}return this.path(f).attr({stroke:a,"stroke-width":b})};Raphael.fn.sai.prim.area=function(j,a,b,c){var d,e,f,g,h;if(j.length<2)return this.set();a=typeof a!=="undefined"&&a!==null?a:"#000000";b=typeof b!=="undefined"&&b!==null?b:1;d=0;for(e=j.length;d<e;d++){g=j[d];if(typeof g!=="undefined"&&g!==null)if(typeof h!=="undefined"&&h!==null){h+="L"+g[0]+" "+g[1];f+="L"+g[0]+" "+g[1]}else{h="M"+g[0]+" "+g[1];f="M"+g[0]+" "+g[1]}}for(j=c.length-1;c.length-1<=0?j<=0:j>=0;j+=-1)f+="L"+c[j][0]+
","+c[j][1];c=this.path(f).attr({fill:a,"stroke-width":0,"stroke-opacity":0,"fill-opacity":0.35});a=this.path(h).attr({stroke:a,"stroke-width":b});return this.set().push(c,a)};Raphael.fn.sai.prim.stackedBar=function(j,a,b,c,d,e,f){var g,h,k,i,l,o,m,p,r,t,s,u;if(d){m=p=null;g=0;for(h=j.length;g<h;g++){l=j[g];if(!(typeof m!=="undefined"&&m!==null)||m<l[1])m=l[1];if(!(typeof p!=="undefined"&&p!==null)||p>l[1])p=l[1]}u=m-p||1}b*=0.67;s=this.set();r=[c,c];p=function(y){return y<c?1:0};h=j.length;for(g=
0;0<=h?g<h:g>h;0<=h?g+=1:g-=1){l=g;if(typeof(k=j[l])!=="undefined"&&k!==null&&j[l][1]!==c){m=p(j[l][1]);o=Math.abs(r[m]-j[l][1]);i=r[m]===c?1:0;t=j[l][1]-(m?0:o-i);s.push(i=this.rect(j[l][0]-b/2,t,b,o-i).attr("fill",(typeof a==="undefined"||a===null?undefined:a[l])||"#000000").attr("stroke",(typeof a==="undefined"||a===null?undefined:a[l])||"#000000"));if(d){o=n(i,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},[function(y){return function(){f[0]&&f[0]();return e({"(selected)":Sai.util.prettystr(y)+
"%"},false)}}(100*o/u),f[1]]);i.hover(o[0],o[1])}r[m]=j[l][1]}}return s};Raphael.fn.sai.prim.groupedBar=function(j,a,b,c,d,e,f){var g,h,k,i,l,o;e=this.set();h=b/(j.length+1);o=(b-h)/2;b=j.length;for(l=0;0<=b?l<b:l>b;0<=b?l+=1:l-=1)if(typeof(g=j[l]==null?undefined:j[l][0])!=="undefined"&&g!==null){k=Math.min(j[l][1],c);i=Math.max(j[l][1],c)-k-0.5;e.push(this.rect(j[l][0]-o+l*h,k,h-1,i).attr("fill",(typeof a==="undefined"||a===null?undefined:a[l])||"#000000").attr("stroke",(typeof a==="undefined"||
a===null?undefined:a[l])||"#000000"))}if(d){j=n(e,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},f);e.hover(j[0],j[1])}return e};Raphael.fn.sai.prim.haxis=function(j,a,b,c,d){var e,f,g,h,k,i,l,o,m,p,r,t,s,u,y,w,C,E,x,A;y=typeof(e=d.ticklens)!=="undefined"&&e!==null?e:[5,2];e=typeof(f=d.width)!=="undefined"&&f!==null?f:1;f=typeof(g=d.color)!=="undefined"&&g!==null?g:"black";t=this.path("M"+a+" "+b+"l"+c+" 0").attr("stroke",f);w=this.set();r=this.set();g=c/25;p=g<j.length?Math.ceil(j.length/g):1;o=
c/(j.length-1)*p;x=a;E=-1;u=false;g=0;A=null;h=j.length;for(m=0;0<=h?m<h:m>h;m+=p){i=j[m];if(typeof i!=="undefined"&&i!==null){l=y[String(i)?0:1];w.push(this.path("M"+x+" "+b+"l0 "+l).attr("stroke",f));if(i!==""){l=this.text(x,b+l+2,Sai.util.prettystr(i).substring(0,12));i=l.getBBox();s=l.attr("y")+5;l.attr("y",s);if(!(typeof A!=="undefined"&&A!==null)||s<A)A=s;r.push(l);l=i.width;g=Math.max(l,g);if(i.x<=E+3)u=true;if(i.x+l>E)E=i.x+l}}x+=o}if(typeof(k=d.title)!=="undefined"&&k!==null)C=this.text(a+
c/2,A+14,d.title).attr({"font-size":"12px","font-weight":"bold"});j=this.set().push(t,w,r,C);if(u){d=r.items;c=0;for(k=d.length;c<k;c++){l=d[c];l.rotate(-90);l.translate(0,l.getBBox().width/2-2)}j.push(this.rect(a,b,1,e+g+y[0]).attr("opacity","0"))}return j};Raphael.fn.sai.prim.vaxis=function(j,a,b,c,d){var e,f,g,h,k,i,l,o,m,p,r,t,s,u,y,w;t=typeof(e=d.ticklens)!=="undefined"&&e!==null?e:[5,2];e=typeof(f=d.color)!=="undefined"&&f!==null?f:"black";r=typeof(g=d.right)!=="undefined"&&g!==null?g:false;
f=this.path("M"+a+" "+b+"l0 "+-c).attr("stroke",e);s=this.set();g=this.set();o=c/(j.length-1);w=b;y=null;h=0;for(k=j.length;h<k;h++){m=j[h];if(m!==null){p=t[String(m)?0:1];s.push(this.path("M"+a+" "+w+"l"+(r?p:-p)+" 0").attr("stroke",e));p=a+(r?1:-1)*(p+3);m=this.text(p,w,Sai.util.prettystr(m));m.attr({"text-anchor":r?"start":"end",fill:e});p+=(r?1:-1)*(m.getBBox().width+8);if(!(typeof y!=="undefined"&&y!==null)||p<y)y=p;g.push(m)}w-=o}if(typeof(i=d.title)!=="undefined"&&i!==null){u=this.text(y,b-
c/2,d.title).attr({"font-size":"12px","font-weight":"bold"});j=u.getBBox();u.rotate(-90);l=this.rect(j.x+(j.width-j.height)/2,b,j.height,1).attr({opacity:0})}l=typeof l!=="undefined"&&l!==null?l:null;return this.set().push(this.set().push(f,s,g,l),u)};Raphael.fn.sai.prim.popup=function(j,a,b){var c,d,e,f,g,h;this.set();h=this.set();d=0;e=a+5+5;if("__HEAD__"in b){c=this.text(j,e,b.__HEAD__).attr({fill:"#cfc","font-size":"12","font-weight":"bold"});d=Math.max(d,c.getBBox().width);h.push(c);e+=17}for(g in b)if(q.call(b,
g))if(g!=="__HEAD__"){f=this.text(j+5,e,g+" = "+b[g]).attr({fill:"white","font-weight":"bold","text-anchor":"start"});d=Math.max(d,f.getBBox().width);e+=10;h.push(f)}b=d+10;this.rect(j,a,b,e-a,5).attr({fill:"black","fill-opacity":".85",stroke:"black"});typeof c==="undefined"||c===null||c.translate(b/2);return h.toFront()};Raphael.fn.sai.prim.legend=function(j,a,b,c,d){var e,f,g,h,k,i,l,o,m;a-=14;o=this.set();i=j;l=a;for(m in c)if(q.call(c,m)){k=this.text(i+14,l+5,m).attr({fill:typeof(e=typeof d===
"undefined"||d===null?undefined:d[m])!=="undefined"&&e!==null?e:"black","text-anchor":"start"});h=this.rect(i,l,9,9).attr({fill:typeof(f=c[m])!=="undefined"&&f!==null?f:"black",stroke:typeof(g=typeof d==="undefined"||d===null?undefined:d[m])!=="undefined"&&g!==null?g:"black"});h=this.set().push(k,h);k=h.getBBox().width;if(i-j+15+k>b){o.translate(0,-14);h.translate(j-i,a-l);i=j;l=a}i+=k+15;o.push(h)}return o};Raphael.fn.sai.prim.wrappedText=function(j,a,b,c,d){var e,f,g,h;d=typeof d!=="undefined"&&
d!==null?d:" ";c=typeof c!=="undefined"&&c!==null?c:"";if(c.match(/^\s*$/))return null;b=b/6;g=[];for(f=0;f<c.length-1;){e=f+b;h=c.substring(f,e+1);e=e>=c.length?e:h.lastIndexOf(d);g.push(h.substring(0,e));f+=e+1}c=g.join("\n");return this.text(j,a+5*g.length,c).attr({"font-family":"Lucida Console","text-anchor":"start"})};Raphael.fn.sai.prim.info=function(j,a,b,c){var d,e,f,g,h,k;g=this.set();f=j;a=a;for(e in c)if(q.call(c,e))if(c[e]!==null){h=e+(e===""?"":": ");h+=typeof c[e]==="string"?c[e]:typeof(d=
Sai.util.prettynum(c[e]))!=="undefined"&&d!==null?d:Sai.util.prettystr(c[e]);k=6*h.length;if(f-j+k>b){f=j;a+=14}h=this.text(f,a,h).attr({"font-family":"Lucida Console","text-anchor":"start"});f+=k+15;g.push(h)}return g};Raphael.fn.sai.prim.hoverShape=function(j,a,b,c){j=j(this).attr(a);b=n(j,c&&c[0]||{},c&&c[1]||{},b);j.mouseover(b[0]);j.mouseout(b[1]);return j};Raphael.fn.sai.prim.histogram=function(j,a,b,c,d,e,f,g,h,k,i,l){var o,m,p,r,t,s;k=typeof k!=="undefined"&&k!==null?k:"white";h=typeof h!==
"undefined"&&h!==null?h:["black","white"];l=typeof l!=="undefined"&&l!==null?l:10;s=this.set();s.push(this.rect(j,a-c,b,c).attr({"stroke-width":0,"stroke-opacity":0,fill:k}));c=a-(c-12);a-=5;e=typeof e!=="undefined"&&e!==null?e:0;f=typeof f!=="undefined"&&f!==null?f:1;s.push(this.text(j,a,Sai.util.prettystr(e)).attr({"text-anchor":"start"}));s.push(this.text(j+b,a,Sai.util.prettystr(f)).attr({"text-anchor":"end"}));a-=7;e={};k=f=0;for(o=d.length;k<o;k++){r=d[k];r=Math.min(l-1,Math.floor(l*r/1));if(r in
e)e[r]+=1;else e[r]=1;f=Math.max(f,e[r])}s.push(this.rect(j,a,b,1).attr({fill:"0-"+h[0]+"-"+(typeof(m=h[1])!=="undefined"&&m!==null?m:h[0]),"stroke-width":0,"stroke-opacity":0}));a-=1;m=b/l;for(p in e)if(q.call(e,p)){d=(a-c)*(e[p]/f);s.push(h.length===1?t=Sai.util.multiplyColor(h[0],(parseInt(p)+0.5)/l,i,0.2).str:t=Sai.util.colerp(h[0],h[1],(parseInt(p)+0.5)/l),this.rect(j+(parseInt(p)+0.2)*m,a-d,m*0.6,d).attr({fill:t,"stroke-width":i?0.35:0,"stroke-opacity":i?1:0,stroke:"#000000"}))}s.push(this.text(j+
b/2,c-6,Sai.util.prettystr(g)));return s}})();(function(){var n=Object.prototype.hasOwnProperty,q=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;typeof b.extended==="function"&&b.extended(a);a.__super__=b.prototype},j=function(a,b){return function(){return a.apply(b,arguments)}};Sai.Plot=function(a,b,c,d,e,f,g,h){this.opts=h;this.rawdata=g;this.data=f;this.h=e;this.w=d;this.y=c;this.x=b;this.r=a;this.opts=typeof this.opts!=="undefined"&&this.opts!==null?this.opts:{};this.setDenormalizedData();
this.set=this.r.set();return this};Sai.Plot.prototype.setDenormalizedData=function(){var a,b,c,d,e,f,g,h,k,i;if(this.data instanceof Array){a=[];c=this.data;b=0;for(d=c.length;b<d;b++){k=c[b];a.push(this.denormalize(k))}return this.dndata=a}else{this.dndata=typeof this.dndata!=="undefined"&&this.dndata!==null?this.dndata:{};a=[];b=this.data;for(i in b)if(n.call(b,i))a.push(this.dndata[i]=function(){e=[];g=this.data[i];f=0;for(h=g.length;f<h;f++){k=g[f];e.push(this.denormalize(k))}return e}.call(this));
return a}};Sai.Plot.prototype.denormalize=function(a){if(a instanceof Array)return[this.x+this.w*a[0],this.y-this.h*a[1]]};Sai.Plot.prototype.render=function(){this.set.push(this.r.rect(20,20,20,20).attr("fill","red"),this.r.circle(40,40,10).attr("fill","blue"));return this};Sai.LinePlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.LinePlot,Sai.Plot);Sai.LinePlot.prototype.setDenormalizedData=function(){var a,b,c;Sai.LinePlot.__super__.setDenormalizedData.apply(this,arguments);a=[];b=this.dndata;
for(c in b)if(n.call(b,c))a.push(this.dndata[c].length===1&&(this.dndata[c]==null?undefined:this.dndata[c][0]==null?undefined:this.dndata[c][0][0])===this.x?this.dndata[c].push([this.x+this.w,this.dndata[c][0][1]]):null);return a};Sai.LinePlot.prototype.render=function(a,b){var c,d;this.set.remove();c=this.dndata;for(d in c)if(n.call(c,d))d.match("^__")||this.set.push(this.r.sai.prim.line(this.dndata[d],(typeof a==="undefined"||a===null?undefined:a[d])||"black",b||1));return this};Sai.AreaPlot=function(){return Sai.LinePlot.apply(this,
arguments)};q(Sai.AreaPlot,Sai.LinePlot);Sai.AreaPlot.prototype.render=function(a,b,c,d){var e,f,g,h,k,i,l,o,m;this.set.remove();i=[this.denormalize([0,d]),this.denormalize([1,d])];d=this.dndata;for(m in d)if(n.call(d,m))if(!m.match("^__")){e=this.dndata[m].length;for(g=0;0<=e?g<e:g>e;0<=e?g+=1:g-=1){l=this.dndata[m][g];if(typeof l!=="undefined"&&l!==null)break}for(g=this.dndata[m].length-1;this.dndata[m].length-1<=0?g<=0:g>=0;this.dndata[m].length-1<=0?g+=1:g-=1){o=this.dndata[m][g];if(typeof o!==
"undefined"&&o!==null)break}typeof f!=="undefined"&&f!==null&&c||(f=[[l[0],i[0][1]],[o[0],i[1][1]]]);this.set.push(this.r.sai.prim.area(this.dndata[m],(typeof a==="undefined"||a===null?undefined:a[m])||"black",b||1,f));if(c){f=[];g=this.dndata[m];e=0;for(h=g.length;e<h;e++){k=g[e];f.push([k[0],k[1]-b/2])}f=f}}return this};Sai.CandlestickPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.CandlestickPlot,Sai.Plot);Sai.CandlestickPlot.prototype.render=function(a,b,c,d){var e,f,g,h,k,i,l,o,
m;this.set.remove();k=(typeof a==="undefined"||a===null?undefined:a.up)||"black";h=(typeof a==="undefined"||a===null?undefined:a.down)||"red";b=typeof b!=="undefined"&&b!==null?b:5;a=this.dndata.open.length;for(i=0;0<=a?i<a:i>a;0<=a?i+=1:i-=1)if(typeof(e=this.dndata.close[i])!=="undefined"&&e!==null){m=this.dndata.close[i][1]<this.dndata.open[i][1];l={};f=this.rawdata;for(o in f)if(n.call(f,o))l[o]=this.rawdata[o][i];this.set.push(this.r.sai.prim.candlestick(this.dndata.open[i][0],m&&this.dndata.close[i][1]||
this.dndata.open[i][1],m&&this.dndata.open[i][1]||this.dndata.close[i][1],this.dndata.high[i][1],this.dndata.low[i][1],b||5,i&&typeof(g=this.dndata.close[i-1])!=="undefined"&&g!==null&&this.dndata.close[i-1][1]<this.dndata.close[i][1]?h:k,!m,c,d,Sai.util.infoSetters(d,l)))}return this};Sai.BarPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.BarPlot,Sai.Plot);Sai.BarPlot.prototype.render=function(a,b,c,d,e){var f,g,h,k,i,l,o;this.set.remove();b=this.denormalize([0,b])[1];i=0;h=[];a=a?this.r.sai.prim.stackedBar:
this.r.sai.prim.groupedBar;f=this.dndata;for(o in f)if(n.call(f,o)){i=this.dndata[o].length;h.push((typeof c==="undefined"||c===null?undefined:c[o])||"black")}for(f=0;0<=i?f<i:f>i;0<=i?f+=1:f-=1){c=[];g=this.dndata;for(o in g)n.call(g,o)&&c.push(this.dndata[o][f]);k={};g=this.rawdata;for(l in g)if(n.call(g,l))k[l]=this.rawdata[l][f];this.set.push(a(c,h,this.w/i,b,d,e,Sai.util.infoSetters(e,k)))}return this};Sai.GeoPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.GeoPlot,Sai.Plot);Sai.GeoPlot.prototype.getRegionColor=
function(a,b,c){return Sai.util.multiplyColor(a[c],(this.data[c][b]==null?undefined:this.data[c][b][1])||0,this.opts.fromWhite,this.opts.fromWhite?0.2:0).str};Sai.GeoPlot.prototype.getRegionOpacity=function(a,b){var c;return typeof(c=this.data[b][a]==null?undefined:this.data[b][a][1])!=="undefined"&&c!==null?1:this.opts.fromWhite?0.15:0.25};Sai.GeoPlot.prototype.render=function(a,b,c,d,e,f,g){var h,k,i,l,o,m,p;this.set.remove();h=[];i=this.rawdata[c];k=0;for(l=i.length;k<l;k++){m=i[k];h.push(m.toUpperCase())}p=
{};k=h.length;for(i=0;0<=k?i<k:i>k;0<=k?i+=1:i-=1)p[h[i]]=i;h=b.paths;for(o in h)n.call(h,o)&&function(){var r,t,s,u,y,w=o;y=p[w];s=b.name[w];s={region:typeof s!=="undefined"&&s!==null?s:w};r=this.rawdata;for(t in r)if(n.call(r,t))if(t!==c)s[t]=this.rawdata[t][y];t=this.getRegionColor(a,y,d);y=this.getRegionOpacity(y,d);u=Sai.util.infoSetters(g,s);return this.set.push(this.r.sai.prim.hoverShape(function(C,E,x,A){return function(v){return v.path(C).translate(x,A).scale(E,E,x,A)}}(b.paths[w],Math.min(this.w/
b.width,this.h/b.height),this.x,this.y-this.h),{fill:t,stroke:this.opts.fromWhite?"black":e,"stroke-width":0.5,opacity:y},f?[function(C){navigator.userAgent.toLowerCase().indexOf("msie")!==-1||navigator.userAgent.toLowerCase().indexOf("opera")!==-1||C.toFront();return u[0]()},u[1]]:null,f?[{"fill-opacity":0.75,"stroke-width":this.opts.fromWhite?1.5:0.5},{"fill-opacity":1,"stroke-width":0.5}]:null))}.call(this);h=this.set.getBBox();this.set.translate((this.w-h.width)/2,(this.h-h.height)/2);return this};
Sai.ChromaticGeoPlot=function(){return Sai.GeoPlot.apply(this,arguments)};q(Sai.ChromaticGeoPlot,Sai.GeoPlot);Sai.ChromaticGeoPlot.prototype.getRegionColor=function(a,b){var c,d,e,f,g,h;f=e=d=0;c=this.data;for(h in c)if(n.call(c,h)){g=Sai.util.multiplyColor(a[h],(this.data[h][b]==null?undefined:this.data[h][b][1])||0,this.opts.fromWhite);f+=g.r;e+=g.g;d+=g.b}return"rgb("+f+", "+e+", "+d+")"};Sai.ChromaticGeoPlot.prototype.getRegionOpacity=function(a){var b,c,d;b=this.data;for(d in b)if(n.call(b,d))if(typeof(c=
this.data[d][a]==null?undefined:this.data[d][a][1])!=="undefined"&&c!==null)return 1;return 0.25};Sai.ScatterPlot=function(){return Sai.Plot.apply(this,arguments)};q(Sai.ScatterPlot,Sai.Plot);Sai.ScatterPlot.prototype.render=function(a,b,c,d,e,f,g){var h,k,i,l,o,m;this.set.remove();h=this.dndata;for(o in h)if(n.call(h,o)){l=this.dndata[o].length;break}i=function(p,r,t){return r*t+p*(1-t)};m=j(function(p){return this.x+this.w*((p-this.y)/-this.h)},this);for(k=0;0<=l?k<l:k>l;0<=l?k+=1:k-=1)(function(){var p,
r,t,s,u,y,w,C,E,x,A,v,F,K,G,I,B,J,z=k;B=m(this.dndata[a.x]==null?undefined:this.dndata[a.x][z][1]);J=this.dndata[a.y]==null?undefined:this.dndata[a.y][z][1];K=b instanceof Array&&typeof(r=a.color)!=="undefined"&&r!==null?Sai.util.colerp(b[0],b[1],typeof(p=this.data[a.color]==null?undefined:this.data[a.color][z]==null?undefined:this.data[a.color][z][1])!=="undefined"&&p!==null?p:0):b instanceof Object&&typeof(t=a.color)!=="undefined"&&t!==null?b[this.rawdata[a.color][z]]:"black";p=e instanceof Array&&
typeof(u=a.stroke_color)!=="undefined"&&u!==null?Sai.util.colerp(e[0],e[1],typeof(s=this.data[a.stroke_color]==null?undefined:this.data[a.stroke_color][z]==null?undefined:this.data[a.stroke_color][z][1])!=="undefined"&&s!==null?s:0):b instanceof Object&&typeof(y=a.color)!=="undefined"&&y!==null?e[this.rawdata[a.stroke_color][z]]:"black";s=c instanceof Array&&typeof(C=a.radius)!=="undefined"&&C!==null?i(c[0],c[1],typeof(w=this.data[a.radius]==null?undefined:this.data[a.radius][z]==null?undefined:this.data[a.radius][z][1])!==
"undefined"&&w!==null?w:0):c instanceof Object&&typeof(E=a.radius)!=="undefined"&&E!==null?c[this.rawdata[a.radius][z]]:5;w=d instanceof Array&&typeof(A=a.stroke_opacity)!=="undefined"&&A!==null?i(d[0],d[1],typeof(x=this.data[a.stroke_opacity]==null?undefined:this.data[a.stroke_opacity][z]==null?undefined:this.data[a.stroke_opacity][z][1])!=="undefined"&&x!==null?x:0):d instanceof Object&&typeof(v=a.stroke_opacity)!=="undefined"&&v!==null?d[this.rawdata[a.stroke_opacity][z]]:1;if(f){A={};x=this.rawdata;
for(I in x)if(n.call(x,I))I.match("^__")||(A[I]=this.rawdata[I][z]);G=Sai.util.infoSetters(g,A)}return this.set.push(F=this.r.circle(B,J,s).attr({fill:K,"stroke-opacity":w,stroke:p,"fill-opacity":0.8,"stroke-width":2}),f?F.hover(function(){G[0]();return this.attr("fill-opacity",0.5)},function(){G[1]();return this.attr("fill-opacity",0.8)}):null)}).call(this);return this}})();(function(){var n=Object.prototype.hasOwnProperty,q=function(a,b){return function(){return a.apply(b,arguments)}},j=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;typeof b.extended==="function"&&b.extended(a);a.__super__=b.prototype};Sai.Chart=function(a,b,c,d,e,f,g,h){var k;this.opts=h;this.__LABELS__=g;this.h=e;this.w=d;this.y=c;this.x=b;this.r=a;k=this;this.drawInfo=function(){return Sai.Chart.prototype.drawInfo.apply(k,arguments)};this.opts=
typeof this.opts!=="undefined"&&this.opts!==null?this.opts:{};this.opts.bgcolor=typeof this.opts.bgcolor!=="undefined"&&this.opts.bgcolor!==null?this.opts.bgcolor:"white";this.setData(f);this.padding={left:5,right:5,top:5,bottom:5};return this};Sai.Chart.prototype.groupsToNullPad=function(){return[]};Sai.Chart.prototype.nonNegativeGroups=function(){return[]};Sai.Chart.prototype.nextSeriesSuffix=function(){var a;this.suffixCtr=(typeof(a=this.suffixCtr)!=="undefined"&&a!==null?a:0)+1;return"["+this.suffixCtr+
"]"};Sai.Chart.prototype.fixSeriesName=function(a){return a+(a.match(/^\s+$/)?this.nextSeriesSuffix():"")};Sai.Chart.prototype.setSemanticRename=function(a){var b,c,d;if(!(typeof(b=this.semanticRenamePatterns)!=="undefined"&&b!==null))return null;this.semanticRenames=typeof this.semanticRenames!=="undefined"&&this.semanticRenames!==null?this.semanticRenames:{};b=[];c=this.semanticRenamePatterns;for(d in c)if(n.call(c,d))b.push(a.match(this.semanticRenamePatterns[d])?this.semanticRenames[d]=a:null);
return b};Sai.Chart.prototype.setData=function(a){var b,c,d,e,f,g,h,k,i,l,o;this.data={};this.renames={};if(function(r){var t;for(t in r)if(n.call(r,t))if(r.hasOwnProperty(t))return false;return true}(a)){this.render=function(){return this.showError("(no data -> empty chart)")};return null}for(o in a)if(n.call(a,o)){for(;;){h=this.fixSeriesName(o);this.setSemanticRename(h);if(h===o||!(h in a))break}this.renames[o]=h;if(a[o]instanceof Array)if(this.__LABELS__===o){this.__LABELS__=h;var m=this.data,
p=h;b=[];d=a[o];c=0;for(e=d.length;c<e;c++){f=d[c];b.push(String(f))}m[p]=b}else{m=this.data;p=h;b=[];d=a[o];c=0;for(e=d.length;c<e;c++){f=d[c];b.push(typeof f==="string"&&f.match(/^[+-]?[\d,]+(\.\d+)?$/)&&!isNaN(g=parseFloat(f.replace(/,/g,"")))?g:f)}m[p]=b}else this.data[h]=a[o]}a=this.dataGroups(this.data);l=this.nonNegativeGroups();for(i in a)if(n.call(a,i))if(a[i].length>0)if(function(){for(var r=0,t=l.length;r<t;r++)if(l[r]===i)return true;return false}.call(this)){g=a[i];f=0;for(h=g.length;f<
h;f++){o=g[f];if(typeof(k=this.data[o])!=="undefined"&&k!==null){b=this.data[o].length;for(c=0;0<=b?c<b:c>b;0<=b?c+=1:c-=1)if(this.data[o][c]<0)this.data[o][c]*=-1}}}f=this.groupsToNullPad();k=0;for(g=f.length;k<g;k++){i=f[k];if(i in a){b=a[i];h=0;for(c=b.length;h<c;h++){o=b[h];this.nullPad(o)}}}return this.normalize(this.data)};Sai.Chart.prototype.nullPad=function(a){return a in this.data?this.data[a]=[null].concat(this.data[a].concat([null])):null};Sai.Chart.prototype.caresAbout=function(a){return!(a.match("^__")||
a===this.__LABELS__)};Sai.Chart.prototype.dataGroups=function(a){var b,c,d;b=[];for(d in a)n.call(a,d)&&this.caresAbout(d)&&b.push(d);c=[];for(d in a)if(n.call(a,d))if(d.match("^__")||d===this.__LABELS__)c.push(d);return{all:b,__META__:c}};Sai.Chart.prototype.getYAxisVals=function(a,b,c){var d,e,f;if(!(typeof a==="number"&&typeof b==="number"))return[a,b];if(a===b)return[0,b,b*2];c=typeof c!=="undefined"&&c!==null?c:false;for(d=1;(b-a)*d<10;)d*=10;a*=d;b*=d;f=Math.floor(e=Math.log(b-a)/Math.LN10-
0.4);f=Math.pow(10,f);if(e%1>0.7&&!c)f*=4;else if(e%1>0.35&&!c)f*=2;e=Sai.util.round(a-(c?f/2.1:f/1.75),f);if(e<0&&0<=a)e=0;a=Sai.util.round(b+(c?f/2.1:f/1.75),f);e/=d;a/=d;f/=d;d=[];for(b=e;e<=a?b<=a:b>=a;b+=f)d.push(Sai.util.round(b,f));return d};Sai.Chart.prototype.getMax=function(a,b){var c,d,e,f,g,h,k,i,l,o;return Math.max.apply(Math,function(){c=[];d=0;for(e=b.length;d<e;d++){o=b[d];if(typeof(i=a[o])!=="undefined"&&i!==null)c.push(Math.max.apply(Math,function(){f=[];h=a[o];g=0;for(k=h.length;g<
k;g++){l=h[g];typeof l!=="undefined"&&l!==null&&typeof l==="number"&&f.push(l)}return f}()))}return c}())};Sai.Chart.prototype.getMin=function(a,b){var c,d,e,f,g,h,k,i,l,o;return Math.min.apply(Math,function(){c=[];d=0;for(e=b.length;d<e;d++){o=b[d];if(typeof(i=a[o])!=="undefined"&&i!==null)c.push(Math.min.apply(Math,function(){f=[];h=a[o];g=0;for(k=h.length;g<k;g++){l=h[g];typeof l!=="undefined"&&l!==null&&typeof l==="number"&&f.push(l)}return f}()))}return c}())};Sai.Chart.prototype.getStackedMax=
function(a,b){var c,d,e,f,g,h,k;return Math.max.apply(Math,function(){c=[];d=a[this.__LABELS__].length;for(h=0;0<=d?h<d:h>d;0<=d?h+=1:h-=1)c.push(Sai.util.sumArray(function(){e=[];f=0;for(g=b.length;f<g;f++){k=b[f];k!==this.__LABELS__&&a[k][h]>=0&&e.push(a[k][h])}return e}.call(this)));return c}.call(this))};Sai.Chart.prototype.getStackedMin=function(a,b){var c,d,e,f,g,h,k;return Math.min.apply(Math,function(){c=[];d=a[this.__LABELS__].length;for(h=0;0<=d?h<d:h>d;0<=d?h+=1:h-=1)c.push(Sai.util.sumArray(function(){e=
[];f=0;for(g=b.length;f<g;f++){k=b[f];k!==this.__LABELS__&&a[k][h]<0&&e.push(a[k][h])}return e}.call(this)));return c}.call(this))};Sai.Chart.prototype.normalize=function(a){var b,c,d,e,f,g,h,k,i,l,o,m,p,r,t,s,u,y,w,C,E,x,A,v,F,K,G,I,B,J;A=this.dataGroups(a);this.ndata={};if(typeof(b=this.opts.stacked)!=="undefined"&&b!==null)this.stackedNdata={};K=function(z,D,H){if(typeof z==="number")return D===H?1:(z-D)/(H-D);return null};b=function(z,D){var H,L,M;H=0;for(L=D.length;H<L;H++){M=D[H];if(!z(M))return false}return true};
E=function(z){var D,H,L;D=0;for(H=z.length;D<H;D++){L=z[D];if(typeof L==="number")return false}return true};for(c in A)if(n.call(A,c)){x=c;if(!(h=x.match("^__"))){if(!(h=Sai.util.sumArray(function(){d=[];f=A[x];e=0;for(g=f.length;e<g;e++){B=f[e];d.push(this.data[B].length)}return d}.call(this))===0)){v=b;F=E;h=[];i=A[x];k=0;for(l=i.length;k<l;k++){B=i[k];h.push(this.data[B])}h=v(F,h)}h=h}if(!h){this.ndata[x]={};if(typeof(o=this.opts.stacked)!=="undefined"&&o!==null){this.stackedNdata[x]={};C={}}h=
this.opts.stacked?q(function(z,D){return this.getStackedMin(z,D)},this):this.getMin;k=this.opts.stacked?q(function(z,D){return this.getStackedMax(z,D)},this):this.getMax;h=h(a,A[x]);F=k(a,A[x]);J=this.getYAxisVals(h,F);h=J[0];F=J[J.length-1];i=A[x];k=0;for(l=i.length;k<l;k++){B=i[k];if(typeof(m=a[B])!=="undefined"&&m!==null){G=this.ndata[x];w=B;p=[];r=a[B].length;for(v=0;0<=r?v<r:v>r;0<=r?v+=1:v-=1)p.push(typeof(t=a[B][v])!=="undefined"&&t!==null&&(I=K(a[B][v],h,F))!==null?[v/(a[B].length-1||1),I]:
null);G[w]=p;if(typeof(y=this.opts.stacked)!=="undefined"&&y!==null){G=K(0,h,F);this.stackedNdata[x][B]=[];p=a[B].length;for(v=0;0<=p?v<p:v>p;0<=p?v+=1:v-=1){r=typeof(s=a[B][v])!=="undefined"&&s!==null&&a[B][v]<0?0:1;C[v]=typeof C[v]!=="undefined"&&C[v]!==null?C[v]:[G,G];w=C[v][r];w=[v/(a[B].length-1||1),(typeof(u=K(a[B][v],h,F))!=="undefined"&&u!==null?u:G)+w-G];this.stackedNdata[x][B].push(w);if(w!==null)C[v][r]=w[1]}}this.ndata[x].__YVALS__=J}}}}return[]};Sai.Chart.prototype.addAxes=function(a,
b){var c,d,e,f,g,h,k,i,l,o,m;this.axisWidth=1.5;this.padding.top+=5;for(m=this.data[this.__LABELS__].length-1;this.data[this.__LABELS__].length-1<=0?m<=0:m>=0;this.data[this.__LABELS__].length-1<=0?m+=1:m-=1)if(typeof(c=this.data[this.__LABELS__][m])!=="undefined"&&c!==null){c=this.r.text(0,0,Sai.util.prettystr(this.data[this.__LABELS__][m]));this.padding.right+=c.getBBox().width/2;c.remove();break}m=this.h-(this.padding.bottom+this.padding.top);c=typeof(d=this.ndata[a[0]])!=="undefined"&&d!==null||
!(typeof(e=this.ndata[a[1]])!=="undefined"&&e!==null);d=typeof(f=this.ndata[a[1]])!=="undefined"&&f!==null;if(c){f=this.r.sai.prim.vaxis(typeof(g=this.ndata[a[0]]==null?undefined:this.ndata[a[0]].__YVALS__)!=="undefined"&&g!==null?g:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,m,{width:this.axisWidth,title:typeof b==="undefined"||b===null?undefined:b.left});g=f.items[0].getBBox().width;f.remove()}else g=0;if(d){f=this.r.sai.prim.vaxis(typeof(h=this.ndata[a[1]]==null?undefined:this.ndata[a[1]].__YVALS__)!==
"undefined"&&h!==null?h:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,m,{width:this.axisWidth,title:typeof b==="undefined"||b===null?undefined:b.right});h=f.getBBox().width;f.remove()}else h=0;this.haxis=this.r.sai.prim.haxis(this.data[this.__LABELS__],this.x+this.padding.left+g,this.y-this.padding.bottom,this.w-this.padding.left-this.padding.right-g-h,{width:this.axisWidth,title:typeof b==="undefined"||b===null?undefined:b.bottom});h=this.haxis.getBBox().height;if(isNaN(h))h=1;this.haxis.translate(0,
-h);this.padding.bottom+=h;m=this.h-(this.padding.bottom+this.padding.top);if(c){this.vaxis=this.r.sai.prim.vaxis(typeof(k=this.ndata[a[0]]==null?undefined:this.ndata[a[0]].__YVALS__)!=="undefined"&&k!==null?k:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,m,{width:this.axisWidth,title:typeof b==="undefined"||b===null?undefined:b.left});k=this.vaxis.items[0].getBBox().width;this.vaxis.translate(k,0);this.padding.left+=k}if(d){this.vaxis_right=this.r.sai.prim.vaxis(typeof(i=this.ndata[a[1]]==
null?undefined:this.ndata[a[1]].__YVALS__)!=="undefined"&&i!==null?i:[0,"?"],this.w-this.padding.right,this.y-this.padding.bottom,m,{width:this.axisWidth,right:true,title:typeof b==="undefined"||b===null?undefined:b.right,color:typeof(l=this.ndata[a[0]])!=="undefined"&&l!==null?typeof(o=this.colors.__RIGHTAXIS__)!=="undefined"&&o!==null?o:"blue":"black"});i=this.vaxis_right.items[0].getBBox().width;this.vaxis_right.translate(-i,0);this.padding.right+=i}this.setPlotCoords();return this.r.set().push(this.haxis).push(this.vaxis)};
Sai.Chart.prototype.setPlotCoords=function(){var a;this.px=this.x+this.padding.left;this.py=this.y-this.padding.bottom;this.pw=this.w-this.padding.left-this.padding.right;this.ph=this.h-this.padding.bottom-this.padding.top;a=this.legend==null?undefined:this.legend.getBBox();this.legend==null||this.legend.translate(this.px+this.pw/2-(a.x+a.width/2),0);a=this.histogramLegend==null?undefined:this.histogramLegend.getBBox();return this.histogramLegend==null?undefined:this.histogramLegend.translate(this.px+
this.pw/2-(a.x+a.width/2),0)};Sai.Chart.prototype.drawBG=function(){var a,b,c,d;return this.bg=this.r.rect(typeof(a=this.px)!=="undefined"&&a!==null&&this.px||this.x,typeof(b=this.py)!=="undefined"&&b!==null&&this.py-this.ph||this.y-this.h,typeof(c=this.pw)!=="undefined"&&c!==null&&this.pw||this.w,typeof(d=this.ph)!=="undefined"&&d!==null&&this.ph||this.h).attr({fill:this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack()};Sai.Chart.prototype.logoPos=function(){var a,b,c,d,e;e=typeof(a=this.px)!==
"undefined"&&a!==null&&typeof(b=this.pw)!=="undefined"&&b!==null?this.px+this.pw-160-5:this.w+this.x-160-this.padding.right;a=typeof(c=this.py)!=="undefined"&&c!==null&&typeof(d=this.ph)!=="undefined"&&d!==null?this.py-this.ph+5:this.y-this.h+this.padding.top;return[e,a,160,34]};Sai.Chart.prototype.drawLogo=function(){var a;a=this.logoPos();return this.logo=this.r.image(Sai.imagePath+"logo.png",a[0],a[1],a[2],a[3]).attr({opacity:0.25})};Sai.Chart.prototype.drawFootnote=function(a){var b;a=typeof a!==
"undefined"&&a!==null?a:typeof(b=this.opts.footnote)!=="undefined"&&b!==null?b:"";if(a.match(/^\s*$/))return null;this.footnote=this.r.sai.prim.wrappedText(this.x+this.padding.left,this.y-this.padding.bottom,this.w,a," ");a=this.footnote.getBBox().height;this.padding.bottom+=a+10;return this.footnote.translate(0,-a)};Sai.Chart.prototype.render=function(){var a;this.opts.simple&&typeof(a=this.renderPlots)!=="undefined"&&a!==null?this.renderPlots():this.renderFull();return this};Sai.Chart.prototype.renderFull=
function(){this.plot=typeof this.plot!=="undefined"&&this.plot!==null?this.plot:new Sai.Plot(this.r);this.plot.render();return this};Sai.Chart.prototype.showError=function(a){var b,c;return this.r.text(this.x+this.padding.left+(typeof(b=this.pw)!=="undefined"&&b!==null?b:this.w)/2,this.y-this.padding.bottom-(typeof(c=this.ph)!=="undefined"&&c!==null?c:this.h)/2,a)};Sai.Chart.prototype.setColors=function(a){var b,c;this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};for(b in a)if(n.call(a,
b)){c=this.renames[b];if(c in this.data)this.colors[c]=a[b]}return this};Sai.Chart.prototype.setColor=function(a,b){this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};this.colors[this.renames[a]]=b;return this};Sai.Chart.prototype.normalizedHeight=function(a,b){var c;if(!(typeof(c=this.ndata[b]==null?undefined:this.ndata[b].__YVALS__)!=="undefined"&&c!==null))return null;c=this.ndata[b].__YVALS__[0];if(!(a>c))return null;return(a-c)/(this.ndata[b].__YVALS__[this.ndata[b].__YVALS__.length-
1]-c)};Sai.Chart.prototype.drawGuideline=function(a,b){var c;b=typeof b!=="undefined"&&b!==null?b:"all";if(!(typeof(c=this.ndata[b]==null?undefined:this.ndata[b].__YVALS__)!=="undefined"&&c!==null))return null;c=this.normalizedHeight(a,b);this.guidelines=typeof this.guidelines!=="undefined"&&this.guidelines!==null?this.guidelines:this.r.set();c=new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,{guideline:[[0,c],[1,c]]});c.render({guideline:"#ccc"});return this.guidelines.push(c.set)};Sai.Chart.prototype.drawLegend=
function(a){var b,c,d,e,f,g,h,k;if(a=typeof a!=="undefined"&&a!==null?a:this.colors){d={};h={};b=a;for(k in b)if(n.call(b,k))if(k!==this.__LABELS__){d[k]=a[k];h[k]="black";if(typeof(g=this.opts.groups==null?undefined:this.opts.groups.right)!=="undefined"&&g!==null)if(function(){for(var i=0,l=(f=this.opts.groups.right).length;i<l;i++)if(f[i]===k)return true;return false}.call(this))h[k]=typeof(c=this.ndata.left)!=="undefined"&&c!==null?typeof(e=this.colors.__RIGHTAXIS__)!=="undefined"&&e!==null?e:
"blue":"black"}this.legend=this.r.sai.prim.legend(this.x,this.y-this.padding.bottom,this.w,d,h);a=this.legend.getBBox();if(this.legend.length>0)this.padding.bottom+=a.height+15;return this.legend.translate((this.w-a.width)/2,0)}};Sai.Chart.prototype.drawTitle=function(){var a;if(typeof(a=this.opts.title)!=="undefined"&&a!==null){this.title=this.r.text(this.x+this.w/2,this.y-this.h,this.opts.title).attr({"font-size":20});this.title.translate(0,this.title.getBBox().height/2);return this.padding.top+=
this.title.getBBox().height+5}};Sai.Chart.prototype.setupInfoSpace=function(){this.info_y=this.y-this.h+this.padding.top;this.info_x=this.x+this.padding.left;this.info_w=this.w-this.padding.left-this.padding.right;return this.padding.top+=30};Sai.Chart.prototype.drawInfo=function(a,b){var c,d,e;b=typeof b!=="undefined"&&b!==null?b:true;a=typeof a!=="undefined"&&a!==null?a:typeof(c=this.default_info)!=="undefined"&&c!==null?this.default_info():{};if(b)this.info_data={};this.info&&this.info.remove();
c=a;for(e in c)if(n.call(c,e))e.match("^__")||(this.info_data[e]=typeof(d=a[e])!=="undefined"&&d!==null?d:"(no data)");return this.info=this.r.sai.prim.info(this.info_x,this.info_y,this.info_w,this.info_data)};Sai.Chart.prototype.getIndex=function(a){a=Sai.util.transformCoords(a,this.r.canvas).x;return Math.round((this.data[this.__LABELS__].length-1)*(a-this.px)/this.pw)};Sai.Chart.prototype.drawHistogramLegend=function(a,b){var c,d,e,f,g,h,k,i,l,o,m,p,r;b=typeof b!=="undefined"&&b!==null?b:this.colors;
this.histogramLegend=this.r.set();l=Math.max(0.1*(this.h-this.padding.bottom-this.padding.top),50);p=Math.min(150,(this.w-this.padding.left-this.padding.right-20)/a.length);c=a.length;for(o=0;0<=c?o<c:o>c;0<=c?o+=1:o-=1){m=a[o];d=[];e=this.ndata[m][m].length;for(g=0;0<=e?g<e:g>e;0<=e?g+=1:g-=1)if(typeof(f=this.ndata[m][m][g])!=="undefined"&&f!==null)d.push(this.ndata[m][m][g][1]);d=d;if(typeof(h=this.bounds==null?undefined:this.bounds[m])!=="undefined"&&h!==null){g=this.bounds[m];e=g[0];g=g[1]}else{e=
[];k=this.data[m];g=0;for(i=k.length;g<i;g++){r=k[g];typeof r!=="undefined"&&r!==null&&e.push(r)}e=e;g=[Math.min.apply(Math,e),Math.max.apply(Math,e)];e=g[0];g=g[1]}g=this.getYAxisVals(e,g,true);e=g[0];k=g[g.length-1];g=b[m];this.histogramLegend.push(d=this.r.sai.prim.histogram(this.x+o*p,this.y-this.padding.bottom,p*0.8,l,d,e,k,m,typeof g==="object"?[g.__LOW__,g.__HIGH__]:[g],"white",this.opts.fromWhite));this.opts.interactive&&this.setupHistogramInteraction(d,m)}this.histogramLegend.translate((this.w-
this.padding.left-this.padding.right-this.histogramLegend.getBBox().width)/2,0);return this.padding.bottom+=l+5};Sai.Chart.prototype.setupHistogramInteraction=function(){return null};Sai.LineChart=function(){return Sai.Chart.apply(this,arguments)};j(Sai.LineChart,Sai.Chart);Sai.LineChart.prototype.nonNegativeGroups=function(){return this.opts.stacked?["all","left","right"]:[]};Sai.LineChart.prototype.dataGroups=function(){var a,b,c,d,e,f;f=Sai.LineChart.__super__.dataGroups.apply(this,arguments);
if(typeof(e=this.opts.groups==null?undefined:this.opts.groups.left)!=="undefined"&&e!==null&&typeof(a=this.opts.groups==null?undefined:this.opts.groups.right)!=="undefined"&&a!==null){a=[];c=this.opts.groups.left;b=0;for(d=c.length;b<d;b++){e=c[b];this.caresAbout(e)&&e in this.data&&a.push(e)}f.left=a;a=[];c=this.opts.groups.right;b=0;for(d=c.length;b<d;b++){e=c[b];this.caresAbout(e)&&e in this.data&&a.push(e)}f.right=a}return f};Sai.LineChart.prototype.renderPlots=function(){var a,b,c,d,e,f,g,h;
typeof(a=this.px)!=="undefined"&&a!==null||this.setPlotCoords();this.drawBG();this.drawLogo();h="right"in this.ndata;a=typeof(b=this.opts.stacked)!=="undefined"&&b!==null?this.stackedNdata:this.ndata;b=this.opts.area?Sai.AreaPlot:Sai.LinePlot;if(h){if((this.ndata.left==null?undefined:this.ndata.left.__YVALS__[0])<0)this.drawGuideline(0,"left");if((this.ndata.right==null?undefined:this.ndata.right.__YVALS__[0])<0)this.drawGuideline(0,"right")}else this.ndata.all.__YVALS__[0]<0&&this.drawGuideline(0,
"all");this.plots=[];if(h){if(typeof(d=a.left)!=="undefined"&&d!==null)this.plots.push((new b(this.r,this.px,this.py,this.pw,this.ph,a.left)).render(this.colors,typeof(c=this.opts.lineWidth)!=="undefined"&&c!==null?c:2,this.opts.stacked,this.normalizedHeight(0,"left")));return typeof(e=a.right)!=="undefined"&&e!==null?this.plots.push((new b(this.r,this.px,this.py,this.pw,this.ph,a.right)).render(this.colors,typeof(f=this.opts.lineWidth)!=="undefined"&&f!==null?f:2,this.opts.stacked,this.normalizedHeight(0,
"right"))):null}else return this.plots.push((new b(this.r,this.px,this.py,this.pw,this.ph,a.all)).render(this.colors,typeof(g=this.opts.lineWidth)!=="undefined"&&g!==null?g:2,this.opts.stacked,this.normalizedHeight(0,"all")))};Sai.LineChart.prototype.renderFull=function(){var a,b,c,d,e,f;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawLegend();"right"in this.ndata?this.addAxes(["left","right"]):this.addAxes(["all"]);this.renderPlots();this.plotSets=this.r.set();b=this.plots;a=
0;for(c=b.length;a<c;a++){e=b[a];this.plotSets.push(e.set)}this.dots=this.r.set();a=this.ndata.all;for(f in a)if(n.call(a,f))if(f!=="__YVALS__")this.dots.push(this.r.circle(0,0,4).attr({fill:typeof(d=this.colors==null?undefined:this.colors[f])!=="undefined"&&d!==null?d:"black"}).hide());d=this.r.set().push(this.bg,this.plotSets,this.dots,this.logo,this.guidelines).mousemove(q(function(g){var h,k,i,l,o,m,p,r,t,s,u;p=this.getIndex(g);r={};if((this.data[this.__LABELS__]==null?undefined:this.data[this.__LABELS__].length)>
p&&p>=0){r[this.__LABELS__]=this.data[this.__LABELS__][p];g=this.ndata.all;for(u in g)if(n.call(g,u))if(typeof(h=this.data[u])!=="undefined"&&h!==null)r[u]=this.data[u][p]}this.drawInfo(r);m=0;h=[];g=this.ndata.all;for(u in g)n.call(g,u)&&u!=="__YVALS__"&&h.push(function(){k=[];l=this.plots;i=0;for(o=l.length;i<o;i++){t=l[i];u in t.dndata&&k.push(function(){s=t.dndata[u][p];typeof s!=="undefined"&&s!==null?this.dots[m].attr({cx:s[0],cy:s[1]}).show().toFront():this.dots[m].hide();return m++}.call(this))}return k}.call(this));
return h},this)).mouseout(q(function(){this.drawInfo({},true);return this.dots.hide()},this));this.opts.href&&d.attr({href:this.opts.href,target:"_blank"});return this};Sai.Sparkline=function(){return Sai.Chart.apply(this,arguments)};j(Sai.Sparkline,Sai.Chart);Sai.Sparkline.prototype.dataGroups=function(){return{data:["data"]}};Sai.Sparkline.prototype.renderFull=function(){this.drawBG();this.plots=this.r.set();this.plots.push((new Sai.LinePlot(this.r,this.x,this.y,this.w,this.h,this.ndata.data)).render({data:this.colors&&
this.colors[series]||"black"},1).set);return this};Sai.BarChart=function(){return Sai.Chart.apply(this,arguments)};j(Sai.BarChart,Sai.Chart);Sai.BarChart.prototype.getMin=function(){return Math.min(Sai.BarChart.__super__.getMin.apply(this,arguments),0)};Sai.BarChart.prototype.groupsToNullPad=function(){var a,b,c;a=[];b=this.dataGroups();for(c in b)n.call(b,c)&&a.push(c);return a};Sai.BarChart.prototype.tooMuchData=function(){var a,b,c,d;c=this.w/3;b=0;a=this.data;for(d in a)if(n.call(a,d))if(d!==
this.__LABELS__){b+=this.data[d].length;if(this.opts.stacked)break}return b>c};Sai.BarChart.prototype.renderPlots=function(){var a,b,c,d,e,f,g;typeof(a=this.px)!=="undefined"&&a!==null||this.setPlotCoords();this.drawLogo();this.drawBG();if(this.tooMuchData()){this.showError("Sorry, the chart isn't wide enough to plot this much data.\n \nPossible solutions include downsampling your data\n (e.g. weekly instead of daily) or using a line chart");return this}if("all"in this.ndata){this.guidelines=this.r.set();
b=this.ndata.all.__YVALS__.slice(1,this.ndata.all.__YVALS__.length-1);a=0;for(c=b.length;a<c;a++){g=b[a];this.drawGuideline(g)}}this.plots=this.r.set();a={};c={};c[this.__LABELS__]=this.data[this.__LABELS__];b=typeof(d=this.opts.stacked)!=="undefined"&&d!==null?this.stackedNdata:this.ndata;d=b.all;for(f in d)if(n.call(d,f))if(!(f.match("^__")||f===this.__LABELS__)){a[f]=b.all[f];c[f]=this.data[f]}return this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph,a,c)).render(typeof(e=
this.opts.stacked)!=="undefined"&&e!==null,this.normalizedHeight(0,"all"),this.colors,this.opts.interactive&&!this.opts.simple,this.drawInfo).set)};Sai.BarChart.prototype.renderFull=function(){var a;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawLegend();this.addAxes(["all"]);this.renderPlots();a=this.r.set().push(this.plots,this.bg,this.logo,this.guidelines);this.opts.href&&a.attr({href:this.opts.href,target:"_blank"});return this};Sai.StockChart=function(){return Sai.Chart.apply(this,
arguments)};j(Sai.StockChart,Sai.Chart);Sai.StockChart.prototype.semanticRenamePatterns={open:/^open$/i,close:/^close$/i,high:/^high$/i,low:/^low$/i,volume:/^vol(ume)?$/i};Sai.StockChart.prototype.groupsToNullPad=function(){return["prices","volume","__META__"]};Sai.StockChart.prototype.dataGroups=function(a){var b,c,d,e;c={__META__:[this.__LABELS__]};e=typeof(b=this.semanticRenames.volume)!=="undefined"&&b!==null?b:"volume";if(e in this.data)c.volume=[e];for(d in a)if(n.call(a,d))if(this.caresAbout(d)&&
!(this.__LABELS__===d||e===d)){c.prices=typeof c.prices!=="undefined"&&c.prices!==null?c.prices:[];c.prices.push(d)}return c};Sai.StockChart.prototype.nonNegativeGroups=function(){return["volume"]};Sai.StockChart.prototype.renderPlots=function(){var a,b,c,d,e,f,g,h,k,i,l;typeof(a=this.px)!=="undefined"&&a!==null||this.setPlotCoords();a=typeof(b=this.semanticRenames.open)!=="undefined"&&b!==null?b:"open";b=typeof(c=this.semanticRenames.close)!=="undefined"&&c!==null?c:"close";c=typeof(d=this.semanticRenames.high)!==
"undefined"&&d!==null?d:"high";d=typeof(e=this.semanticRenames.low)!=="undefined"&&e!==null?e:"low";e=typeof(f=this.semanticRenames.volume)!=="undefined"&&f!==null?f:"volume";this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};this.colors.up=typeof this.colors.up!=="undefined"&&this.colors.up!==null?this.colors.up:"black";this.colors.down=typeof this.colors.down!=="undefined"&&this.colors.down!==null?this.colors.down:"red";this.colors.vol_up=typeof this.colors.vol_up!==
"undefined"&&this.colors.vol_up!==null?this.colors.vol_up:"#666666";this.colors.vol_down=typeof this.colors.vol_down!=="undefined"&&this.colors.vol_down!==null?this.colors.vol_down:"#cc6666";this.drawLogo();this.drawBG();if(!(typeof(g=this.ndata.prices)!=="undefined"&&g!==null&&a in this.ndata.prices&&b in this.ndata.prices&&c in this.ndata.prices&&d in this.ndata.prices)){this.showError("This chart requires data series named\nopen, close, high, and low.\n \nOnce you add series with these names, the chart will display.");
return null}this.ndata.prices.__YVALS__[0]<0&&this.drawGuideline(0,"prices");this.plots=this.r.set();g={up:[],down:[]};f={};h=this.ndata.prices;for(i in h)if(n.call(h,i))i.match("^__")||i===this.__LABELS__||(f[i]=this.data[i]);if(typeof(k=this.data[e])!=="undefined"&&k!==null)f.vol=this.data[e];if("volume"in this.ndata){k=this.ndata.volume[e].length;for(i=0;0<=k?i<k:i>k;0<=k?i+=1:i-=1)if(this.ndata.volume[e][i]!==null)if(i&&this.ndata.prices[b][i-1]&&this.ndata.prices[b][i][1]<this.ndata.prices[b][i-
1][1]){g.down.push(this.ndata.volume[e][i]);g.up.push([this.ndata.volume[e][i][0],0])}else{g.up.push(this.ndata.volume[e][i]);g.down.push([this.ndata.volume[e][i][0],0])}else{g.up.push([0,0]);g.down.push([0,0])}this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph*0.2,g,f)).render(true,this.normalizedHeight(0,e),{up:this.colors.vol_up,down:this.colors.vol_down}).set)}this.plots.push((new Sai.CandlestickPlot(this.r,this.px,this.py,this.pw,this.ph,{open:this.ndata.prices[a],close:this.ndata.prices[b],
high:this.ndata.prices[c],low:this.ndata.prices[d]},f)).render(this.colors,Math.min(5,this.pw/this.ndata.prices[a].length-2)).set);i={};k=this.ndata.prices;for(l in k)if(n.call(k,l))a===l||b===l||c===l||d===l||l.match("^__")||l===this.__LABELS__||(i[l]=this.ndata.prices[l]);return this.plots.push((new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,i)).render(this.colors).set)};Sai.StockChart.prototype.renderFull=function(){var a,b,c,d,e,f,g,h,k,i;this.drawTitle();this.setupInfoSpace();this.drawFootnote();
g=typeof(a=this.semanticRenames.open)!=="undefined"&&a!==null?a:"open";a=typeof(b=this.semanticRenames.close)!=="undefined"&&b!==null?b:"close";b=typeof(c=this.semanticRenames.high)!=="undefined"&&c!==null?c:"high";c=typeof(d=this.semanticRenames.low)!=="undefined"&&d!==null?d:"low";i=typeof(e=this.semanticRenames.volume)!=="undefined"&&e!==null?e:"volume";e={};k=false;d=this.ndata.prices;for(h in d)if(n.call(d,h))if(!(g===h||a===h||b===h||c===h)&&!(h.match("^__")||h===this.__LABELS__)){e[h]=(this.colors==
null?undefined:this.colors[h])||"black";k=true}k&&this.drawLegend(e);this.addAxes(["prices"]);this.renderPlots();f=this.pw/(this.data[this.__LABELS__].length-1);this.glow=this.r.rect(this.px-f/2,this.py-this.ph,f,this.ph).attr({fill:"0-"+this.opts.bgcolor+"-#DDAA99-"+this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack().hide();this.bg.toBack();this.r.set().push(this.bg,this.plots,this.logo,this.glow,this.guidelines).mousemove(q(function(l){var o,m,p,r,t,s;l=this.getIndex(l);r={};if(typeof(o=
this.data[this.__LABELS__][l])!=="undefined"&&o!==null)r[this.__LABELS__]=this.data[this.__LABELS__][l];t=false;o=this.ndata.prices;for(s in o)if(n.call(o,s))if(!(s.match("^__")||s===this.__LABELS__))if(typeof(m=this.data[s]==null?undefined:this.data[s][l])!=="undefined"&&m!==null){r[s]=this.data[s][l];t=true}if(typeof(p=this.data[i]==null?undefined:this.data[i][l])!=="undefined"&&p!==null){r[i]=this.data[i][l];t=true}this.drawInfo(r);return t?this.glow.attr({x:this.px+f*(l-0.5)}).show():null},this)).mouseout(q(function(){this.drawInfo({},
true);return this.glow.hide()},this));return this};Sai.GeoChart=function(){var a;a=this;this.renderPlots=function(){return Sai.GeoChart.prototype.renderPlots.apply(a,arguments)};return Sai.Chart.apply(this,arguments)};j(Sai.GeoChart,Sai.Chart);Sai.GeoChart.prototype.plotType=Sai.GeoPlot;Sai.GeoChart.prototype.interactiveHistogram=true;Sai.GeoChart.prototype.getMax=function(a){return Math.max.apply(Math,a)};Sai.GeoChart.prototype.getMin=function(a){return Math.min.apply(Math,a)};Sai.GeoChart.prototype.normalize=
function(a){var b,c,d,e,f,g,h,k,i,l,o,m,p;this.ndata={};this.bounds={};i={};l={};for(p in a)if(n.call(a,p))if(!(p.match("^__")||p===this.__LABELS__))if(typeof(b=a[p])!=="undefined"&&b!==null){c=[];e=a[p];d=0;for(f=e.length;d<f;d++){k=e[d];typeof k!=="undefined"&&k!==null&&c.push(k)}c=c;i[p]=this.getMax(c,p);if(!(typeof o!=="undefined"&&o!==null)||i[p]>o)o=i[p];l[p]=this.getMin(c,p);if(!(typeof m!=="undefined"&&m!==null)||l[p]<m)m=l[p]}for(p in a)if(n.call(a,p))if(!(p.match("^__")||p===this.__LABELS__))if(typeof(g=
a[p])!=="undefined"&&g!==null){if(this.opts.groupedNormalization){e=o;f=m}else{e=i[p];f=l[p]}this.bounds[p]=[f,e];this.ndata[p]={};k=this.ndata[p];var r=p;b=[];c=a[p].length;for(d=0;0<=c?d<c:d>c;0<=c?d+=1:d-=1)b.push(typeof(h=a[p][d])!=="undefined"&&h!==null?[d/(a[p].length-1),(a[p][d]-f)/(e-f)]:null);k[r]=b}return[]};Sai.GeoChart.prototype.dataGroups=function(a){var b,c;b=[];for(c in a)if(n.call(a,c))if(c.match("^__")||c===this.__LABELS__)b.push(c);b={__META__:b};for(c in a)if(n.call(a,c))c.match("^__")||
c===this.__LABELS__||(b[c]=[c]);return b};Sai.GeoChart.prototype.setupHistogramInteraction=function(a,b){return a.click(q(function(){return this.renderPlots(b)},this)).hover(q(function(c){return q(function(){c.attr({"fill-opacity":0.75});return this.drawInfo({"Click to display on map":b})},this)},this)(a),q(function(c){return q(function(){c.attr({"fill-opacity":1});return this.drawInfo()},this)},this)(a))};Sai.GeoChart.prototype.renderPlots=function(a){var b,c,d;typeof(b=this.px)!=="undefined"&&b!==
null||this.setPlotCoords();this.bg==null||this.bg.remove();this.logo==null||this.logo.remove();this.geoPlot==null||this.geoPlot.set.remove();this.drawBG();this.drawLogo();c={};b=this.ndata;for(d in b)if(n.call(b,d))c[d]=this.ndata[d][d];this.geoPlot=(new this.plotType(this.r,this.px,this.py,this.pw,this.ph,c,this.data,{fromWhite:this.opts.fromWhite})).render(this.colors||{},this.data.__MAP__,this.__LABELS__,typeof a!=="undefined"&&a!==null?a:this.data.__DEFAULT__,this.opts.bgcolor,this.opts.interactive&&
!this.opts.simple,this.drawInfo);return this};Sai.GeoChart.prototype.default_info=function(){return{"":this.opts.interactive?"Click histogram below to change map display":""}};Sai.GeoChart.prototype.renderFull=function(){var a,b,c,d;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawHistogramLegend(function(){a=[];b=this.data;for(d in b)if(n.call(b,d))d.match("^__")||d===this.__LABELS__||a.push(d);return a}.call(this));this.setPlotCoords();this.drawInfo();this.renderPlots();c=this.r.set().push(this.geoPlot.set,
this.bg,this.logo,this.info,this.footnote);this.opts.href&&c.attr({href:this.opts.href,target:"_blank"});return this};Sai.ChromaticGeoChart=function(){return Sai.GeoChart.apply(this,arguments)};j(Sai.ChromaticGeoChart,Sai.GeoChart);Sai.ChromaticGeoChart.prototype.plotType=Sai.ChromaticGeoPlot;Sai.ChromaticGeoChart.prototype.interactiveHistogram=false;Sai.ChromaticGeoChart.prototype.default_info=function(){return{}};Sai.ChromaticGeoChart.prototype.setupHistogramInteraction=function(){return false};
Sai.ScatterChart=function(){return Sai.Chart.apply(this,arguments)};j(Sai.ScatterChart,Sai.Chart);Sai.ScatterChart.prototype.dataGroups=function(a){var b,c;b=[];for(c in a)if(n.call(a,c))if(c.match("^__")||c===this.__LABELS__)b.push(c);b={__META__:b};for(c in a)if(n.call(a,c))c.match("^__")||c===this.__LABELS__||(b[c]=[c]);return b};Sai.ScatterChart.prototype.renderPlots=function(){var a,b,c,d,e,f,g;typeof(a=this.px)!=="undefined"&&a!==null||this.setPlotCoords();a=typeof(b=this.opts.colors)!=="undefined"&&
b!==null?b:typeof(c=this.colors)!=="undefined"&&c!==null?c:["black","white"];b=typeof(d=this.opts.stroke_opacity)!=="undefined"&&d!==null?d:[0,1];d=typeof(e=this.opts.stroke_colors)!=="undefined"&&e!==null?e:["black","black"];e=typeof(f=this.opts.radius)!=="undefined"&&f!==null?f:[4,12];this.drawLogo();this.drawBG();c={};f=this.ndata;for(g in f)if(n.call(f,g))c[g]=this.ndata[g][g];this.plots=this.r.set();this.plots.push((new Sai.ScatterPlot(this.r,this.px,this.py,this.pw,this.ph,c,this.data)).render(this.opts.mappings,
a,e,b,d,this.opts.interactive&&!this.opts.simple,this.drawInfo).set);return this};Sai.ScatterChart.prototype.renderFull=function(){var a,b,c,d,e,f,g;this.drawTitle();this.setupInfoSpace();this.drawFootnote();e=typeof(a=this.opts.colors)!=="undefined"&&a!==null?a:typeof(b=this.colors)!=="undefined"&&b!==null?b:["black","white"];a=typeof(c=this.opts.stroke_colors)!=="undefined"&&c!==null?c:["black","black"];b=[];c={};if(e instanceof Array){b.push(this.opts.mappings.color);c[this.opts.mappings.color]=
{__LOW__:e[0],__HIGH__:e[1]}}else{g=typeof g!=="undefined"&&g!==null?g:{};f=true;for(d in e)if(n.call(e,d))g[d]=e[d]}if(a instanceof Array){b.push(this.opts.mappings.stroke_color);c[this.opts.mappings.stroke_color]={__LOW__:a[0],__HIGH__:a[1]}}else{g=typeof g!=="undefined"&&g!==null?g:{};f=true;for(d in e)if(n.call(e,d))g[d]=a[d]}b.length&&this.drawHistogramLegend(b,c);f&&this.drawLegend(e);this.__LABELS__="__XVALS__";this.data.__XVALS__=this.ndata[this.opts.mappings.x].__YVALS__;this.addAxes([this.opts.mappings.y],
{left:this.opts.mappings.y,bottom:this.opts.mappings.x});this.renderPlots();d=this.r.set().push(this.plots,this.bg,this.logo,this.info,this.footnote,this.histogramLegend,this.legend);this.opts.href&&d.attr({href:this.opts.href,target:"_blank"});return this}})();
