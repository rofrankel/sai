Sai={};Sai.util={};Sai.imagePath=typeof Sai.imagePath!=="undefined"&&Sai.imagePath!==null?Sai.imagePath:"/static/images/sai/";Sai.util.roundToMag=function(n,p){var g;p=typeof p!=="undefined"&&p!==null?p:0;g=Math.pow(10,p);return parseFloat((Math.round(n/g)*g).toFixed(Math.max(0,p)))};Sai.util.round=function(n,p){return parseFloat((Math.round(n/p)*p).toFixed(Math.max(0,Math.ceil(-1*Math.log(p)/Math.LN10))))};
Sai.util.sumArray=function(n){var p,g,a;a=0;p=n.length;for(g=0;0<=p?g<p:g>p;0<=p?g+=1:g-=1)a+=typeof n[g]==="number"?n[g]:0;return a};Sai.util.prettystr=function(n,p){var g;p=typeof p!=="undefined"&&p!==null?p:2;if(typeof n==="number"){if(Math.abs(n)>=1E12){g="t";n/=1E12}else if(Math.abs(n)>=1E9){g="b";n/=1E9}else if(Math.abs(n)>=1E6){g="m";n/=1E6}else if(Math.abs(n)>=1E3){g="k";n/=1E3}else return String(parseFloat(n.toFixed(p)));return parseFloat(n.toFixed(1))+g}return n};
Sai.util.prettynum=function(n){var p;if(!(isNaN(parseFloat(n))||!String(n).match(/^[-+]?\d+(\.\d+)?$/))){n=String(n).split(".");for(p=/(\d+)(\d{3})/;p.test(n[0]);)n[0]=n[0].replace(p,"$1,$2");return n[0]+(n.length>1?parseFloat("0."+n[1]).toFixed(2).slice(1):"")}};Sai.util.infoSetters=function(n,p){return[function(){return n(p)},function(){return n()}]};
Sai.util.transformCoords=function(n,p){var g;if(p.getScreenCTM){g=p.createSVGPoint();g.x=n.clientX;g.y=n.clientY;g=g.matrixTransform(p.getScreenCTM().inverse());if(navigator.userAgent.toLowerCase().indexOf("chrome")!==-1||navigator.userAgent.toLowerCase().indexOf("safari")!==-1)g.x+=document.body.scrollLeft;return{x:g.x,y:g.y}}else return{x:n.x,y:n.y}};
Sai.util.multiplyColor=function(n,p,g,a){a=typeof a!=="undefined"&&a!==null?a:0;p=a+(1-a)*p;a=Raphael.getRGB(n);if(g){n=a.r+(255-a.r)*(1-p);g=a.g+(255-a.g)*(1-p);p=a.b+(255-a.b)*(1-p)}else{n=a.r*p;g=a.g*p;p=a.b*p}return{r:n,g:g,b:p,str:"rgb("+n+", "+g+", "+p+")"}};Sai.util.colerp=function(n,p,g){n=Raphael.getRGB(n);p=Raphael.getRGB(p);return"rgb("+(n.r*g+p.r*(1-g))+", "+(n.g*g+p.g*(1-g))+", "+(n.b*g+p.b*(1-g))+")"};
Sai.util.reflectColor=function(n,p){var g,a,b,c,e,f,d,h,i;f=Raphael.getRGB(n);h=Raphael.getRGB(p);i={};a=["r","g","b"];g=0;for(b=a.length;g<b;g++){e=a[g];c=f[e];d=h[e];i[e]=c===d?c:c>d?d*((255-c)/(255-d)):(255*(d-c)+d*c)/d}return"rgb("+i.r+", "+i.g+", "+i.b+")"};Sai.data=typeof Sai.data!=="undefined"&&Sai.data!==null?Sai.data:{};Sai.data.map=typeof Sai.data.map!=="undefined"&&Sai.data.map!==null?Sai.data.map:{};
Raphael.fn.sai=typeof Raphael.fn.sai!=="undefined"&&Raphael.fn.sai!==null?Raphael.fn.sai:{};Raphael.fn.sai.chart=function(n,p,g,a,b,c){b=typeof{line:Sai.LineChart}[b]!=="undefined"&&{line:Sai.LineChart}[b]!==null?{line:Sai.LineChart}[b]:b;b=typeof b!=="undefined"&&b!==null?b:Sai.Chart;return(new b(this,n,p,g,a,c)).render()};(function(){var n,p=Object.prototype.hasOwnProperty;Raphael.fn.sai.prim=typeof Raphael.fn.sai.prim!=="undefined"&&Raphael.fn.sai.prim!==null?Raphael.fn.sai.prim:{};n=function(g,a,b,c){return[function(){g.attr(a);return c?c[0](g):null},function(){g.attr(b);return c?c[1](g):null}]};Raphael.fn.sai.prim.candlestick=function(g,a,b,c,e,f,d,h,i,j,m){d=typeof d!=="undefined"&&d!==null?d:"#000000";f%2||f++;f=this.rect(g-f/2,a,f,b-a||1).attr("stroke",d);c=this.path("M"+g+" "+c+"L"+g+" "+a+"M"+g+" "+b+"L"+g+
" "+e).attr("stroke",d);f.attr("fill",h?d:"#ffffff");d=this.set().push(f,c);if(i){g=n(d,{scale:"1.5,1.5,"+g+","+(a+(b-a)/2),"fill-opacity":0.5},{scale:"1.0,1.0,"+g+","+(a+(b-a)/2),"fill-opacity":1},m);d.hover(g[0],g[1])}return d};Raphael.fn.sai.prim.line=function(g,a,b){var c,e,f,d;a=typeof a!=="undefined"&&a!==null?a:"#000000";b=typeof b!=="undefined"&&b!==null?b:1;c=0;for(e=g.length;c<e;c++){f=g[c];if(typeof f!=="undefined"&&f!==null)if(typeof d!=="undefined"&&d!==null)d+="L"+f[0]+" "+f[1];else d=
"M"+f[0]+" "+f[1]}return this.path(d).attr({stroke:a,"stroke-width":b})};Raphael.fn.sai.prim.area=function(g,a,b,c){var e,f,d,h,i;if(g.length<2)return this.set();a=typeof a!=="undefined"&&a!==null?a:"#000000";b=typeof b!=="undefined"&&b!==null?b:1;e=0;for(f=g.length;e<f;e++){h=g[e];if(typeof h!=="undefined"&&h!==null)if(typeof i!=="undefined"&&i!==null){i+="L"+h[0]+" "+h[1];d+="L"+h[0]+" "+h[1]}else{i="M"+h[0]+" "+h[1];d="M"+h[0]+" "+h[1]}}for(g=c.length-1;c.length-1<=0?g<=0:g>=0;g+=-1)d+="L"+c[g][0]+
","+c[g][1];c=this.path(d).attr({fill:a,"stroke-width":0,"stroke-opacity":0,"fill-opacity":0.35});a=this.path(i).attr({stroke:a,"stroke-width":b});return this.set().push(c,a)};Raphael.fn.sai.prim.stackedBar=function(g,a,b,c,e,f,d){var h,i,j,m,k,l,o,q;if(e&&typeof(h=g[g.length-1])!=="undefined"&&h!==null)q=c-g[g.length-1][1];b*=0.67;o=this.set();m=c;i=g.length;for(h=0;0<=i?h<i:h>i;0<=i?h+=1:h-=1){l=h;if(typeof(j=g[l])!=="undefined"&&j!==null&&g[l][1]!==c){k=m-g[l][1];m=l===0?1:0;o.push(m=this.rect(g[l][0]-
b/2,g[l][1],b,k-m).attr("fill",(typeof a==="undefined"||a===null?undefined:a[l])||"#000000").attr("stroke",(typeof a==="undefined"||a===null?undefined:a[l])||"#000000"));if(e){k=n(m,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},[function(r){return function(){d[0]&&d[0]();return f({"(selected)":Sai.util.prettystr(r)+"%"},false)}}(100*k/q),d[1]]);m.hover(k[0],k[1])}m=g[l][1]}}return o};Raphael.fn.sai.prim.groupedBar=function(g,a,b,c,e,f,d){var h,i,j,m,k,l;f=this.set();i=b/(g.length+1);l=(b-i)/2;b=
g.length;for(k=0;0<=b?k<b:k>b;0<=b?k+=1:k-=1)if(typeof(h=g[k]==null?undefined:g[k][0])!=="undefined"&&h!==null){j=Math.min(g[k][1],c);m=Math.max(g[k][1],c)-j-0.5;f.push(this.rect(g[k][0]-l+k*i,j,i-1,m).attr("fill",(typeof a==="undefined"||a===null?undefined:a[k])||"#000000").attr("stroke",(typeof a==="undefined"||a===null?undefined:a[k])||"#000000"))}if(e){g=n(f,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},d);f.hover(g[0],g[1])}return f};Raphael.fn.sai.prim.haxis=function(g,a,b,c,e,f,d){var h,i,
j,m,k,l,o,q,r,u,x,v;d=typeof d!=="undefined"&&d!==null?d:[5,2];e=typeof e!=="undefined"&&e!==null?e:1;f=typeof f!=="undefined"&&f!==null?f:"black";j=this.path("M"+a+" "+b+"l"+c+" 0").attr("stroke",f);u=this.set();i=this.set();q=c/20;q=q<g.length?Math.ceil(g.length/q):1;l=c/(g.length-1)*q;v=a;x=-1;r=false;c=0;h=g.length;for(o=0;0<=h?o<h:o>h;o+=q){m=g[o];if(typeof m!=="undefined"&&m!==null){k=d[String(m)?0:1];u.push(this.path("M"+v+" "+b+"l0 "+k).attr("stroke",f));if(m!==""){k=this.text(v,b+k+2,Sai.util.prettystr(m));
m=k.getBBox();k.attr("y",k.attr("y")+m.height/2);i.push(k);k=m.width;c=Math.max(k,c);if(m.x<=x)r=true;if(m.x+k>x)x=m.x+k}}v+=l}g=this.set().push(j,u,i);if(r){f=i.items;i=0;for(j=f.length;i<j;i++){k=f[i];k.rotate(-90);k.translate(0,k.getBBox().width/2-2)}g.push(this.rect(a,b,1,e+c+d[0]).attr("opacity","0"))}return g};Raphael.fn.sai.prim.vaxis=function(g,a,b,c,e,f,d,h){var i,j,m,k,l,o;h=typeof h!=="undefined"&&h!==null?h:[0,0];d=typeof d!=="undefined"&&d!==null?d:"#000000";f=typeof f!=="undefined"&&
f!==null?f:false;m=this.path("M"+a+" "+b+"l0 "+-c).attr("stroke",d);k=this.set();e=this.set();c=c/(g.length-1);o=b;b=0;for(i=g.length;b<i;b++){l=g[b];if(l!==null){j=h[String(l)?0:1];k.push(this.path("M"+a+" "+o+"l"+(f?j:-j)+" 0").attr("stroke",d));j=this.text(a+(f?1:-1)*(j+2),o,Sai.util.prettystr(l));j.attr({x:j.attr("x")+(f?1:-1)*(j.getBBox().width/2+3),fill:d});e.push(j)}o-=c}return this.set().push(m,k,e)};Raphael.fn.sai.prim.popup=function(g,a,b){var c,e,f,d,h,i;this.set();i=this.set();e=0;f=a+
5+5;if("__HEAD__"in b){c=this.text(g,f,b.__HEAD__).attr({fill:"#cfc","font-size":"12","font-weight":"bold"});e=Math.max(e,c.getBBox().width);i.push(c);f+=17}for(h in b)if(p.call(b,h))if(h!=="__HEAD__"){d=this.text(g+5,f,h+" = "+b[h]).attr({fill:"white","font-weight":"bold"});d.translate(d.getBBox().width/2,0);e=Math.max(e,d.getBBox().width);f+=10;i.push(d)}b=e+10;this.rect(g,a,b,f-a,5).attr({fill:"black","fill-opacity":".85",stroke:"black"});typeof c==="undefined"||c===null||c.translate(b/2);return i.toFront()};
Raphael.fn.sai.prim.legend=function(g,a,b,c,e){var f,d,h,i,j,m,k,l,o;a-=14;k=this.set();j=g;m=a;for(o in c)if(p.call(c,o)){l=this.text(j+14,m,o).attr({fill:typeof(f=typeof e==="undefined"||e===null?undefined:e[o])!=="undefined"&&f!==null?f:"black"});l.translate(l.getBBox().width/2,l.getBBox().height/2);i=this.rect(j,m,9,9).attr({fill:typeof(d=c[o])!=="undefined"&&d!==null?d:"black",stroke:typeof(h=typeof e==="undefined"||e===null?undefined:e[o])!=="undefined"&&h!==null?h:"black"});i=this.set().push(l,
i);if(j-g+15+i.getBBox().width>b){k.translate(0,-14);i.translate(g-j,a-m);j=g;m=a}j+=i.getBBox().width+15;k.push(i)}return k};Raphael.fn.sai.prim.info=function(g,a,b,c){var e,f,d,h,i,j;h=this.set();d=g;a=a;for(f in c)if(p.call(c,f))if(c[f]!==null){i=f+(f===""?"":": ");i+=typeof c[f]==="string"?c[f]:typeof(e=Sai.util.prettynum(c[f]))!=="undefined"&&e!==null?e:Sai.util.prettystr(c[f]);i=this.text(d,a,i);j=i.getBBox();i.translate(j.width/2,j.height/2);if(d-g+15+j.width>b){i.translate(g-d,14);d=g;a+=
14}d+=j.width+15;h.push(i)}return h};Raphael.fn.sai.prim.hoverShape=function(g,a,b,c){g=g(this).attr(a);b=n(g,c&&c[0]||{},c&&c[1]||{},b);g.mouseover(b[0]);g.mouseout(b[1]);return g};Raphael.fn.sai.prim.histogram=function(g,a,b,c,e,f,d,h,i,j,m,k){var l,o,q,r;j=typeof j!=="undefined"&&j!==null?j:"white";i=typeof i!=="undefined"&&i!==null?i:"black";k=typeof k!=="undefined"&&k!==null?k:10;r=this.set();r.push(this.rect(g,a-c,b,c).attr({"stroke-width":0,"stroke-opacity":0,fill:j}));c=a-(c-12);a-=5;f=typeof f!==
"undefined"&&f!==null?f:0;d=typeof d!=="undefined"&&d!==null?d:1;r.push(f=this.text(g,a,Sai.util.prettystr(f)));f.translate(f.getBBox().width/2,0);r.push(d=this.text(g+b,a,Sai.util.prettystr(d)));d.translate(-d.getBBox().width/2,0);a-=7;d={};j=f=0;for(l=e.length;j<l;j++){q=e[j];q=Math.min(k-1,Math.floor(k*q/1));if(q in d)d[q]+=1;else d[q]=1;f=Math.max(f,d[q])}r.push(this.path("M"+g+","+a+" l"+b+", 0").attr("stroke",i));a-=1;j=b/k;for(o in d)if(p.call(d,o)){e=(a-c)*(d[o]/f);r.push(this.rect(g+(parseInt(o)+
0.2)*j,a-e,j*0.6,e).attr({fill:Sai.util.multiplyColor(i,(parseInt(o)+0.5)/k,m,0.2).str,"stroke-width":m?0.35:0,"stroke-opacity":m?1:0,stroke:"#000000"}))}r.push(this.text(g+b/2,c-6,Sai.util.prettystr(h)));return r}})();(function(){var n=Object.prototype.hasOwnProperty,p=function(g,a){var b=function(){};b.prototype=a.prototype;g.prototype=new b;g.prototype.constructor=g;typeof a.extended==="function"&&a.extended(g);g.__super__=a.prototype};Sai.Plot=function(g,a,b,c,e,f,d,h){this.opts=h;this.rawdata=d;this.data=f;this.h=e;this.w=c;this.y=b;this.x=a;this.r=g;this.opts=typeof this.opts!=="undefined"&&this.opts!==null?this.opts:{};this.setDenormalizedData();this.set=this.r.set();return this};Sai.Plot.prototype.setDenormalizedData=
function(){var g,a,b,c,e,f,d,h,i,j;if(this.data instanceof Array){g=[];b=this.data;a=0;for(c=b.length;a<c;a++){i=b[a];g.push(this.denormalize(i))}return this.dndata=g}else{this.dndata=typeof this.dndata!=="undefined"&&this.dndata!==null?this.dndata:{};g=[];a=this.data;for(j in a)if(n.call(a,j))g.push(this.dndata[j]=function(){e=[];d=this.data[j];f=0;for(h=d.length;f<h;f++){i=d[f];e.push(this.denormalize(i))}return e}.call(this));return g}};Sai.Plot.prototype.denormalize=function(g){if(g instanceof
Array)return[this.x+this.w*g[0],this.y-this.h*g[1]]};Sai.Plot.prototype.render=function(){this.set.push(this.r.rect(20,20,20,20).attr("fill","red"),this.r.circle(40,40,10).attr("fill","blue"));return this};Sai.LinePlot=function(){return Sai.Plot.apply(this,arguments)};p(Sai.LinePlot,Sai.Plot);Sai.LinePlot.prototype.setDenormalizedData=function(){var g,a,b;Sai.LinePlot.__super__.setDenormalizedData.apply(this,arguments);g=[];a=this.dndata;for(b in a)if(n.call(a,b))g.push(this.dndata[b].length===1&&
(this.dndata[b]==null?undefined:this.dndata[b][0]==null?undefined:this.dndata[b][0][0])===this.x?this.dndata[b].push([this.x+this.w,this.dndata[b][0][1]]):null);return g};Sai.LinePlot.prototype.render=function(g,a){var b,c;this.set.remove();b=this.dndata;for(c in b)if(n.call(b,c))c.match("^__")||this.set.push(this.r.sai.prim.line(this.dndata[c],(typeof g==="undefined"||g===null?undefined:g[c])||"black",a||1));return this};Sai.AreaPlot=function(){return Sai.LinePlot.apply(this,arguments)};p(Sai.AreaPlot,
Sai.LinePlot);Sai.AreaPlot.prototype.render=function(g,a,b,c){var e,f,d,h,i,j,m,k,l;this.set.remove();j=[this.denormalize([0,c]),this.denormalize([1,c])];c=this.dndata;for(l in c)if(n.call(c,l))if(!l.match("^__")){e=this.dndata[l].length;for(d=0;0<=e?d<e:d>e;0<=e?d+=1:d-=1){m=this.dndata[l][d];if(typeof m!=="undefined"&&m!==null)break}for(d=this.dndata[l].length-1;this.dndata[l].length-1<=0?d<=0:d>=0;this.dndata[l].length-1<=0?d+=1:d-=1){k=this.dndata[l][d];if(typeof k!=="undefined"&&k!==null)break}typeof f!==
"undefined"&&f!==null&&b||(f=[[m[0],j[0][1]],[k[0],j[1][1]]]);this.set.push(this.r.sai.prim.area(this.dndata[l],(typeof g==="undefined"||g===null?undefined:g[l])||"black",a||1,f));if(b){f=[];d=this.dndata[l];e=0;for(h=d.length;e<h;e++){i=d[e];f.push([i[0],i[1]-a/2])}f=f}}return this};Sai.CandlestickPlot=function(){return Sai.Plot.apply(this,arguments)};p(Sai.CandlestickPlot,Sai.Plot);Sai.CandlestickPlot.prototype.render=function(g,a,b,c){var e,f,d,h,i,j,m,k,l;this.set.remove();i=(typeof g==="undefined"||
g===null?undefined:g.up)||"black";h=(typeof g==="undefined"||g===null?undefined:g.down)||"red";a=typeof a!=="undefined"&&a!==null?a:5;g=this.dndata.open.length;for(j=0;0<=g?j<g:j>g;0<=g?j+=1:j-=1)if(typeof(e=this.dndata.close[j])!=="undefined"&&e!==null){l=this.dndata.close[j][1]<this.dndata.open[j][1];m={};f=this.rawdata;for(k in f)if(n.call(f,k))m[k]=this.rawdata[k][j];this.set.push(this.r.sai.prim.candlestick(this.dndata.open[j][0],l&&this.dndata.close[j][1]||this.dndata.open[j][1],l&&this.dndata.open[j][1]||
this.dndata.close[j][1],this.dndata.high[j][1],this.dndata.low[j][1],a||5,j&&typeof(d=this.dndata.close[j-1])!=="undefined"&&d!==null&&this.dndata.close[j-1][1]<this.dndata.close[j][1]?h:i,!l,b,c,Sai.util.infoSetters(c,m)))}return this};Sai.BarPlot=function(){return Sai.Plot.apply(this,arguments)};p(Sai.BarPlot,Sai.Plot);Sai.BarPlot.prototype.render=function(g,a,b,c,e){var f,d,h,i,j,m,k;this.set.remove();a=this.denormalize([0,a])[1];j=0;h=[];g=g?this.r.sai.prim.stackedBar:this.r.sai.prim.groupedBar;
f=this.dndata;for(k in f)if(n.call(f,k)){j=this.dndata[k].length;h.push((typeof b==="undefined"||b===null?undefined:b[k])||"black")}for(f=0;0<=j?f<j:f>j;0<=j?f+=1:f-=1){b=[];d=this.dndata;for(k in d)n.call(d,k)&&b.push(this.dndata[k][f]);i={};d=this.rawdata;for(m in d)if(n.call(d,m))i[m]=this.rawdata[m][f];this.set.push(g(b,h,this.w/j,a,c,e,Sai.util.infoSetters(e,i)))}return this};Sai.GeoPlot=function(){return Sai.Plot.apply(this,arguments)};p(Sai.GeoPlot,Sai.Plot);Sai.GeoPlot.prototype.getRegionColor=
function(g,a,b){return Sai.util.multiplyColor(g[b],(this.data[b][a]==null?undefined:this.data[b][a][1])||0,this.opts.fromWhite,this.opts.fromWhite?0.2:0).str};Sai.GeoPlot.prototype.getRegionOpacity=function(g,a){var b;return typeof(b=this.data[a][g]==null?undefined:this.data[a][g][1])!=="undefined"&&b!==null?1:this.opts.fromWhite?0.15:0.25};Sai.GeoPlot.prototype.render=function(g,a,b,c,e,f,d){var h,i,j,m,k,l,o;this.set.remove();h=[];j=this.rawdata[b];i=0;for(m=j.length;i<m;i++){l=j[i];h.push(l.toUpperCase())}o=
{};i=h.length;for(j=0;0<=i?j<i:j>i;0<=i?j+=1:j-=1)o[h[j]]=j;h=a.paths;for(k in h)n.call(h,k)&&function(){var q,r,u,x,v,y=k;v=o[y];u=a.name[y];u={region:typeof u!=="undefined"&&u!==null?u:y};q=this.rawdata;for(r in q)if(n.call(q,r))if(r!==b)u[r]=this.rawdata[r][v];r=this.getRegionColor(g,v,c);v=this.getRegionOpacity(v,c);x=Sai.util.infoSetters(d,u);return this.set.push(this.r.sai.prim.hoverShape(function(s,z,t,B){return function(E){return E.path(s).translate(t,B).scale(z,z,t,B)}}(a.paths[y],Math.min(this.w/
a.width,this.h/a.height),this.x,this.y-this.h),{fill:r,stroke:this.opts.fromWhite?"black":e,"stroke-width":0.5,opacity:v},f?[function(s){navigator.userAgent.toLowerCase().indexOf("msie")!==-1||navigator.userAgent.toLowerCase().indexOf("opera")!==-1||s.toFront();return x[0]()},x[1]]:null,f?[{"fill-opacity":0.75,"stroke-width":this.opts.fromWhite?2:0.5},{"fill-opacity":1,"stroke-width":0.5}]:null))}.call(this);h=this.set.getBBox();this.set.translate((this.w-h.width)/2,(this.h-h.height)/2);return this};
Sai.ChromaticGeoPlot=function(){return Sai.GeoPlot.apply(this,arguments)};p(Sai.ChromaticGeoPlot,Sai.GeoPlot);Sai.ChromaticGeoPlot.prototype.getRegionColor=function(g,a){var b,c,e,f,d,h;f=e=c=0;b=this.data;for(h in b)if(n.call(b,h)){d=Sai.util.multiplyColor(g[h],(this.data[h][a]==null?undefined:this.data[h][a][1])||0,this.opts.fromWhite);f+=d.r;e+=d.g;c+=d.b}return"rgb("+f+", "+e+", "+c+")"};Sai.ChromaticGeoPlot.prototype.getRegionOpacity=function(g){var a,b,c;a=this.data;for(c in a)if(n.call(a,c))if(typeof(b=
this.data[c][g]==null?undefined:this.data[c][g][1])!=="undefined"&&b!==null)return 1;return 0.25};Sai.ScatterPlot=function(){return Sai.Plot.apply(this,arguments)};p(Sai.ScatterPlot,Sai.Plot);Sai.ScatterPlot.prototype.render=function(g,a,b,c){var e,f,d,h,i,j,m,k,l;this.set.remove();e=this.dndata;for(h in e)if(n.call(e,h)){i=this.dndata[h].length;break}for(h=0;0<=i?h<i:h>i;0<=i?h+=1:h-=1){alert(g.x);alert(this.dndata[g.x]);k=(this.dndata[g.x]==null?undefined:this.dndata[g.x][h][1])*(this.w/this.h);
l=this.dndata[g.y]==null?undefined:this.dndata[g.y][h][1];e=typeof(f=g.color)!=="undefined"&&f!==null?Sai.util.colerp(a[0],a[1],this.data[g.color]==null?undefined:this.data[g.color][h][1]):"black";j=typeof(d=g.radius)!=="undefined"&&d!==null?b[0]+(b[1]-b[0])*(this.data[g.radius]==null?undefined:this.data[g.radius][h][1]):"20";m=g.stroke_width?c[0]+(c[1]-c[0])*(this.data[g.stroke_width]==null?undefined:this.data[g.stroke_width][h][1]):"2";this.set.push(this.r.circle(k,l,j).attr({fill:e,"stroke-width":m}))}return this}})();(function(){var n=Object.prototype.hasOwnProperty,p=function(a,b){return function(){return a.apply(b,arguments)}},g=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;typeof b.extended==="function"&&b.extended(a);a.__super__=b.prototype};Sai.Chart=function(a,b,c,e,f,d,h,i){var j;this.opts=i;this.__LABELS__=h;this.h=f;this.w=e;this.y=c;this.x=b;this.r=a;j=this;this.drawInfo=function(){return Sai.Chart.prototype.drawInfo.apply(j,arguments)};this.getStackedMax=
function(){return Sai.Chart.prototype.getStackedMax.apply(j,arguments)};this.opts=typeof this.opts!=="undefined"&&this.opts!==null?this.opts:{};this.opts.bgcolor=typeof this.opts.bgcolor!=="undefined"&&this.opts.bgcolor!==null?this.opts.bgcolor:"white";this.setData(d);this.padding={left:5,right:5,top:5,bottom:5};return this};Sai.Chart.prototype.groupsToNullPad=function(){return[]};Sai.Chart.prototype.nonNegativeGroups=function(){return[]};Sai.Chart.prototype.nextSeriesSuffix=function(){var a;this.suffixCtr=
(typeof(a=this.suffixCtr)!=="undefined"&&a!==null?a:0)+1;return"["+this.suffixCtr+"]"};Sai.Chart.prototype.fixSeriesName=function(a){return a+(a.match(/^\s+$/)?this.nextSeriesSuffix():"")};Sai.Chart.prototype.setData=function(a){var b,c,e,f,d,h,i,j,m,k,l;this.data={};this.renames={};for(l in a)if(n.call(a,l)){for(;;){i=this.fixSeriesName(l);if(i===l||!(i in a))break}this.renames[l]=i;if(a[l]instanceof Array)if(this.__LABELS__===l){this.__LABELS__=i;var o=this.data,q=i;b=[];e=a[l];c=0;for(f=e.length;c<
f;c++){d=e[c];b.push(String(d))}o[q]=b}else{o=this.data;q=i;b=[];e=a[l];c=0;for(f=e.length;c<f;c++){d=e[c];b.push(typeof d==="string"&&d.match(/^[+-]?[\d,]+(\.\d+)?$/)&&!isNaN(h=parseFloat(d.replace(",","")))?h:d)}o[q]=b}else this.data[i]=a[l]}a=this.dataGroups(this.data);k=this.nonNegativeGroups();for(m in a)if(n.call(a,m))if(a[m].length>0)if(function(){for(var r=0,u=k.length;r<u;r++)if(k[r]===m)return true;return false}.call(this)){h=a[m];d=0;for(i=h.length;d<i;d++){l=h[d];if(typeof(j=this.data[l])!==
"undefined"&&j!==null){b=this.data[l].length;for(c=0;0<=b?c<b:c>b;0<=b?c+=1:c-=1)if(this.data[l][c]<0)this.data[l][c]*=-1}}}d=this.groupsToNullPad();j=0;for(h=d.length;j<h;j++){m=d[j];if(m in a){b=a[m];i=0;for(c=b.length;i<c;i++){l=b[i];this.nullPad(l)}}}return this.normalize(this.data)};Sai.Chart.prototype.nullPad=function(a){return a in this.data?this.data[a]=[null].concat(this.data[a].concat([null])):null};Sai.Chart.prototype.caresAbout=function(a){return!(a.match("^__")||a===this.__LABELS__)};
Sai.Chart.prototype.dataGroups=function(a){var b,c,e;b=[];for(e in a)n.call(a,e)&&this.caresAbout(e)&&b.push(e);c=[];for(e in a)if(n.call(a,e))if(e.match("^__")||e===this.__LABELS__)c.push(e);return{all:b,__META__:c}};Sai.Chart.prototype.getYAxisVals=function(a,b,c){var e,f,d;if(a===b)return[0,b,b*2];c=typeof c!=="undefined"&&c!==null?c:false;for(e=1;(b-a)*e<10;)e*=10;a*=e;b*=e;d=Math.floor(f=Math.log(b-a)/Math.LN10-0.4);d=Math.pow(10,d);if(f%1>0.7&&!c)d*=4;else if(f%1>0.35&&!c)d*=2;f=Sai.util.round(a-
(c?d/2.1:d/1.75),d);if(f<0&&0<=a)f=0;a=Sai.util.round(b+(c?d/2.1:d/1.75),d);f/=e;a/=e;d/=e;e=[];for(b=f;f<=a?b<=a:b>=a;b+=d)e.push(Sai.util.round(b,d));return e};Sai.Chart.prototype.getMax=function(a,b){var c,e,f,d,h,i,j,m,k,l;return Math.max.apply(Math,function(){c=[];e=0;for(f=b.length;e<f;e++){l=b[e];if(typeof(m=a[l])!=="undefined"&&m!==null)c.push(Math.max.apply(Math,function(){d=[];i=a[l];h=0;for(j=i.length;h<j;h++){k=i[h];typeof k!=="undefined"&&k!==null&&typeof k==="number"&&d.push(k)}return d}()))}return c}())};
Sai.Chart.prototype.getMin=function(a,b){var c,e,f,d,h,i,j,m,k,l;return Math.min.apply(Math,function(){c=[];e=0;for(f=b.length;e<f;e++){l=b[e];if(typeof(m=a[l])!=="undefined"&&m!==null)c.push(Math.min.apply(Math,function(){d=[];i=a[l];h=0;for(j=i.length;h<j;h++){k=i[h];typeof k!=="undefined"&&k!==null&&typeof k==="number"&&d.push(k)}return d}()))}return c}())};Sai.Chart.prototype.getStackedMax=function(a,b){var c,e,f,d,h,i,j;return Math.max.apply(Math,function(){c=[];e=a[this.__LABELS__].length;for(i=
0;0<=e?i<e:i>e;0<=e?i+=1:i-=1)c.push(Sai.util.sumArray(function(){f=[];d=0;for(h=b.length;d<h;d++){j=b[d];j!==this.__LABELS__&&f.push(a[j][i])}return f}.call(this)));return c}.call(this))};Sai.Chart.prototype.getStackedMin=function(){return 0};Sai.Chart.prototype.normalize=function(a){var b,c,e,f,d,h,i,j,m,k,l,o,q,r,u,x,v,y,s,z,t,B,E,H,w,F;z=this.dataGroups(a);this.ndata={};if(typeof(b=this.opts.stacked)!=="undefined"&&b!==null)this.stackedNdata={};E=function(D,A,C){if(typeof D==="number")return A===
C?1:(D-A)/(C-A);return null};b=function(D,A){var C,G,I;C=0;for(G=A.length;C<G;C++){I=A[C];if(!D(I))return false}return true};y=function(D){var A,C,G;A=0;for(C=D.length;A<C;A++){G=D[A];if(typeof G==="number")return false}return true};for(s in z)if(n.call(z,s)){if(!(h=s.match("^__"))){if(!(h=Sai.util.sumArray(function(){c=[];f=z[s];e=0;for(d=f.length;e<d;e++){w=f[e];c.push(this.data[w].length)}return c}.call(this))===0)){t=b;B=y;h=[];j=z[s];i=0;for(m=j.length;i<m;i++){w=j[i];h.push(this.data[w])}h=
t(B,h)}h=h}if(!h){this.ndata[s]={};if(typeof(k=this.opts.stacked)!=="undefined"&&k!==null){this.stackedNdata[s]={};v={}}h=this.opts.stacked?this.getStackedMin:this.getMin;i=this.opts.stacked?this.getStackedMax:this.getMax;h=h(a,z[s]);B=i(a,z[s]);F=this.getYAxisVals(h,B);h=F[0];B=F[F.length-1];j=z[s];i=0;for(m=j.length;i<m;i++){w=j[i];if(typeof(l=a[w])!=="undefined"&&l!==null){var J=this.ndata[s],K=w;o=[];q=a[w].length;for(t=0;0<=q?t<q:t>q;0<=q?t+=1:t-=1)o.push(typeof(r=a[w][t])!=="undefined"&&r!==
null&&(H=E(a[w][t],h,B))!==null?[t/(a[w].length-1||1),H]:null);J[K]=o;if(typeof(x=this.opts.stacked)!=="undefined"&&x!==null){this.stackedNdata[s][w]=[];o=a[w].length;for(t=0;0<=o?t<o:t>o;0<=o?t+=1:t-=1){q=v[t]||0;q=[t/(a[w].length-1||1),typeof(u=a[w][t])!=="undefined"&&u!==null&&(H=E(a[w][t],h,B))!==null?H+q:q];this.stackedNdata[s][w].push(q);if(q!==null)v[t]=q[1]}}this.ndata[s].__YVALS__=F}}}}return[]};Sai.Chart.prototype.addAxes=function(a,b){var c,e,f,d,h,i,j,m,k,l,o;this.axisWidth=1.5;this.padding.top+=
5;for(o=this.data[this.__LABELS__].length-1;this.data[this.__LABELS__].length-1<=0?o<=0:o>=0;this.data[this.__LABELS__].length-1<=0?o+=1:o-=1)if(typeof(c=this.data[this.__LABELS__][o])!=="undefined"&&c!==null){c=this.r.text(0,0,Sai.util.prettystr(this.data[this.__LABELS__][o]));this.padding.right+=c.getBBox().width/2;c.remove();break}o=this.h-(this.padding.bottom+this.padding.top);c=typeof(e=this.ndata[a])!=="undefined"&&e!==null||!(typeof(f=this.ndata[b])!=="undefined"&&f!==null);e=typeof(d=this.ndata[b])!==
"undefined"&&d!==null;if(c){d=this.r.sai.prim.vaxis(typeof(h=this.ndata[a]==null?undefined:this.ndata[a].__YVALS__)!=="undefined"&&h!==null?h:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,o,this.axisWidth);h=d.getBBox().width;d.remove()}else h=0;if(e){d=this.r.sai.prim.vaxis(typeof(i=this.ndata[b]==null?undefined:this.ndata[b].__YVALS__)!=="undefined"&&i!==null?i:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,o,this.axisWidth);i=d.getBBox().width;d.remove()}else i=0;this.haxis=
this.r.sai.prim.haxis(this.data[this.__LABELS__],this.x+this.padding.left+h,this.y-this.padding.bottom,this.w-this.padding.left-this.padding.right-h-i,this.axisWidth);i=this.haxis.getBBox().height;if(isNaN(i))i=1;this.haxis.translate(0,-i);this.padding.bottom+=i;o=this.h-(this.padding.bottom+this.padding.top);if(c){this.vaxis=this.r.sai.prim.vaxis(typeof(j=this.ndata[a]==null?undefined:this.ndata[a].__YVALS__)!=="undefined"&&j!==null?j:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,o,
this.axisWidth);this.vaxis.translate(this.vaxis.getBBox().width,0);this.padding.left+=this.vaxis.getBBox().width}if(e){this.vaxis_right=this.r.sai.prim.vaxis(typeof(m=this.ndata[b]==null?undefined:this.ndata[b].__YVALS__)!=="undefined"&&m!==null?m:[0,"?"],this.w-this.padding.right,this.y-this.padding.bottom,o,this.axisWidth,true,typeof(k=this.ndata[a])!=="undefined"&&k!==null?typeof(l=this.colors.__RIGHTAXIS__)!=="undefined"&&l!==null?l:"blue":"black");this.vaxis_right.translate(-this.vaxis_right.getBBox().width,
0);this.padding.right+=this.vaxis_right.getBBox().width}this.setPlotCoords();return this.r.set().push(this.haxis).push(this.vaxis)};Sai.Chart.prototype.setPlotCoords=function(){this.px=this.x+this.padding.left;this.py=this.y-this.padding.bottom;this.pw=this.w-this.padding.left-this.padding.right;return this.ph=this.h-this.padding.bottom-this.padding.top};Sai.Chart.prototype.drawBG=function(){var a,b,c,e;return this.bg=this.r.rect(typeof(a=this.px)!=="undefined"&&a!==null&&this.px||this.x,typeof(b=
this.py)!=="undefined"&&b!==null&&this.py-this.ph||this.y-this.h,typeof(c=this.pw)!=="undefined"&&c!==null&&this.pw||this.w,typeof(e=this.ph)!=="undefined"&&e!==null&&this.ph||this.h).attr({fill:this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack()};Sai.Chart.prototype.logoPos=function(){var a,b,c,e,f;f=typeof(a=this.px)!=="undefined"&&a!==null&&typeof(b=this.pw)!=="undefined"&&b!==null?this.px+this.pw-160-5:this.w+this.x-160-this.padding.right;a=typeof(c=this.py)!=="undefined"&&c!==null&&
typeof(e=this.ph)!=="undefined"&&e!==null?this.py-this.ph+5:this.y-this.h+this.padding.top;return[f,a,160,34]};Sai.Chart.prototype.drawLogo=function(){var a;a=this.logoPos();return this.logo=this.r.image(Sai.imagePath+"logo.png",a[0],a[1],a[2],a[3]).attr({opacity:0.25})};Sai.Chart.prototype.drawFootnote=function(a){var b,c,e,f,d,h;a=typeof a!=="undefined"&&a!==null?a:typeof(b=this.opts.footnote)!=="undefined"&&b!==null?b:"";if(a.match(/^\s*$/))return null;b=(this.w-this.padding.left-this.padding.right)/
5.5;h=a.split(" ");f=[];e="";a=0;for(c=h.length;a<c;a++){d=h[a];if(e.length+d.length>b){f.push(e);e=""}e+=d+" "}e!==""&&f.push(e);a=f.join("\n");this.footnote=this.r.text(this.x+this.padding.left,this.y-this.padding.bottom,a);b=this.footnote.getBBox().height;this.padding.bottom+=b+10;return this.footnote.translate(0,-b/2).attr({"text-anchor":"start"})};Sai.Chart.prototype.render=function(){this.plot=typeof this.plot!=="undefined"&&this.plot!==null?this.plot:new Sai.Plot(this.r);this.plot.render();
return this};Sai.Chart.prototype.showError=function(a){return this.r.text(this.x+this.padding.left+this.pw/2,this.y-this.padding.bottom-this.ph/2,a)};Sai.Chart.prototype.setColors=function(a){var b,c;this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};for(b in a)if(n.call(a,b)){c=this.renames[b];if(c in this.data)this.colors[c]=a[b]}return this};Sai.Chart.prototype.setColor=function(a,b){this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};this.colors[this.renames[a]]=
b;return this};Sai.Chart.prototype.normalizedHeight=function(a,b){var c;if(!(typeof(c=this.ndata[b]==null?undefined:this.ndata[b].__YVALS__)!=="undefined"&&c!==null))return null;c=this.ndata[b].__YVALS__[0];if(!(a>c))return null;return(a-c)/(this.ndata[b].__YVALS__[this.ndata[b].__YVALS__.length-1]-c)};Sai.Chart.prototype.drawGuideline=function(a,b){var c;b=typeof b!=="undefined"&&b!==null?b:"all";if(!(typeof(c=this.ndata[b]==null?undefined:this.ndata[b].__YVALS__)!=="undefined"&&c!==null))return null;
c=this.normalizedHeight(a,b);this.guidelines=typeof this.guidelines!=="undefined"&&this.guidelines!==null?this.guidelines:this.r.set();c=new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,{guideline:[[0,c],[1,c]]});c.render({guideline:"#ccc"});return this.guidelines.push(c.set)};Sai.Chart.prototype.drawLegend=function(a){var b,c,e,f,d,h,i,j;if(a=typeof a!=="undefined"&&a!==null?a:this.colors){e={};i={};b=a;for(j in b)if(n.call(b,j))if(j!==this.__LABELS__){e[j]=a[j];i[j]="black";if(typeof(h=this.opts.groups==
null?undefined:this.opts.groups.right)!=="undefined"&&h!==null)if(function(){for(var m=0,k=(d=this.opts.groups.right).length;m<k;m++)if(d[m]===j)return true;return false}.call(this))i[j]=typeof(c=this.ndata.left)!=="undefined"&&c!==null?typeof(f=this.colors.__RIGHTAXIS__)!=="undefined"&&f!==null?f:"blue":"black"}this.legend=this.r.sai.prim.legend(this.x,this.y-this.padding.bottom,this.w,e,i);if(this.legend.length>0)this.padding.bottom+=this.legend.getBBox().height+15;return this.legend.translate((this.w-
this.legend.getBBox().width)/2,0)}};Sai.Chart.prototype.drawTitle=function(){var a;if(typeof(a=this.opts.title)!=="undefined"&&a!==null){this.title=this.r.text(this.x+this.w/2,this.y-this.h,this.opts.title).attr({"font-size":20});this.title.translate(0,this.title.getBBox().height/2);return this.padding.top+=this.title.getBBox().height+5}};Sai.Chart.prototype.setupInfoSpace=function(){this.info_y=this.y-this.h+this.padding.top;this.info_x=this.x+this.padding.left;this.info_w=this.w-this.padding.left-
this.padding.right;return this.padding.top+=30};Sai.Chart.prototype.drawInfo=function(a,b){var c,e,f;b=typeof b!=="undefined"&&b!==null?b:true;a=typeof a!=="undefined"&&a!==null?a:typeof(c=this.default_info)!=="undefined"&&c!==null?this.default_info():{};if(b)this.info_data={};this.info&&this.info.remove();c=a;for(f in c)if(n.call(c,f))f.match("^__")||(this.info_data[f]=typeof(e=a[f])!=="undefined"&&e!==null?e:"(no data)");return this.info=this.r.sai.prim.info(this.info_x,this.info_y,this.info_w,
this.info_data)};Sai.Chart.prototype.getIndex=function(a){a=Sai.util.transformCoords(a,this.r.canvas).x;return Math.round((this.data[this.__LABELS__].length-1)*(a-this.px)/this.pw)};Sai.LineChart=function(){return Sai.Chart.apply(this,arguments)};g(Sai.LineChart,Sai.Chart);Sai.LineChart.prototype.nonNegativeGroups=function(){return this.opts.stacked?["all","left","right"]:[]};Sai.LineChart.prototype.dataGroups=function(){var a,b,c,e,f,d;d=Sai.LineChart.__super__.dataGroups.apply(this,arguments);if(typeof(f=
this.opts.groups==null?undefined:this.opts.groups.left)!=="undefined"&&f!==null&&typeof(a=this.opts.groups==null?undefined:this.opts.groups.right)!=="undefined"&&a!==null){a=[];c=this.opts.groups.left;b=0;for(e=c.length;b<e;b++){f=c[b];this.caresAbout(f)&&f in this.data&&a.push(f)}d.left=a;a=[];c=this.opts.groups.right;b=0;for(e=c.length;b<e;b++){f=c[b];this.caresAbout(f)&&f in this.data&&a.push(f)}d.right=a}return d};Sai.LineChart.prototype.render=function(){var a,b,c,e,f,d,h,i;this.drawTitle();
this.setupInfoSpace();this.drawFootnote();this.drawLegend();(h="right"in this.ndata)?this.addAxes("left","right"):this.addAxes("all");this.drawBG();this.drawLogo();if(h){this.ndata.left.__YVALS__[0]<0&&this.drawGuideline(0,"left");this.ndata.right.__YVALS__[0]<0&&this.drawGuideline(0,"right")}else this.ndata.all.__YVALS__[0]<0&&this.drawGuideline(0,"all");this.lines=[];this.dots=this.r.set();d=typeof(a=this.opts.stacked)!=="undefined"&&a!==null?this.stackedNdata:this.ndata;a=this.opts.area?Sai.AreaPlot:
Sai.LinePlot;this.plotSets=this.r.set();this.plots=[];if(h){this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,d.left)).render(this.colors,typeof(b=this.opts.lineWidth)!=="undefined"&&b!==null?b:2,this.opts.stacked,this.normalizedHeight(0,"left")));this.plotSets.push(this.plots[0].set);this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,d.right)).render(this.colors,typeof(c=this.opts.lineWidth)!=="undefined"&&c!==null?c:2,this.opts.stacked,this.normalizedHeight(0,"right")));this.plotSets.push(this.plots[1].set)}else{this.plots.push((new a(this.r,
this.px,this.py,this.pw,this.ph,d.all)).render(this.colors,typeof(e=this.opts.lineWidth)!=="undefined"&&e!==null?e:2,this.opts.stacked,this.normalizedHeight(0,"all")));this.plotSets.push(this.plots[0].set)}b=d.all;for(i in b)if(n.call(b,i))if(i!=="__YVALS__")this.dots.push(this.r.circle(0,0,4).attr({fill:typeof(f=this.colors==null?undefined:this.colors[i])!=="undefined"&&f!==null?f:"black"}).hide());this.r.set().push(this.bg,this.plotSets,this.dots,this.logo,this.guidelines).mousemove(p(function(j){var m,
k,l,o,q,r,u,x,v,y,s;u=this.getIndex(j);x={};x[this.__LABELS__]=this.data[this.__LABELS__][u];j=d.all;for(s in j)if(n.call(j,s))if(typeof(m=this.data[s])!=="undefined"&&m!==null)x[s]=this.data[s][u];this.drawInfo(x);r=0;m=[];j=d.all;for(s in j)n.call(j,s)&&s!=="__YVALS__"&&m.push(function(){k=[];o=this.plots;l=0;for(q=o.length;l<q;l++){v=o[l];s in v.dndata&&k.push(function(){y=v.dndata[s][u];typeof y!=="undefined"&&y!==null?this.dots[r].attr({cx:y[0],cy:y[1]}).show().toFront():this.dots[r].hide();
return r++}.call(this))}return k}.call(this));return m},this)).mouseout(p(function(){this.drawInfo({},true);return this.dots.hide()},this));this.logo==null||this.logo.toFront();return this};Sai.Sparkline=function(){return Sai.Chart.apply(this,arguments)};g(Sai.Sparkline,Sai.Chart);Sai.Sparkline.prototype.dataGroups=function(){return{data:["data"]}};Sai.Sparkline.prototype.render=function(){this.drawBG();this.plots=this.r.set();this.plots.push((new Sai.LinePlot(this.r,this.x,this.y,this.w,this.h,this.ndata.data)).render({data:this.colors&&
this.colors[series]||"black"},1).set);return this};Sai.BarChart=function(){var a;a=this;this.getMin=function(){return Sai.BarChart.prototype.getMin.apply(a,arguments)};return Sai.Chart.apply(this,arguments)};g(Sai.BarChart,Sai.Chart);Sai.BarChart.prototype.getMin=function(){return Math.min(Sai.BarChart.__super__.getMin.apply(this,arguments),0)};Sai.BarChart.prototype.groupsToNullPad=function(){var a,b,c;a=[];b=this.dataGroups();for(c in b)n.call(b,c)&&a.push(c);return a};Sai.BarChart.prototype.nonNegativeGroups=
function(){var a,b,c;if(this.opts.stacked){a=[];b=this.dataGroups();for(c in b)n.call(b,c)&&a.push(c);return a}return[]};Sai.BarChart.prototype.tooMuchData=function(){var a,b,c,e;c=this.w/3;b=0;a=this.data;for(e in a)if(n.call(a,e))if(e!==this.__LABELS__){b+=this.data[e].length;if(this.opts.stacked)break}return b>c};Sai.BarChart.prototype.render=function(){var a,b,c,e,f,d,h;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawLegend();this.addAxes("all");this.drawLogo();this.drawBG();
if(this.tooMuchData()){this.showError("Sorry, the chart isn't wide enough to plot this much data.\n \nPossible solutions include downsampling your data\n (e.g. monthly instead of daily) or using a line chart");return this}if("all"in this.ndata){this.guidelines=this.r.set();b=this.ndata.all.__YVALS__.slice(1,this.ndata.all.__YVALS__.length-1);a=0;for(c=b.length;a<c;a++){h=b[a];this.drawGuideline(h)}}this.plots=this.r.set();a={};c={};c[this.__LABELS__]=this.data[this.__LABELS__];b=typeof(e=this.opts.stacked)!==
"undefined"&&e!==null?this.stackedNdata:this.ndata;e=b.all;for(d in e)if(n.call(e,d))if(!(d.match("^__")||d===this.__LABELS__)){a[d]=b.all[d];c[d]=this.data[d]}this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph,a,c)).render(typeof(f=this.opts.stacked)!=="undefined"&&f!==null,this.normalizedHeight(0,"all"),this.colors,this.opts.interactive,this.drawInfo).set);this.logo==null||this.logo.toFront();return this};Sai.StockChart=function(){return Sai.Chart.apply(this,arguments)};g(Sai.StockChart,
Sai.Chart);Sai.StockChart.prototype.groupsToNullPad=function(){return["prices","volume","__META__"]};Sai.StockChart.prototype.dataGroups=function(a){var b,c;b={__META__:[this.__LABELS__]};if("volume"in this.data)b.volume=["volume"];for(c in a)if(n.call(a,c))if(this.caresAbout(c)&&!(this.__LABELS__===c||"volume"===c)){b.prices=typeof b.prices!=="undefined"&&b.prices!==null?b.prices:[];b.prices.push(c)}return b};Sai.StockChart.prototype.nonNegativeGroups=function(){return["volume"]};Sai.StockChart.prototype.render=
function(){var a,b,c,e,f,d,h,i;this.drawTitle();this.setupInfoSpace();this.drawFootnote();c={};i=false;a=this.ndata.prices;for(h in a)if(n.call(a,h))if(!("open"===h||"close"===h||"high"===h||"low"===h)&&!(h.match("^__")||h===this.__LABELS__)){c[h]=(this.colors==null?undefined:this.colors[h])||"black";i=true}i&&this.drawLegend(c);this.colors=typeof this.colors!=="undefined"&&this.colors!==null?this.colors:{};this.colors.up=typeof this.colors.up!=="undefined"&&this.colors.up!==null?this.colors.up:"black";
this.colors.down=typeof this.colors.down!=="undefined"&&this.colors.down!==null?this.colors.down:"red";this.colors.vol_up=typeof this.colors.vol_up!=="undefined"&&this.colors.vol_up!==null?this.colors.vol_up:"#666666";this.colors.vol_down=typeof this.colors.vol_down!=="undefined"&&this.colors.vol_down!==null?this.colors.vol_down:"#cc6666";this.addAxes("prices");this.drawLogo();this.drawBG();if(!(typeof(b=this.ndata.prices)!=="undefined"&&b!==null&&"open"in this.ndata.prices&&"close"in this.ndata.prices&&
"high"in this.ndata.prices&&"low"in this.ndata.prices)){this.showError("This chart requires data series named\nopen, close, high, and low.\n \nOnce you add series with these names, the chart will display.");return null}this.ndata.prices.__YVALS__[0]<0&&this.drawGuideline(0,"prices");this.plots=this.r.set();b={up:[],down:[]};a={};c=this.ndata.prices;for(f in c)if(n.call(c,f))f.match("^__")||f===this.__LABELS__||(a[f]=this.data[f]);if(typeof(e=this.data.volume)!=="undefined"&&e!==null)a.vol=this.data.volume;
if("volume"in this.ndata){e=this.ndata.volume.volume.length;for(f=0;0<=e?f<e:f>e;0<=e?f+=1:f-=1)if(this.ndata.volume.volume[f]!==null)if(f&&this.ndata.prices.close[f-1]&&this.ndata.prices.close[f][1]<this.ndata.prices.close[f-1][1]){b.down.push(this.ndata.volume.volume[f]);b.up.push([this.ndata.volume.volume[f][0],0])}else{b.up.push(this.ndata.volume.volume[f]);b.down.push([this.ndata.volume.volume[f][0],0])}else{b.up.push([0,0]);b.down.push([0,0])}this.plots.push((new Sai.BarPlot(this.r,this.px,
this.py,this.pw,this.ph*0.2,b,a)).render(true,this.normalizedHeight(0,"volume"),{up:this.colors.vol_up,down:this.colors.vol_down}).set)}this.plots.push((new Sai.CandlestickPlot(this.r,this.px,this.py,this.pw,this.ph,{open:this.ndata.prices.open,close:this.ndata.prices.close,high:this.ndata.prices.high,low:this.ndata.prices.low},a)).render(this.colors,Math.min(5,this.pw/this.ndata.prices.open.length-2)).set);f={};e=this.ndata.prices;for(h in e)if(n.call(e,h))"open"===h||"close"===h||"high"===h||"low"===
h||h.match("^__")||h===this.__LABELS__||(f[h]=this.ndata.prices[h]);this.plots.push((new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,f)).render(this.colors).set);d=this.pw/(this.data[this.__LABELS__].length-1);this.glow=this.r.rect(this.px-d/2,this.py-this.ph,d,this.ph).attr({fill:"0-"+this.opts.bgcolor+"-#DDAA99-"+this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack().hide();this.bg.toBack();this.r.set().push(this.bg,this.plots,this.logo,this.glow,this.guidelines).mousemove(p(function(j){var m,
k,l,o,q,r;l=this.getIndex(j);o={};o[this.__LABELS__]=this.data[this.__LABELS__][l];q=false;j=this.ndata.prices;for(r in j)if(n.call(j,r))if(!(r.match("^__")||r===this.__LABELS__))if(typeof(m=this.data[r]==null?undefined:this.data[r][l])!=="undefined"&&m!==null){o[r]=this.data[r][l];q=true}if(typeof(k=this.data.volume==null?undefined:this.data.volume[l])!=="undefined"&&k!==null){o.volume=this.data.volume[l];q=true}this.drawInfo(o);return q?this.glow.attr({x:this.px+d*(l-0.5)}).show():null},this)).mouseout(p(function(){this.drawInfo({},
true);return this.glow.hide()},this));this.logo==null||this.logo.toFront();return this};Sai.GeoChart=function(){var a;a=this;this.renderPlot=function(){return Sai.GeoChart.prototype.renderPlot.apply(a,arguments)};return Sai.Chart.apply(this,arguments)};g(Sai.GeoChart,Sai.Chart);Sai.GeoChart.prototype.plotType=Sai.GeoPlot;Sai.GeoChart.prototype.interactiveHistogram=true;Sai.GeoChart.prototype.getMax=function(a){return Math.max.apply(Math,a)};Sai.GeoChart.prototype.getMin=function(a){return Math.min.apply(Math,
a)};Sai.GeoChart.prototype.normalize=function(a){var b,c,e,f,d,h,i,j,m,k,l,o,q;this.ndata={};this.bounds={};m={};k={};for(q in a)if(n.call(a,q))if(!(q.match("^__")||q===this.__LABELS__))if(typeof(b=a[q])!=="undefined"&&b!==null){c=[];f=a[q];e=0;for(d=f.length;e<d;e++){j=f[e];typeof j!=="undefined"&&j!==null&&c.push(j)}c=c;m[q]=this.getMax(c,q);if(!(typeof l!=="undefined"&&l!==null)||m[q]>l)l=m[q];k[q]=this.getMin(c,q);if(!(typeof o!=="undefined"&&o!==null)||k[q]<o)o=k[q]}for(q in a)if(n.call(a,q))if(!(q.match("^__")||
q===this.__LABELS__))if(typeof(h=a[q])!=="undefined"&&h!==null){if(this.opts.groupedNormalization){f=l;d=o}else{f=m[q];d=k[q]}this.bounds[q]=[d,f];j=this.ndata;var r=q;b=[];c=a[q].length;for(e=0;0<=c?e<c:e>c;0<=c?e+=1:e-=1)b.push(typeof(i=a[q][e])!=="undefined"&&i!==null?[e/(a[q].length-1),(a[q][e]-d)/(f-d)]:null);j[r]=b}return[]};Sai.GeoChart.prototype.dataGroups=function(a){var b,c;b=[];for(c in a)if(n.call(a,c))if(c.match("^__")||c===this.__LABELS__)b.push(c);b={__META__:b};for(c in a)if(n.call(a,
c))c.match("^__")||c===this.__LABELS__||(b[c]=[c]);return b};Sai.GeoChart.prototype.drawHistogramLegend=function(a){var b,c,e,f,d,h,i,j,m,k,l,o,q,r;this.histogramLegend=this.r.set();m=Math.max(0.1*(this.h-this.padding.bottom-this.padding.top),50);q=Math.min(150,(this.w-this.padding.left-this.padding.right-20)/a.length);b=a.length;for(l=0;0<=b?l<b:l>b;0<=b?l+=1:l-=1){o=a[l];k=this.x+l*q;c=[];e=this.ndata[o].length;for(d=0;0<=e?d<e:d>e;0<=e?d+=1:d-=1)if(typeof(f=this.ndata[o][d])!=="undefined"&&f!==
null)c.push(this.ndata[o][d][1]);c=c;if(typeof(h=this.bounds==null?undefined:this.bounds[o])!=="undefined"&&h!==null){d=this.bounds[o];e=d[0];d=d[1]}else{e=[];i=this.data[o];d=0;for(j=i.length;d<j;d++){r=i[d];typeof r!=="undefined"&&r!==null&&e.push(r)}e=e;d=[Math.min.apply(Math,e),Math.max.apply(Math,e)];e=d[0];d=d[1]}d=this.getYAxisVals(e,d,true);e=d[0];d=d[d.length-1];this.histogramLegend.push(k=this.r.sai.prim.histogram(k,this.y-this.padding.bottom,q*0.8,m,c,e,d,o,this.colors[o],"white",this.opts.fromWhite));
this.opts.interactive&&this.setupHistogramInteraction(k,o)}this.histogramLegend.translate((this.w-this.padding.left-this.padding.right-this.histogramLegend.getBBox().width)/2,0);return this.padding.bottom+=m+5};Sai.GeoChart.prototype.setupHistogramInteraction=function(a,b){return a.click(p(function(){return this.renderPlot(b)},this)).hover(p(function(c){return p(function(){c.attr({"fill-opacity":0.75});return this.drawInfo({"Click to display on map":b})},this)},this)(a),p(function(c){return p(function(){c.attr({"fill-opacity":1});
return this.drawInfo()},this)},this)(a))};Sai.GeoChart.prototype.renderPlot=function(a){this.geoPlot==null||this.geoPlot.set.remove();this.geoPlot=(new this.plotType(this.r,this.px,this.py,this.pw,this.ph,this.ndata,this.data,{fromWhite:this.opts.fromWhite})).render(this.colors||{},this.data.__MAP__,this.__LABELS__,a,this.opts.bgcolor,this.opts.interactive,this.drawInfo);return this.logo==null?undefined:this.logo.toFront()};Sai.GeoChart.prototype.default_info=function(){return{"":this.opts.interactive?
"Click histogram below to change map display":""}};Sai.GeoChart.prototype.render=function(){var a,b,c;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawHistogramLegend(function(){a=[];b=this.data;for(c in b)if(n.call(b,c))c.match("^__")||c===this.__LABELS__||a.push(c);return a}.call(this));this.setPlotCoords();this.drawLogo();this.drawBG();this.drawInfo();this.renderPlot(this.data.__DEFAULT__);return this};Sai.ChromaticGeoChart=function(){return Sai.GeoChart.apply(this,arguments)};
g(Sai.ChromaticGeoChart,Sai.GeoChart);Sai.ChromaticGeoChart.prototype.plotType=Sai.ChromaticGeoPlot;Sai.ChromaticGeoChart.prototype.interactiveHistogram=false;Sai.ChromaticGeoChart.prototype.default_info=function(){return{}};Sai.ChromaticGeoChart.prototype.setupHistogramInteraction=function(){return false};Sai.ScatterChart=function(){return Sai.Chart.apply(this,arguments)};g(Sai.ScatterChart,Sai.Chart);Sai.ScatterChart.prototype.render=function(){var a,b;this.drawTitle();this.setupInfoSpace();this.drawFootnote();
this.drawLegend();this.addAxes("all");this.drawLogo();this.drawBG();this.plots=this.r.set();this.plots.push((new Sai.ScatterPlot(this.r,this.px,this.py,this.pw,this.ph,this.ndata,this.data)).render(this.opts.mappings,[typeof(a=this.colors.__LOW__)!=="undefined"&&a!==null?a:"black",typeof(b=this.colors.__HIGH__)!=="undefined"&&b!==null?b:"white"],this.opts.radii,this.opts.stroke_widths).set);this.logo==null||this.logo.toFront();return this}})();
