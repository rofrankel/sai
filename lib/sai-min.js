(function(){Sai={};var w,D;Sai.util={};Sai.imagePath!=null||(Sai.imagePath="/static/images/sai/");Sai.util.roundToMag=function(v,j){var e;if(j==null)j=0;e=Math.pow(10,j);return parseFloat((Math.round(v/e)*e).toFixed(Math.max(0,j)))};Sai.util.round=function(v,j){return parseFloat((Math.round(v/j)*j).toFixed(Math.max(0,Math.ceil(-1*Math.log(j)/Math.LN10))))};Sai.util.sumArray=function(v){var j,e,b;j=e=0;for(b=v.length;0<=b?j<b:j>b;0<=b?j+=1:j-=1)e+=typeof v[j]==="number"?v[j]:0;return e};Sai.util.prettystr=
function(v,j){var e,b;e=j!=null?j:1;j!=null||(j=2);if(typeof v==="number"){if(Math.abs(v)>=1E12){b="t";v/=1E12}else if(Math.abs(v)>=1E9){if(e>=8)return v;b="b";v/=1E9}else if(Math.abs(v)>=1E6){if(e>=5)return v;b="m";v/=1E6}else if(Math.abs(v)>=1E3){if(e>=2)return v;b="k";v/=1E3}else return String(parseFloat(v.toFixed(j)));return parseFloat(v.toFixed(e))+b}return v};Sai.util.prettynum=function(v){var j;if(!(isNaN(parseFloat(v))||!String(v).match(/^[-+]?\d+(\.\d+)?$/))){v=String(v).split(".");for(j=
/(\d+)(\d{3})/;j.test(v[0]);)v[0]=v[0].replace(j,"$1,$2");return v[0]+(v.length>1?parseFloat("0."+v[1]).toFixed(2).slice(1):"")}};Sai.util.infoSetters=function(v,j){return[function(){return v(j)},function(){return v()}]};Sai.util.transformCoords=function(v,j){var e;if(j.getScreenCTM){e=j.createSVGPoint();e.x=v.clientX;e.y=v.clientY;e=e.matrixTransform(j.getScreenCTM().inverse());if(navigator.userAgent.toLowerCase().indexOf("chrome")!==-1||navigator.userAgent.toLowerCase().indexOf("safari")!==-1){e.x+=
document.body.scrollLeft;e.y+=document.body.scrollTop}return{x:e.x,y:e.y}}else return{x:v.x,y:v.y}};Sai.util.multiplyColor=function(v,j,e,b){if(b==null)b=0;j=b+(1-b)*j;b=Raphael.getRGB(v);if(e){v=b.r+(255-b.r)*(1-j);e=b.g+(255-b.g)*(1-j);j=b.b+(255-b.b)*(1-j)}else{v=b.r*j;e=b.g*j;j=b.b*j}return{r:v,g:e,b:j,str:"rgb("+v+", "+e+", "+j+")"}};Sai.util.colerp=function(v,j,e){v=Raphael.getRGB(v);j=Raphael.getRGB(j);return"rgb("+(j.r*e+v.r*(1-e))+", "+(j.g*e+v.g*(1-e))+", "+(j.b*e+v.b*(1-e))+")"};Sai.util.reflectColor=
function(v,j){var e,b,a,c,f,d,h,g,i;a=Raphael.getRGB(v);f=Raphael.getRGB(j);d={};i=["r","g","b"];h=0;for(g=i.length;h<g;h++){b=i[h];e=a[b];c=f[b];d[b]=e===c?e:e>c?c*((255-e)/(255-c)):(255*(c-e)+c*e)/c}return"rgb("+d.r+", "+d.g+", "+d.b+")"};Sai.data!=null||(Sai.data={});(w=Sai.data).map!=null||(w.map={});(D=Raphael.fn).sai!=null||(D.sai={});Raphael.fn.sai.chart=function(v,j,e,b,a,c){var f;a=(f={line:Sai.LineChart}[a])!=null?f:a;a!=null||(a=Sai.Chart);return(new a(this,v,j,e,b,c)).render()}}).call(this);(function(){var w,D,v=Array.prototype.indexOf||function(j){for(var e=0,b=this.length;e<b;e++)if(this[e]===j)return e;return-1};(D=Raphael.fn.sai).prim!=null||(D.prim={});w=function(j,e,b,a){return[function(){j.attr(e);return a!=null?typeof a[0]==="function"?a[0](j):void 0:void 0},function(){j.attr(b);return a!=null?typeof a[1]==="function"?a[1](j):void 0:void 0}]};Raphael.fn.sai.prim.candlestick=function(j,e,b,a,c,f,d,h,g,i,k){if(d==null)d="black";f%2||f++;f=this.rect(j-f/2,e,f,b-e||1).attr("stroke",
d);a=this.path("M"+j+" "+a+"L"+j+" "+e+"M"+j+" "+b+"L"+j+" "+c).attr("stroke",d);f.attr("fill",h?d:"#ffffff");d=this.set().push(f,a);if(g){j=w(d,{scale:"1.5,1.5,"+j+","+(e+(b-e)/2),"fill-opacity":0.5},{scale:"1.0,1.0,"+j+","+(e+(b-e)/2),"fill-opacity":1},k);d.hover(j[0],j[1])}return d};Raphael.fn.sai.prim.line=function(j,e,b){var a,c,f,d;if(e==null)e="black";if(b==null)b=1;f=0;for(d=j.length;f<d;f++){a=j[f];if(a!=null)if(typeof c!="undefined"&&c!==null)c+="L"+a[0]+" "+a[1];else c="M"+a[0]+" "+a[1]}return this.path(c).attr({stroke:e,
"stroke-width":b})};Raphael.fn.sai.prim.area=function(j,e,b,a){var c,f,d,h,g;if(e==null)e="black";if(b==null)b=1;if(j.length<2)return this.set();h=0;for(g=j.length;h<g;h++){f=j[h];if(f!=null)if(typeof d!="undefined"&&d!==null){d+="L"+f[0]+" "+f[1];c+="L"+f[0]+" "+f[1]}else{d="M"+f[0]+" "+f[1];c="M"+f[0]+" "+f[1]}}for(j=g=a.length-1;g<=0?j<=0:j>=0;j+=-1){f=a[j][0];h=a[j][1];c+="L"+f+","+h}a=this.path(c).attr({fill:e,"stroke-width":0,"stroke-opacity":0,"fill-opacity":0.35});e=this.path(d).attr({stroke:e,
"stroke-width":b});return this.set().push(a,e)};Raphael.fn.sai.prim.stackedBar=function(j,e,b,a,c,f,d){var h,g,i,k,l,m,o,n,p,q;if(c){k=l=a;m=0;for(n=j.length;m<n;m++){g=j[m];if(k<g[1])k=g[1];if(l>g[1])l=g[1]}p=k-l||1}b*=0.67;n=this.set();m=[a,a];l=function(s){return s<a?1:0};g=0;for(q=j.length;0<=q?g<q:g>q;0<=q?g+=1:g-=1)if(j[g]!=null&&j[g][1]!==a){k=l(j[g][1]);i=Math.abs(m[k]-j[g][1]);h=m[k]===a?1:0;o=j[g][1]-(k?0:i-h);n.push(h=this.rect(j[g][0]-b/2,o,b,i-h).attr("fill",(e!=null?e[g]:void 0)||"#000000").attr("stroke",
(e!=null?e[g]:void 0)||"#000000"));if(c){i=w(h,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},[function(s){return function(){d[0]&&d[0]();return f({"(selected)":Sai.util.prettystr(s)+"%"},false)}}(100*(i/p)),d[1]]);h.hover(i[0],i[1])}m[k]=j[g][1]}return n};Raphael.fn.sai.prim.groupedBar=function(j,e,b,a,c,f,d){var h,g,i,k,l,m;f=this.set();h=b/(j.length+1);k=(b-h)/2;i=0;for(l=j.length;0<=l?i<l:i>l;0<=l?i+=1:i-=1)if(((m=j[i])!=null?m[0]:void 0)!=null){b=Math.min(j[i][1],a);g=Math.max(j[i][1],a)-b-0.5;
f.push(this.rect(j[i][0]-k+i*h,b,h-1,g).attr("fill",(e!=null?e[i]:void 0)||"#000000").attr("stroke",(e!=null?e[i]:void 0)||"#000000"))}if(c){j=w(f,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},d);f.hover(j[0],j[1])}return f};Raphael.fn.sai.prim.haxis=function(j,e,b,a,c){var f,d,h,g,i,k,l,m,o,n,p,q,s,r,t,u,x,B,C;q=(t=c.ticklens)!=null?t:[5,2];t=(h=c.width)!=null?h:1;h=(n=c.color)!=null?n:"black";m=this.path("M"+e+" "+b+"l"+a+" 0").attr("stroke",h);s=this.set();l=this.set();n=a/25;k=n<j.length?Math.ceil(j.length/
n):1;g=a/(j.length-1)*k;x=e;u=-1;p=false;n=0;B=null;i=0;for(C=j.length;0<=C?i<C:i>C;i+=k){f=j[i];if(f!=null){d=q[String(f)?0:1];s.push(this.path("M"+x+" "+b+"l0 "+d).attr("stroke",h));if(f!==""){d=this.text(x,b+d+2,Sai.util.prettystr(f).substring(0,12));f=d.getBBox();o=d.attr("y")+5;d.attr("y",o);if(B==null||o<B)B=o;l.push(d);d=f.width;n=Math.max(d,n);if(f.x<=u+3)p=true;if(f.x+d>u)u=f.x+d}}x+=g}if(c.title!=null)r=this.text(e+a/2,B+14,c.title).attr({"font-size":"12px","font-weight":"bold"});j=this.set().push(m,
s,l,r);if(p){r=l.items;a=0;for(c=r.length;a<c;a++){d=r[a];d.rotate(-90);d.translate(0,d.getBBox().width/2-2)}j.push(this.rect(e,b,1,t+n+q[0]).attr("opacity","0"))}return j};Raphael.fn.sai.prim.vaxis=function(j,e,b,a,c){var f,d,h,g,i,k,l,m,o,n,p,q,s,r,t,u,x;p=(f=c.ticklens)!=null?f:[5,2];f=(m=c.color)!=null?m:"black";n=(k=c.right)!=null?k:false;m=this.path("M"+e+" "+b+"l0 "+-a).attr("stroke",f);q=this.set();k=this.set();h=a/(j.length-1);t=b;r=null;i=[];l=true;u=0;for(x=j.length;u<x;u++){g=j[u];if(g!==
null){g=Sai.util.prettystr(g);if(v.call(i,g)>=0){l=false;break}i.push(g)}}if(!l){u=[];i=0;for(l=j.length;i<l;i++){g=j[i];u.push(Sai.util.prettystr(g,2))}i=u}u=l=0;for(x=j.length;u<x;u++){g=j[u];if(g!==null){g=p[String(g)?0:1];q.push(this.path("M"+e+" "+t+"l"+(n?g:-g)+" 0").attr("stroke",f));o=e+(n?1:-1)*(g+3);g=this.text(o,t,i[l++]);g.attr({"text-anchor":n?"start":"end",fill:f});o+=(n?1:-1)*(g.getBBox().width+8);if(r==null||o<r)r=o;k.push(g)}t-=h}if(c.title!=null){s=this.text(r,b-a/2,c.title).attr({"font-size":"12px",
"font-weight":"bold"});j=s.getBBox();s.rotate(-90);d=this.rect(j.x+(j.width-j.height)/2,b,j.height,1).attr({opacity:0})}d!=null||(d=null);return this.set().push(this.set().push(m,q,k,d),s)};Raphael.fn.sai.prim.popup=function(j,e,b){var a,c,f,d,h,g;this.set();g=this.set();c=0;f=e+5+5;if("__HEAD__"in b){a=this.text(j,f,b.__HEAD__).attr({fill:"#cfc","font-size":"12","font-weight":"bold"});c=Math.max(c,a.getBBox().width);g.push(a);f+=17}for(h in b)if(h!=="__HEAD__"){d=this.text(j+5,f,h+" = "+b[h]).attr({fill:"white",
"font-weight":"bold","text-anchor":"start"});c=Math.max(c,d.getBBox().width);f+=10;g.push(d)}b=c+10;this.rect(j,e,b,f-e,5).attr({fill:"black","fill-opacity":".85",stroke:"black"});a!=null&&a.translate(b/2);return g.toFront()};Raphael.fn.sai.prim.legend=function(j,e,b,a,c){var f,d,h,g,i,k,l,m,o;e-=14;i=this.set();h=j;g=e;for(k in a){d=this.text(h+14,g+5,k).attr({fill:(l=c!=null?c[k]:void 0)!=null?l:"black","text-anchor":"start"});f=this.rect(h,g,9,9).attr({fill:(m=a[k])!=null?m:"black",stroke:(o=c!=
null?c[k]:void 0)!=null?o:"black"});f=this.set().push(d,f);d=f.getBBox().width;if(h-j+15+d>b){i.translate(0,-14);f.translate(j-h,e-g);h=j;g=e}h+=d+15;i.push(f)}return i};Raphael.fn.sai.prim.wrappedText=function(j,e,b,a,c){var f,d,h,g;if(a==null)a="";if(c==null)c=" ";typeof spacing!="undefined"&&spacing!==null||(spacing=1);if(!a.match(/^\s*$/)){b=b/6;h=[];for(d=0;d<a.length-1;){f=d+b;g=a.substring(d,f+1);f=f>=a.length?f:g.lastIndexOf(c);h.push(g.substring(0,f));d+=f+1}a=h.join("\n");return this.text(j,
e+5*h.length,a).attr({"font-family":"Lucida Console","text-anchor":"start"})}};Raphael.fn.sai.prim.info=function(j,e,b,a){var c,f,d,h,g,i;d=this.set();f=j;e=e;for(c in a)if(a[c]!==null){h=c+(c===""?"":": ");h+=typeof a[c]==="string"?a[c]:(i=Sai.util.prettynum(a[c]))!=null?i:Sai.util.prettystr(a[c]);g=6*h.length;if(f-j+g>b){f=j;e+=14}h=this.text(f,e,h).attr({"font-family":"Lucida Console","text-anchor":"start"});f+=g+15;d.push(h)}return d};Raphael.fn.sai.prim.hoverShape=function(j,e,b,a){j=j(this).attr(e);
b=w(j,a&&a[0]||{},a&&a[1]||{},b);j.mouseover(b[0]);j.mouseout(b[1]);return j};Raphael.fn.sai.prim.histogram=function(j,e,b,a,c,f,d,h,g,i,k,l){var m,o,n,p,q,s;if(f==null)f=0;if(d==null)d=1;if(g==null)g=["black","white"];if(i==null)i="white";if(l==null)l=10;q=this.set();q.push(this.rect(j,e-a,b,a).attr({"stroke-width":0,"stroke-opacity":0,fill:i}));a=e-(a-12);e-=5;q.push(this.text(j,e,Sai.util.prettystr(f)).attr({"text-anchor":"start"}));q.push(this.text(j+b,e,Sai.util.prettystr(d)).attr({"text-anchor":"end"}));
e-=7;f={};i=d=0;for(s=c.length;i<s;i++){n=c[i];n=Math.min(l-1,Math.floor(l*n/1));if(n in f)f[n]+=1;else f[n]=1;d=Math.max(d,f[n])}q.push(this.rect(j,e,b,1).attr({fill:"0-"+g[0]+"-"+((o=g[1])!=null?o:g[0]),"stroke-width":0,"stroke-opacity":0}));e-=1;o=b/l;for(m in f){c=(e-a)*(f[m]/d);q.push(g.length===1?p=Sai.util.multiplyColor(g[0],(parseInt(m)+0.5)/l,k,0.2).str:p=Sai.util.colerp(g[0],g[1],(parseInt(m)+0.5)/l),this.rect(j+(parseInt(m)+0.2)*o,e-c,o*0.6,c).attr({fill:p,"stroke-width":k?0.35:0,"stroke-opacity":k?
1:0,stroke:"#000000"}))}q.push(this.text(j+b/2,a-6,Sai.util.prettystr(h)));return q}}).call(this);(function(){var w,D,v=Array.prototype.indexOf||function(j){for(var e=0,b=this.length;e<b;e++)if(this[e]===j)return e;return-1};(D=Raphael.fn.sai).prim!=null||(D.prim={});w=function(j,e,b,a){return[function(){j.attr(e);return a!=null?typeof a[0]==="function"?a[0](j):void 0:void 0},function(){j.attr(b);return a!=null?typeof a[1]==="function"?a[1](j):void 0:void 0}]};Raphael.fn.sai.prim.candlestick=function(j,e,b,a,c,f,d,h,g,i,k){if(d==null)d="black";f%2||f++;f=this.rect(j-f/2,e,f,b-e||1).attr("stroke",
d);a=this.path("M"+j+" "+a+"L"+j+" "+e+"M"+j+" "+b+"L"+j+" "+c).attr("stroke",d);f.attr("fill",h?d:"#ffffff");d=this.set().push(f,a);if(g){j=w(d,{scale:"1.5,1.5,"+j+","+(e+(b-e)/2),"fill-opacity":0.5},{scale:"1.0,1.0,"+j+","+(e+(b-e)/2),"fill-opacity":1},k);d.hover(j[0],j[1])}return d};Raphael.fn.sai.prim.line=function(j,e,b){var a,c,f,d;if(e==null)e="black";if(b==null)b=1;f=0;for(d=j.length;f<d;f++){a=j[f];if(a!=null)if(typeof c!="undefined"&&c!==null)c+="L"+a[0]+" "+a[1];else c="M"+a[0]+" "+a[1]}return this.path(c).attr({stroke:e,
"stroke-width":b})};Raphael.fn.sai.prim.area=function(j,e,b,a){var c,f,d,h,g;if(e==null)e="black";if(b==null)b=1;if(j.length<2)return this.set();h=0;for(g=j.length;h<g;h++){f=j[h];if(f!=null)if(typeof d!="undefined"&&d!==null){d+="L"+f[0]+" "+f[1];c+="L"+f[0]+" "+f[1]}else{d="M"+f[0]+" "+f[1];c="M"+f[0]+" "+f[1]}}for(j=g=a.length-1;g<=0?j<=0:j>=0;j+=-1){f=a[j][0];h=a[j][1];c+="L"+f+","+h}a=this.path(c).attr({fill:e,"stroke-width":0,"stroke-opacity":0,"fill-opacity":0.35});e=this.path(d).attr({stroke:e,
"stroke-width":b});return this.set().push(a,e)};Raphael.fn.sai.prim.stackedBar=function(j,e,b,a,c,f,d){var h,g,i,k,l,m,o,n,p,q;if(c){k=l=a;m=0;for(n=j.length;m<n;m++){g=j[m];if(k<g[1])k=g[1];if(l>g[1])l=g[1]}p=k-l||1}b*=0.67;n=this.set();m=[a,a];l=function(s){return s<a?1:0};g=0;for(q=j.length;0<=q?g<q:g>q;0<=q?g+=1:g-=1)if(j[g]!=null&&j[g][1]!==a){k=l(j[g][1]);i=Math.abs(m[k]-j[g][1]);h=m[k]===a?1:0;o=j[g][1]-(k?0:i-h);n.push(h=this.rect(j[g][0]-b/2,o,b,i-h).attr("fill",(e!=null?e[g]:void 0)||"#000000").attr("stroke",
(e!=null?e[g]:void 0)||"#000000"));if(c){i=w(h,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},[function(s){return function(){d[0]&&d[0]();return f({"(selected)":Sai.util.prettystr(s)+"%"},false)}}(100*(i/p)),d[1]]);h.hover(i[0],i[1])}m[k]=j[g][1]}return n};Raphael.fn.sai.prim.groupedBar=function(j,e,b,a,c,f,d){var h,g,i,k,l,m;f=this.set();h=b/(j.length+1);k=(b-h)/2;i=0;for(l=j.length;0<=l?i<l:i>l;0<=l?i+=1:i-=1)if(((m=j[i])!=null?m[0]:void 0)!=null){b=Math.min(j[i][1],a);g=Math.max(j[i][1],a)-b-0.5;
f.push(this.rect(j[i][0]-k+i*h,b,h-1,g).attr("fill",(e!=null?e[i]:void 0)||"#000000").attr("stroke",(e!=null?e[i]:void 0)||"#000000"))}if(c){j=w(f,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},d);f.hover(j[0],j[1])}return f};Raphael.fn.sai.prim.haxis=function(j,e,b,a,c){var f,d,h,g,i,k,l,m,o,n,p,q,s,r,t,u,x,B,C;q=(t=c.ticklens)!=null?t:[5,2];t=(h=c.width)!=null?h:1;h=(n=c.color)!=null?n:"black";m=this.path("M"+e+" "+b+"l"+a+" 0").attr("stroke",h);s=this.set();l=this.set();n=a/25;k=n<j.length?Math.ceil(j.length/
n):1;g=a/(j.length-1)*k;x=e;u=-1;p=false;n=0;B=null;i=0;for(C=j.length;0<=C?i<C:i>C;i+=k){f=j[i];if(f!=null){d=q[String(f)?0:1];s.push(this.path("M"+x+" "+b+"l0 "+d).attr("stroke",h));if(f!==""){d=this.text(x,b+d+2,Sai.util.prettystr(f).substring(0,12));f=d.getBBox();o=d.attr("y")+5;d.attr("y",o);if(B==null||o<B)B=o;l.push(d);d=f.width;n=Math.max(d,n);if(f.x<=u+3)p=true;if(f.x+d>u)u=f.x+d}}x+=g}if(c.title!=null)r=this.text(e+a/2,B+14,c.title).attr({"font-size":"12px","font-weight":"bold"});j=this.set().push(m,
s,l,r);if(p){r=l.items;a=0;for(c=r.length;a<c;a++){d=r[a];d.rotate(-90);d.translate(0,d.getBBox().width/2-2)}j.push(this.rect(e,b,1,t+n+q[0]).attr("opacity","0"))}return j};Raphael.fn.sai.prim.vaxis=function(j,e,b,a,c){var f,d,h,g,i,k,l,m,o,n,p,q,s,r,t,u,x;p=(f=c.ticklens)!=null?f:[5,2];f=(m=c.color)!=null?m:"black";n=(k=c.right)!=null?k:false;m=this.path("M"+e+" "+b+"l0 "+-a).attr("stroke",f);q=this.set();k=this.set();h=a/(j.length-1);t=b;r=null;i=[];l=true;u=0;for(x=j.length;u<x;u++){g=j[u];if(g!==
null){g=Sai.util.prettystr(g);if(v.call(i,g)>=0){l=false;break}i.push(g)}}if(!l){u=[];i=0;for(l=j.length;i<l;i++){g=j[i];u.push(Sai.util.prettystr(g,2))}i=u}u=l=0;for(x=j.length;u<x;u++){g=j[u];if(g!==null){g=p[String(g)?0:1];q.push(this.path("M"+e+" "+t+"l"+(n?g:-g)+" 0").attr("stroke",f));o=e+(n?1:-1)*(g+3);g=this.text(o,t,i[l++]);g.attr({"text-anchor":n?"start":"end",fill:f});o+=(n?1:-1)*(g.getBBox().width+8);if(r==null||o<r)r=o;k.push(g)}t-=h}if(c.title!=null){s=this.text(r,b-a/2,c.title).attr({"font-size":"12px",
"font-weight":"bold"});j=s.getBBox();s.rotate(-90);d=this.rect(j.x+(j.width-j.height)/2,b,j.height,1).attr({opacity:0})}d!=null||(d=null);return this.set().push(this.set().push(m,q,k,d),s)};Raphael.fn.sai.prim.popup=function(j,e,b){var a,c,f,d,h,g;this.set();g=this.set();c=0;f=e+5+5;if("__HEAD__"in b){a=this.text(j,f,b.__HEAD__).attr({fill:"#cfc","font-size":"12","font-weight":"bold"});c=Math.max(c,a.getBBox().width);g.push(a);f+=17}for(h in b)if(h!=="__HEAD__"){d=this.text(j+5,f,h+" = "+b[h]).attr({fill:"white",
"font-weight":"bold","text-anchor":"start"});c=Math.max(c,d.getBBox().width);f+=10;g.push(d)}b=c+10;this.rect(j,e,b,f-e,5).attr({fill:"black","fill-opacity":".85",stroke:"black"});a!=null&&a.translate(b/2);return g.toFront()};Raphael.fn.sai.prim.legend=function(j,e,b,a,c){var f,d,h,g,i,k,l,m,o;e-=14;i=this.set();h=j;g=e;for(k in a){d=this.text(h+14,g+5,k).attr({fill:(l=c!=null?c[k]:void 0)!=null?l:"black","text-anchor":"start"});f=this.rect(h,g,9,9).attr({fill:(m=a[k])!=null?m:"black",stroke:(o=c!=
null?c[k]:void 0)!=null?o:"black"});f=this.set().push(d,f);d=f.getBBox().width;if(h-j+15+d>b){i.translate(0,-14);f.translate(j-h,e-g);h=j;g=e}h+=d+15;i.push(f)}return i};Raphael.fn.sai.prim.wrappedText=function(j,e,b,a,c){var f,d,h,g;if(a==null)a="";if(c==null)c=" ";typeof spacing!="undefined"&&spacing!==null||(spacing=1);if(!a.match(/^\s*$/)){b=b/6;h=[];for(d=0;d<a.length-1;){f=d+b;g=a.substring(d,f+1);f=f>=a.length?f:g.lastIndexOf(c);h.push(g.substring(0,f));d+=f+1}a=h.join("\n");return this.text(j,
e+5*h.length,a).attr({"font-family":"Lucida Console","text-anchor":"start"})}};Raphael.fn.sai.prim.info=function(j,e,b,a){var c,f,d,h,g,i;d=this.set();f=j;e=e;for(c in a)if(a[c]!==null){h=c+(c===""?"":": ");h+=typeof a[c]==="string"?a[c]:(i=Sai.util.prettynum(a[c]))!=null?i:Sai.util.prettystr(a[c]);g=6*h.length;if(f-j+g>b){f=j;e+=14}h=this.text(f,e,h).attr({"font-family":"Lucida Console","text-anchor":"start"});f+=g+15;d.push(h)}return d};Raphael.fn.sai.prim.hoverShape=function(j,e,b,a){j=j(this).attr(e);
b=w(j,a&&a[0]||{},a&&a[1]||{},b);j.mouseover(b[0]);j.mouseout(b[1]);return j};Raphael.fn.sai.prim.histogram=function(j,e,b,a,c,f,d,h,g,i,k,l){var m,o,n,p,q,s;if(f==null)f=0;if(d==null)d=1;if(g==null)g=["black","white"];if(i==null)i="white";if(l==null)l=10;q=this.set();q.push(this.rect(j,e-a,b,a).attr({"stroke-width":0,"stroke-opacity":0,fill:i}));a=e-(a-12);e-=5;q.push(this.text(j,e,Sai.util.prettystr(f)).attr({"text-anchor":"start"}));q.push(this.text(j+b,e,Sai.util.prettystr(d)).attr({"text-anchor":"end"}));
e-=7;f={};i=d=0;for(s=c.length;i<s;i++){n=c[i];n=Math.min(l-1,Math.floor(l*n/1));if(n in f)f[n]+=1;else f[n]=1;d=Math.max(d,f[n])}q.push(this.rect(j,e,b,1).attr({fill:"0-"+g[0]+"-"+((o=g[1])!=null?o:g[0]),"stroke-width":0,"stroke-opacity":0}));e-=1;o=b/l;for(m in f){c=(e-a)*(f[m]/d);q.push(g.length===1?p=Sai.util.multiplyColor(g[0],(parseInt(m)+0.5)/l,k,0.2).str:p=Sai.util.colerp(g[0],g[1],(parseInt(m)+0.5)/l),this.rect(j+(parseInt(m)+0.2)*o,e-c,o*0.6,c).attr({fill:p,"stroke-width":k?0.35:0,"stroke-opacity":k?
1:0,stroke:"#000000"}))}q.push(this.text(j+b/2,a-6,Sai.util.prettystr(h)));return q}}).call(this);(function(){var w,D,v=Array.prototype.indexOf||function(j){for(var e=0,b=this.length;e<b;e++)if(this[e]===j)return e;return-1};(D=Raphael.fn.sai).prim!=null||(D.prim={});w=function(j,e,b,a){return[function(){j.attr(e);return a!=null?typeof a[0]==="function"?a[0](j):void 0:void 0},function(){j.attr(b);return a!=null?typeof a[1]==="function"?a[1](j):void 0:void 0}]};Raphael.fn.sai.prim.candlestick=function(j,e,b,a,c,f,d,h,g,i,k){if(d==null)d="black";f%2||f++;f=this.rect(j-f/2,e,f,b-e||1).attr("stroke",
d);a=this.path("M"+j+" "+a+"L"+j+" "+e+"M"+j+" "+b+"L"+j+" "+c).attr("stroke",d);f.attr("fill",h?d:"#ffffff");d=this.set().push(f,a);if(g){j=w(d,{scale:"1.5,1.5,"+j+","+(e+(b-e)/2),"fill-opacity":0.5},{scale:"1.0,1.0,"+j+","+(e+(b-e)/2),"fill-opacity":1},k);d.hover(j[0],j[1])}return d};Raphael.fn.sai.prim.line=function(j,e,b){var a,c,f,d;if(e==null)e="black";if(b==null)b=1;f=0;for(d=j.length;f<d;f++){a=j[f];if(a!=null)if(typeof c!="undefined"&&c!==null)c+="L"+a[0]+" "+a[1];else c="M"+a[0]+" "+a[1]}return this.path(c).attr({stroke:e,
"stroke-width":b})};Raphael.fn.sai.prim.area=function(j,e,b,a){var c,f,d,h,g;if(e==null)e="black";if(b==null)b=1;if(j.length<2)return this.set();h=0;for(g=j.length;h<g;h++){f=j[h];if(f!=null)if(typeof d!="undefined"&&d!==null){d+="L"+f[0]+" "+f[1];c+="L"+f[0]+" "+f[1]}else{d="M"+f[0]+" "+f[1];c="M"+f[0]+" "+f[1]}}for(j=g=a.length-1;g<=0?j<=0:j>=0;j+=-1){f=a[j][0];h=a[j][1];c+="L"+f+","+h}a=this.path(c).attr({fill:e,"stroke-width":0,"stroke-opacity":0,"fill-opacity":0.35});e=this.path(d).attr({stroke:e,
"stroke-width":b});return this.set().push(a,e)};Raphael.fn.sai.prim.stackedBar=function(j,e,b,a,c,f,d){var h,g,i,k,l,m,o,n,p,q;if(c){k=l=a;m=0;for(n=j.length;m<n;m++){g=j[m];if(k<g[1])k=g[1];if(l>g[1])l=g[1]}p=k-l||1}b*=0.67;n=this.set();m=[a,a];l=function(s){return s<a?1:0};g=0;for(q=j.length;0<=q?g<q:g>q;0<=q?g+=1:g-=1)if(j[g]!=null&&j[g][1]!==a){k=l(j[g][1]);i=Math.abs(m[k]-j[g][1]);h=m[k]===a?1:0;o=j[g][1]-(k?0:i-h);n.push(h=this.rect(j[g][0]-b/2,o,b,i-h).attr("fill",(e!=null?e[g]:void 0)||"#000000").attr("stroke",
(e!=null?e[g]:void 0)||"#000000"));if(c){i=w(h,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},[function(s){return function(){d[0]&&d[0]();return f({"(selected)":Sai.util.prettystr(s)+"%"},false)}}(100*(i/p)),d[1]]);h.hover(i[0],i[1])}m[k]=j[g][1]}return n};Raphael.fn.sai.prim.groupedBar=function(j,e,b,a,c,f,d){var h,g,i,k,l,m;f=this.set();h=b/(j.length+1);k=(b-h)/2;i=0;for(l=j.length;0<=l?i<l:i>l;0<=l?i+=1:i-=1)if(((m=j[i])!=null?m[0]:void 0)!=null){b=Math.min(j[i][1],a);g=Math.max(j[i][1],a)-b-0.5;
f.push(this.rect(j[i][0]-k+i*h,b,h-1,g).attr("fill",(e!=null?e[i]:void 0)||"#000000").attr("stroke",(e!=null?e[i]:void 0)||"#000000"))}if(c){j=w(f,{"fill-opacity":"0.75"},{"fill-opacity":"1.0"},d);f.hover(j[0],j[1])}return f};Raphael.fn.sai.prim.haxis=function(j,e,b,a,c){var f,d,h,g,i,k,l,m,o,n,p,q,s,r,t,u,x,B,C;q=(t=c.ticklens)!=null?t:[5,2];t=(h=c.width)!=null?h:1;h=(n=c.color)!=null?n:"black";m=this.path("M"+e+" "+b+"l"+a+" 0").attr("stroke",h);s=this.set();l=this.set();n=a/25;k=n<j.length?Math.ceil(j.length/
n):1;g=a/(j.length-1)*k;x=e;u=-1;p=false;n=0;B=null;i=0;for(C=j.length;0<=C?i<C:i>C;i+=k){f=j[i];if(f!=null){d=q[String(f)?0:1];s.push(this.path("M"+x+" "+b+"l0 "+d).attr("stroke",h));if(f!==""){d=this.text(x,b+d+2,Sai.util.prettystr(f).substring(0,12));f=d.getBBox();o=d.attr("y")+5;d.attr("y",o);if(B==null||o<B)B=o;l.push(d);d=f.width;n=Math.max(d,n);if(f.x<=u+3)p=true;if(f.x+d>u)u=f.x+d}}x+=g}if(c.title!=null)r=this.text(e+a/2,B+14,c.title).attr({"font-size":"12px","font-weight":"bold"});j=this.set().push(m,
s,l,r);if(p){r=l.items;a=0;for(c=r.length;a<c;a++){d=r[a];d.rotate(-90);d.translate(0,d.getBBox().width/2-2)}j.push(this.rect(e,b,1,t+n+q[0]).attr("opacity","0"))}return j};Raphael.fn.sai.prim.vaxis=function(j,e,b,a,c){var f,d,h,g,i,k,l,m,o,n,p,q,s,r,t,u,x;p=(f=c.ticklens)!=null?f:[5,2];f=(m=c.color)!=null?m:"black";n=(k=c.right)!=null?k:false;m=this.path("M"+e+" "+b+"l0 "+-a).attr("stroke",f);q=this.set();k=this.set();h=a/(j.length-1);t=b;r=null;i=[];l=true;u=0;for(x=j.length;u<x;u++){g=j[u];if(g!==
null){g=Sai.util.prettystr(g);if(v.call(i,g)>=0){l=false;break}i.push(g)}}if(!l){u=[];i=0;for(l=j.length;i<l;i++){g=j[i];u.push(Sai.util.prettystr(g,2))}i=u}u=l=0;for(x=j.length;u<x;u++){g=j[u];if(g!==null){g=p[String(g)?0:1];q.push(this.path("M"+e+" "+t+"l"+(n?g:-g)+" 0").attr("stroke",f));o=e+(n?1:-1)*(g+3);g=this.text(o,t,i[l++]);g.attr({"text-anchor":n?"start":"end",fill:f});o+=(n?1:-1)*(g.getBBox().width+8);if(r==null||o<r)r=o;k.push(g)}t-=h}if(c.title!=null){s=this.text(r,b-a/2,c.title).attr({"font-size":"12px",
"font-weight":"bold"});j=s.getBBox();s.rotate(-90);d=this.rect(j.x+(j.width-j.height)/2,b,j.height,1).attr({opacity:0})}d!=null||(d=null);return this.set().push(this.set().push(m,q,k,d),s)};Raphael.fn.sai.prim.popup=function(j,e,b){var a,c,f,d,h,g;this.set();g=this.set();c=0;f=e+5+5;if("__HEAD__"in b){a=this.text(j,f,b.__HEAD__).attr({fill:"#cfc","font-size":"12","font-weight":"bold"});c=Math.max(c,a.getBBox().width);g.push(a);f+=17}for(h in b)if(h!=="__HEAD__"){d=this.text(j+5,f,h+" = "+b[h]).attr({fill:"white",
"font-weight":"bold","text-anchor":"start"});c=Math.max(c,d.getBBox().width);f+=10;g.push(d)}b=c+10;this.rect(j,e,b,f-e,5).attr({fill:"black","fill-opacity":".85",stroke:"black"});a!=null&&a.translate(b/2);return g.toFront()};Raphael.fn.sai.prim.legend=function(j,e,b,a,c){var f,d,h,g,i,k,l,m,o;e-=14;i=this.set();h=j;g=e;for(k in a){d=this.text(h+14,g+5,k).attr({fill:(l=c!=null?c[k]:void 0)!=null?l:"black","text-anchor":"start"});f=this.rect(h,g,9,9).attr({fill:(m=a[k])!=null?m:"black",stroke:(o=c!=
null?c[k]:void 0)!=null?o:"black"});f=this.set().push(d,f);d=f.getBBox().width;if(h-j+15+d>b){i.translate(0,-14);f.translate(j-h,e-g);h=j;g=e}h+=d+15;i.push(f)}return i};Raphael.fn.sai.prim.wrappedText=function(j,e,b,a,c){var f,d,h,g;if(a==null)a="";if(c==null)c=" ";typeof spacing!="undefined"&&spacing!==null||(spacing=1);if(!a.match(/^\s*$/)){b=b/6;h=[];for(d=0;d<a.length-1;){f=d+b;g=a.substring(d,f+1);f=f>=a.length?f:g.lastIndexOf(c);h.push(g.substring(0,f));d+=f+1}a=h.join("\n");return this.text(j,
e+5*h.length,a).attr({"font-family":"Lucida Console","text-anchor":"start"})}};Raphael.fn.sai.prim.info=function(j,e,b,a){var c,f,d,h,g,i;d=this.set();f=j;e=e;for(c in a)if(a[c]!==null){h=c+(c===""?"":": ");h+=typeof a[c]==="string"?a[c]:(i=Sai.util.prettynum(a[c]))!=null?i:Sai.util.prettystr(a[c]);g=6*h.length;if(f-j+g>b){f=j;e+=14}h=this.text(f,e,h).attr({"font-family":"Lucida Console","text-anchor":"start"});f+=g+15;d.push(h)}return d};Raphael.fn.sai.prim.hoverShape=function(j,e,b,a){j=j(this).attr(e);
b=w(j,a&&a[0]||{},a&&a[1]||{},b);j.mouseover(b[0]);j.mouseout(b[1]);return j};Raphael.fn.sai.prim.histogram=function(j,e,b,a,c,f,d,h,g,i,k,l){var m,o,n,p,q,s;if(f==null)f=0;if(d==null)d=1;if(g==null)g=["black","white"];if(i==null)i="white";if(l==null)l=10;q=this.set();q.push(this.rect(j,e-a,b,a).attr({"stroke-width":0,"stroke-opacity":0,fill:i}));a=e-(a-12);e-=5;q.push(this.text(j,e,Sai.util.prettystr(f)).attr({"text-anchor":"start"}));q.push(this.text(j+b,e,Sai.util.prettystr(d)).attr({"text-anchor":"end"}));
e-=7;f={};i=d=0;for(s=c.length;i<s;i++){n=c[i];n=Math.min(l-1,Math.floor(l*n/1));if(n in f)f[n]+=1;else f[n]=1;d=Math.max(d,f[n])}q.push(this.rect(j,e,b,1).attr({fill:"0-"+g[0]+"-"+((o=g[1])!=null?o:g[0]),"stroke-width":0,"stroke-opacity":0}));e-=1;o=b/l;for(m in f){c=(e-a)*(f[m]/d);q.push(g.length===1?p=Sai.util.multiplyColor(g[0],(parseInt(m)+0.5)/l,k,0.2).str:p=Sai.util.colerp(g[0],g[1],(parseInt(m)+0.5)/l),this.rect(j+(parseInt(m)+0.2)*o,e-c,o*0.6,c).attr({fill:p,"stroke-width":k?0.35:0,"stroke-opacity":k?
1:0,stroke:"#000000"}))}q.push(this.text(j+b/2,a-6,Sai.util.prettystr(h)));return q}}).call(this);(function(){var w=Object.prototype.hasOwnProperty,D=function(j,e){function b(){this.constructor=j}for(var a in e)if(w.call(e,a))j[a]=e[a];b.prototype=e.prototype;j.prototype=new b;j.__super__=e.prototype;return j},v=function(j,e){return function(){return j.apply(e,arguments)}};Sai.Plot=function(){function j(e,b,a,c,f,d,h,g){this.r=e;this.x=b;this.y=a;this.w=c;this.h=f;this.data=d;this.rawdata=h;this.opts=g!=null?g:{};this.setDenormalizedData();this.set=this.r.set()}j.prototype.setDenormalizedData=
function(){var e,b,a,c,f,d,h,g,i,k;if(this.data instanceof Array){h=this.data;i=[];a=0;for(f=h.length;a<f;a++){e=h[a];i.push(this.denormalize(e))}return this.dndata=i}else{this.dndata!=null||(this.dndata={});a=[];for(b in this.data)a.push(this.dndata[b]=function(){g=this.data[b];k=[];c=0;for(d=g.length;c<d;c++){e=g[c];k.push(this.denormalize(e))}return k}.call(this));return a}};j.prototype.denormalize=function(e){if(e instanceof Array)return[this.x+this.w*e[0],this.y-this.h*e[1]]};j.prototype.render=
function(){this.set.push(this.r.rect(20,20,20,20).attr("fill","red"),this.r.circle(40,40,10).attr("fill","blue"));return this};return j}();Sai.LinePlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,Sai.Plot);j.prototype.setDenormalizedData=function(){var e,b,a,c;j.__super__.setDenormalizedData.apply(this,arguments);c=[];for(e in this.dndata)c.push(this.dndata[e].length===1&&((b=this.dndata[e])!=null?(a=b[0])!=null?a[0]:void 0:void 0)===this.x?this.dndata[e].push([this.x+
this.w,this.dndata[e][0][1]]):void 0);return c};j.prototype.render=function(e,b){var a;this.set.remove();for(a in this.dndata)a.match("^__")||this.set.push(this.r.sai.prim.line(this.dndata[a],(e!=null?e[a]:void 0)||"black",b||1));return this};return j}();Sai.AreaPlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,Sai.LinePlot);j.prototype.render=function(e,b,a,c){var f,d,h,g,i,k,l;this.set.remove();l=[];i=0;for(k=c.length;i<k;i++){d=c[i];l.push(this.denormalize(d))}c=l;
for(g in this.dndata)if(!g.match("^__")){d=0;for(i=this.dndata[g].length;0<=i?d<i:d>i;0<=i?d+=1:d-=1){f=this.dndata[g][d];if(f!=null)break}for(d=i=this.dndata[g].length-1;i<=0?d<=0:d>=0;i<=0?d+=1:d-=1){h=this.dndata[g][d];if(h!=null)break}l=[];i=0;for(k=c.length;i<k;i++){d=c[i];l.push([Math.max(Math.min(h[0],d[0]),f[0]),d[1]])}d=l;this.set.push(this.r.sai.prim.area(this.dndata[g],(e!=null?e[g]:void 0)||"black",b||1,d));if(a)c=this.dndata[g]}return this};return j}();Sai.CandlestickPlot=function(){function j(){j.__super__.constructor.apply(this,
arguments)}D(j,Sai.Plot);j.prototype.render=function(e,b,a,c){var f,d,h,g,i,k;if(b==null)b=5;this.set.remove();f=(e!=null?e.up:void 0)||"black";e=(e!=null?e.down:void 0)||"red";d=0;for(k=this.dndata.open.length;0<=k?d<k:d>k;0<=k?d+=1:d-=1)if(this.dndata.close[d]!=null){i=this.dndata.close[d][1]<this.dndata.open[d][1];h={};for(g in this.rawdata)h[g]=this.rawdata[g][d];this.set.push(this.r.sai.prim.candlestick(this.dndata.open[d][0],i&&this.dndata.close[d][1]||this.dndata.open[d][1],i&&this.dndata.open[d][1]||
this.dndata.close[d][1],this.dndata.high[d][1],this.dndata.low[d][1],b||5,d&&this.dndata.close[d-1]!=null&&this.dndata.close[d-1][1]<this.dndata.close[d][1]?e:f,!i,a,c,Sai.util.infoSetters(c,h)))}return this};return j}();Sai.BarPlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,Sai.Plot);j.prototype.render=function(e,b,a,c,f,d){var h,g,i,k,l,m,o,n,p;this.set.remove();b=this.denormalize([0,b])[1];l=0;g=[];h=e?this.r.sai.prim.stackedBar:this.r.sai.prim.groupedBar;for(p in this.dndata){l=
Math.max(l,this.dndata[p].length);g.push((a!=null?a[p]:void 0)||"black")}for(i=0;0<=l?i<l:i>l;0<=l?i+=1:i-=1){a=[];for(p in this.dndata)a.push(this.dndata[p][i]);k={};for(n in this.rawdata)k[n]=this.rawdata[n][i];if(e){o=m=0;for(p in this.rawdata)if(p!==d)if(!isNaN(this.rawdata[p][i])){m+=Math.abs(this.rawdata[p][i]);o+=this.rawdata[p][i]}k["(magnitude)"]=m}this.set.push(h(a,g,this.w/l,b,c,f,Sai.util.infoSetters(f,k)))}return this};return j}();Sai.GeoPlot=function(){function j(){j.__super__.constructor.apply(this,
arguments)}D(j,Sai.Plot);j.prototype.getRegionColor=function(e,b,a){var c;return Sai.util.multiplyColor(e[a],((c=this.data[a][b])!=null?c[1]:void 0)||0,this.opts.fromWhite,this.opts.fromWhite?0.2:0).str};j.prototype.getRegionOpacity=function(e,b){var a;return((a=this.data[b][e])!=null?a[1]:void 0)!=null?1:this.opts.fromWhite?0.15:0.25};j.prototype.render=function(e,b,a,c,f,d,h){var g,i,k,l,m,o,n,p,q,s,r,t,u;this.set.remove();u=this.rawdata[a];r=[];k=0;for(t=u.length;k<t;k++){g=u[k];r.push(g.toUpperCase())}p=
{};k=0;for(t=r.length;0<=t?k<t:k>t;0<=t?k+=1:k-=1)p[r[k]]=k;r=function(x){q=p[x];o=b.name[x];l={region:o!=null?o:x};for(s in this.rawdata)if(s!==a)l[s]=this.rawdata[s][q];i=this.getRegionColor(e,q,c);n=this.getRegionOpacity(q,c);m=Sai.util.infoSetters(h,l);return this.set.push(this.r.sai.prim.hoverShape(function(B,C,F,G){return function(H){return H.path(B).translate(F,G).scale(C,C,F,G)}}(b.paths[x],Math.min(this.w/b.width,this.h/b.height),this.x,this.y-this.h),{fill:i,stroke:this.opts.fromWhite?"black":
f,"stroke-width":0.5,opacity:n},d?[function(B){return function(C){navigator.userAgent.toLowerCase().indexOf("msie")!==-1||navigator.userAgent.toLowerCase().indexOf("opera")!==-1||C.toFront();return B()}}(m[0]),m[1]]:null,d?[{"fill-opacity":0.75,"stroke-width":this.opts.fromWhite?1.5:0.5},{"fill-opacity":1,"stroke-width":0.5}]:null))};for(g in b.paths)r.call(this,g);g=this.set.getBBox();this.set.translate((this.w-g.width)/2,(this.h-g.height)/2);return this};return j}();Sai.ChromaticGeoPlot=function(){function j(){j.__super__.constructor.apply(this,
arguments)}D(j,Sai.GeoPlot);j.prototype.getRegionColor=function(e,b){var a,c,f,d,h,g;f=c=a=0;for(h in this.data){d=Sai.util.multiplyColor(e[h],((g=this.data[h][b])!=null?g[1]:void 0)||0,this.opts.fromWhite);f+=d.r;c+=d.g;a+=d.b}return"rgb("+f+", "+c+", "+a+")"};j.prototype.getRegionOpacity=function(e){var b,a;for(b in this.data)if(((a=this.data[b][e])!=null?a[1]:void 0)!=null)return 1;return 0.25};return j}();Sai.ScatterPlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,
Sai.Plot);j.prototype.render=function(e,b,a,c,f,d,h){var g,i,k,l,m,o,n,p,q,s,r,t,u,x,B,C,F,G,H,I,J,R,L,M,N,O,P,Q,S;this.set.remove();for(q in this.dndata){n=this.dndata[q].length;break}o=function(A,y,z){return y*z+A*(1-z)};x=v(function(A){return this.x+this.w*((A-this.y)/-this.h)},this);B=function(A){t=x((C=this.dndata[e.x])!=null?C[A][1]:void 0);u=(R=this.dndata[e.y])!=null?R[A][1]:void 0;i=b instanceof Array&&e.color!=null?Sai.util.colerp(b[0],b[1],(L=(M=this.data[e.color])!=null?(N=M[A])!=null?
N[1]:void 0:void 0)!=null?L:0):b instanceof Object&&e.color!=null?b[this.rawdata[e.color][A]]:"black";s=f instanceof Array&&e.stroke_color!=null?Sai.util.colerp(f[0],f[1],(O=(P=this.data[e.stroke_color])!=null?(Q=P[A])!=null?Q[1]:void 0:void 0)!=null?O:0):b instanceof Object&&e.color!=null?f[this.rawdata[e.stroke_color][A]]:"black";p=a instanceof Array&&e.radius!=null?o(a[0],a[1],(S=(F=this.data[e.radius])!=null?(G=F[A])!=null?G[1]:void 0:void 0)!=null?S:0):a instanceof Object&&e.radius!=null?a[this.rawdata[e.radius][A]]:
5;r=c instanceof Array&&e.stroke_opacity!=null?o(c[0],c[1],(H=(I=this.data[e.stroke_opacity])!=null?(J=I[A])!=null?J[1]:void 0:void 0)!=null?H:0):c instanceof Object&&e.stroke_opacity!=null?c[this.rawdata[e.stroke_opacity][A]]:1;if(d){l={};for(q in this.rawdata)q.match("^__")||(l[q]=this.rawdata[q][A]);m=Sai.util.infoSetters(h,l)}return this.set.push(g=this.r.circle(t,u,p).attr({fill:i,"stroke-opacity":r,stroke:s,"fill-opacity":0.8,"stroke-width":2}),d?g.hover(function(y){return function(){y();return this.attr("fill-opacity",
0.5)}}(m[0]),function(y){return function(){y();return this.attr("fill-opacity",0.8)}}(m[1])):void 0)};for(k=0;0<=n?k<n:k>n;0<=n?k+=1:k-=1)B.call(this,k);return this};return j}()}).call(this);(function(){var w=Object.prototype.hasOwnProperty,D=function(j,e){function b(){this.constructor=j}for(var a in e)if(w.call(e,a))j[a]=e[a];b.prototype=e.prototype;j.prototype=new b;j.__super__=e.prototype;return j},v=function(j,e){return function(){return j.apply(e,arguments)}};Sai.Plot=function(){function j(e,b,a,c,f,d,h,g){this.r=e;this.x=b;this.y=a;this.w=c;this.h=f;this.data=d;this.rawdata=h;this.opts=g!=null?g:{};this.setDenormalizedData();this.set=this.r.set()}j.prototype.setDenormalizedData=
function(){var e,b,a,c,f,d,h,g,i,k;if(this.data instanceof Array){h=this.data;i=[];a=0;for(f=h.length;a<f;a++){e=h[a];i.push(this.denormalize(e))}return this.dndata=i}else{this.dndata!=null||(this.dndata={});a=[];for(b in this.data)a.push(this.dndata[b]=function(){g=this.data[b];k=[];c=0;for(d=g.length;c<d;c++){e=g[c];k.push(this.denormalize(e))}return k}.call(this));return a}};j.prototype.denormalize=function(e){if(e instanceof Array)return[this.x+this.w*e[0],this.y-this.h*e[1]]};j.prototype.render=
function(){this.set.push(this.r.rect(20,20,20,20).attr("fill","red"),this.r.circle(40,40,10).attr("fill","blue"));return this};return j}();Sai.LinePlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,Sai.Plot);j.prototype.setDenormalizedData=function(){var e,b,a,c;j.__super__.setDenormalizedData.apply(this,arguments);c=[];for(e in this.dndata)c.push(this.dndata[e].length===1&&((b=this.dndata[e])!=null?(a=b[0])!=null?a[0]:void 0:void 0)===this.x?this.dndata[e].push([this.x+
this.w,this.dndata[e][0][1]]):void 0);return c};j.prototype.render=function(e,b){var a;this.set.remove();for(a in this.dndata)a.match("^__")||this.set.push(this.r.sai.prim.line(this.dndata[a],(e!=null?e[a]:void 0)||"black",b||1));return this};return j}();Sai.AreaPlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,Sai.LinePlot);j.prototype.render=function(e,b,a,c){var f,d,h,g,i,k,l;this.set.remove();l=[];i=0;for(k=c.length;i<k;i++){d=c[i];l.push(this.denormalize(d))}c=l;
for(g in this.dndata)if(!g.match("^__")){d=0;for(i=this.dndata[g].length;0<=i?d<i:d>i;0<=i?d+=1:d-=1){f=this.dndata[g][d];if(f!=null)break}for(d=i=this.dndata[g].length-1;i<=0?d<=0:d>=0;i<=0?d+=1:d-=1){h=this.dndata[g][d];if(h!=null)break}l=[];i=0;for(k=c.length;i<k;i++){d=c[i];l.push([Math.max(Math.min(h[0],d[0]),f[0]),d[1]])}d=l;this.set.push(this.r.sai.prim.area(this.dndata[g],(e!=null?e[g]:void 0)||"black",b||1,d));if(a)c=this.dndata[g]}return this};return j}();Sai.CandlestickPlot=function(){function j(){j.__super__.constructor.apply(this,
arguments)}D(j,Sai.Plot);j.prototype.render=function(e,b,a,c){var f,d,h,g,i,k;if(b==null)b=5;this.set.remove();f=(e!=null?e.up:void 0)||"black";e=(e!=null?e.down:void 0)||"red";d=0;for(k=this.dndata.open.length;0<=k?d<k:d>k;0<=k?d+=1:d-=1)if(this.dndata.close[d]!=null){i=this.dndata.close[d][1]<this.dndata.open[d][1];h={};for(g in this.rawdata)h[g]=this.rawdata[g][d];this.set.push(this.r.sai.prim.candlestick(this.dndata.open[d][0],i&&this.dndata.close[d][1]||this.dndata.open[d][1],i&&this.dndata.open[d][1]||
this.dndata.close[d][1],this.dndata.high[d][1],this.dndata.low[d][1],b||5,d&&this.dndata.close[d-1]!=null&&this.dndata.close[d-1][1]<this.dndata.close[d][1]?e:f,!i,a,c,Sai.util.infoSetters(c,h)))}return this};return j}();Sai.BarPlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,Sai.Plot);j.prototype.render=function(e,b,a,c,f,d){var h,g,i,k,l,m,o,n,p;this.set.remove();b=this.denormalize([0,b])[1];l=0;g=[];h=e?this.r.sai.prim.stackedBar:this.r.sai.prim.groupedBar;for(p in this.dndata){l=
Math.max(l,this.dndata[p].length);g.push((a!=null?a[p]:void 0)||"black")}for(i=0;0<=l?i<l:i>l;0<=l?i+=1:i-=1){a=[];for(p in this.dndata)a.push(this.dndata[p][i]);k={};for(n in this.rawdata)k[n]=this.rawdata[n][i];if(e){o=m=0;for(p in this.rawdata)if(p!==d)if(!isNaN(this.rawdata[p][i])){m+=Math.abs(this.rawdata[p][i]);o+=this.rawdata[p][i]}k["(magnitude)"]=m}this.set.push(h(a,g,this.w/l,b,c,f,Sai.util.infoSetters(f,k)))}return this};return j}();Sai.GeoPlot=function(){function j(){j.__super__.constructor.apply(this,
arguments)}D(j,Sai.Plot);j.prototype.getRegionColor=function(e,b,a){var c;return Sai.util.multiplyColor(e[a],((c=this.data[a][b])!=null?c[1]:void 0)||0,this.opts.fromWhite,this.opts.fromWhite?0.2:0).str};j.prototype.getRegionOpacity=function(e,b){var a;return((a=this.data[b][e])!=null?a[1]:void 0)!=null?1:this.opts.fromWhite?0.15:0.25};j.prototype.render=function(e,b,a,c,f,d,h){var g,i,k,l,m,o,n,p,q,s,r,t,u;this.set.remove();u=this.rawdata[a];r=[];k=0;for(t=u.length;k<t;k++){g=u[k];r.push(g.toUpperCase())}p=
{};k=0;for(t=r.length;0<=t?k<t:k>t;0<=t?k+=1:k-=1)p[r[k]]=k;r=function(x){q=p[x];o=b.name[x];l={region:o!=null?o:x};for(s in this.rawdata)if(s!==a)l[s]=this.rawdata[s][q];i=this.getRegionColor(e,q,c);n=this.getRegionOpacity(q,c);m=Sai.util.infoSetters(h,l);return this.set.push(this.r.sai.prim.hoverShape(function(B,C,F,G){return function(H){return H.path(B).translate(F,G).scale(C,C,F,G)}}(b.paths[x],Math.min(this.w/b.width,this.h/b.height),this.x,this.y-this.h),{fill:i,stroke:this.opts.fromWhite?"black":
f,"stroke-width":0.5,opacity:n},d?[function(B){return function(C){navigator.userAgent.toLowerCase().indexOf("msie")!==-1||navigator.userAgent.toLowerCase().indexOf("opera")!==-1||C.toFront();return B()}}(m[0]),m[1]]:null,d?[{"fill-opacity":0.75,"stroke-width":this.opts.fromWhite?1.5:0.5},{"fill-opacity":1,"stroke-width":0.5}]:null))};for(g in b.paths)r.call(this,g);g=this.set.getBBox();this.set.translate((this.w-g.width)/2,(this.h-g.height)/2);return this};return j}();Sai.ChromaticGeoPlot=function(){function j(){j.__super__.constructor.apply(this,
arguments)}D(j,Sai.GeoPlot);j.prototype.getRegionColor=function(e,b){var a,c,f,d,h,g;f=c=a=0;for(h in this.data){d=Sai.util.multiplyColor(e[h],((g=this.data[h][b])!=null?g[1]:void 0)||0,this.opts.fromWhite);f+=d.r;c+=d.g;a+=d.b}return"rgb("+f+", "+c+", "+a+")"};j.prototype.getRegionOpacity=function(e){var b,a;for(b in this.data)if(((a=this.data[b][e])!=null?a[1]:void 0)!=null)return 1;return 0.25};return j}();Sai.ScatterPlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,
Sai.Plot);j.prototype.render=function(e,b,a,c,f,d,h){var g,i,k,l,m,o,n,p,q,s,r,t,u,x,B,C,F,G,H,I,J,R,L,M,N,O,P,Q,S;this.set.remove();for(q in this.dndata){n=this.dndata[q].length;break}o=function(A,y,z){return y*z+A*(1-z)};x=v(function(A){return this.x+this.w*((A-this.y)/-this.h)},this);B=function(A){t=x((C=this.dndata[e.x])!=null?C[A][1]:void 0);u=(R=this.dndata[e.y])!=null?R[A][1]:void 0;i=b instanceof Array&&e.color!=null?Sai.util.colerp(b[0],b[1],(L=(M=this.data[e.color])!=null?(N=M[A])!=null?
N[1]:void 0:void 0)!=null?L:0):b instanceof Object&&e.color!=null?b[this.rawdata[e.color][A]]:"black";s=f instanceof Array&&e.stroke_color!=null?Sai.util.colerp(f[0],f[1],(O=(P=this.data[e.stroke_color])!=null?(Q=P[A])!=null?Q[1]:void 0:void 0)!=null?O:0):b instanceof Object&&e.color!=null?f[this.rawdata[e.stroke_color][A]]:"black";p=a instanceof Array&&e.radius!=null?o(a[0],a[1],(S=(F=this.data[e.radius])!=null?(G=F[A])!=null?G[1]:void 0:void 0)!=null?S:0):a instanceof Object&&e.radius!=null?a[this.rawdata[e.radius][A]]:
5;r=c instanceof Array&&e.stroke_opacity!=null?o(c[0],c[1],(H=(I=this.data[e.stroke_opacity])!=null?(J=I[A])!=null?J[1]:void 0:void 0)!=null?H:0):c instanceof Object&&e.stroke_opacity!=null?c[this.rawdata[e.stroke_opacity][A]]:1;if(d){l={};for(q in this.rawdata)q.match("^__")||(l[q]=this.rawdata[q][A]);m=Sai.util.infoSetters(h,l)}return this.set.push(g=this.r.circle(t,u,p).attr({fill:i,"stroke-opacity":r,stroke:s,"fill-opacity":0.8,"stroke-width":2}),d?g.hover(function(y){return function(){y();return this.attr("fill-opacity",
0.5)}}(m[0]),function(y){return function(){y();return this.attr("fill-opacity",0.8)}}(m[1])):void 0)};for(k=0;0<=n?k<n:k>n;0<=n?k+=1:k-=1)B.call(this,k);return this};return j}()}).call(this);(function(){var w=Object.prototype.hasOwnProperty,D=function(j,e){function b(){this.constructor=j}for(var a in e)if(w.call(e,a))j[a]=e[a];b.prototype=e.prototype;j.prototype=new b;j.__super__=e.prototype;return j},v=function(j,e){return function(){return j.apply(e,arguments)}};Sai.Plot=function(){function j(e,b,a,c,f,d,h,g){this.r=e;this.x=b;this.y=a;this.w=c;this.h=f;this.data=d;this.rawdata=h;this.opts=g!=null?g:{};this.setDenormalizedData();this.set=this.r.set()}j.prototype.setDenormalizedData=
function(){var e,b,a,c,f,d,h,g,i,k;if(this.data instanceof Array){h=this.data;i=[];a=0;for(f=h.length;a<f;a++){e=h[a];i.push(this.denormalize(e))}return this.dndata=i}else{this.dndata!=null||(this.dndata={});a=[];for(b in this.data)a.push(this.dndata[b]=function(){g=this.data[b];k=[];c=0;for(d=g.length;c<d;c++){e=g[c];k.push(this.denormalize(e))}return k}.call(this));return a}};j.prototype.denormalize=function(e){if(e instanceof Array)return[this.x+this.w*e[0],this.y-this.h*e[1]]};j.prototype.render=
function(){this.set.push(this.r.rect(20,20,20,20).attr("fill","red"),this.r.circle(40,40,10).attr("fill","blue"));return this};return j}();Sai.LinePlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,Sai.Plot);j.prototype.setDenormalizedData=function(){var e,b,a,c;j.__super__.setDenormalizedData.apply(this,arguments);c=[];for(e in this.dndata)c.push(this.dndata[e].length===1&&((b=this.dndata[e])!=null?(a=b[0])!=null?a[0]:void 0:void 0)===this.x?this.dndata[e].push([this.x+
this.w,this.dndata[e][0][1]]):void 0);return c};j.prototype.render=function(e,b){var a;this.set.remove();for(a in this.dndata)a.match("^__")||this.set.push(this.r.sai.prim.line(this.dndata[a],(e!=null?e[a]:void 0)||"black",b||1));return this};return j}();Sai.AreaPlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,Sai.LinePlot);j.prototype.render=function(e,b,a,c){var f,d,h,g,i,k,l;this.set.remove();l=[];i=0;for(k=c.length;i<k;i++){d=c[i];l.push(this.denormalize(d))}c=l;
for(g in this.dndata)if(!g.match("^__")){d=0;for(i=this.dndata[g].length;0<=i?d<i:d>i;0<=i?d+=1:d-=1){f=this.dndata[g][d];if(f!=null)break}for(d=i=this.dndata[g].length-1;i<=0?d<=0:d>=0;i<=0?d+=1:d-=1){h=this.dndata[g][d];if(h!=null)break}l=[];i=0;for(k=c.length;i<k;i++){d=c[i];l.push([Math.max(Math.min(h[0],d[0]),f[0]),d[1]])}d=l;this.set.push(this.r.sai.prim.area(this.dndata[g],(e!=null?e[g]:void 0)||"black",b||1,d));if(a)c=this.dndata[g]}return this};return j}();Sai.CandlestickPlot=function(){function j(){j.__super__.constructor.apply(this,
arguments)}D(j,Sai.Plot);j.prototype.render=function(e,b,a,c){var f,d,h,g,i,k;if(b==null)b=5;this.set.remove();f=(e!=null?e.up:void 0)||"black";e=(e!=null?e.down:void 0)||"red";d=0;for(k=this.dndata.open.length;0<=k?d<k:d>k;0<=k?d+=1:d-=1)if(this.dndata.close[d]!=null){i=this.dndata.close[d][1]<this.dndata.open[d][1];h={};for(g in this.rawdata)h[g]=this.rawdata[g][d];this.set.push(this.r.sai.prim.candlestick(this.dndata.open[d][0],i&&this.dndata.close[d][1]||this.dndata.open[d][1],i&&this.dndata.open[d][1]||
this.dndata.close[d][1],this.dndata.high[d][1],this.dndata.low[d][1],b||5,d&&this.dndata.close[d-1]!=null&&this.dndata.close[d-1][1]<this.dndata.close[d][1]?e:f,!i,a,c,Sai.util.infoSetters(c,h)))}return this};return j}();Sai.BarPlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,Sai.Plot);j.prototype.render=function(e,b,a,c,f,d){var h,g,i,k,l,m,o,n,p;this.set.remove();b=this.denormalize([0,b])[1];l=0;g=[];h=e?this.r.sai.prim.stackedBar:this.r.sai.prim.groupedBar;for(p in this.dndata){l=
Math.max(l,this.dndata[p].length);g.push((a!=null?a[p]:void 0)||"black")}for(i=0;0<=l?i<l:i>l;0<=l?i+=1:i-=1){a=[];for(p in this.dndata)a.push(this.dndata[p][i]);k={};for(n in this.rawdata)k[n]=this.rawdata[n][i];if(e){o=m=0;for(p in this.rawdata)if(p!==d)if(!isNaN(this.rawdata[p][i])){m+=Math.abs(this.rawdata[p][i]);o+=this.rawdata[p][i]}k["(magnitude)"]=m}this.set.push(h(a,g,this.w/l,b,c,f,Sai.util.infoSetters(f,k)))}return this};return j}();Sai.GeoPlot=function(){function j(){j.__super__.constructor.apply(this,
arguments)}D(j,Sai.Plot);j.prototype.getRegionColor=function(e,b,a){var c;return Sai.util.multiplyColor(e[a],((c=this.data[a][b])!=null?c[1]:void 0)||0,this.opts.fromWhite,this.opts.fromWhite?0.2:0).str};j.prototype.getRegionOpacity=function(e,b){var a;return((a=this.data[b][e])!=null?a[1]:void 0)!=null?1:this.opts.fromWhite?0.15:0.25};j.prototype.render=function(e,b,a,c,f,d,h){var g,i,k,l,m,o,n,p,q,s,r,t,u;this.set.remove();u=this.rawdata[a];r=[];k=0;for(t=u.length;k<t;k++){g=u[k];r.push(g.toUpperCase())}p=
{};k=0;for(t=r.length;0<=t?k<t:k>t;0<=t?k+=1:k-=1)p[r[k]]=k;r=function(x){q=p[x];o=b.name[x];l={region:o!=null?o:x};for(s in this.rawdata)if(s!==a)l[s]=this.rawdata[s][q];i=this.getRegionColor(e,q,c);n=this.getRegionOpacity(q,c);m=Sai.util.infoSetters(h,l);return this.set.push(this.r.sai.prim.hoverShape(function(B,C,F,G){return function(H){return H.path(B).translate(F,G).scale(C,C,F,G)}}(b.paths[x],Math.min(this.w/b.width,this.h/b.height),this.x,this.y-this.h),{fill:i,stroke:this.opts.fromWhite?"black":
f,"stroke-width":0.5,opacity:n},d?[function(B){return function(C){navigator.userAgent.toLowerCase().indexOf("msie")!==-1||navigator.userAgent.toLowerCase().indexOf("opera")!==-1||C.toFront();return B()}}(m[0]),m[1]]:null,d?[{"fill-opacity":0.75,"stroke-width":this.opts.fromWhite?1.5:0.5},{"fill-opacity":1,"stroke-width":0.5}]:null))};for(g in b.paths)r.call(this,g);g=this.set.getBBox();this.set.translate((this.w-g.width)/2,(this.h-g.height)/2);return this};return j}();Sai.ChromaticGeoPlot=function(){function j(){j.__super__.constructor.apply(this,
arguments)}D(j,Sai.GeoPlot);j.prototype.getRegionColor=function(e,b){var a,c,f,d,h,g;f=c=a=0;for(h in this.data){d=Sai.util.multiplyColor(e[h],((g=this.data[h][b])!=null?g[1]:void 0)||0,this.opts.fromWhite);f+=d.r;c+=d.g;a+=d.b}return"rgb("+f+", "+c+", "+a+")"};j.prototype.getRegionOpacity=function(e){var b,a;for(b in this.data)if(((a=this.data[b][e])!=null?a[1]:void 0)!=null)return 1;return 0.25};return j}();Sai.ScatterPlot=function(){function j(){j.__super__.constructor.apply(this,arguments)}D(j,
Sai.Plot);j.prototype.render=function(e,b,a,c,f,d,h){var g,i,k,l,m,o,n,p,q,s,r,t,u,x,B,C,F,G,H,I,J,R,L,M,N,O,P,Q,S;this.set.remove();for(q in this.dndata){n=this.dndata[q].length;break}o=function(A,y,z){return y*z+A*(1-z)};x=v(function(A){return this.x+this.w*((A-this.y)/-this.h)},this);B=function(A){t=x((C=this.dndata[e.x])!=null?C[A][1]:void 0);u=(R=this.dndata[e.y])!=null?R[A][1]:void 0;i=b instanceof Array&&e.color!=null?Sai.util.colerp(b[0],b[1],(L=(M=this.data[e.color])!=null?(N=M[A])!=null?
N[1]:void 0:void 0)!=null?L:0):b instanceof Object&&e.color!=null?b[this.rawdata[e.color][A]]:"black";s=f instanceof Array&&e.stroke_color!=null?Sai.util.colerp(f[0],f[1],(O=(P=this.data[e.stroke_color])!=null?(Q=P[A])!=null?Q[1]:void 0:void 0)!=null?O:0):b instanceof Object&&e.color!=null?f[this.rawdata[e.stroke_color][A]]:"black";p=a instanceof Array&&e.radius!=null?o(a[0],a[1],(S=(F=this.data[e.radius])!=null?(G=F[A])!=null?G[1]:void 0:void 0)!=null?S:0):a instanceof Object&&e.radius!=null?a[this.rawdata[e.radius][A]]:
5;r=c instanceof Array&&e.stroke_opacity!=null?o(c[0],c[1],(H=(I=this.data[e.stroke_opacity])!=null?(J=I[A])!=null?J[1]:void 0:void 0)!=null?H:0):c instanceof Object&&e.stroke_opacity!=null?c[this.rawdata[e.stroke_opacity][A]]:1;if(d){l={};for(q in this.rawdata)q.match("^__")||(l[q]=this.rawdata[q][A]);m=Sai.util.infoSetters(h,l)}return this.set.push(g=this.r.circle(t,u,p).attr({fill:i,"stroke-opacity":r,stroke:s,"fill-opacity":0.8,"stroke-width":2}),d?g.hover(function(y){return function(){y();return this.attr("fill-opacity",
0.5)}}(m[0]),function(y){return function(){y();return this.attr("fill-opacity",0.8)}}(m[1])):void 0)};for(k=0;0<=n?k<n:k>n;0<=n?k+=1:k-=1)B.call(this,k);return this};return j}()}).call(this);(function(){var w=function(e,b){return function(){return e.apply(b,arguments)}},D=Array.prototype.indexOf||function(e){for(var b=0,a=this.length;b<a;b++)if(this[b]===e)return b;return-1},v=Object.prototype.hasOwnProperty,j=function(e,b){function a(){this.constructor=e}for(var c in b)if(v.call(b,c))e[c]=b[c];a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e};Sai.Chart=function(){function e(b,a,c,f,d,h,g,i){var k;this.r=b;this.x=a;this.y=c;this.w=f;this.h=d;this.__LABELS__=
g;this.opts=i!=null?i:{};this.drawInfo=w(this.drawInfo,this);(k=this.opts).bgcolor!=null||(k.bgcolor="white");this.setData(h);b=this.opts.simple?0:5;this.padding={left:b,right:b,top:b,bottom:b}}e.prototype.groupsToNullPad=function(){return[]};e.prototype.nonNegativeGroups=function(){return[]};e.prototype.nextSeriesSuffix=function(){var b;this.suffixCtr=((b=this.suffixCtr)!=null?b:0)+1;return"["+this.suffixCtr+"]"};e.prototype.fixSeriesName=function(b){return b+(b.match(/^\s+$/)?this.nextSeriesSuffix():
"")};e.prototype.setSemanticRename=function(b){var a,c;if(this.semanticRenamePatterns!=null){this.semanticRenames!=null||(this.semanticRenames={});c=[];for(a in this.semanticRenamePatterns)c.push(b.match(this.semanticRenamePatterns[a])?this.semanticRenames[a]=b:void 0);return c}};e.prototype.getBaseline=function(b){b=this.normalizedHeight(0,b!=null?b:"all");return[[0,b],[1,b]]};e.prototype.setData=function(b){var a,c,f,d,h,g,i,k,l;this.data={};this.renames={};if(function(n){var p;for(p in n)if(n.hasOwnProperty(p))return false;
return true}(b))this.render=function(){return this.showError("(no data -> empty chart)")};else{for(d in b){for(;;){h=this.fixSeriesName(d);this.setSemanticRename(h);if(h===d||!(h in b))break}this.renames[d]=h;if(b[d]instanceof Array)if(this.__LABELS__===d){this.__LABELS__=h;var m=this.data,o=h;k=b[d];l=[];g=0;for(i=k.length;g<i;g++){a=k[g];l.push(String(a))}m[o]=l}else{m=this.data;o=h;k=b[d];l=[];g=0;for(i=k.length;g<i;g++){a=k[g];l.push(typeof a==="string"&&a.match(/^( +)?[+-]?[\d,]+(\.\d+)?( +)?$/)&&
!isNaN(f=parseFloat(a.replace(/,/g,"")))?f:a)}m[o]=l}else this.data[h]=b[d]}b=this.dataGroups(this.data);f=this.nonNegativeGroups();for(c in b)if(b[c].length>0)if(D.call(f,c)>=0){i=b[c];h=0;for(g=i.length;h<g;h++){d=i[h];if(this.data[d]!=null){a=0;for(k=this.data[d].length;0<=k?a<k:a>k;0<=k?a+=1:a-=1)if(this.data[d][a]<0)this.data[d][a]*=-1}}}h=this.groupsToNullPad();a=0;for(f=h.length;a<f;a++){c=h[a];if(c in b){i=b[c];g=0;for(c=i.length;g<c;g++){d=i[g];this.nullPad(d)}}}return this.normalize(this.data)}};
e.prototype.nullPad=function(b){if(b in this.data)return this.data[b]=[null].concat(this.data[b].concat([null]))};e.prototype.caresAbout=function(b){return!(b.match("^__")||b===this.__LABELS__)};e.prototype.dataGroups=function(b){var a,c,f;c=[];for(a in b)this.caresAbout(a)&&c.push(a);f=[];for(a in b)if(a.match("^__")||a===this.__LABELS__)f.push(a);return{all:c,__META__:f}};e.prototype.getYAxisVals=function(b,a,c){var f,d,h;if(c==null)c=false;if(!(typeof b==="number"&&typeof a==="number"))return[b,
a];if(b===a)return[0,a,a*2];for(d=1;(a-b)*d<10;)d*=10;b*=d;a*=d;h=Math.floor(f=Math.log(a-b)/Math.LN10-0.4);h=Math.pow(10,h);if(f%1>0.7&&!c)h*=4;else if(f%1>0.35&&!c)h*=2;f=Sai.util.round(b-(c?h/2.1:h/1.75),h);if(f<0&&0<=b)f=0;b=Sai.util.round(a+(c?h/2.1:h/1.75),h);f/=d;b/=d;h/=d;d=f;for(a=[d];d<b;){d=Sai.util.round(d+h,h);a.push(d)}return a};e.prototype.getMax=function(b,a){var c,f,d,h,g,i,k,l,m;return Math.max.apply(Math,function(){l=[];d=0;for(g=a.length;d<g;d++){f=a[d];b[f]!=null&&l.push(Math.max.apply(Math,
function(){k=b[f];m=[];h=0;for(i=k.length;h<i;h++){c=k[h];c!=null&&typeof c==="number"&&m.push(c)}return m}()))}return l}())};e.prototype.getMin=function(b,a){var c,f,d,h,g,i,k,l,m;return Math.min.apply(Math,function(){l=[];d=0;for(g=a.length;d<g;d++){f=a[d];b[f]!=null&&l.push(Math.min.apply(Math,function(){k=b[f];m=[];h=0;for(i=k.length;h<i;h++){c=k[h];c!=null&&typeof c==="number"&&m.push(c)}return m}()))}return l}())};e.prototype.getStackedMax=function(b,a){var c,f,d,h,g,i,k,l;this.stackedMax!=
null||(this.stackedMax={});this.stackedMax[a]=(g=this.stackedMax[a])!=null?g:Math.max.apply(Math,function(){k=[];c=0;for(i=b[this.__LABELS__].length;0<=i?c<i:c>i;0<=i?c+=1:c-=1)k.push(Sai.util.sumArray(function(){l=[];d=0;for(h=a.length;d<h;d++){f=a[d];f!==this.__LABELS__&&b[f][c]>=0&&l.push(b[f][c])}return l}.call(this)));return k}.call(this));return this.stackedMax[a]};e.prototype.getStackedMin=function(b,a){var c,f,d,h,g,i,k,l;this.stackedMin!=null||(this.stackedMin={});this.stackedMin[a]=(g=this.stackedMin[a])!=
null?g:Math.min.apply(Math,function(){k=[];c=0;for(i=b[this.__LABELS__].length;0<=i?c<i:c>i;0<=i?c+=1:c-=1)k.push(Sai.util.sumArray(function(){l=[];d=0;for(h=a.length;d<h;d++){f=a[d];f!==this.__LABELS__&&b[f][c]<0&&l.push(b[f][c])}return l}.call(this)));return k}.call(this));return this.stackedMin[a]};e.prototype.normalize=function(b){var a,c,f,d,h,g,i,k,l,m,o,n,p,q,s,r,t,u,x,B,C,F,G,H,I,J,R,L,M,N,O,P,Q;i=this.dataGroups(b);this.ndata={};if(this.opts.stacked!=null)this.stackedNdata={};p=function(y,
z,E){if(typeof y==="number")return z===E?1:(y-z)/(E-z);return null};a=function(y,z){var E,K,T;K=0;for(T=z.length;K<T;K++){E=z[K];if(!y(E))return false}return true};h=function(y){var z,E,K;E=0;for(K=y.length;E<K;E++){z=y[E];if(typeof z==="number")return false}return true};L=[];for(g in i){if(!(m=g.match("^__"))){if(!(m=Sai.util.sumArray(function(){F=i[g];M=[];u=0;for(B=F.length;u<B;u++){r=F[u];M.push(this.data[r].length)}return M}.call(this))===0)){var S=a,A=h;G=i[g];N=[];m=0;for(n=G.length;m<n;m++){r=
G[m];N.push(this.data[r])}m=S(A,N)}m=m}if(!m){this.ndata[g]={};if(this.opts.stacked!=null){this.stackedNdata[g]={};f={}}n=this.opts.stacked?w(function(y,z){return this.getStackedMin(y,z)},this):this.getMin;m=this.opts.stacked?w(function(y,z){return this.getStackedMax(y,z)},this):this.getMax;o=n(b,i[g]);l=m(b,i[g]);m=this.getYAxisVals(o,l);o=m[0];l=m[m.length-1];this.ndata[g].__YVALS__=m;L.push(function(){H=i[g];O=[];x=0;for(C=H.length;x<C;x++){r=H[x];if(b[r]!=null){var y=this.ndata[g],z=r;P=[];k=
0;for(I=b[r].length;0<=I?k<I:k>I;0<=I?k+=1:k-=1)P.push(b[r][k]!=null&&(s=p(b[r][k],o,l))!==null?[k/(b[r].length-1||1),s]:null);y[z]=P;O.push(function(){if(this.opts.stacked!=null){q=p(0,o,l);this.stackedNdata[g][r]=[];Q=[];k=0;for(J=b[r].length;0<=J?k<J:k>J;0<=J?k+=1:k-=1){d=b[r][k]!=null&&b[r][k]<0?0:1;f[k]!=null||(f[k]=[q,q]);c=f[k][d];t=[k/(b[r].length-1||1),((R=p(b[r][k],o,l))!=null?R:q)-q+c];this.stackedNdata[g][r].push(t);Q.push(t!==null?f[k][d]=t[1]:void 0)}return Q}}.call(this))}}return O}.call(this))}}return L};
e.prototype.addAxes=function(b,a){var c,f,d,h,g,i,k,l,m,o,n,p,q;this.axisWidth=1.5;this.padding.top+=5;for(f=c=this.data[this.__LABELS__].length-1;c<=0?f<=0:f>=0;c<=0?f+=1:f-=1)if(this.data[this.__LABELS__][f]!=null){f=this.r.text(0,0,Sai.util.prettystr(this.data[this.__LABELS__][f]));this.padding.right+=f.getBBox().width/2;f.remove();break}i=this.h-(this.padding.bottom+this.padding.top);c=this.ndata[b[0]]!=null||this.ndata[b[1]]==null;f=this.ndata[b[1]]!=null;if(c){q=this.r.sai.prim.vaxis((h=(l=
this.ndata[b[0]])!=null?l.__YVALS__:void 0)!=null?h:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,i,{width:this.axisWidth,title:a!=null?a.left:void 0});h=q.items[0].getBBox().width;q.remove()}else h=0;if(f){q=this.r.sai.prim.vaxis((d=(m=this.ndata[b[1]])!=null?m.__YVALS__:void 0)!=null?d:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,i,{width:this.axisWidth,title:a!=null?a.right:void 0});d=q.getBBox().width;q.remove()}else d=0;this.haxis=this.r.sai.prim.haxis(this.data[this.__LABELS__],
this.x+this.padding.left+h,this.y-this.padding.bottom,this.w-this.padding.left-this.padding.right-h-d,{width:this.axisWidth,title:a!=null?a.bottom:void 0});d=this.haxis.getBBox().height;if(isNaN(d))d=1;this.haxis.translate(0,-d);this.padding.bottom+=d;i=this.h-(this.padding.bottom+this.padding.top);if(c){this.vaxis=this.r.sai.prim.vaxis((g=(o=this.ndata[b[0]])!=null?o.__YVALS__:void 0)!=null?g:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,i,{width:this.axisWidth,title:a!=null?a.left:
void 0});g=this.vaxis.items[0].getBBox().width;this.vaxis.translate(g,0);this.padding.left+=g}if(f){this.vaxis_right=this.r.sai.prim.vaxis((n=(p=this.ndata[b[1]])!=null?p.__YVALS__:void 0)!=null?n:[0,"?"],this.w-this.padding.right,this.y-this.padding.bottom,i,{width:this.axisWidth,right:true,title:a!=null?a.right:void 0,color:this.ndata[b[0]]!=null?(k=this.colors.__RIGHTAXIS__)!=null?k:"blue":"black"});k=this.vaxis_right.items[0].getBBox().width;this.vaxis_right.translate(-k,0);this.padding.right+=
k}this.setPlotCoords();return this.r.set().push(this.haxis).push(this.vaxis)};e.prototype.setPlotCoords=function(){var b,a,c,f;this.px=this.x+this.padding.left;this.py=this.y-this.padding.bottom;this.pw=this.w-this.padding.left-this.padding.right;this.ph=this.h-this.padding.bottom-this.padding.top;b=(a=this.legend)!=null?a.getBBox():void 0;if((a=this.legend)!=null)a.translate(this.px+this.pw/2-(b.x+b.width/2),0);b=(c=this.histogramLegend)!=null?c.getBBox():void 0;return(f=this.histogramLegend)!=null?
f.translate(this.px+this.pw/2-(b.x+b.width/2),0):void 0};e.prototype.drawBG=function(){return this.bg=this.r.rect(this.px!=null&&this.px||this.x,this.py!=null&&this.py-this.ph||this.y-this.h,this.pw!=null&&this.pw||this.w,this.ph!=null&&this.ph||this.h).attr({fill:this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack()};e.prototype.logoPos=function(){return[this.px!=null&&this.pw!=null?this.px+this.pw-150-5:this.w+this.x-150-this.padding.right,this.py!=null&&this.ph!=null?this.py-this.ph+
5:this.y-this.h+this.padding.top,150,28]};e.prototype.drawLogo=function(){var b,a,c,f,d,h,g;if(!this.opts.simple){b=this.logoPos();d=b[0];h=b[1];f=b[2];b=b[3];a=[328.3,53.06];c=[f/344,b/65];d+=a[0]*c[0];h+=a[1]*c[1];return this.logo=this.r.path("M"+d+","+h+"h1.9v1.6c0.5-0.5,0.9-0.9,1.3-1.2,0.6-0.4,1.4-0.7,2.2-0.7,0.9,0,1.6,0.3,2.2,0.7,0.3,0.3,0.6,0.7,0.9,1.2,0.4-0.7,0.9-1.1,1.5-1.4,0.6-0.3,1.2-0.5,2-0.5,1.5,0,2.6,0.6,3.1,1.7,0.3,0.6,0.5,1.4,0.5,2.5v7.7h-2v-8.1c0-0.7-0.2-1.3-0.6-1.6-0.4-0.2-0.9-0.4-1.4-0.4-0.8,0-1.4,0.3-2,0.8-0.5,0.5-0.8,1.3-0.8,2.5v6.8h-2v-7.6c0-0.8-0.1-1.3-0.3-1.7-0.3-0.5-0.8-0.8-1.6-0.8-0.8,0-1.4,0.3-2,0.8-0.6,0.6-0.9,1.6-0.9,3.1v6.2h-2v-11.6zm-3.9,1.1c1,1,1.5,2.5,1.5,4.4,0,1.9-0.4,3.4-1.3,4.7-0.9,1.2-2.3,1.8-4.2,1.8-1.6,0-2.9-0.6-3.8-1.6-0.9-1.1-1.4-2.6-1.4-4.4,0-1.9,0.5-3.5,1.5-4.6,1-1.2,2.3-1.7,3.9-1.7,1.5,0,2.8,0.5,3.8,1.4zm-1.2,7.7c0.5-0.9,0.7-2,0.7-3.2,0-1.1-0.2-2-0.5-2.6-0.6-1.1-1.5-1.6-2.8-1.6-1.2,0-2,0.4-2.6,1.3-0.5,0.9-0.8,2-0.8,3.3,0,1.2,0.3,2.2,0.8,3.1,0.6,0.8,1.4,1.2,2.6,1.2,1.2,0,2.1-0.5,2.6-1.5zm-10.6-8.2c0.8,0.6,1.3,1.7,1.5,3.3h-1.9c-0.1-0.7-0.4-1.3-0.8-1.8-0.4-0.5-1.1-0.7-2-0.7-1.2,0-2.1,0.6-2.6,1.8-0.4,0.8-0.6,1.8-0.6,2.9,0,1.2,0.3,2.1,0.8,2.9,0.5,0.8,1.2,1.2,2.3,1.2,0.8,0,1.4-0.2,1.9-0.7,0.5-0.5,0.8-1.2,1-2h1.9c-0.2,1.5-0.8,2.6-1.7,3.3-0.8,0.7-1.9,1.1-3.3,1.1-1.5,0-2.7-0.6-3.6-1.7-0.9-1.1-1.3-2.4-1.3-4.1,0-2,0.5-3.6,1.4-4.7,1-1.2,2.3-1.7,3.8-1.7,1.3,0,2.4,0.3,3.2,0.9zm-13.3,8.6h2.2v2.4h-2.2v-2.4zm-181-15.8-6,12.9h-7.6c-0.9-0.4-4.5-6-5.3-7.2-3.3-4.5-6.8-8.9-10.1-13.5-1.2-1.7-2.8-3.2-4-5.1h-8.9v-2.8h17.7c3.4,0,7.2,0.3,9.6-0.8,2.2-0.9,3.9-2.5,5.2-4.3,1.1-1.7,2.8-4.6,2.1-8-1.2-4.9-4-7.791-8.5-9.251-2.6-0.81-9.8-0.61-9.8-0.61h-21v56.361h4.7v-26h6.5c6.4,8.6,12.9,17.3,19.3,26h12.9l6.5-13.1h34.5l6.4,13.1h5.4l-8.6-17.7h-41zm-41.9-34.10h17.7c4.5,0,7.8-0.1,10,2.1,1.1,1.1,2.8,3.2,2.1,5.9-0.5,2.2-1.9,4-3.9,4.8-2,0.9-5.8,0.7-8.4,0.7h-17.5v-13.50zm61.1-4.751-17.4,36.051h37.5l-17.4-36.051h-2.7zm-9.9,31.251,11-22.9,11.4,22.9h-22.4zm-127.60-26.500h25.800v51.8h4.7v-56.361h-30.500v4.561zm276.70-12.341-35.6,29.741v-29.741h-4.8v39.441l48-39.441h-7.6zm19.4,0h-7.4l-32.3,26.941,32.3,37.2h6.2l-31.6-36.400,32.8-27.741zm-163.3,0-25.1,50.841-5.9-7.8-3.4-4.5v-0.4c9.7,0,16-4.9,18.8-11.6,4.8-11.3-2.7-21.961-10.4-25.211-3.4-1.44-8-1.33-12.9-1.33h-20.3h-73.600v4.74h64.100v2.97l-30.7,0.1v56.331h4.7v-51.8h26v51.8h4.7v-59.401h22.8c4,0,8.8-0.46,12,0.57,3.4,1.12,5.9,3.35,7.7,6.031,1.7,2.6,3.5,7.2,2.1,11.6-0.7,2.3-1.9,4.2-3.2,5.9-1.3,1.7-4.4,3.4-6.6,4.2-1,0.3-3.1,0.5-3.1,0.5h-11.5c5.6,7.7,11.3,15.3,17,23h4.4c0.6-0.4,25-50.151,25.4-51.801h6.1l29.2,59.401h5.1l-31.3-64.141h-12.1zm103.5,43.641v20.5h4.8v-18.2l12.5-10.5,25,28.7h6.3l-30.6-35.1-18,14.6zm-7.7-28.3c-6.1-9.141-17.1-15.251-29.6-15.251-19.2,0-34.8,14.351-34.8,32.151,0,17.7,15.6,32.1,34.8,32.1,10.5,0,22.4-4.1,29.7-10.8v10.6h4.8v-19c-1.7,0.8-3.3,1.8-4.9,2.8v0.1c-10.9,7.1-19.4,11.2-29.9,11.3-16.4,0-29.6-12.2-29.6-27.2,0-15.1,13.2-27.311,29.6-27.311,11.5,0,21.5,6.011,26.4,14.811,0,0,2.2-1.4,3.5-2.2v20.8c-1.3,0.9-4.5,3.3-4.6,3.4-8.2,5.4-17.9,10.3-25.5,10.4-12,0-21.7-9-21.7-19.9,0-11,9.7-19.9,21.7-19.9,8.4,0,15.7,4.4,19.3,10.8l0.1,0.1c0.2,0.2,0.5,0.2,0.7,0.1,0,0,0.1-0.1,0.1-0.1,0.1-0.1,0.9-0.6,1.7-1,0.4-0.3,0.8-0.5,1.1-0.7,0.1,0,0.2-0.1,0.3-0.2h0.1l0.1-0.1c0.2-0.1,0.3-0.5,0.1-0.7-4.5-7.8-13.3-12.971-23.4-12.971-14.8,0-26.7,11.071-26.7,24.771,0,13.7,11.9,24.7,26.7,24.7,9.6,0,25.4-8.1,29.9-12.2,1.6-1.1,3.1-2.4,4.9-3.2v-41.561h-4.9v15.361z").hide().attr({fill:(g=
this.opts.logoColor)!=null?g:"#AA5128","stroke-width":0,"stroke-opacity":0,opacity:0.25,cx:d+f/2,cy:h-b/2}).scale(c[0],c[1],d,h).show()}};e.prototype.drawFootnote=function(b){var a;b!=null||(b=(a=this.opts.footnote)!=null?a:"");if(!b.match(/^\s*$/)){this.footnote=this.r.sai.prim.wrappedText(this.x+this.padding.left,this.y-this.padding.bottom,this.w,b," ");b=this.footnote.getBBox().height;this.padding.bottom+=b+10;return this.footnote.translate(0,-b)}};e.prototype.render=function(){this.opts.simple&&
this.renderPlots!=null?this.renderPlots():this.renderFull();return this};e.prototype.renderFull=function(){this.plot!=null||(this.plot=new Sai.Plot(this.r));this.plot.render();return this};e.prototype.showError=function(b){var a,c;return this.r.text(this.x+this.padding.left+((a=this.pw)!=null?a:this.w)/2,this.y-this.padding.bottom-((c=this.ph)!=null?c:this.h)/2,b)};e.prototype.setColors=function(b){var a,c;this.colors!=null||(this.colors={});for(a in b){c=this.renames[a];if(c in this.data)this.colors[c]=
b[a]}return this};e.prototype.setColor=function(b,a){this.colors!=null||(this.colors={});this.colors[this.renames[b]]=a;return this};e.prototype.normalizedHeight=function(b,a){var c,f;if(((c=this.ndata[a])!=null?c.__YVALS__:void 0)!=null){f=this.ndata[a].__YVALS__[0];c=this.ndata[a].__YVALS__[this.ndata[a].__YVALS__.length-1];if(b<f)b=f;else if(b>c)b=c;return(b-f)/(c-f)}};e.prototype.drawGuideline=function(b,a){var c;if(a==null)a="all";if(((c=this.ndata[a])!=null?c.__YVALS__:void 0)!=null){c=this.normalizedHeight(b,
a);this.guidelines!=null||(this.guidelines=this.r.set());c=new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,{guideline:[[0,c],[1,c]]});c.render({guideline:"#ccc"});return this.guidelines.push(c.set)}};e.prototype.drawLegend=function(b){var a,c,f,d,h;b!=null||(b=this.colors);if(b){c={};f={};for(a in b)if(a!==this.__LABELS__){c[a]=b[a];f[a]="black";if(((d=this.opts.groups)!=null?d.right:void 0)!=null)if(D.call(this.opts.groups.right,a)>=0)f[a]=this.ndata.left!=null?(h=this.colors.__RIGHTAXIS__)!=
null?h:"blue":"black"}this.legend=this.r.sai.prim.legend(this.x,this.y-this.padding.bottom,this.w,c,f);b=this.legend.getBBox();if(this.legend.length>0)this.padding.bottom+=b.height+15;return this.legend.translate((this.w-b.width)/2,0)}};e.prototype.drawTitle=function(){if(this.opts.title!=null){this.title=this.r.text(this.x+this.w/2,this.y-this.h,this.opts.title).attr({"font-size":20});this.title.translate(0,this.title.getBBox().height/2);return this.padding.top+=this.title.getBBox().height+5}};e.prototype.setupInfoSpace=
function(){this.info_y=this.y-this.h+this.padding.top;this.info_x=this.x+this.padding.left;this.info_w=this.w-this.padding.left-this.padding.right;return this.padding.top+=30};e.prototype.drawInfo=function(b,a){var c,f;if(a==null)a=true;b!=null||(b=this.default_info!=null?this.default_info():{});if(a)this.info_data={};this.info&&this.info.remove();for(c in b)c.match("^__")||(this.info_data[c]=(f=b[c])!=null?f:"(no data)");return this.info=this.r.sai.prim.info(this.info_x,this.info_y,this.info_w,this.info_data)};
e.prototype.getIndex=function(b){b=Sai.util.transformCoords(b,this.r.canvas).x;return Math.round((this.data[this.__LABELS__].length-1)*(b-this.px)/this.pw)};e.prototype.drawHistogramLegend=function(b,a){var c,f,d,h,g,i,k,l,m,o,n,p;a!=null||(a=this.colors);this.histogramLegend=this.r.set();h=Math.max(0.1*(this.h-this.padding.bottom-this.padding.top),50);l=Math.min(150,(this.w-this.padding.left-this.padding.right-20)/b.length);g=0;for(m=b.length;0<=m?g<m:g>m;0<=m?g+=1:g-=1){k=b[g];c=[];f=0;for(d=this.ndata[k][k].length;0<=
d?f<d:f>d;0<=d?f+=1:f-=1)this.ndata[k][k][f]!=null&&c.push(this.ndata[k][k][f][1]);f=c;if(((o=this.bounds)!=null?o[k]:void 0)!=null){c=this.bounds[k];d=c[0];c=c[1]}else{n=this.data[k];p=[];c=0;for(i=n.length;c<i;c++){d=n[c];d!=null&&p.push(d)}d=p;c=[Math.min.apply(Math,d),Math.max.apply(Math,d)];d=c[0];c=c[1]}c=this.getYAxisVals(d,c,true);d=c[0];i=c[c.length-1];c=a[k];this.histogramLegend.push(f=this.r.sai.prim.histogram(this.x+g*l,this.y-this.padding.bottom,l*0.8,h,f,d,i,k,typeof c==="object"?[c.__LOW__,
c.__HIGH__]:[c],"white",this.opts.fromWhite));this.opts.interactive&&this.setupHistogramInteraction(f,k)}this.histogramLegend.translate((this.w-this.padding.left-this.padding.right-this.histogramLegend.getBBox().width)/2,0);return this.padding.bottom+=h+5};e.prototype.setupHistogramInteraction=function(){return null};return e}();Sai.LineChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.nonNegativeGroups=function(){return this.opts.stacked?["all",
"left","right"]:[]};e.prototype.dataGroups=function(){var b,a,c,f,d,h;b=e.__super__.dataGroups.apply(this,arguments);if(((a=this.opts.groups)!=null?a.left:void 0)!=null&&((c=this.opts.groups)!=null?c.right:void 0)!=null){d=this.opts.groups.left;h=[];c=0;for(f=d.length;c<f;c++){a=d[c];this.caresAbout(a)&&a in this.data&&h.push(a)}b.left=h;d=this.opts.groups.right;h=[];c=0;for(f=d.length;c<f;c++){a=d[c];this.caresAbout(a)&&a in this.data&&h.push(a)}b.right=h}return b};e.prototype.renderPlots=function(){var b,
a,c,f,d,h,g,i;this.px==null&&this.setPlotCoords();this.drawBG();this.drawLogo();c="right"in this.ndata;b=this.opts.stacked!=null?this.stackedNdata:this.ndata;a=this.opts.area?Sai.AreaPlot:Sai.LinePlot;if(c){if(((f=this.ndata.left)!=null?f.__YVALS__[0]:void 0)<0)this.drawGuideline(0,"left");if(((d=this.ndata.right)!=null?d.__YVALS__[0]:void 0)<0)this.drawGuideline(0,"right")}else this.ndata.all.__YVALS__[0]<0&&this.drawGuideline(0,"all");this.plots=[];if(c){if(b.left!=null)this.plots.push((new a(this.r,
this.px,this.py,this.pw,this.ph,b.left)).render(this.colors,(h=this.opts.lineWidth)!=null?h:2,this.opts.stacked,this.getBaseline("left")));if(b.right!=null)return this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,b.right)).render(this.colors,(g=this.opts.lineWidth)!=null?g:2,this.opts.stacked,this.getBaseline("right")))}else return this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,b.all)).render(this.colors,(i=this.opts.lineWidth)!=null?i:2,this.opts.stacked,this.getBaseline("all")))};
e.prototype.renderFull=function(){var b,a,c,f,d,h,g;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawLegend();"right"in this.ndata?this.addAxes(["left","right"]):this.addAxes(["all"]);this.renderPlots();this.plotSets=this.r.set();d=this.plots;c=0;for(f=d.length;c<f;c++){b=d[c];this.plotSets.push(b.set)}this.dots=this.r.set();for(a in this.ndata.all)if(a!=="__YVALS__")this.dots.push(this.r.circle(0,0,4).attr({fill:(h=(g=this.colors)!=null?g[a]:void 0)!=null?h:"black"}).hide());b=
this.r.set().push(this.bg,this.plotSets,this.dots,this.logo,this.guidelines).mousemove(w(function(i){var k,l,m,o,n,p,q,s,r,t;l=this.getIndex(i);i={};if(((s=this.data[this.__LABELS__])!=null?s.length:void 0)>l&&l>=0){i[this.__LABELS__]=this.data[this.__LABELS__][l];for(n in this.ndata.all)if(this.data[n]!=null)i[n]=this.data[n][l]}this.drawInfo(i);k=0;s=[];for(n in this.ndata.all)n!=="__YVALS__"&&s.push(function(){r=this.plots;t=[];p=0;for(q=r.length;p<q;p++){m=r[p];if(n in m.dndata){o=m.dndata[n][l];
o!=null?this.dots[k].attr({cx:o[0],cy:o[1]}).show().toFront():this.dots[k].hide();t.push(k++)}}return t}.call(this));return s},this)).mouseout(w(function(){this.drawInfo({},true);return this.dots.hide()},this));this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}();Sai.StreamChart=function(){function e(b,a,c,f,d,h,g,i){this.r=b;this.x=a;this.y=c;this.w=f;this.h=d;this.__LABELS__=g;this.opts=i;this.opts.stacked=true;e.__super__.constructor.apply(this,arguments)}j(e,
Sai.LineChart);e.prototype.getStackedMax=function(){return e.__super__.getStackedMax.apply(this,arguments)/2};e.prototype.getStackedMin=function(b,a){var c,f;c=e.__super__.getStackedMin.apply(this,arguments);f=this.getStackedMax(b,a);return c-f};e.prototype.normalize=function(b){var a,c,f,d,h,g,i,k,l,m,o,n,p,q,s,r;e.__super__.normalize.apply(this,arguments);c=this.dataGroups(this.data);this.baselines!=null||(this.baselines={});q=[];for(a in this.stackedNdata){d=this.normalizedHeight(0,a!=null?a:"all");
this.normalizedHeight(this.getStackedMin(b,c[a]),a);this.baselines[a]=[];var t=this.ndata[a];n=this.ndata[a].__YVALS__;s=[];m=0;for(o=n.length;m<o;m++){l=n[m];s.push(Math.abs(l))}t.__YVALS__=s;for(i in this.stackedNdata[a])k=i;q.push(function(){r=[];f=0;for(p=this.stackedNdata[a][i].length;0<=p?f<p:f>p;0<=p?f+=1:f-=1){h=(this.stackedNdata[a][k][f][1]-d)/2;for(i in this.stackedNdata[a]){g=this.stackedNdata[a][i][f];if(g!=null)g[1]-=h}r.push(this.baselines[a].push([g[0],d-h]))}return r}.call(this))}return q};
e.prototype.addAxes=function(b,a){if(a==null)a={};"left"in a||(a.left="magnitude");return e.__super__.addAxes.call(this,b,a)};e.prototype.getBaseline=function(b){return this.baselines[b]};return e}();Sai.Sparkline=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.dataGroups=function(){return{data:["data"]}};e.prototype.renderFull=function(){this.drawBG();this.plots=this.r.set();this.plots.push((new Sai.LinePlot(this.r,this.x,this.y,this.w,this.h,this.ndata.data)).render({data:this.colors&&
this.colors[series]||"black"},1).set);return this};return e}();Sai.BarChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.getMin=function(){return Math.min(e.__super__.getMin.apply(this,arguments),0)};e.prototype.groupsToNullPad=function(){var b,a;a=[];for(b in this.dataGroups())a.push(b);return a};e.prototype.tooMuchData=function(){var b,a,c;a=this.w/3;b=0;for(c in this.data)if(c!==this.__LABELS__){b+=this.data[c].length;if(this.opts.stacked)break}return b>
a};e.prototype.renderPlots=function(){var b,a,c,f,d;this.px==null&&this.setPlotCoords();this.drawLogo();this.drawBG();if(this.tooMuchData()){this.showError("Sorry, the chart isn't wide enough to plot this much data.\n \nPossible solutions include downsampling your data\n (e.g. weekly instead of daily) or using a line chart");return this}if("all"in this.ndata){this.guidelines=this.r.set();d=this.ndata.all.__YVALS__.slice(1,this.ndata.all.__YVALS__.length-1);a=0;for(c=d.length;a<c;a++){b=d[a];this.drawGuideline(b)}}this.plots=
this.r.set();b={};c={};c[this.__LABELS__]=this.data[this.__LABELS__];a=this.opts.stacked!=null?this.stackedNdata:this.ndata;for(f in a.all)if(!(f.match("^__")||f===this.__LABELS__)){b[f]=a.all[f];c[f]=this.data[f]}return this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph,b,c)).render(this.opts.stacked!=null,this.normalizedHeight(0,"all"),this.colors,this.opts.interactive&&!this.opts.simple,this.drawInfo,this.__LABELS__).set)};e.prototype.renderFull=function(){var b;this.drawTitle();
this.setupInfoSpace();this.drawFootnote();this.drawLegend();this.addAxes(["all"]);this.renderPlots();b=this.r.set().push(this.plots,this.bg,this.logo,this.guidelines);this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}();Sai.StockChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.semanticRenamePatterns={open:/^open$/i,close:/^close$/i,high:/^high$/i,low:/^low$/i,volume:/^vol(ume)?$/i};e.prototype.groupsToNullPad=
function(){return["prices","volume","__META__"]};e.prototype.dataGroups=function(b){var a,c,f,d;a={__META__:[this.__LABELS__]};f=(d=this.semanticRenames.volume)!=null?d:"volume";if(f in this.data)a.volume=[f];for(c in b)if(this.caresAbout(c)&&c!==this.__LABELS__&&c!==f){a.prices!=null||(a.prices=[]);a.prices.push(c)}return a};e.prototype.nonNegativeGroups=function(){return["volume"]};e.prototype.renderPlots=function(){var b,a,c,f,d,h,g,i,k,l,m,o;this.px==null&&this.setPlotCoords();d=(a=this.semanticRenames.open)!=
null?a:"open";a=(c=this.semanticRenames.close)!=null?c:"close";c=(f=this.semanticRenames.high)!=null?f:"high";f=(k=this.semanticRenames.low)!=null?k:"low";k=(o=this.semanticRenames.volume)!=null?o:"volume";this.colors!=null||(this.colors={});(h=this.colors).up!=null||(h.up="black");(i=this.colors).down!=null||(i.down="red");(l=this.colors).vol_up!=null||(l.vol_up="#666666");(m=this.colors).vol_down!=null||(m.vol_down="#cc6666");this.drawLogo();this.drawBG();if(this.ndata.prices!=null&&d in this.ndata.prices&&
a in this.ndata.prices&&c in this.ndata.prices&&f in this.ndata.prices){this.ndata.prices.__YVALS__[0]<0&&this.drawGuideline(0,"prices");this.plots=this.r.set();i={up:[],down:[]};h={};for(b in this.ndata.prices)b.match("^__")||b===this.__LABELS__||(h[b]=this.data[b]);if(this.data[k]!=null)h.vol=this.data[k];if("volume"in this.ndata){b=0;for(l=this.ndata.volume[k].length;0<=l?b<l:b>l;0<=l?b+=1:b-=1)if(this.ndata.volume[k][b]!==null)if(b&&this.ndata.prices[a][b-1]&&this.ndata.prices[a][b][1]<this.ndata.prices[a][b-
1][1]){i.down.push(this.ndata.volume[k][b]);i.up.push([this.ndata.volume[k][b][0],0])}else{i.up.push(this.ndata.volume[k][b]);i.down.push([this.ndata.volume[k][b][0],0])}else{i.up.push([0,0]);i.down.push([0,0])}this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph*0.2,i,h)).render(true,this.normalizedHeight(0,"volume"),{up:this.colors.vol_up,down:this.colors.vol_down}).set)}this.plots.push((new Sai.CandlestickPlot(this.r,this.px,this.py,this.pw,this.ph,{open:this.ndata.prices[d],
close:this.ndata.prices[a],high:this.ndata.prices[c],low:this.ndata.prices[f]},h)).render(this.colors,Math.min(5,this.pw/this.ndata.prices[d].length-2)).set);b={};for(g in this.ndata.prices)g===d||g===a||g===c||g===f||g.match("^__")||g===this.__LABELS__||(b[g]=this.ndata.prices[g]);return this.plots.push((new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,b)).render(this.colors).set)}else this.showError("This chart requires data series named\nopen, close, high, and low.\n \nOnce you add series with these names, the chart will display.")};
e.prototype.renderFull=function(){var b,a,c,f,d,h,g,i,k,l;this.drawTitle();this.setupInfoSpace();this.drawFootnote();h=(a=this.semanticRenames.open)!=null?a:"open";a=(f=this.semanticRenames.close)!=null?f:"close";f=(d=this.semanticRenames.high)!=null?d:"high";d=(b=this.semanticRenames.low)!=null?b:"low";k=(i=this.semanticRenames.volume)!=null?i:"volume";b={};i=false;for(g in this.ndata.prices)if(g!==h&&g!==a&&g!==f&&g!==d&&!(g.match("^__")||g===this.__LABELS__)){b[g]=((l=this.colors)!=null?l[g]:void 0)||
"black";i=true}i&&this.drawLegend(b);this.addAxes(["prices"]);this.renderPlots();c=this.pw/(this.data[this.__LABELS__].length-1);this.glow=this.r.rect(this.px-c/2,this.py-this.ph,c,this.ph).attr({fill:"0-"+this.opts.bgcolor+"-#DDAA99-"+this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack().hide();this.bg.toBack();this.r.set().push(this.bg,this.plots,this.logo,this.glow,this.guidelines).mousemove(w(function(m){var o,n,p,q,s;m=this.getIndex(m);o={};if(this.data[this.__LABELS__][m]!=null)o[this.__LABELS__]=
this.data[this.__LABELS__][m];n=false;for(p in this.ndata.prices)if(!(p.match("^__")||p===this.__LABELS__))if(((q=this.data[p])!=null?q[m]:void 0)!=null){o[p]=this.data[p][m];n=true}if(((s=this.data[k])!=null?s[m]:void 0)!=null){o[k]=this.data[k][m];n=true}this.drawInfo(o);if(n)return this.glow.attr({x:this.px+c*(m-0.5)}).show()},this)).mouseout(w(function(){this.drawInfo({},true);return this.glow.hide()},this));return this};return e}();Sai.GeoChart=function(){function e(){this.renderPlots=w(this.renderPlots,
this);e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.plotType=Sai.GeoPlot;e.prototype.interactiveHistogram=true;e.prototype.getMax=function(b){return Math.max.apply(Math,b)};e.prototype.getMin=function(b){return Math.min.apply(Math,b)};e.prototype.normalize=function(b){var a,c,f,d,h,g,i,k,l,m,o,n,p,q,s;this.ndata={};this.bounds={};d={};g={};for(l in b)if(!(l.match("^__")||l===this.__LABELS__))if(b[l]!=null){n=b[l];q=[];m=0;for(o=n.length;m<o;m++){a=n[m];a!=null&&q.push(a)}a=
q;d[l]=this.getMax(a,l);if(!(typeof i!="undefined"&&i!==null)||d[l]>i)i=d[l];g[l]=this.getMin(a,l);if(!(typeof k!="undefined"&&k!==null)||g[l]<k)k=g[l]}a=[];for(l in b)if(!(l.match("^__")||l===this.__LABELS__))if(b[l]!=null){if(this.opts.groupedNormalization){f=i;h=k}else{f=d[l];h=g[l]}this.bounds[l]=[h,f];this.ndata[l]={};a.push(this.ndata[l][l]=function(){s=[];c=0;for(p=b[l].length;0<=p?c<p:c>p;0<=p?c+=1:c-=1)s.push(b[l][c]!=null?[c/(b[l].length-1),(b[l][c]-h)/(f-h)]:null);return s}())}return a};
e.prototype.dataGroups=function(b){var a,c;a=[];for(c in b)if(c.match("^__")||c===this.__LABELS__)a.push(c);a={__META__:a};for(c in b)c.match("^__")||c===this.__LABELS__||(a[c]=[c]);return a};e.prototype.setupHistogramInteraction=function(b,a){return b.click(w(function(){return this.renderPlots(a)},this)).hover(w(function(c){return w(function(){c.attr({"fill-opacity":0.75});return this.drawInfo({"Click to display on map":a})},this)},this)(b),w(function(c){return w(function(){c.attr({"fill-opacity":1});
return this.drawInfo()},this)},this)(b))};e.prototype.renderPlots=function(b){var a,c;this.px==null&&this.setPlotCoords();if((a=this.bg)!=null)a.remove();if((a=this.logo)!=null)a.remove();if((a=this.geoPlot)!=null)a.set.remove();this.drawBG();this.drawLogo();a={};for(c in this.ndata)a[c]=this.ndata[c][c];this.geoPlot=(new this.plotType(this.r,this.px,this.py,this.pw,this.ph,a,this.data,{fromWhite:this.opts.fromWhite})).render(this.colors||{},this.data.__MAP__,this.__LABELS__,b!=null?b:this.data.__DEFAULT__,
this.opts.bgcolor,this.opts.interactive&&!this.opts.simple,this.drawInfo);return this};e.prototype.default_info=function(){return{"":this.opts.interactive?"Click histogram below to change map display":""}};e.prototype.renderFull=function(){var b,a,c;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawHistogramLegend(function(){c=[];for(a in this.data)a.match("^__")||a===this.__LABELS__||c.push(a);return c}.call(this));this.setPlotCoords();this.drawInfo();this.renderPlots();b=this.r.set().push(this.geoPlot.set,
this.bg,this.logo,this.info,this.footnote);this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}();Sai.ChromaticGeoChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.GeoChart);e.prototype.plotType=Sai.ChromaticGeoPlot;e.prototype.interactiveHistogram=false;e.prototype.default_info=function(){return{}};e.prototype.setupHistogramInteraction=function(){return false};return e}();Sai.ScatterChart=function(){function e(){e.__super__.constructor.apply(this,
arguments)}j(e,Sai.Chart);e.prototype.dataGroups=function(b){var a,c;a=[];for(c in b)if(c.match("^__")||c===this.__LABELS__)a.push(c);a={__META__:a};for(c in b)c.match("^__")||c===this.__LABELS__||(a[c]=[c]);return a};e.prototype.renderPlots=function(){var b,a,c,f,d,h,g;this.px==null&&this.setPlotCoords();b=(h=(g=this.opts.colors)!=null?g:this.colors)!=null?h:["black","white"];h=(d=this.opts.stroke_opacity)!=null?d:[0,1];d=(c=this.opts.stroke_colors)!=null?c:["black","black"];c=(a=this.opts.radius)!=
null?a:[4,12];this.drawLogo();this.drawBG();a={};for(f in this.ndata)a[f]=this.ndata[f][f];this.plots=this.r.set();this.plots.push((new Sai.ScatterPlot(this.r,this.px,this.py,this.pw,this.ph,a,this.data)).render(this.opts.mappings,b,c,h,d,this.opts.interactive&&!this.opts.simple,this.drawInfo).set);return this};e.prototype.renderFull=function(){var b,a,c,f,d,h;this.drawTitle();this.setupInfoSpace();this.drawFootnote();a=(h=(d=this.opts.colors)!=null?d:this.colors)!=null?h:["black","white"];h=(f=this.opts.stroke_colors)!=
null?f:["black","black"];d=[];f={};if(a instanceof Array){d.push(this.opts.mappings.color);f[this.opts.mappings.color]={__LOW__:a[0],__HIGH__:a[1]}}else{typeof legend_colors!="undefined"&&legend_colors!==null||(legend_colors={});c=true;for(b in a)legend_colors[b]=a[b]}if(!(h instanceof Array)){typeof legend_colors!="undefined"&&legend_colors!==null||(legend_colors={});c=true;for(b in a)legend_colors[b]=h[b]}d.length&&this.drawHistogramLegend(d,f);c&&this.drawLegend(a);this.__LABELS__="__XVALS__";
this.data.__XVALS__=this.ndata[this.opts.mappings.x].__YVALS__;this.addAxes([this.opts.mappings.y],{left:this.opts.mappings.y,bottom:this.opts.mappings.x});this.renderPlots();b=this.r.set().push(this.plots,this.bg,this.logo,this.info,this.footnote,this.histogramLegend,this.legend);this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}()}).call(this);(function(){var w=function(e,b){return function(){return e.apply(b,arguments)}},D=Array.prototype.indexOf||function(e){for(var b=0,a=this.length;b<a;b++)if(this[b]===e)return b;return-1},v=Object.prototype.hasOwnProperty,j=function(e,b){function a(){this.constructor=e}for(var c in b)if(v.call(b,c))e[c]=b[c];a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e};Sai.Chart=function(){function e(b,a,c,f,d,h,g,i){var k;this.r=b;this.x=a;this.y=c;this.w=f;this.h=d;this.__LABELS__=
g;this.opts=i!=null?i:{};this.drawInfo=w(this.drawInfo,this);(k=this.opts).bgcolor!=null||(k.bgcolor="white");this.setData(h);b=this.opts.simple?0:5;this.padding={left:b,right:b,top:b,bottom:b}}e.prototype.groupsToNullPad=function(){return[]};e.prototype.nonNegativeGroups=function(){return[]};e.prototype.nextSeriesSuffix=function(){var b;this.suffixCtr=((b=this.suffixCtr)!=null?b:0)+1;return"["+this.suffixCtr+"]"};e.prototype.fixSeriesName=function(b){return b+(b.match(/^\s+$/)?this.nextSeriesSuffix():
"")};e.prototype.setSemanticRename=function(b){var a,c;if(this.semanticRenamePatterns!=null){this.semanticRenames!=null||(this.semanticRenames={});c=[];for(a in this.semanticRenamePatterns)c.push(b.match(this.semanticRenamePatterns[a])?this.semanticRenames[a]=b:void 0);return c}};e.prototype.getBaseline=function(b){b=this.normalizedHeight(0,b!=null?b:"all");return[[0,b],[1,b]]};e.prototype.setData=function(b){var a,c,f,d,h,g,i,k,l;this.data={};this.renames={};if(function(n){var p;for(p in n)if(n.hasOwnProperty(p))return false;
return true}(b))this.render=function(){return this.showError("(no data -> empty chart)")};else{for(d in b){for(;;){h=this.fixSeriesName(d);this.setSemanticRename(h);if(h===d||!(h in b))break}this.renames[d]=h;if(b[d]instanceof Array)if(this.__LABELS__===d){this.__LABELS__=h;var m=this.data,o=h;k=b[d];l=[];g=0;for(i=k.length;g<i;g++){a=k[g];l.push(String(a))}m[o]=l}else{m=this.data;o=h;k=b[d];l=[];g=0;for(i=k.length;g<i;g++){a=k[g];l.push(typeof a==="string"&&a.match(/^( +)?[+-]?[\d,]+(\.\d+)?( +)?$/)&&
!isNaN(f=parseFloat(a.replace(/,/g,"")))?f:a)}m[o]=l}else this.data[h]=b[d]}b=this.dataGroups(this.data);f=this.nonNegativeGroups();for(c in b)if(b[c].length>0)if(D.call(f,c)>=0){i=b[c];h=0;for(g=i.length;h<g;h++){d=i[h];if(this.data[d]!=null){a=0;for(k=this.data[d].length;0<=k?a<k:a>k;0<=k?a+=1:a-=1)if(this.data[d][a]<0)this.data[d][a]*=-1}}}h=this.groupsToNullPad();a=0;for(f=h.length;a<f;a++){c=h[a];if(c in b){i=b[c];g=0;for(c=i.length;g<c;g++){d=i[g];this.nullPad(d)}}}return this.normalize(this.data)}};
e.prototype.nullPad=function(b){if(b in this.data)return this.data[b]=[null].concat(this.data[b].concat([null]))};e.prototype.caresAbout=function(b){return!(b.match("^__")||b===this.__LABELS__)};e.prototype.dataGroups=function(b){var a,c,f;c=[];for(a in b)this.caresAbout(a)&&c.push(a);f=[];for(a in b)if(a.match("^__")||a===this.__LABELS__)f.push(a);return{all:c,__META__:f}};e.prototype.getYAxisVals=function(b,a,c){var f,d,h;if(c==null)c=false;if(!(typeof b==="number"&&typeof a==="number"))return[b,
a];if(b===a)return[0,a,a*2];for(d=1;(a-b)*d<10;)d*=10;b*=d;a*=d;h=Math.floor(f=Math.log(a-b)/Math.LN10-0.4);h=Math.pow(10,h);if(f%1>0.7&&!c)h*=4;else if(f%1>0.35&&!c)h*=2;f=Sai.util.round(b-(c?h/2.1:h/1.75),h);if(f<0&&0<=b)f=0;b=Sai.util.round(a+(c?h/2.1:h/1.75),h);f/=d;b/=d;h/=d;d=f;for(a=[d];d<b;){d=Sai.util.round(d+h,h);a.push(d)}return a};e.prototype.getMax=function(b,a){var c,f,d,h,g,i,k,l,m;return Math.max.apply(Math,function(){l=[];d=0;for(g=a.length;d<g;d++){f=a[d];b[f]!=null&&l.push(Math.max.apply(Math,
function(){k=b[f];m=[];h=0;for(i=k.length;h<i;h++){c=k[h];c!=null&&typeof c==="number"&&m.push(c)}return m}()))}return l}())};e.prototype.getMin=function(b,a){var c,f,d,h,g,i,k,l,m;return Math.min.apply(Math,function(){l=[];d=0;for(g=a.length;d<g;d++){f=a[d];b[f]!=null&&l.push(Math.min.apply(Math,function(){k=b[f];m=[];h=0;for(i=k.length;h<i;h++){c=k[h];c!=null&&typeof c==="number"&&m.push(c)}return m}()))}return l}())};e.prototype.getStackedMax=function(b,a){var c,f,d,h,g,i,k,l;this.stackedMax!=
null||(this.stackedMax={});this.stackedMax[a]=(g=this.stackedMax[a])!=null?g:Math.max.apply(Math,function(){k=[];c=0;for(i=b[this.__LABELS__].length;0<=i?c<i:c>i;0<=i?c+=1:c-=1)k.push(Sai.util.sumArray(function(){l=[];d=0;for(h=a.length;d<h;d++){f=a[d];f!==this.__LABELS__&&b[f][c]>=0&&l.push(b[f][c])}return l}.call(this)));return k}.call(this));return this.stackedMax[a]};e.prototype.getStackedMin=function(b,a){var c,f,d,h,g,i,k,l;this.stackedMin!=null||(this.stackedMin={});this.stackedMin[a]=(g=this.stackedMin[a])!=
null?g:Math.min.apply(Math,function(){k=[];c=0;for(i=b[this.__LABELS__].length;0<=i?c<i:c>i;0<=i?c+=1:c-=1)k.push(Sai.util.sumArray(function(){l=[];d=0;for(h=a.length;d<h;d++){f=a[d];f!==this.__LABELS__&&b[f][c]<0&&l.push(b[f][c])}return l}.call(this)));return k}.call(this));return this.stackedMin[a]};e.prototype.normalize=function(b){var a,c,f,d,h,g,i,k,l,m,o,n,p,q,s,r,t,u,x,B,C,F,G,H,I,J,R,L,M,N,O,P,Q;i=this.dataGroups(b);this.ndata={};if(this.opts.stacked!=null)this.stackedNdata={};p=function(y,
z,E){if(typeof y==="number")return z===E?1:(y-z)/(E-z);return null};a=function(y,z){var E,K,T;K=0;for(T=z.length;K<T;K++){E=z[K];if(!y(E))return false}return true};h=function(y){var z,E,K;E=0;for(K=y.length;E<K;E++){z=y[E];if(typeof z==="number")return false}return true};L=[];for(g in i){if(!(m=g.match("^__"))){if(!(m=Sai.util.sumArray(function(){F=i[g];M=[];u=0;for(B=F.length;u<B;u++){r=F[u];M.push(this.data[r].length)}return M}.call(this))===0)){var S=a,A=h;G=i[g];N=[];m=0;for(n=G.length;m<n;m++){r=
G[m];N.push(this.data[r])}m=S(A,N)}m=m}if(!m){this.ndata[g]={};if(this.opts.stacked!=null){this.stackedNdata[g]={};f={}}n=this.opts.stacked?w(function(y,z){return this.getStackedMin(y,z)},this):this.getMin;m=this.opts.stacked?w(function(y,z){return this.getStackedMax(y,z)},this):this.getMax;o=n(b,i[g]);l=m(b,i[g]);m=this.getYAxisVals(o,l);o=m[0];l=m[m.length-1];this.ndata[g].__YVALS__=m;L.push(function(){H=i[g];O=[];x=0;for(C=H.length;x<C;x++){r=H[x];if(b[r]!=null){var y=this.ndata[g],z=r;P=[];k=
0;for(I=b[r].length;0<=I?k<I:k>I;0<=I?k+=1:k-=1)P.push(b[r][k]!=null&&(s=p(b[r][k],o,l))!==null?[k/(b[r].length-1||1),s]:null);y[z]=P;O.push(function(){if(this.opts.stacked!=null){q=p(0,o,l);this.stackedNdata[g][r]=[];Q=[];k=0;for(J=b[r].length;0<=J?k<J:k>J;0<=J?k+=1:k-=1){d=b[r][k]!=null&&b[r][k]<0?0:1;f[k]!=null||(f[k]=[q,q]);c=f[k][d];t=[k/(b[r].length-1||1),((R=p(b[r][k],o,l))!=null?R:q)-q+c];this.stackedNdata[g][r].push(t);Q.push(t!==null?f[k][d]=t[1]:void 0)}return Q}}.call(this))}}return O}.call(this))}}return L};
e.prototype.addAxes=function(b,a){var c,f,d,h,g,i,k,l,m,o,n,p,q;this.axisWidth=1.5;this.padding.top+=5;for(f=c=this.data[this.__LABELS__].length-1;c<=0?f<=0:f>=0;c<=0?f+=1:f-=1)if(this.data[this.__LABELS__][f]!=null){f=this.r.text(0,0,Sai.util.prettystr(this.data[this.__LABELS__][f]));this.padding.right+=f.getBBox().width/2;f.remove();break}i=this.h-(this.padding.bottom+this.padding.top);c=this.ndata[b[0]]!=null||this.ndata[b[1]]==null;f=this.ndata[b[1]]!=null;if(c){q=this.r.sai.prim.vaxis((h=(l=
this.ndata[b[0]])!=null?l.__YVALS__:void 0)!=null?h:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,i,{width:this.axisWidth,title:a!=null?a.left:void 0});h=q.items[0].getBBox().width;q.remove()}else h=0;if(f){q=this.r.sai.prim.vaxis((d=(m=this.ndata[b[1]])!=null?m.__YVALS__:void 0)!=null?d:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,i,{width:this.axisWidth,title:a!=null?a.right:void 0});d=q.getBBox().width;q.remove()}else d=0;this.haxis=this.r.sai.prim.haxis(this.data[this.__LABELS__],
this.x+this.padding.left+h,this.y-this.padding.bottom,this.w-this.padding.left-this.padding.right-h-d,{width:this.axisWidth,title:a!=null?a.bottom:void 0});d=this.haxis.getBBox().height;if(isNaN(d))d=1;this.haxis.translate(0,-d);this.padding.bottom+=d;i=this.h-(this.padding.bottom+this.padding.top);if(c){this.vaxis=this.r.sai.prim.vaxis((g=(o=this.ndata[b[0]])!=null?o.__YVALS__:void 0)!=null?g:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,i,{width:this.axisWidth,title:a!=null?a.left:
void 0});g=this.vaxis.items[0].getBBox().width;this.vaxis.translate(g,0);this.padding.left+=g}if(f){this.vaxis_right=this.r.sai.prim.vaxis((n=(p=this.ndata[b[1]])!=null?p.__YVALS__:void 0)!=null?n:[0,"?"],this.w-this.padding.right,this.y-this.padding.bottom,i,{width:this.axisWidth,right:true,title:a!=null?a.right:void 0,color:this.ndata[b[0]]!=null?(k=this.colors.__RIGHTAXIS__)!=null?k:"blue":"black"});k=this.vaxis_right.items[0].getBBox().width;this.vaxis_right.translate(-k,0);this.padding.right+=
k}this.setPlotCoords();return this.r.set().push(this.haxis).push(this.vaxis)};e.prototype.setPlotCoords=function(){var b,a,c,f;this.px=this.x+this.padding.left;this.py=this.y-this.padding.bottom;this.pw=this.w-this.padding.left-this.padding.right;this.ph=this.h-this.padding.bottom-this.padding.top;b=(a=this.legend)!=null?a.getBBox():void 0;if((a=this.legend)!=null)a.translate(this.px+this.pw/2-(b.x+b.width/2),0);b=(c=this.histogramLegend)!=null?c.getBBox():void 0;return(f=this.histogramLegend)!=null?
f.translate(this.px+this.pw/2-(b.x+b.width/2),0):void 0};e.prototype.drawBG=function(){return this.bg=this.r.rect(this.px!=null&&this.px||this.x,this.py!=null&&this.py-this.ph||this.y-this.h,this.pw!=null&&this.pw||this.w,this.ph!=null&&this.ph||this.h).attr({fill:this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack()};e.prototype.logoPos=function(){return[this.px!=null&&this.pw!=null?this.px+this.pw-150-5:this.w+this.x-150-this.padding.right,this.py!=null&&this.ph!=null?this.py-this.ph+
5:this.y-this.h+this.padding.top,150,28]};e.prototype.drawLogo=function(){var b,a,c,f,d,h,g;if(!this.opts.simple){b=this.logoPos();d=b[0];h=b[1];f=b[2];b=b[3];a=[328.3,53.06];c=[f/344,b/65];d+=a[0]*c[0];h+=a[1]*c[1];return this.logo=this.r.path("M"+d+","+h+"h1.9v1.6c0.5-0.5,0.9-0.9,1.3-1.2,0.6-0.4,1.4-0.7,2.2-0.7,0.9,0,1.6,0.3,2.2,0.7,0.3,0.3,0.6,0.7,0.9,1.2,0.4-0.7,0.9-1.1,1.5-1.4,0.6-0.3,1.2-0.5,2-0.5,1.5,0,2.6,0.6,3.1,1.7,0.3,0.6,0.5,1.4,0.5,2.5v7.7h-2v-8.1c0-0.7-0.2-1.3-0.6-1.6-0.4-0.2-0.9-0.4-1.4-0.4-0.8,0-1.4,0.3-2,0.8-0.5,0.5-0.8,1.3-0.8,2.5v6.8h-2v-7.6c0-0.8-0.1-1.3-0.3-1.7-0.3-0.5-0.8-0.8-1.6-0.8-0.8,0-1.4,0.3-2,0.8-0.6,0.6-0.9,1.6-0.9,3.1v6.2h-2v-11.6zm-3.9,1.1c1,1,1.5,2.5,1.5,4.4,0,1.9-0.4,3.4-1.3,4.7-0.9,1.2-2.3,1.8-4.2,1.8-1.6,0-2.9-0.6-3.8-1.6-0.9-1.1-1.4-2.6-1.4-4.4,0-1.9,0.5-3.5,1.5-4.6,1-1.2,2.3-1.7,3.9-1.7,1.5,0,2.8,0.5,3.8,1.4zm-1.2,7.7c0.5-0.9,0.7-2,0.7-3.2,0-1.1-0.2-2-0.5-2.6-0.6-1.1-1.5-1.6-2.8-1.6-1.2,0-2,0.4-2.6,1.3-0.5,0.9-0.8,2-0.8,3.3,0,1.2,0.3,2.2,0.8,3.1,0.6,0.8,1.4,1.2,2.6,1.2,1.2,0,2.1-0.5,2.6-1.5zm-10.6-8.2c0.8,0.6,1.3,1.7,1.5,3.3h-1.9c-0.1-0.7-0.4-1.3-0.8-1.8-0.4-0.5-1.1-0.7-2-0.7-1.2,0-2.1,0.6-2.6,1.8-0.4,0.8-0.6,1.8-0.6,2.9,0,1.2,0.3,2.1,0.8,2.9,0.5,0.8,1.2,1.2,2.3,1.2,0.8,0,1.4-0.2,1.9-0.7,0.5-0.5,0.8-1.2,1-2h1.9c-0.2,1.5-0.8,2.6-1.7,3.3-0.8,0.7-1.9,1.1-3.3,1.1-1.5,0-2.7-0.6-3.6-1.7-0.9-1.1-1.3-2.4-1.3-4.1,0-2,0.5-3.6,1.4-4.7,1-1.2,2.3-1.7,3.8-1.7,1.3,0,2.4,0.3,3.2,0.9zm-13.3,8.6h2.2v2.4h-2.2v-2.4zm-181-15.8-6,12.9h-7.6c-0.9-0.4-4.5-6-5.3-7.2-3.3-4.5-6.8-8.9-10.1-13.5-1.2-1.7-2.8-3.2-4-5.1h-8.9v-2.8h17.7c3.4,0,7.2,0.3,9.6-0.8,2.2-0.9,3.9-2.5,5.2-4.3,1.1-1.7,2.8-4.6,2.1-8-1.2-4.9-4-7.791-8.5-9.251-2.6-0.81-9.8-0.61-9.8-0.61h-21v56.361h4.7v-26h6.5c6.4,8.6,12.9,17.3,19.3,26h12.9l6.5-13.1h34.5l6.4,13.1h5.4l-8.6-17.7h-41zm-41.9-34.10h17.7c4.5,0,7.8-0.1,10,2.1,1.1,1.1,2.8,3.2,2.1,5.9-0.5,2.2-1.9,4-3.9,4.8-2,0.9-5.8,0.7-8.4,0.7h-17.5v-13.50zm61.1-4.751-17.4,36.051h37.5l-17.4-36.051h-2.7zm-9.9,31.251,11-22.9,11.4,22.9h-22.4zm-127.60-26.500h25.800v51.8h4.7v-56.361h-30.500v4.561zm276.70-12.341-35.6,29.741v-29.741h-4.8v39.441l48-39.441h-7.6zm19.4,0h-7.4l-32.3,26.941,32.3,37.2h6.2l-31.6-36.400,32.8-27.741zm-163.3,0-25.1,50.841-5.9-7.8-3.4-4.5v-0.4c9.7,0,16-4.9,18.8-11.6,4.8-11.3-2.7-21.961-10.4-25.211-3.4-1.44-8-1.33-12.9-1.33h-20.3h-73.600v4.74h64.100v2.97l-30.7,0.1v56.331h4.7v-51.8h26v51.8h4.7v-59.401h22.8c4,0,8.8-0.46,12,0.57,3.4,1.12,5.9,3.35,7.7,6.031,1.7,2.6,3.5,7.2,2.1,11.6-0.7,2.3-1.9,4.2-3.2,5.9-1.3,1.7-4.4,3.4-6.6,4.2-1,0.3-3.1,0.5-3.1,0.5h-11.5c5.6,7.7,11.3,15.3,17,23h4.4c0.6-0.4,25-50.151,25.4-51.801h6.1l29.2,59.401h5.1l-31.3-64.141h-12.1zm103.5,43.641v20.5h4.8v-18.2l12.5-10.5,25,28.7h6.3l-30.6-35.1-18,14.6zm-7.7-28.3c-6.1-9.141-17.1-15.251-29.6-15.251-19.2,0-34.8,14.351-34.8,32.151,0,17.7,15.6,32.1,34.8,32.1,10.5,0,22.4-4.1,29.7-10.8v10.6h4.8v-19c-1.7,0.8-3.3,1.8-4.9,2.8v0.1c-10.9,7.1-19.4,11.2-29.9,11.3-16.4,0-29.6-12.2-29.6-27.2,0-15.1,13.2-27.311,29.6-27.311,11.5,0,21.5,6.011,26.4,14.811,0,0,2.2-1.4,3.5-2.2v20.8c-1.3,0.9-4.5,3.3-4.6,3.4-8.2,5.4-17.9,10.3-25.5,10.4-12,0-21.7-9-21.7-19.9,0-11,9.7-19.9,21.7-19.9,8.4,0,15.7,4.4,19.3,10.8l0.1,0.1c0.2,0.2,0.5,0.2,0.7,0.1,0,0,0.1-0.1,0.1-0.1,0.1-0.1,0.9-0.6,1.7-1,0.4-0.3,0.8-0.5,1.1-0.7,0.1,0,0.2-0.1,0.3-0.2h0.1l0.1-0.1c0.2-0.1,0.3-0.5,0.1-0.7-4.5-7.8-13.3-12.971-23.4-12.971-14.8,0-26.7,11.071-26.7,24.771,0,13.7,11.9,24.7,26.7,24.7,9.6,0,25.4-8.1,29.9-12.2,1.6-1.1,3.1-2.4,4.9-3.2v-41.561h-4.9v15.361z").hide().attr({fill:(g=
this.opts.logoColor)!=null?g:"#AA5128","stroke-width":0,"stroke-opacity":0,opacity:0.25,cx:d+f/2,cy:h-b/2}).scale(c[0],c[1],d,h).show()}};e.prototype.drawFootnote=function(b){var a;b!=null||(b=(a=this.opts.footnote)!=null?a:"");if(!b.match(/^\s*$/)){this.footnote=this.r.sai.prim.wrappedText(this.x+this.padding.left,this.y-this.padding.bottom,this.w,b," ");b=this.footnote.getBBox().height;this.padding.bottom+=b+10;return this.footnote.translate(0,-b)}};e.prototype.render=function(){this.opts.simple&&
this.renderPlots!=null?this.renderPlots():this.renderFull();return this};e.prototype.renderFull=function(){this.plot!=null||(this.plot=new Sai.Plot(this.r));this.plot.render();return this};e.prototype.showError=function(b){var a,c;return this.r.text(this.x+this.padding.left+((a=this.pw)!=null?a:this.w)/2,this.y-this.padding.bottom-((c=this.ph)!=null?c:this.h)/2,b)};e.prototype.setColors=function(b){var a,c;this.colors!=null||(this.colors={});for(a in b){c=this.renames[a];if(c in this.data)this.colors[c]=
b[a]}return this};e.prototype.setColor=function(b,a){this.colors!=null||(this.colors={});this.colors[this.renames[b]]=a;return this};e.prototype.normalizedHeight=function(b,a){var c,f;if(((c=this.ndata[a])!=null?c.__YVALS__:void 0)!=null){f=this.ndata[a].__YVALS__[0];c=this.ndata[a].__YVALS__[this.ndata[a].__YVALS__.length-1];if(b<f)b=f;else if(b>c)b=c;return(b-f)/(c-f)}};e.prototype.drawGuideline=function(b,a){var c;if(a==null)a="all";if(((c=this.ndata[a])!=null?c.__YVALS__:void 0)!=null){c=this.normalizedHeight(b,
a);this.guidelines!=null||(this.guidelines=this.r.set());c=new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,{guideline:[[0,c],[1,c]]});c.render({guideline:"#ccc"});return this.guidelines.push(c.set)}};e.prototype.drawLegend=function(b){var a,c,f,d,h;b!=null||(b=this.colors);if(b){c={};f={};for(a in b)if(a!==this.__LABELS__){c[a]=b[a];f[a]="black";if(((d=this.opts.groups)!=null?d.right:void 0)!=null)if(D.call(this.opts.groups.right,a)>=0)f[a]=this.ndata.left!=null?(h=this.colors.__RIGHTAXIS__)!=
null?h:"blue":"black"}this.legend=this.r.sai.prim.legend(this.x,this.y-this.padding.bottom,this.w,c,f);b=this.legend.getBBox();if(this.legend.length>0)this.padding.bottom+=b.height+15;return this.legend.translate((this.w-b.width)/2,0)}};e.prototype.drawTitle=function(){if(this.opts.title!=null){this.title=this.r.text(this.x+this.w/2,this.y-this.h,this.opts.title).attr({"font-size":20});this.title.translate(0,this.title.getBBox().height/2);return this.padding.top+=this.title.getBBox().height+5}};e.prototype.setupInfoSpace=
function(){this.info_y=this.y-this.h+this.padding.top;this.info_x=this.x+this.padding.left;this.info_w=this.w-this.padding.left-this.padding.right;return this.padding.top+=30};e.prototype.drawInfo=function(b,a){var c,f;if(a==null)a=true;b!=null||(b=this.default_info!=null?this.default_info():{});if(a)this.info_data={};this.info&&this.info.remove();for(c in b)c.match("^__")||(this.info_data[c]=(f=b[c])!=null?f:"(no data)");return this.info=this.r.sai.prim.info(this.info_x,this.info_y,this.info_w,this.info_data)};
e.prototype.getIndex=function(b){b=Sai.util.transformCoords(b,this.r.canvas).x;return Math.round((this.data[this.__LABELS__].length-1)*(b-this.px)/this.pw)};e.prototype.drawHistogramLegend=function(b,a){var c,f,d,h,g,i,k,l,m,o,n,p;a!=null||(a=this.colors);this.histogramLegend=this.r.set();h=Math.max(0.1*(this.h-this.padding.bottom-this.padding.top),50);l=Math.min(150,(this.w-this.padding.left-this.padding.right-20)/b.length);g=0;for(m=b.length;0<=m?g<m:g>m;0<=m?g+=1:g-=1){k=b[g];c=[];f=0;for(d=this.ndata[k][k].length;0<=
d?f<d:f>d;0<=d?f+=1:f-=1)this.ndata[k][k][f]!=null&&c.push(this.ndata[k][k][f][1]);f=c;if(((o=this.bounds)!=null?o[k]:void 0)!=null){c=this.bounds[k];d=c[0];c=c[1]}else{n=this.data[k];p=[];c=0;for(i=n.length;c<i;c++){d=n[c];d!=null&&p.push(d)}d=p;c=[Math.min.apply(Math,d),Math.max.apply(Math,d)];d=c[0];c=c[1]}c=this.getYAxisVals(d,c,true);d=c[0];i=c[c.length-1];c=a[k];this.histogramLegend.push(f=this.r.sai.prim.histogram(this.x+g*l,this.y-this.padding.bottom,l*0.8,h,f,d,i,k,typeof c==="object"?[c.__LOW__,
c.__HIGH__]:[c],"white",this.opts.fromWhite));this.opts.interactive&&this.setupHistogramInteraction(f,k)}this.histogramLegend.translate((this.w-this.padding.left-this.padding.right-this.histogramLegend.getBBox().width)/2,0);return this.padding.bottom+=h+5};e.prototype.setupHistogramInteraction=function(){return null};return e}();Sai.LineChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.nonNegativeGroups=function(){return this.opts.stacked?["all",
"left","right"]:[]};e.prototype.dataGroups=function(){var b,a,c,f,d,h;b=e.__super__.dataGroups.apply(this,arguments);if(((a=this.opts.groups)!=null?a.left:void 0)!=null&&((c=this.opts.groups)!=null?c.right:void 0)!=null){d=this.opts.groups.left;h=[];c=0;for(f=d.length;c<f;c++){a=d[c];this.caresAbout(a)&&a in this.data&&h.push(a)}b.left=h;d=this.opts.groups.right;h=[];c=0;for(f=d.length;c<f;c++){a=d[c];this.caresAbout(a)&&a in this.data&&h.push(a)}b.right=h}return b};e.prototype.renderPlots=function(){var b,
a,c,f,d,h,g,i;this.px==null&&this.setPlotCoords();this.drawBG();this.drawLogo();c="right"in this.ndata;b=this.opts.stacked!=null?this.stackedNdata:this.ndata;a=this.opts.area?Sai.AreaPlot:Sai.LinePlot;if(c){if(((f=this.ndata.left)!=null?f.__YVALS__[0]:void 0)<0)this.drawGuideline(0,"left");if(((d=this.ndata.right)!=null?d.__YVALS__[0]:void 0)<0)this.drawGuideline(0,"right")}else this.ndata.all.__YVALS__[0]<0&&this.drawGuideline(0,"all");this.plots=[];if(c){if(b.left!=null)this.plots.push((new a(this.r,
this.px,this.py,this.pw,this.ph,b.left)).render(this.colors,(h=this.opts.lineWidth)!=null?h:2,this.opts.stacked,this.getBaseline("left")));if(b.right!=null)return this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,b.right)).render(this.colors,(g=this.opts.lineWidth)!=null?g:2,this.opts.stacked,this.getBaseline("right")))}else return this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,b.all)).render(this.colors,(i=this.opts.lineWidth)!=null?i:2,this.opts.stacked,this.getBaseline("all")))};
e.prototype.renderFull=function(){var b,a,c,f,d,h,g;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawLegend();"right"in this.ndata?this.addAxes(["left","right"]):this.addAxes(["all"]);this.renderPlots();this.plotSets=this.r.set();d=this.plots;c=0;for(f=d.length;c<f;c++){b=d[c];this.plotSets.push(b.set)}this.dots=this.r.set();for(a in this.ndata.all)if(a!=="__YVALS__")this.dots.push(this.r.circle(0,0,4).attr({fill:(h=(g=this.colors)!=null?g[a]:void 0)!=null?h:"black"}).hide());b=
this.r.set().push(this.bg,this.plotSets,this.dots,this.logo,this.guidelines).mousemove(w(function(i){var k,l,m,o,n,p,q,s,r,t;l=this.getIndex(i);i={};if(((s=this.data[this.__LABELS__])!=null?s.length:void 0)>l&&l>=0){i[this.__LABELS__]=this.data[this.__LABELS__][l];for(n in this.ndata.all)if(this.data[n]!=null)i[n]=this.data[n][l]}this.drawInfo(i);k=0;s=[];for(n in this.ndata.all)n!=="__YVALS__"&&s.push(function(){r=this.plots;t=[];p=0;for(q=r.length;p<q;p++){m=r[p];if(n in m.dndata){o=m.dndata[n][l];
o!=null?this.dots[k].attr({cx:o[0],cy:o[1]}).show().toFront():this.dots[k].hide();t.push(k++)}}return t}.call(this));return s},this)).mouseout(w(function(){this.drawInfo({},true);return this.dots.hide()},this));this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}();Sai.StreamChart=function(){function e(b,a,c,f,d,h,g,i){this.r=b;this.x=a;this.y=c;this.w=f;this.h=d;this.__LABELS__=g;this.opts=i;this.opts.stacked=true;e.__super__.constructor.apply(this,arguments)}j(e,
Sai.LineChart);e.prototype.getStackedMax=function(){return e.__super__.getStackedMax.apply(this,arguments)/2};e.prototype.getStackedMin=function(b,a){var c,f;c=e.__super__.getStackedMin.apply(this,arguments);f=this.getStackedMax(b,a);return c-f};e.prototype.normalize=function(b){var a,c,f,d,h,g,i,k,l,m,o,n,p,q,s,r;e.__super__.normalize.apply(this,arguments);c=this.dataGroups(this.data);this.baselines!=null||(this.baselines={});q=[];for(a in this.stackedNdata){d=this.normalizedHeight(0,a!=null?a:"all");
this.normalizedHeight(this.getStackedMin(b,c[a]),a);this.baselines[a]=[];var t=this.ndata[a];n=this.ndata[a].__YVALS__;s=[];m=0;for(o=n.length;m<o;m++){l=n[m];s.push(Math.abs(l))}t.__YVALS__=s;for(i in this.stackedNdata[a])k=i;q.push(function(){r=[];f=0;for(p=this.stackedNdata[a][i].length;0<=p?f<p:f>p;0<=p?f+=1:f-=1){h=(this.stackedNdata[a][k][f][1]-d)/2;for(i in this.stackedNdata[a]){g=this.stackedNdata[a][i][f];if(g!=null)g[1]-=h}r.push(this.baselines[a].push([g[0],d-h]))}return r}.call(this))}return q};
e.prototype.addAxes=function(b,a){if(a==null)a={};"left"in a||(a.left="magnitude");return e.__super__.addAxes.call(this,b,a)};e.prototype.getBaseline=function(b){return this.baselines[b]};return e}();Sai.Sparkline=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.dataGroups=function(){return{data:["data"]}};e.prototype.renderFull=function(){this.drawBG();this.plots=this.r.set();this.plots.push((new Sai.LinePlot(this.r,this.x,this.y,this.w,this.h,this.ndata.data)).render({data:this.colors&&
this.colors[series]||"black"},1).set);return this};return e}();Sai.BarChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.getMin=function(){return Math.min(e.__super__.getMin.apply(this,arguments),0)};e.prototype.groupsToNullPad=function(){var b,a;a=[];for(b in this.dataGroups())a.push(b);return a};e.prototype.tooMuchData=function(){var b,a,c;a=this.w/3;b=0;for(c in this.data)if(c!==this.__LABELS__){b+=this.data[c].length;if(this.opts.stacked)break}return b>
a};e.prototype.renderPlots=function(){var b,a,c,f,d;this.px==null&&this.setPlotCoords();this.drawLogo();this.drawBG();if(this.tooMuchData()){this.showError("Sorry, the chart isn't wide enough to plot this much data.\n \nPossible solutions include downsampling your data\n (e.g. weekly instead of daily) or using a line chart");return this}if("all"in this.ndata){this.guidelines=this.r.set();d=this.ndata.all.__YVALS__.slice(1,this.ndata.all.__YVALS__.length-1);a=0;for(c=d.length;a<c;a++){b=d[a];this.drawGuideline(b)}}this.plots=
this.r.set();b={};c={};c[this.__LABELS__]=this.data[this.__LABELS__];a=this.opts.stacked!=null?this.stackedNdata:this.ndata;for(f in a.all)if(!(f.match("^__")||f===this.__LABELS__)){b[f]=a.all[f];c[f]=this.data[f]}return this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph,b,c)).render(this.opts.stacked!=null,this.normalizedHeight(0,"all"),this.colors,this.opts.interactive&&!this.opts.simple,this.drawInfo,this.__LABELS__).set)};e.prototype.renderFull=function(){var b;this.drawTitle();
this.setupInfoSpace();this.drawFootnote();this.drawLegend();this.addAxes(["all"]);this.renderPlots();b=this.r.set().push(this.plots,this.bg,this.logo,this.guidelines);this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}();Sai.StockChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.semanticRenamePatterns={open:/^open$/i,close:/^close$/i,high:/^high$/i,low:/^low$/i,volume:/^vol(ume)?$/i};e.prototype.groupsToNullPad=
function(){return["prices","volume","__META__"]};e.prototype.dataGroups=function(b){var a,c,f,d;a={__META__:[this.__LABELS__]};f=(d=this.semanticRenames.volume)!=null?d:"volume";if(f in this.data)a.volume=[f];for(c in b)if(this.caresAbout(c)&&c!==this.__LABELS__&&c!==f){a.prices!=null||(a.prices=[]);a.prices.push(c)}return a};e.prototype.nonNegativeGroups=function(){return["volume"]};e.prototype.renderPlots=function(){var b,a,c,f,d,h,g,i,k,l,m,o;this.px==null&&this.setPlotCoords();d=(a=this.semanticRenames.open)!=
null?a:"open";a=(c=this.semanticRenames.close)!=null?c:"close";c=(f=this.semanticRenames.high)!=null?f:"high";f=(k=this.semanticRenames.low)!=null?k:"low";k=(o=this.semanticRenames.volume)!=null?o:"volume";this.colors!=null||(this.colors={});(h=this.colors).up!=null||(h.up="black");(i=this.colors).down!=null||(i.down="red");(l=this.colors).vol_up!=null||(l.vol_up="#666666");(m=this.colors).vol_down!=null||(m.vol_down="#cc6666");this.drawLogo();this.drawBG();if(this.ndata.prices!=null&&d in this.ndata.prices&&
a in this.ndata.prices&&c in this.ndata.prices&&f in this.ndata.prices){this.ndata.prices.__YVALS__[0]<0&&this.drawGuideline(0,"prices");this.plots=this.r.set();i={up:[],down:[]};h={};for(b in this.ndata.prices)b.match("^__")||b===this.__LABELS__||(h[b]=this.data[b]);if(this.data[k]!=null)h.vol=this.data[k];if("volume"in this.ndata){b=0;for(l=this.ndata.volume[k].length;0<=l?b<l:b>l;0<=l?b+=1:b-=1)if(this.ndata.volume[k][b]!==null)if(b&&this.ndata.prices[a][b-1]&&this.ndata.prices[a][b][1]<this.ndata.prices[a][b-
1][1]){i.down.push(this.ndata.volume[k][b]);i.up.push([this.ndata.volume[k][b][0],0])}else{i.up.push(this.ndata.volume[k][b]);i.down.push([this.ndata.volume[k][b][0],0])}else{i.up.push([0,0]);i.down.push([0,0])}this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph*0.2,i,h)).render(true,this.normalizedHeight(0,"volume"),{up:this.colors.vol_up,down:this.colors.vol_down}).set)}this.plots.push((new Sai.CandlestickPlot(this.r,this.px,this.py,this.pw,this.ph,{open:this.ndata.prices[d],
close:this.ndata.prices[a],high:this.ndata.prices[c],low:this.ndata.prices[f]},h)).render(this.colors,Math.min(5,this.pw/this.ndata.prices[d].length-2)).set);b={};for(g in this.ndata.prices)g===d||g===a||g===c||g===f||g.match("^__")||g===this.__LABELS__||(b[g]=this.ndata.prices[g]);return this.plots.push((new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,b)).render(this.colors).set)}else this.showError("This chart requires data series named\nopen, close, high, and low.\n \nOnce you add series with these names, the chart will display.")};
e.prototype.renderFull=function(){var b,a,c,f,d,h,g,i,k,l;this.drawTitle();this.setupInfoSpace();this.drawFootnote();h=(a=this.semanticRenames.open)!=null?a:"open";a=(f=this.semanticRenames.close)!=null?f:"close";f=(d=this.semanticRenames.high)!=null?d:"high";d=(b=this.semanticRenames.low)!=null?b:"low";k=(i=this.semanticRenames.volume)!=null?i:"volume";b={};i=false;for(g in this.ndata.prices)if(g!==h&&g!==a&&g!==f&&g!==d&&!(g.match("^__")||g===this.__LABELS__)){b[g]=((l=this.colors)!=null?l[g]:void 0)||
"black";i=true}i&&this.drawLegend(b);this.addAxes(["prices"]);this.renderPlots();c=this.pw/(this.data[this.__LABELS__].length-1);this.glow=this.r.rect(this.px-c/2,this.py-this.ph,c,this.ph).attr({fill:"0-"+this.opts.bgcolor+"-#DDAA99-"+this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack().hide();this.bg.toBack();this.r.set().push(this.bg,this.plots,this.logo,this.glow,this.guidelines).mousemove(w(function(m){var o,n,p,q,s;m=this.getIndex(m);o={};if(this.data[this.__LABELS__][m]!=null)o[this.__LABELS__]=
this.data[this.__LABELS__][m];n=false;for(p in this.ndata.prices)if(!(p.match("^__")||p===this.__LABELS__))if(((q=this.data[p])!=null?q[m]:void 0)!=null){o[p]=this.data[p][m];n=true}if(((s=this.data[k])!=null?s[m]:void 0)!=null){o[k]=this.data[k][m];n=true}this.drawInfo(o);if(n)return this.glow.attr({x:this.px+c*(m-0.5)}).show()},this)).mouseout(w(function(){this.drawInfo({},true);return this.glow.hide()},this));return this};return e}();Sai.GeoChart=function(){function e(){this.renderPlots=w(this.renderPlots,
this);e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.plotType=Sai.GeoPlot;e.prototype.interactiveHistogram=true;e.prototype.getMax=function(b){return Math.max.apply(Math,b)};e.prototype.getMin=function(b){return Math.min.apply(Math,b)};e.prototype.normalize=function(b){var a,c,f,d,h,g,i,k,l,m,o,n,p,q,s;this.ndata={};this.bounds={};d={};g={};for(l in b)if(!(l.match("^__")||l===this.__LABELS__))if(b[l]!=null){n=b[l];q=[];m=0;for(o=n.length;m<o;m++){a=n[m];a!=null&&q.push(a)}a=
q;d[l]=this.getMax(a,l);if(!(typeof i!="undefined"&&i!==null)||d[l]>i)i=d[l];g[l]=this.getMin(a,l);if(!(typeof k!="undefined"&&k!==null)||g[l]<k)k=g[l]}a=[];for(l in b)if(!(l.match("^__")||l===this.__LABELS__))if(b[l]!=null){if(this.opts.groupedNormalization){f=i;h=k}else{f=d[l];h=g[l]}this.bounds[l]=[h,f];this.ndata[l]={};a.push(this.ndata[l][l]=function(){s=[];c=0;for(p=b[l].length;0<=p?c<p:c>p;0<=p?c+=1:c-=1)s.push(b[l][c]!=null?[c/(b[l].length-1),(b[l][c]-h)/(f-h)]:null);return s}())}return a};
e.prototype.dataGroups=function(b){var a,c;a=[];for(c in b)if(c.match("^__")||c===this.__LABELS__)a.push(c);a={__META__:a};for(c in b)c.match("^__")||c===this.__LABELS__||(a[c]=[c]);return a};e.prototype.setupHistogramInteraction=function(b,a){return b.click(w(function(){return this.renderPlots(a)},this)).hover(w(function(c){return w(function(){c.attr({"fill-opacity":0.75});return this.drawInfo({"Click to display on map":a})},this)},this)(b),w(function(c){return w(function(){c.attr({"fill-opacity":1});
return this.drawInfo()},this)},this)(b))};e.prototype.renderPlots=function(b){var a,c;this.px==null&&this.setPlotCoords();if((a=this.bg)!=null)a.remove();if((a=this.logo)!=null)a.remove();if((a=this.geoPlot)!=null)a.set.remove();this.drawBG();this.drawLogo();a={};for(c in this.ndata)a[c]=this.ndata[c][c];this.geoPlot=(new this.plotType(this.r,this.px,this.py,this.pw,this.ph,a,this.data,{fromWhite:this.opts.fromWhite})).render(this.colors||{},this.data.__MAP__,this.__LABELS__,b!=null?b:this.data.__DEFAULT__,
this.opts.bgcolor,this.opts.interactive&&!this.opts.simple,this.drawInfo);return this};e.prototype.default_info=function(){return{"":this.opts.interactive?"Click histogram below to change map display":""}};e.prototype.renderFull=function(){var b,a,c;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawHistogramLegend(function(){c=[];for(a in this.data)a.match("^__")||a===this.__LABELS__||c.push(a);return c}.call(this));this.setPlotCoords();this.drawInfo();this.renderPlots();b=this.r.set().push(this.geoPlot.set,
this.bg,this.logo,this.info,this.footnote);this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}();Sai.ChromaticGeoChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.GeoChart);e.prototype.plotType=Sai.ChromaticGeoPlot;e.prototype.interactiveHistogram=false;e.prototype.default_info=function(){return{}};e.prototype.setupHistogramInteraction=function(){return false};return e}();Sai.ScatterChart=function(){function e(){e.__super__.constructor.apply(this,
arguments)}j(e,Sai.Chart);e.prototype.dataGroups=function(b){var a,c;a=[];for(c in b)if(c.match("^__")||c===this.__LABELS__)a.push(c);a={__META__:a};for(c in b)c.match("^__")||c===this.__LABELS__||(a[c]=[c]);return a};e.prototype.renderPlots=function(){var b,a,c,f,d,h,g;this.px==null&&this.setPlotCoords();b=(h=(g=this.opts.colors)!=null?g:this.colors)!=null?h:["black","white"];h=(d=this.opts.stroke_opacity)!=null?d:[0,1];d=(c=this.opts.stroke_colors)!=null?c:["black","black"];c=(a=this.opts.radius)!=
null?a:[4,12];this.drawLogo();this.drawBG();a={};for(f in this.ndata)a[f]=this.ndata[f][f];this.plots=this.r.set();this.plots.push((new Sai.ScatterPlot(this.r,this.px,this.py,this.pw,this.ph,a,this.data)).render(this.opts.mappings,b,c,h,d,this.opts.interactive&&!this.opts.simple,this.drawInfo).set);return this};e.prototype.renderFull=function(){var b,a,c,f,d,h;this.drawTitle();this.setupInfoSpace();this.drawFootnote();a=(h=(d=this.opts.colors)!=null?d:this.colors)!=null?h:["black","white"];h=(f=this.opts.stroke_colors)!=
null?f:["black","black"];d=[];f={};if(a instanceof Array){d.push(this.opts.mappings.color);f[this.opts.mappings.color]={__LOW__:a[0],__HIGH__:a[1]}}else{typeof legend_colors!="undefined"&&legend_colors!==null||(legend_colors={});c=true;for(b in a)legend_colors[b]=a[b]}if(!(h instanceof Array)){typeof legend_colors!="undefined"&&legend_colors!==null||(legend_colors={});c=true;for(b in a)legend_colors[b]=h[b]}d.length&&this.drawHistogramLegend(d,f);c&&this.drawLegend(a);this.__LABELS__="__XVALS__";
this.data.__XVALS__=this.ndata[this.opts.mappings.x].__YVALS__;this.addAxes([this.opts.mappings.y],{left:this.opts.mappings.y,bottom:this.opts.mappings.x});this.renderPlots();b=this.r.set().push(this.plots,this.bg,this.logo,this.info,this.footnote,this.histogramLegend,this.legend);this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}()}).call(this);(function(){var w=function(e,b){return function(){return e.apply(b,arguments)}},D=Array.prototype.indexOf||function(e){for(var b=0,a=this.length;b<a;b++)if(this[b]===e)return b;return-1},v=Object.prototype.hasOwnProperty,j=function(e,b){function a(){this.constructor=e}for(var c in b)if(v.call(b,c))e[c]=b[c];a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e};Sai.Chart=function(){function e(b,a,c,f,d,h,g,i){var k;this.r=b;this.x=a;this.y=c;this.w=f;this.h=d;this.__LABELS__=
g;this.opts=i!=null?i:{};this.drawInfo=w(this.drawInfo,this);(k=this.opts).bgcolor!=null||(k.bgcolor="white");this.setData(h);b=this.opts.simple?0:5;this.padding={left:b,right:b,top:b,bottom:b}}e.prototype.groupsToNullPad=function(){return[]};e.prototype.nonNegativeGroups=function(){return[]};e.prototype.nextSeriesSuffix=function(){var b;this.suffixCtr=((b=this.suffixCtr)!=null?b:0)+1;return"["+this.suffixCtr+"]"};e.prototype.fixSeriesName=function(b){return b+(b.match(/^\s+$/)?this.nextSeriesSuffix():
"")};e.prototype.setSemanticRename=function(b){var a,c;if(this.semanticRenamePatterns!=null){this.semanticRenames!=null||(this.semanticRenames={});c=[];for(a in this.semanticRenamePatterns)c.push(b.match(this.semanticRenamePatterns[a])?this.semanticRenames[a]=b:void 0);return c}};e.prototype.getBaseline=function(b){b=this.normalizedHeight(0,b!=null?b:"all");return[[0,b],[1,b]]};e.prototype.setData=function(b){var a,c,f,d,h,g,i,k,l;this.data={};this.renames={};if(function(n){var p;for(p in n)if(n.hasOwnProperty(p))return false;
return true}(b))this.render=function(){return this.showError("(no data -> empty chart)")};else{for(d in b){for(;;){h=this.fixSeriesName(d);this.setSemanticRename(h);if(h===d||!(h in b))break}this.renames[d]=h;if(b[d]instanceof Array)if(this.__LABELS__===d){this.__LABELS__=h;var m=this.data,o=h;k=b[d];l=[];g=0;for(i=k.length;g<i;g++){a=k[g];l.push(String(a))}m[o]=l}else{m=this.data;o=h;k=b[d];l=[];g=0;for(i=k.length;g<i;g++){a=k[g];l.push(typeof a==="string"&&a.match(/^( +)?[+-]?[\d,]+(\.\d+)?( +)?$/)&&
!isNaN(f=parseFloat(a.replace(/,/g,"")))?f:a)}m[o]=l}else this.data[h]=b[d]}b=this.dataGroups(this.data);f=this.nonNegativeGroups();for(c in b)if(b[c].length>0)if(D.call(f,c)>=0){i=b[c];h=0;for(g=i.length;h<g;h++){d=i[h];if(this.data[d]!=null){a=0;for(k=this.data[d].length;0<=k?a<k:a>k;0<=k?a+=1:a-=1)if(this.data[d][a]<0)this.data[d][a]*=-1}}}h=this.groupsToNullPad();a=0;for(f=h.length;a<f;a++){c=h[a];if(c in b){i=b[c];g=0;for(c=i.length;g<c;g++){d=i[g];this.nullPad(d)}}}return this.normalize(this.data)}};
e.prototype.nullPad=function(b){if(b in this.data)return this.data[b]=[null].concat(this.data[b].concat([null]))};e.prototype.caresAbout=function(b){return!(b.match("^__")||b===this.__LABELS__)};e.prototype.dataGroups=function(b){var a,c,f;c=[];for(a in b)this.caresAbout(a)&&c.push(a);f=[];for(a in b)if(a.match("^__")||a===this.__LABELS__)f.push(a);return{all:c,__META__:f}};e.prototype.getYAxisVals=function(b,a,c){var f,d,h;if(c==null)c=false;if(!(typeof b==="number"&&typeof a==="number"))return[b,
a];if(b===a)return[0,a,a*2];for(d=1;(a-b)*d<10;)d*=10;b*=d;a*=d;h=Math.floor(f=Math.log(a-b)/Math.LN10-0.4);h=Math.pow(10,h);if(f%1>0.7&&!c)h*=4;else if(f%1>0.35&&!c)h*=2;f=Sai.util.round(b-(c?h/2.1:h/1.75),h);if(f<0&&0<=b)f=0;b=Sai.util.round(a+(c?h/2.1:h/1.75),h);f/=d;b/=d;h/=d;d=f;for(a=[d];d<b;){d=Sai.util.round(d+h,h);a.push(d)}return a};e.prototype.getMax=function(b,a){var c,f,d,h,g,i,k,l,m;return Math.max.apply(Math,function(){l=[];d=0;for(g=a.length;d<g;d++){f=a[d];b[f]!=null&&l.push(Math.max.apply(Math,
function(){k=b[f];m=[];h=0;for(i=k.length;h<i;h++){c=k[h];c!=null&&typeof c==="number"&&m.push(c)}return m}()))}return l}())};e.prototype.getMin=function(b,a){var c,f,d,h,g,i,k,l,m;return Math.min.apply(Math,function(){l=[];d=0;for(g=a.length;d<g;d++){f=a[d];b[f]!=null&&l.push(Math.min.apply(Math,function(){k=b[f];m=[];h=0;for(i=k.length;h<i;h++){c=k[h];c!=null&&typeof c==="number"&&m.push(c)}return m}()))}return l}())};e.prototype.getStackedMax=function(b,a){var c,f,d,h,g,i,k,l;this.stackedMax!=
null||(this.stackedMax={});this.stackedMax[a]=(g=this.stackedMax[a])!=null?g:Math.max.apply(Math,function(){k=[];c=0;for(i=b[this.__LABELS__].length;0<=i?c<i:c>i;0<=i?c+=1:c-=1)k.push(Sai.util.sumArray(function(){l=[];d=0;for(h=a.length;d<h;d++){f=a[d];f!==this.__LABELS__&&b[f][c]>=0&&l.push(b[f][c])}return l}.call(this)));return k}.call(this));return this.stackedMax[a]};e.prototype.getStackedMin=function(b,a){var c,f,d,h,g,i,k,l;this.stackedMin!=null||(this.stackedMin={});this.stackedMin[a]=(g=this.stackedMin[a])!=
null?g:Math.min.apply(Math,function(){k=[];c=0;for(i=b[this.__LABELS__].length;0<=i?c<i:c>i;0<=i?c+=1:c-=1)k.push(Sai.util.sumArray(function(){l=[];d=0;for(h=a.length;d<h;d++){f=a[d];f!==this.__LABELS__&&b[f][c]<0&&l.push(b[f][c])}return l}.call(this)));return k}.call(this));return this.stackedMin[a]};e.prototype.normalize=function(b){var a,c,f,d,h,g,i,k,l,m,o,n,p,q,s,r,t,u,x,B,C,F,G,H,I,J,R,L,M,N,O,P,Q;i=this.dataGroups(b);this.ndata={};if(this.opts.stacked!=null)this.stackedNdata={};p=function(y,
z,E){if(typeof y==="number")return z===E?1:(y-z)/(E-z);return null};a=function(y,z){var E,K,T;K=0;for(T=z.length;K<T;K++){E=z[K];if(!y(E))return false}return true};h=function(y){var z,E,K;E=0;for(K=y.length;E<K;E++){z=y[E];if(typeof z==="number")return false}return true};L=[];for(g in i){if(!(m=g.match("^__"))){if(!(m=Sai.util.sumArray(function(){F=i[g];M=[];u=0;for(B=F.length;u<B;u++){r=F[u];M.push(this.data[r].length)}return M}.call(this))===0)){var S=a,A=h;G=i[g];N=[];m=0;for(n=G.length;m<n;m++){r=
G[m];N.push(this.data[r])}m=S(A,N)}m=m}if(!m){this.ndata[g]={};if(this.opts.stacked!=null){this.stackedNdata[g]={};f={}}n=this.opts.stacked?w(function(y,z){return this.getStackedMin(y,z)},this):this.getMin;m=this.opts.stacked?w(function(y,z){return this.getStackedMax(y,z)},this):this.getMax;o=n(b,i[g]);l=m(b,i[g]);m=this.getYAxisVals(o,l);o=m[0];l=m[m.length-1];this.ndata[g].__YVALS__=m;L.push(function(){H=i[g];O=[];x=0;for(C=H.length;x<C;x++){r=H[x];if(b[r]!=null){var y=this.ndata[g],z=r;P=[];k=
0;for(I=b[r].length;0<=I?k<I:k>I;0<=I?k+=1:k-=1)P.push(b[r][k]!=null&&(s=p(b[r][k],o,l))!==null?[k/(b[r].length-1||1),s]:null);y[z]=P;O.push(function(){if(this.opts.stacked!=null){q=p(0,o,l);this.stackedNdata[g][r]=[];Q=[];k=0;for(J=b[r].length;0<=J?k<J:k>J;0<=J?k+=1:k-=1){d=b[r][k]!=null&&b[r][k]<0?0:1;f[k]!=null||(f[k]=[q,q]);c=f[k][d];t=[k/(b[r].length-1||1),((R=p(b[r][k],o,l))!=null?R:q)-q+c];this.stackedNdata[g][r].push(t);Q.push(t!==null?f[k][d]=t[1]:void 0)}return Q}}.call(this))}}return O}.call(this))}}return L};
e.prototype.addAxes=function(b,a){var c,f,d,h,g,i,k,l,m,o,n,p,q;this.axisWidth=1.5;this.padding.top+=5;for(f=c=this.data[this.__LABELS__].length-1;c<=0?f<=0:f>=0;c<=0?f+=1:f-=1)if(this.data[this.__LABELS__][f]!=null){f=this.r.text(0,0,Sai.util.prettystr(this.data[this.__LABELS__][f]));this.padding.right+=f.getBBox().width/2;f.remove();break}i=this.h-(this.padding.bottom+this.padding.top);c=this.ndata[b[0]]!=null||this.ndata[b[1]]==null;f=this.ndata[b[1]]!=null;if(c){q=this.r.sai.prim.vaxis((h=(l=
this.ndata[b[0]])!=null?l.__YVALS__:void 0)!=null?h:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,i,{width:this.axisWidth,title:a!=null?a.left:void 0});h=q.items[0].getBBox().width;q.remove()}else h=0;if(f){q=this.r.sai.prim.vaxis((d=(m=this.ndata[b[1]])!=null?m.__YVALS__:void 0)!=null?d:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,i,{width:this.axisWidth,title:a!=null?a.right:void 0});d=q.getBBox().width;q.remove()}else d=0;this.haxis=this.r.sai.prim.haxis(this.data[this.__LABELS__],
this.x+this.padding.left+h,this.y-this.padding.bottom,this.w-this.padding.left-this.padding.right-h-d,{width:this.axisWidth,title:a!=null?a.bottom:void 0});d=this.haxis.getBBox().height;if(isNaN(d))d=1;this.haxis.translate(0,-d);this.padding.bottom+=d;i=this.h-(this.padding.bottom+this.padding.top);if(c){this.vaxis=this.r.sai.prim.vaxis((g=(o=this.ndata[b[0]])!=null?o.__YVALS__:void 0)!=null?g:[0,"?"],this.x+this.padding.left,this.y-this.padding.bottom,i,{width:this.axisWidth,title:a!=null?a.left:
void 0});g=this.vaxis.items[0].getBBox().width;this.vaxis.translate(g,0);this.padding.left+=g}if(f){this.vaxis_right=this.r.sai.prim.vaxis((n=(p=this.ndata[b[1]])!=null?p.__YVALS__:void 0)!=null?n:[0,"?"],this.w-this.padding.right,this.y-this.padding.bottom,i,{width:this.axisWidth,right:true,title:a!=null?a.right:void 0,color:this.ndata[b[0]]!=null?(k=this.colors.__RIGHTAXIS__)!=null?k:"blue":"black"});k=this.vaxis_right.items[0].getBBox().width;this.vaxis_right.translate(-k,0);this.padding.right+=
k}this.setPlotCoords();return this.r.set().push(this.haxis).push(this.vaxis)};e.prototype.setPlotCoords=function(){var b,a,c,f;this.px=this.x+this.padding.left;this.py=this.y-this.padding.bottom;this.pw=this.w-this.padding.left-this.padding.right;this.ph=this.h-this.padding.bottom-this.padding.top;b=(a=this.legend)!=null?a.getBBox():void 0;if((a=this.legend)!=null)a.translate(this.px+this.pw/2-(b.x+b.width/2),0);b=(c=this.histogramLegend)!=null?c.getBBox():void 0;return(f=this.histogramLegend)!=null?
f.translate(this.px+this.pw/2-(b.x+b.width/2),0):void 0};e.prototype.drawBG=function(){return this.bg=this.r.rect(this.px!=null&&this.px||this.x,this.py!=null&&this.py-this.ph||this.y-this.h,this.pw!=null&&this.pw||this.w,this.ph!=null&&this.ph||this.h).attr({fill:this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack()};e.prototype.logoPos=function(){return[this.px!=null&&this.pw!=null?this.px+this.pw-150-5:this.w+this.x-150-this.padding.right,this.py!=null&&this.ph!=null?this.py-this.ph+
5:this.y-this.h+this.padding.top,150,28]};e.prototype.drawLogo=function(){var b,a,c,f,d,h,g;if(!this.opts.simple){b=this.logoPos();d=b[0];h=b[1];f=b[2];b=b[3];a=[328.3,53.06];c=[f/344,b/65];d+=a[0]*c[0];h+=a[1]*c[1];return this.logo=this.r.path("M"+d+","+h+"h1.9v1.6c0.5-0.5,0.9-0.9,1.3-1.2,0.6-0.4,1.4-0.7,2.2-0.7,0.9,0,1.6,0.3,2.2,0.7,0.3,0.3,0.6,0.7,0.9,1.2,0.4-0.7,0.9-1.1,1.5-1.4,0.6-0.3,1.2-0.5,2-0.5,1.5,0,2.6,0.6,3.1,1.7,0.3,0.6,0.5,1.4,0.5,2.5v7.7h-2v-8.1c0-0.7-0.2-1.3-0.6-1.6-0.4-0.2-0.9-0.4-1.4-0.4-0.8,0-1.4,0.3-2,0.8-0.5,0.5-0.8,1.3-0.8,2.5v6.8h-2v-7.6c0-0.8-0.1-1.3-0.3-1.7-0.3-0.5-0.8-0.8-1.6-0.8-0.8,0-1.4,0.3-2,0.8-0.6,0.6-0.9,1.6-0.9,3.1v6.2h-2v-11.6zm-3.9,1.1c1,1,1.5,2.5,1.5,4.4,0,1.9-0.4,3.4-1.3,4.7-0.9,1.2-2.3,1.8-4.2,1.8-1.6,0-2.9-0.6-3.8-1.6-0.9-1.1-1.4-2.6-1.4-4.4,0-1.9,0.5-3.5,1.5-4.6,1-1.2,2.3-1.7,3.9-1.7,1.5,0,2.8,0.5,3.8,1.4zm-1.2,7.7c0.5-0.9,0.7-2,0.7-3.2,0-1.1-0.2-2-0.5-2.6-0.6-1.1-1.5-1.6-2.8-1.6-1.2,0-2,0.4-2.6,1.3-0.5,0.9-0.8,2-0.8,3.3,0,1.2,0.3,2.2,0.8,3.1,0.6,0.8,1.4,1.2,2.6,1.2,1.2,0,2.1-0.5,2.6-1.5zm-10.6-8.2c0.8,0.6,1.3,1.7,1.5,3.3h-1.9c-0.1-0.7-0.4-1.3-0.8-1.8-0.4-0.5-1.1-0.7-2-0.7-1.2,0-2.1,0.6-2.6,1.8-0.4,0.8-0.6,1.8-0.6,2.9,0,1.2,0.3,2.1,0.8,2.9,0.5,0.8,1.2,1.2,2.3,1.2,0.8,0,1.4-0.2,1.9-0.7,0.5-0.5,0.8-1.2,1-2h1.9c-0.2,1.5-0.8,2.6-1.7,3.3-0.8,0.7-1.9,1.1-3.3,1.1-1.5,0-2.7-0.6-3.6-1.7-0.9-1.1-1.3-2.4-1.3-4.1,0-2,0.5-3.6,1.4-4.7,1-1.2,2.3-1.7,3.8-1.7,1.3,0,2.4,0.3,3.2,0.9zm-13.3,8.6h2.2v2.4h-2.2v-2.4zm-181-15.8-6,12.9h-7.6c-0.9-0.4-4.5-6-5.3-7.2-3.3-4.5-6.8-8.9-10.1-13.5-1.2-1.7-2.8-3.2-4-5.1h-8.9v-2.8h17.7c3.4,0,7.2,0.3,9.6-0.8,2.2-0.9,3.9-2.5,5.2-4.3,1.1-1.7,2.8-4.6,2.1-8-1.2-4.9-4-7.791-8.5-9.251-2.6-0.81-9.8-0.61-9.8-0.61h-21v56.361h4.7v-26h6.5c6.4,8.6,12.9,17.3,19.3,26h12.9l6.5-13.1h34.5l6.4,13.1h5.4l-8.6-17.7h-41zm-41.9-34.10h17.7c4.5,0,7.8-0.1,10,2.1,1.1,1.1,2.8,3.2,2.1,5.9-0.5,2.2-1.9,4-3.9,4.8-2,0.9-5.8,0.7-8.4,0.7h-17.5v-13.50zm61.1-4.751-17.4,36.051h37.5l-17.4-36.051h-2.7zm-9.9,31.251,11-22.9,11.4,22.9h-22.4zm-127.60-26.500h25.800v51.8h4.7v-56.361h-30.500v4.561zm276.70-12.341-35.6,29.741v-29.741h-4.8v39.441l48-39.441h-7.6zm19.4,0h-7.4l-32.3,26.941,32.3,37.2h6.2l-31.6-36.400,32.8-27.741zm-163.3,0-25.1,50.841-5.9-7.8-3.4-4.5v-0.4c9.7,0,16-4.9,18.8-11.6,4.8-11.3-2.7-21.961-10.4-25.211-3.4-1.44-8-1.33-12.9-1.33h-20.3h-73.600v4.74h64.100v2.97l-30.7,0.1v56.331h4.7v-51.8h26v51.8h4.7v-59.401h22.8c4,0,8.8-0.46,12,0.57,3.4,1.12,5.9,3.35,7.7,6.031,1.7,2.6,3.5,7.2,2.1,11.6-0.7,2.3-1.9,4.2-3.2,5.9-1.3,1.7-4.4,3.4-6.6,4.2-1,0.3-3.1,0.5-3.1,0.5h-11.5c5.6,7.7,11.3,15.3,17,23h4.4c0.6-0.4,25-50.151,25.4-51.801h6.1l29.2,59.401h5.1l-31.3-64.141h-12.1zm103.5,43.641v20.5h4.8v-18.2l12.5-10.5,25,28.7h6.3l-30.6-35.1-18,14.6zm-7.7-28.3c-6.1-9.141-17.1-15.251-29.6-15.251-19.2,0-34.8,14.351-34.8,32.151,0,17.7,15.6,32.1,34.8,32.1,10.5,0,22.4-4.1,29.7-10.8v10.6h4.8v-19c-1.7,0.8-3.3,1.8-4.9,2.8v0.1c-10.9,7.1-19.4,11.2-29.9,11.3-16.4,0-29.6-12.2-29.6-27.2,0-15.1,13.2-27.311,29.6-27.311,11.5,0,21.5,6.011,26.4,14.811,0,0,2.2-1.4,3.5-2.2v20.8c-1.3,0.9-4.5,3.3-4.6,3.4-8.2,5.4-17.9,10.3-25.5,10.4-12,0-21.7-9-21.7-19.9,0-11,9.7-19.9,21.7-19.9,8.4,0,15.7,4.4,19.3,10.8l0.1,0.1c0.2,0.2,0.5,0.2,0.7,0.1,0,0,0.1-0.1,0.1-0.1,0.1-0.1,0.9-0.6,1.7-1,0.4-0.3,0.8-0.5,1.1-0.7,0.1,0,0.2-0.1,0.3-0.2h0.1l0.1-0.1c0.2-0.1,0.3-0.5,0.1-0.7-4.5-7.8-13.3-12.971-23.4-12.971-14.8,0-26.7,11.071-26.7,24.771,0,13.7,11.9,24.7,26.7,24.7,9.6,0,25.4-8.1,29.9-12.2,1.6-1.1,3.1-2.4,4.9-3.2v-41.561h-4.9v15.361z").hide().attr({fill:(g=
this.opts.logoColor)!=null?g:"#AA5128","stroke-width":0,"stroke-opacity":0,opacity:0.25,cx:d+f/2,cy:h-b/2}).scale(c[0],c[1],d,h).show()}};e.prototype.drawFootnote=function(b){var a;b!=null||(b=(a=this.opts.footnote)!=null?a:"");if(!b.match(/^\s*$/)){this.footnote=this.r.sai.prim.wrappedText(this.x+this.padding.left,this.y-this.padding.bottom,this.w,b," ");b=this.footnote.getBBox().height;this.padding.bottom+=b+10;return this.footnote.translate(0,-b)}};e.prototype.render=function(){this.opts.simple&&
this.renderPlots!=null?this.renderPlots():this.renderFull();return this};e.prototype.renderFull=function(){this.plot!=null||(this.plot=new Sai.Plot(this.r));this.plot.render();return this};e.prototype.showError=function(b){var a,c;return this.r.text(this.x+this.padding.left+((a=this.pw)!=null?a:this.w)/2,this.y-this.padding.bottom-((c=this.ph)!=null?c:this.h)/2,b)};e.prototype.setColors=function(b){var a,c;this.colors!=null||(this.colors={});for(a in b){c=this.renames[a];if(c in this.data)this.colors[c]=
b[a]}return this};e.prototype.setColor=function(b,a){this.colors!=null||(this.colors={});this.colors[this.renames[b]]=a;return this};e.prototype.normalizedHeight=function(b,a){var c,f;if(((c=this.ndata[a])!=null?c.__YVALS__:void 0)!=null){f=this.ndata[a].__YVALS__[0];c=this.ndata[a].__YVALS__[this.ndata[a].__YVALS__.length-1];if(b<f)b=f;else if(b>c)b=c;return(b-f)/(c-f)}};e.prototype.drawGuideline=function(b,a){var c;if(a==null)a="all";if(((c=this.ndata[a])!=null?c.__YVALS__:void 0)!=null){c=this.normalizedHeight(b,
a);this.guidelines!=null||(this.guidelines=this.r.set());c=new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,{guideline:[[0,c],[1,c]]});c.render({guideline:"#ccc"});return this.guidelines.push(c.set)}};e.prototype.drawLegend=function(b){var a,c,f,d,h;b!=null||(b=this.colors);if(b){c={};f={};for(a in b)if(a!==this.__LABELS__){c[a]=b[a];f[a]="black";if(((d=this.opts.groups)!=null?d.right:void 0)!=null)if(D.call(this.opts.groups.right,a)>=0)f[a]=this.ndata.left!=null?(h=this.colors.__RIGHTAXIS__)!=
null?h:"blue":"black"}this.legend=this.r.sai.prim.legend(this.x,this.y-this.padding.bottom,this.w,c,f);b=this.legend.getBBox();if(this.legend.length>0)this.padding.bottom+=b.height+15;return this.legend.translate((this.w-b.width)/2,0)}};e.prototype.drawTitle=function(){if(this.opts.title!=null){this.title=this.r.text(this.x+this.w/2,this.y-this.h,this.opts.title).attr({"font-size":20});this.title.translate(0,this.title.getBBox().height/2);return this.padding.top+=this.title.getBBox().height+5}};e.prototype.setupInfoSpace=
function(){this.info_y=this.y-this.h+this.padding.top;this.info_x=this.x+this.padding.left;this.info_w=this.w-this.padding.left-this.padding.right;return this.padding.top+=30};e.prototype.drawInfo=function(b,a){var c,f;if(a==null)a=true;b!=null||(b=this.default_info!=null?this.default_info():{});if(a)this.info_data={};this.info&&this.info.remove();for(c in b)c.match("^__")||(this.info_data[c]=(f=b[c])!=null?f:"(no data)");return this.info=this.r.sai.prim.info(this.info_x,this.info_y,this.info_w,this.info_data)};
e.prototype.getIndex=function(b){b=Sai.util.transformCoords(b,this.r.canvas).x;return Math.round((this.data[this.__LABELS__].length-1)*(b-this.px)/this.pw)};e.prototype.drawHistogramLegend=function(b,a){var c,f,d,h,g,i,k,l,m,o,n,p;a!=null||(a=this.colors);this.histogramLegend=this.r.set();h=Math.max(0.1*(this.h-this.padding.bottom-this.padding.top),50);l=Math.min(150,(this.w-this.padding.left-this.padding.right-20)/b.length);g=0;for(m=b.length;0<=m?g<m:g>m;0<=m?g+=1:g-=1){k=b[g];c=[];f=0;for(d=this.ndata[k][k].length;0<=
d?f<d:f>d;0<=d?f+=1:f-=1)this.ndata[k][k][f]!=null&&c.push(this.ndata[k][k][f][1]);f=c;if(((o=this.bounds)!=null?o[k]:void 0)!=null){c=this.bounds[k];d=c[0];c=c[1]}else{n=this.data[k];p=[];c=0;for(i=n.length;c<i;c++){d=n[c];d!=null&&p.push(d)}d=p;c=[Math.min.apply(Math,d),Math.max.apply(Math,d)];d=c[0];c=c[1]}c=this.getYAxisVals(d,c,true);d=c[0];i=c[c.length-1];c=a[k];this.histogramLegend.push(f=this.r.sai.prim.histogram(this.x+g*l,this.y-this.padding.bottom,l*0.8,h,f,d,i,k,typeof c==="object"?[c.__LOW__,
c.__HIGH__]:[c],"white",this.opts.fromWhite));this.opts.interactive&&this.setupHistogramInteraction(f,k)}this.histogramLegend.translate((this.w-this.padding.left-this.padding.right-this.histogramLegend.getBBox().width)/2,0);return this.padding.bottom+=h+5};e.prototype.setupHistogramInteraction=function(){return null};return e}();Sai.LineChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.nonNegativeGroups=function(){return this.opts.stacked?["all",
"left","right"]:[]};e.prototype.dataGroups=function(){var b,a,c,f,d,h;b=e.__super__.dataGroups.apply(this,arguments);if(((a=this.opts.groups)!=null?a.left:void 0)!=null&&((c=this.opts.groups)!=null?c.right:void 0)!=null){d=this.opts.groups.left;h=[];c=0;for(f=d.length;c<f;c++){a=d[c];this.caresAbout(a)&&a in this.data&&h.push(a)}b.left=h;d=this.opts.groups.right;h=[];c=0;for(f=d.length;c<f;c++){a=d[c];this.caresAbout(a)&&a in this.data&&h.push(a)}b.right=h}return b};e.prototype.renderPlots=function(){var b,
a,c,f,d,h,g,i;this.px==null&&this.setPlotCoords();this.drawBG();this.drawLogo();c="right"in this.ndata;b=this.opts.stacked!=null?this.stackedNdata:this.ndata;a=this.opts.area?Sai.AreaPlot:Sai.LinePlot;if(c){if(((f=this.ndata.left)!=null?f.__YVALS__[0]:void 0)<0)this.drawGuideline(0,"left");if(((d=this.ndata.right)!=null?d.__YVALS__[0]:void 0)<0)this.drawGuideline(0,"right")}else this.ndata.all.__YVALS__[0]<0&&this.drawGuideline(0,"all");this.plots=[];if(c){if(b.left!=null)this.plots.push((new a(this.r,
this.px,this.py,this.pw,this.ph,b.left)).render(this.colors,(h=this.opts.lineWidth)!=null?h:2,this.opts.stacked,this.getBaseline("left")));if(b.right!=null)return this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,b.right)).render(this.colors,(g=this.opts.lineWidth)!=null?g:2,this.opts.stacked,this.getBaseline("right")))}else return this.plots.push((new a(this.r,this.px,this.py,this.pw,this.ph,b.all)).render(this.colors,(i=this.opts.lineWidth)!=null?i:2,this.opts.stacked,this.getBaseline("all")))};
e.prototype.renderFull=function(){var b,a,c,f,d,h,g;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawLegend();"right"in this.ndata?this.addAxes(["left","right"]):this.addAxes(["all"]);this.renderPlots();this.plotSets=this.r.set();d=this.plots;c=0;for(f=d.length;c<f;c++){b=d[c];this.plotSets.push(b.set)}this.dots=this.r.set();for(a in this.ndata.all)if(a!=="__YVALS__")this.dots.push(this.r.circle(0,0,4).attr({fill:(h=(g=this.colors)!=null?g[a]:void 0)!=null?h:"black"}).hide());b=
this.r.set().push(this.bg,this.plotSets,this.dots,this.logo,this.guidelines).mousemove(w(function(i){var k,l,m,o,n,p,q,s,r,t;l=this.getIndex(i);i={};if(((s=this.data[this.__LABELS__])!=null?s.length:void 0)>l&&l>=0){i[this.__LABELS__]=this.data[this.__LABELS__][l];for(n in this.ndata.all)if(this.data[n]!=null)i[n]=this.data[n][l]}this.drawInfo(i);k=0;s=[];for(n in this.ndata.all)n!=="__YVALS__"&&s.push(function(){r=this.plots;t=[];p=0;for(q=r.length;p<q;p++){m=r[p];if(n in m.dndata){o=m.dndata[n][l];
o!=null?this.dots[k].attr({cx:o[0],cy:o[1]}).show().toFront():this.dots[k].hide();t.push(k++)}}return t}.call(this));return s},this)).mouseout(w(function(){this.drawInfo({},true);return this.dots.hide()},this));this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}();Sai.StreamChart=function(){function e(b,a,c,f,d,h,g,i){this.r=b;this.x=a;this.y=c;this.w=f;this.h=d;this.__LABELS__=g;this.opts=i;this.opts.stacked=true;e.__super__.constructor.apply(this,arguments)}j(e,
Sai.LineChart);e.prototype.getStackedMax=function(){return e.__super__.getStackedMax.apply(this,arguments)/2};e.prototype.getStackedMin=function(b,a){var c,f;c=e.__super__.getStackedMin.apply(this,arguments);f=this.getStackedMax(b,a);return c-f};e.prototype.normalize=function(b){var a,c,f,d,h,g,i,k,l,m,o,n,p,q,s,r;e.__super__.normalize.apply(this,arguments);c=this.dataGroups(this.data);this.baselines!=null||(this.baselines={});q=[];for(a in this.stackedNdata){d=this.normalizedHeight(0,a!=null?a:"all");
this.normalizedHeight(this.getStackedMin(b,c[a]),a);this.baselines[a]=[];var t=this.ndata[a];n=this.ndata[a].__YVALS__;s=[];m=0;for(o=n.length;m<o;m++){l=n[m];s.push(Math.abs(l))}t.__YVALS__=s;for(i in this.stackedNdata[a])k=i;q.push(function(){r=[];f=0;for(p=this.stackedNdata[a][i].length;0<=p?f<p:f>p;0<=p?f+=1:f-=1){h=(this.stackedNdata[a][k][f][1]-d)/2;for(i in this.stackedNdata[a]){g=this.stackedNdata[a][i][f];if(g!=null)g[1]-=h}r.push(this.baselines[a].push([g[0],d-h]))}return r}.call(this))}return q};
e.prototype.addAxes=function(b,a){if(a==null)a={};"left"in a||(a.left="magnitude");return e.__super__.addAxes.call(this,b,a)};e.prototype.getBaseline=function(b){return this.baselines[b]};return e}();Sai.Sparkline=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.dataGroups=function(){return{data:["data"]}};e.prototype.renderFull=function(){this.drawBG();this.plots=this.r.set();this.plots.push((new Sai.LinePlot(this.r,this.x,this.y,this.w,this.h,this.ndata.data)).render({data:this.colors&&
this.colors[series]||"black"},1).set);return this};return e}();Sai.BarChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.getMin=function(){return Math.min(e.__super__.getMin.apply(this,arguments),0)};e.prototype.groupsToNullPad=function(){var b,a;a=[];for(b in this.dataGroups())a.push(b);return a};e.prototype.tooMuchData=function(){var b,a,c;a=this.w/3;b=0;for(c in this.data)if(c!==this.__LABELS__){b+=this.data[c].length;if(this.opts.stacked)break}return b>
a};e.prototype.renderPlots=function(){var b,a,c,f,d;this.px==null&&this.setPlotCoords();this.drawLogo();this.drawBG();if(this.tooMuchData()){this.showError("Sorry, the chart isn't wide enough to plot this much data.\n \nPossible solutions include downsampling your data\n (e.g. weekly instead of daily) or using a line chart");return this}if("all"in this.ndata){this.guidelines=this.r.set();d=this.ndata.all.__YVALS__.slice(1,this.ndata.all.__YVALS__.length-1);a=0;for(c=d.length;a<c;a++){b=d[a];this.drawGuideline(b)}}this.plots=
this.r.set();b={};c={};c[this.__LABELS__]=this.data[this.__LABELS__];a=this.opts.stacked!=null?this.stackedNdata:this.ndata;for(f in a.all)if(!(f.match("^__")||f===this.__LABELS__)){b[f]=a.all[f];c[f]=this.data[f]}return this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph,b,c)).render(this.opts.stacked!=null,this.normalizedHeight(0,"all"),this.colors,this.opts.interactive&&!this.opts.simple,this.drawInfo,this.__LABELS__).set)};e.prototype.renderFull=function(){var b;this.drawTitle();
this.setupInfoSpace();this.drawFootnote();this.drawLegend();this.addAxes(["all"]);this.renderPlots();b=this.r.set().push(this.plots,this.bg,this.logo,this.guidelines);this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}();Sai.StockChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.semanticRenamePatterns={open:/^open$/i,close:/^close$/i,high:/^high$/i,low:/^low$/i,volume:/^vol(ume)?$/i};e.prototype.groupsToNullPad=
function(){return["prices","volume","__META__"]};e.prototype.dataGroups=function(b){var a,c,f,d;a={__META__:[this.__LABELS__]};f=(d=this.semanticRenames.volume)!=null?d:"volume";if(f in this.data)a.volume=[f];for(c in b)if(this.caresAbout(c)&&c!==this.__LABELS__&&c!==f){a.prices!=null||(a.prices=[]);a.prices.push(c)}return a};e.prototype.nonNegativeGroups=function(){return["volume"]};e.prototype.renderPlots=function(){var b,a,c,f,d,h,g,i,k,l,m,o;this.px==null&&this.setPlotCoords();d=(a=this.semanticRenames.open)!=
null?a:"open";a=(c=this.semanticRenames.close)!=null?c:"close";c=(f=this.semanticRenames.high)!=null?f:"high";f=(k=this.semanticRenames.low)!=null?k:"low";k=(o=this.semanticRenames.volume)!=null?o:"volume";this.colors!=null||(this.colors={});(h=this.colors).up!=null||(h.up="black");(i=this.colors).down!=null||(i.down="red");(l=this.colors).vol_up!=null||(l.vol_up="#666666");(m=this.colors).vol_down!=null||(m.vol_down="#cc6666");this.drawLogo();this.drawBG();if(this.ndata.prices!=null&&d in this.ndata.prices&&
a in this.ndata.prices&&c in this.ndata.prices&&f in this.ndata.prices){this.ndata.prices.__YVALS__[0]<0&&this.drawGuideline(0,"prices");this.plots=this.r.set();i={up:[],down:[]};h={};for(b in this.ndata.prices)b.match("^__")||b===this.__LABELS__||(h[b]=this.data[b]);if(this.data[k]!=null)h.vol=this.data[k];if("volume"in this.ndata){b=0;for(l=this.ndata.volume[k].length;0<=l?b<l:b>l;0<=l?b+=1:b-=1)if(this.ndata.volume[k][b]!==null)if(b&&this.ndata.prices[a][b-1]&&this.ndata.prices[a][b][1]<this.ndata.prices[a][b-
1][1]){i.down.push(this.ndata.volume[k][b]);i.up.push([this.ndata.volume[k][b][0],0])}else{i.up.push(this.ndata.volume[k][b]);i.down.push([this.ndata.volume[k][b][0],0])}else{i.up.push([0,0]);i.down.push([0,0])}this.plots.push((new Sai.BarPlot(this.r,this.px,this.py,this.pw,this.ph*0.2,i,h)).render(true,this.normalizedHeight(0,"volume"),{up:this.colors.vol_up,down:this.colors.vol_down}).set)}this.plots.push((new Sai.CandlestickPlot(this.r,this.px,this.py,this.pw,this.ph,{open:this.ndata.prices[d],
close:this.ndata.prices[a],high:this.ndata.prices[c],low:this.ndata.prices[f]},h)).render(this.colors,Math.min(5,this.pw/this.ndata.prices[d].length-2)).set);b={};for(g in this.ndata.prices)g===d||g===a||g===c||g===f||g.match("^__")||g===this.__LABELS__||(b[g]=this.ndata.prices[g]);return this.plots.push((new Sai.LinePlot(this.r,this.px,this.py,this.pw,this.ph,b)).render(this.colors).set)}else this.showError("This chart requires data series named\nopen, close, high, and low.\n \nOnce you add series with these names, the chart will display.")};
e.prototype.renderFull=function(){var b,a,c,f,d,h,g,i,k,l;this.drawTitle();this.setupInfoSpace();this.drawFootnote();h=(a=this.semanticRenames.open)!=null?a:"open";a=(f=this.semanticRenames.close)!=null?f:"close";f=(d=this.semanticRenames.high)!=null?d:"high";d=(b=this.semanticRenames.low)!=null?b:"low";k=(i=this.semanticRenames.volume)!=null?i:"volume";b={};i=false;for(g in this.ndata.prices)if(g!==h&&g!==a&&g!==f&&g!==d&&!(g.match("^__")||g===this.__LABELS__)){b[g]=((l=this.colors)!=null?l[g]:void 0)||
"black";i=true}i&&this.drawLegend(b);this.addAxes(["prices"]);this.renderPlots();c=this.pw/(this.data[this.__LABELS__].length-1);this.glow=this.r.rect(this.px-c/2,this.py-this.ph,c,this.ph).attr({fill:"0-"+this.opts.bgcolor+"-#DDAA99-"+this.opts.bgcolor,"stroke-width":0,"stroke-opacity":0}).toBack().hide();this.bg.toBack();this.r.set().push(this.bg,this.plots,this.logo,this.glow,this.guidelines).mousemove(w(function(m){var o,n,p,q,s;m=this.getIndex(m);o={};if(this.data[this.__LABELS__][m]!=null)o[this.__LABELS__]=
this.data[this.__LABELS__][m];n=false;for(p in this.ndata.prices)if(!(p.match("^__")||p===this.__LABELS__))if(((q=this.data[p])!=null?q[m]:void 0)!=null){o[p]=this.data[p][m];n=true}if(((s=this.data[k])!=null?s[m]:void 0)!=null){o[k]=this.data[k][m];n=true}this.drawInfo(o);if(n)return this.glow.attr({x:this.px+c*(m-0.5)}).show()},this)).mouseout(w(function(){this.drawInfo({},true);return this.glow.hide()},this));return this};return e}();Sai.GeoChart=function(){function e(){this.renderPlots=w(this.renderPlots,
this);e.__super__.constructor.apply(this,arguments)}j(e,Sai.Chart);e.prototype.plotType=Sai.GeoPlot;e.prototype.interactiveHistogram=true;e.prototype.getMax=function(b){return Math.max.apply(Math,b)};e.prototype.getMin=function(b){return Math.min.apply(Math,b)};e.prototype.normalize=function(b){var a,c,f,d,h,g,i,k,l,m,o,n,p,q,s;this.ndata={};this.bounds={};d={};g={};for(l in b)if(!(l.match("^__")||l===this.__LABELS__))if(b[l]!=null){n=b[l];q=[];m=0;for(o=n.length;m<o;m++){a=n[m];a!=null&&q.push(a)}a=
q;d[l]=this.getMax(a,l);if(!(typeof i!="undefined"&&i!==null)||d[l]>i)i=d[l];g[l]=this.getMin(a,l);if(!(typeof k!="undefined"&&k!==null)||g[l]<k)k=g[l]}a=[];for(l in b)if(!(l.match("^__")||l===this.__LABELS__))if(b[l]!=null){if(this.opts.groupedNormalization){f=i;h=k}else{f=d[l];h=g[l]}this.bounds[l]=[h,f];this.ndata[l]={};a.push(this.ndata[l][l]=function(){s=[];c=0;for(p=b[l].length;0<=p?c<p:c>p;0<=p?c+=1:c-=1)s.push(b[l][c]!=null?[c/(b[l].length-1),(b[l][c]-h)/(f-h)]:null);return s}())}return a};
e.prototype.dataGroups=function(b){var a,c;a=[];for(c in b)if(c.match("^__")||c===this.__LABELS__)a.push(c);a={__META__:a};for(c in b)c.match("^__")||c===this.__LABELS__||(a[c]=[c]);return a};e.prototype.setupHistogramInteraction=function(b,a){return b.click(w(function(){return this.renderPlots(a)},this)).hover(w(function(c){return w(function(){c.attr({"fill-opacity":0.75});return this.drawInfo({"Click to display on map":a})},this)},this)(b),w(function(c){return w(function(){c.attr({"fill-opacity":1});
return this.drawInfo()},this)},this)(b))};e.prototype.renderPlots=function(b){var a,c;this.px==null&&this.setPlotCoords();if((a=this.bg)!=null)a.remove();if((a=this.logo)!=null)a.remove();if((a=this.geoPlot)!=null)a.set.remove();this.drawBG();this.drawLogo();a={};for(c in this.ndata)a[c]=this.ndata[c][c];this.geoPlot=(new this.plotType(this.r,this.px,this.py,this.pw,this.ph,a,this.data,{fromWhite:this.opts.fromWhite})).render(this.colors||{},this.data.__MAP__,this.__LABELS__,b!=null?b:this.data.__DEFAULT__,
this.opts.bgcolor,this.opts.interactive&&!this.opts.simple,this.drawInfo);return this};e.prototype.default_info=function(){return{"":this.opts.interactive?"Click histogram below to change map display":""}};e.prototype.renderFull=function(){var b,a,c;this.drawTitle();this.setupInfoSpace();this.drawFootnote();this.drawHistogramLegend(function(){c=[];for(a in this.data)a.match("^__")||a===this.__LABELS__||c.push(a);return c}.call(this));this.setPlotCoords();this.drawInfo();this.renderPlots();b=this.r.set().push(this.geoPlot.set,
this.bg,this.logo,this.info,this.footnote);this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}();Sai.ChromaticGeoChart=function(){function e(){e.__super__.constructor.apply(this,arguments)}j(e,Sai.GeoChart);e.prototype.plotType=Sai.ChromaticGeoPlot;e.prototype.interactiveHistogram=false;e.prototype.default_info=function(){return{}};e.prototype.setupHistogramInteraction=function(){return false};return e}();Sai.ScatterChart=function(){function e(){e.__super__.constructor.apply(this,
arguments)}j(e,Sai.Chart);e.prototype.dataGroups=function(b){var a,c;a=[];for(c in b)if(c.match("^__")||c===this.__LABELS__)a.push(c);a={__META__:a};for(c in b)c.match("^__")||c===this.__LABELS__||(a[c]=[c]);return a};e.prototype.renderPlots=function(){var b,a,c,f,d,h,g;this.px==null&&this.setPlotCoords();b=(h=(g=this.opts.colors)!=null?g:this.colors)!=null?h:["black","white"];h=(d=this.opts.stroke_opacity)!=null?d:[0,1];d=(c=this.opts.stroke_colors)!=null?c:["black","black"];c=(a=this.opts.radius)!=
null?a:[4,12];this.drawLogo();this.drawBG();a={};for(f in this.ndata)a[f]=this.ndata[f][f];this.plots=this.r.set();this.plots.push((new Sai.ScatterPlot(this.r,this.px,this.py,this.pw,this.ph,a,this.data)).render(this.opts.mappings,b,c,h,d,this.opts.interactive&&!this.opts.simple,this.drawInfo).set);return this};e.prototype.renderFull=function(){var b,a,c,f,d,h;this.drawTitle();this.setupInfoSpace();this.drawFootnote();a=(h=(d=this.opts.colors)!=null?d:this.colors)!=null?h:["black","white"];h=(f=this.opts.stroke_colors)!=
null?f:["black","black"];d=[];f={};if(a instanceof Array){d.push(this.opts.mappings.color);f[this.opts.mappings.color]={__LOW__:a[0],__HIGH__:a[1]}}else{typeof legend_colors!="undefined"&&legend_colors!==null||(legend_colors={});c=true;for(b in a)legend_colors[b]=a[b]}if(!(h instanceof Array)){typeof legend_colors!="undefined"&&legend_colors!==null||(legend_colors={});c=true;for(b in a)legend_colors[b]=h[b]}d.length&&this.drawHistogramLegend(d,f);c&&this.drawLegend(a);this.__LABELS__="__XVALS__";
this.data.__XVALS__=this.ndata[this.opts.mappings.x].__YVALS__;this.addAxes([this.opts.mappings.y],{left:this.opts.mappings.y,bottom:this.opts.mappings.x});this.renderPlots();b=this.r.set().push(this.plots,this.bg,this.logo,this.info,this.footnote,this.histogramLegend,this.legend);this.opts.href&&b.attr({href:this.opts.href,target:"_blank"});return this};return e}()}).call(this);
